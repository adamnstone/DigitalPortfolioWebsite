
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../disability-forewarning-system/">
      
      
      <link rel="icon" href="../../assets/images/favicon/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Expert Network Map - Adam Stone Digital Portfoio</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-Z0ZXQ8VL5C"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-Z0ZXQ8VL5C",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-Z0ZXQ8VL5C",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#expert-network-map" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Adam Stone Digital Portfoio" class="md-header__button md-logo" aria-label="Adam Stone Digital Portfoio" data-md-component="logo">
      
  <img src="../../assets/images/favicon/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Adam Stone Digital Portfoio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Expert Network Map
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/adamnstone/DigitalPortfolioWebsite" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    adamnstone/DigitalPortfolioWebsite
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  STEM

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../arts/" class="md-tabs__link">
          
  
    
  
  Arts

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../advocacy/" class="md-tabs__link">
          
  
    
  
  Advocacy

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Adam Stone Digital Portfoio" class="md-nav__button md-logo" aria-label="Adam Stone Digital Portfoio" data-md-component="logo">
      
  <img src="../../assets/images/favicon/logo.png" alt="logo">

    </a>
    Adam Stone Digital Portfoio
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/adamnstone/DigitalPortfolioWebsite" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    adamnstone/DigitalPortfolioWebsite
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    STEM
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            STEM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="./" class="md-nav__link md-nav__link--active">
              
  
  <span class="md-ellipsis">
    Expert Network Map
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Expert Network Map
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../disability-forewarning-system/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Disability Forewarning System
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Disability Forewarning System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/final-project-planning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/cupholder-mechanism/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cupholder Mechanism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/cupholder-electronics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cupholder Electronics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/display-mechanics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Display Mechanism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/display-electronics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Display Electronics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/motor-calculations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Motor Calculations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/wireless-communication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wireless Communication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/combining-electronics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Combining Electronics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/project-requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Summary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disability-forewarning-system/project-reflection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Final Project: Reflection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../fab-academy/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Fab Academy
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Fab Academy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../panopticom/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Panopticom
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Panopticom
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../bridge-builder/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Bridge Builder
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Bridge Builder
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../test-generator/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Test Generator
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Test Generator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../arts/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Arts
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Arts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../advocacy/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Advocacy
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Advocacy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-description" class="md-nav__link">
    <span class="md-ellipsis">
      Project Description
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Project Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    <span class="md-ellipsis">
      Background
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-hypothesis-and-prototype" class="md-nav__link">
    <span class="md-ellipsis">
      Problem, Hypothesis, and Prototype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pitch" class="md-nav__link">
    <span class="md-ellipsis">
      Pitch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Project Execution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Project Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-data-collection" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Data Collection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-ai-sorting-data-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: AI, Sorting Data &amp; Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-data-visualization" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Data Visualization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Documentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-data-collection_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Data Collection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1: Data Collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scraping-overview-and-pagination-concerns" class="md-nav__link">
    <span class="md-ellipsis">
      Scraping Overview and Pagination Concerns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Data Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subject-area-keywords" class="md-nav__link">
    <span class="md-ellipsis">
      Subject-Area Keywords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gitlab-structure" class="md-nav__link">
    <span class="md-ellipsis">
      GitLab Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-code" class="md-nav__link">
    <span class="md-ellipsis">
      Full Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-ai-sorting-data-analysis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: AI, Sorting Data &amp; Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2: AI, Sorting Data & Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#training-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      Training the Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classifying-references" class="md-nav__link">
    <span class="md-ellipsis">
      Classifying References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Network Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-data-visualization_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Data Visualization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Data Visualization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library-and-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Library and Data Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transforming-data" class="md-nav__link">
    <span class="md-ellipsis">
      Transforming Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#name-conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      Name Conflicts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Code Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualization-constants-and-global-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Visualization Constants and Global Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-js" class="md-nav__link">
    <span class="md-ellipsis">
      App JS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-data" class="md-nav__link">
    <span class="md-ellipsis">
      Update Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lab-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Lab Filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimum-times-referenced-dial" class="md-nav__link">
    <span class="md-ellipsis">
      Minimum Times Referenced Dial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subject-area-carousel" class="md-nav__link">
    <span class="md-ellipsis">
      Subject-Area Carousel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#year-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Year Selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overlay-text" class="md-nav__link">
    <span class="md-ellipsis">
      Overlay Text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-files-minification-and-google-analytics" class="md-nav__link">
    <span class="md-ellipsis">
      Other Files, Minification, and Google Analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#html" class="md-nav__link">
    <span class="md-ellipsis">
      HTML
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#css" class="md-nav__link">
    <span class="md-ellipsis">
      CSS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updates" class="md-nav__link">
    <span class="md-ellipsis">
      Updates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-overview" class="md-nav__link">
    <span class="md-ellipsis">
      High-Level Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="High-Level Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-data_1" class="md-nav__link">
    <span class="md-ellipsis">
      Update Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-data" class="md-nav__link">
    <span class="md-ellipsis">
      Format Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples-of-automated-commits" class="md-nav__link">
    <span class="md-ellipsis">
      Examples of Automated Commits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#offshoot-projects" class="md-nav__link">
    <span class="md-ellipsis">
      Offshoot Projects
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<div><h1 id="expert-network-map">Expert Network Map</h1>
<h2 id="introduction">Introduction</h2>
<p>While enrolled in <a href="../fab-academy/">Fab Academy</a>, I could easily identify experts within the Charlotte Fab Lab when I faced technical roadblocks. However, subject area experts were difficult to locate beyond my local lab, and vast amounts of helpful documentation shared by the global Fab community were hard to find. To resolve this problem, I created the <code>Expert Network Map</code>, a software project consisting of two components: a network analysis of the Fab Academy community and an interactive visualization of the network. </p>
<p>I executed the project in three distinct phases: I wrote a script to collect the data, designed a text-classification AI model to sort links by subject area for analysis, and utilized D3JS to present the findings in an interactive visualization.</p>
<p><a href="https://adamnstone.github.io/ExpertNetworkMap-ANS/public/">Here is a link to the <code>Expert Network Map</code>!</a> <em>(be sure to use Chrome on a computer)</em></p>
<p>In July 2023, I virtually presented the <code>Expert Network Map</code> at the <a href="https://fab23.fabevent.org/">International Fab Lab Conference and Symposium</a>, the largest digital fabrication event in the world. The Expert Network Map is live and used by over 500 students. Find my presentation below.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/F12IUwdAcgs?si=glPwne61UZXOQMvC&amp;hd=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>For a more detailed description of the project, please read below.</p>
<p>Thank you very much to <a href="https://fabacademy.org/archives/2013/students/sanchez.francisco/">Francisco Sanchez Arroyo</a> for all of his guidance and help, as well as to <a href="https://www.visualcinnamon.com/">Nadieh Bremer</a> for her advice on visualization.</p>
<h2 id="project-description">Project Description</h2>
<h3 id="background">Background</h3>
<p>The <code>Expert Network Map</code> is an analysis of 1,000+ members of the Fab Academy community to locate hidden expertise in 17 subject areas and an interactive visualization of the network. Fab Academy is a digital fabrication course focused on rapid-prototyping led by MIT Professor Neil Gershenfeld. All Fab Academy students keep a documentation website detailing the process of completing projects, and students are encouraged to seek out others’ documentation to navigate technical roadblocks. For an example of a documentation website, see mine <a href="https://fabacademy.org/2023/labs/charlotte/students/adam-stone/">here</a>. To give credit to content referenced, students add links in their own websites to the documentation websites they found helpful. See the box below for an example in my documentation website where I link to <a href="https://fabacademy.org/2022/labs/charlotte/students/nidhie-dhiman/">Nidhie Dhiman</a>'s documentation to give her credit.</p>
<p><img alt="Reference Example" src="../../assets/images/stem/expert-network-map/reference-example.jpg" style="border-style: solid;"></p>
<h3 id="problem-hypothesis-and-prototype">Problem, Hypothesis, and Prototype</h3>
<p>While I knew who had helpful documentation in my Charlotte Fab community, with over 1,000 documentation websites globally, there was a lot of untapped expertise I couldn’t locate. I recognized that if expert documentation could quickly be identified, all students would be able to work more efficiently. </p>
<p>I hypothesized that the more times students’ documentation websites were referenced by their peers in a subject area, the more expertise they possessed. As a test, I ran a network analysis of the 13 students in the Charlotte Fab community, quantifying the number of times each student’s documentation website was referenced by their peers. The analysis yielded promising results: some students had significantly more references than the rest of the peer group, and student were frequently linking each other's websites. </p>
<p><img alt="Test Graph" src="../../assets/images/stem/expert-network-map/test-graph.jpg"></p>
<p>Read more about my initial prototype here: <a href="https://fabacademy.org/2023/labs/charlotte/students/adam-stone/lessons/side-projects/lab-link-graph/#iteration-1">1st iteration</a> and <a href="https://fabacademy.org/2023/labs/charlotte/students/adam-stone/lessons/side-projects/lab-link-graph/#iteration-2">2nd iteration</a>.</p>
<h3 id="pitch">Pitch</h3>
<p>I showed the results to my local lab leader, <a href="https://www.linkedin.com/in/tomdubick">Mr. Dubick</a>, who suggested that I talk to Professor Gershenfeld and propose analyzing the global Fab community network to identify experts by topic. Professor Gershenfeld believed the network analysis would be incredibly valuable and connected me with a mentor in Spain, <a href="https://www.fablabs.io/users/francisco">Francisco Sanchez Arroyo</a>, who advised me on the best tools and structure to use.</p>
<h2 id="project-execution">Project Execution</h2>
<p>I executed the project in three distinct phases: I wrote a script to collect the data, designed a text-classification AI model to sort links by subject area, and utilized D3JS to present the data in an interactive visualization.</p>
<h3 id="step-1-data-collection">Step 1: Data Collection</h3>
<p>For the first step, I wrote a <code>Python</code> script to scrape all Fab Academy students’ documentation website GitLab repos over the past six years using the <a href="https://python-gitlab.readthedocs.io/en/stable/api-usage.html"><code>Python-GitLab API</code></a> and scan for URL references to other student websites using <a href="https://docs.python.org/3/library/re.html"><code>RegEx</code></a>. I also stored 1,000 characters before and after to use for classification and used Pandas to create a reference matrix that structured the data for analysis. My program yielded a database of ~29,000 references.</p>
<h3 id="step-2-ai-sorting-data-analysis">Step 2: AI, Sorting Data &amp; Analysis</h3>
<p>After the data were collected, I knew I had a significant challenge. For the network analysis to be useful, I needed to calculate the number of times a student’s documentation was referenced for a specific subject area. I had collected tens of thousands of pages of documentation text that used vastly different naming conventions for each subject area (for example, "3D Scanning &amp; Printing" vs "3d.printing.and.scanning"), and much of the text understandably had spelling errors given that many Fab Academy students do not speak English as a first language. To overcome the challenge of categorizing references by subject area with no consistent naming convention, I created a text-classification neural network. Using a list of keywords that were often associated with a Fab Academy subject-area, for example "PLA filament" for "3D Printing," I was able to classify ~13,000 of the ~29,000 references based on the surrounding text. Find a <code>JSON</code> file of the keywords I used for each subject area below.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">"Prefab"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nt">"Computer-Aided Design"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="s2">"Computer-Aided Design"</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="s2">"freecad"</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="nt">"Computer-Controlled Cutting"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="s2">"Laser Cut"</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="s2">"CCC week"</span><span class="p">,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="s2">"Computer-Controlled Cutting"</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="nt">"Embedded Programing"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="s2">"Embedded Programming"</span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="s2">"MicroPython"</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="s2">"C++"</span><span class="p">,</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="s2">"pythoncpp"</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="s2">"ino"</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="s2">"Arduino IDE"</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="s2">"programming week"</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">  </span><span class="nt">"3D Scanning and Printing"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">    </span><span class="s2">"3D Printing"</span><span class="p">,</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">    </span><span class="s2">"3D Scanning"</span><span class="p">,</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="s2">"TPU"</span><span class="p">,</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">    </span><span class="s2">"PETG"</span><span class="p">,</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">    </span><span class="s2">"filament"</span><span class="p">,</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">    </span><span class="s2">"Prusa"</span><span class="p">,</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="w">    </span><span class="s2">"3d printing week"</span><span class="p">,</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">    </span><span class="s2">"polyCAM"</span><span class="p">,</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">    </span><span class="s2">"3D Scanning and Printing"</span><span class="p">,</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">    </span><span class="s2">"3d printers"</span><span class="p">,</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="w">    </span><span class="s2">"3d printer"</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">  </span><span class="nt">"Electronics Design"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">    </span><span class="s2">"EagleCAD"</span><span class="p">,</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">    </span><span class="s2">"Eagle"</span><span class="p">,</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">    </span><span class="s2">"KiCAD"</span><span class="p">,</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">    </span><span class="s2">"Routing"</span><span class="p">,</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">    </span><span class="s2">"Auto-Route"</span><span class="p">,</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">    </span><span class="s2">"Trace"</span><span class="p">,</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="w">    </span><span class="s2">"Footprint"</span><span class="p">,</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="w">    </span><span class="s2">"electronic design"</span><span class="p">,</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="w">    </span><span class="s2">"Electronics Design"</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="w">  </span><span class="nt">"Computer-Controlled Machining"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">    </span><span class="s2">"CNC"</span><span class="p">,</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="w">    </span><span class="s2">"Shopbot"</span><span class="p">,</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="w">    </span><span class="s2">"Computer-Controlled Machining"</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="w">  </span><span class="nt">"Electronics Production"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="w">    </span><span class="s2">"Mill"</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="w">    </span><span class="s2">"Milling"</span><span class="p">,</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="w">    </span><span class="s2">"copper"</span><span class="p">,</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="w">    </span><span class="s2">"electronic production"</span><span class="p">,</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="w">    </span><span class="s2">"Electronics Production"</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="w">  </span><span class="nt">"Mechanical Design, Machine Design"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="w">    </span><span class="s2">"Machine week"</span><span class="p">,</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="w">    </span><span class="s2">"actuation and automation"</span><span class="p">,</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="w">    </span><span class="s2">"Mechanical Design, Machine Design"</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="w">  </span><span class="nt">"Input Devices"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="w">    </span><span class="s2">"Input Devices"</span><span class="p">,</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="w">    </span><span class="s2">"Input Device"</span><span class="p">,</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="w">    </span><span class="s2">"Inputs Devices"</span><span class="p">,</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="w">    </span><span class="s2">"Electronic input"</span><span class="p">,</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="w">    </span><span class="s2">"sensor"</span><span class="p">,</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="w">    </span><span class="s2">"Input Devices"</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="w">  </span><span class="nt">"Moulding and Casting"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="w">    </span><span class="s2">"Part A"</span><span class="p">,</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="w">    </span><span class="s2">"Part B"</span><span class="p">,</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="w">    </span><span class="s2">"pot time"</span><span class="p">,</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="w">    </span><span class="s2">"pottime"</span><span class="p">,</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="w">    </span><span class="s2">"molding"</span><span class="p">,</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="w">    </span><span class="s2">"moulding"</span><span class="p">,</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="w">    </span><span class="s2">"casting"</span><span class="p">,</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="w">    </span><span class="s2">"cast"</span><span class="p">,</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="w">    </span><span class="s2">"Moulding and Casting"</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="w">  </span><span class="nt">"Output Devices"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="w">    </span><span class="s2">"Output Device"</span><span class="p">,</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="w">    </span><span class="s2">"Outputs Devices"</span><span class="p">,</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="w">    </span><span class="s2">"Outputs Device"</span><span class="p">,</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="w">    </span><span class="s2">"Servo"</span><span class="p">,</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="w">    </span><span class="s2">"motor"</span><span class="p">,</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="w">    </span><span class="s2">"Output Devices"</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="w">  </span><span class="nt">"Embedded Networking and Communications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="w">    </span><span class="s2">"SPI"</span><span class="p">,</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="w">    </span><span class="s2">"UART"</span><span class="p">,</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="w">    </span><span class="s2">"I2C"</span><span class="p">,</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="w">    </span><span class="s2">"RX"</span><span class="p">,</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="w">    </span><span class="s2">"TX"</span><span class="p">,</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="w">    </span><span class="s2">"SCL"</span><span class="p">,</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="w">    </span><span class="s2">"networking week"</span><span class="p">,</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="w">    </span><span class="s2">"networking"</span><span class="p">,</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="w">    </span><span class="s2">"network"</span><span class="p">,</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="w">    </span><span class="s2">"networking and communications"</span><span class="p">,</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a><span class="w">    </span><span class="s2">"Embedded Networking and Communications"</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="w">  </span><span class="nt">"Interface and Application Programming"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="w">    </span><span class="s2">"Interfacing Week"</span><span class="p">,</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="w">    </span><span class="s2">"interface week"</span><span class="p">,</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="w">    </span><span class="s2">"Interface and Application Programming"</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="w">  </span><span class="nt">"Wildcard Week"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="w">    </span><span class="s2">"Wildcard Week"</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a><span class="w">  </span><span class="nt">"Applications and Implications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a><span class="w">    </span><span class="s2">"Applications and Implications"</span><span class="p">,</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="w">    </span><span class="s2">"Bill-of-Materials"</span><span class="p">,</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="w">    </span><span class="s2">"Bill of materials"</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="w">  </span><span class="nt">"Invention, Intellectual Property and Business Models"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a><span class="w">    </span><span class="s2">"Patent"</span><span class="p">,</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a><span class="w">    </span><span class="s2">"copyright"</span><span class="p">,</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a><span class="w">    </span><span class="s2">"trademark"</span><span class="p">,</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a><span class="w">    </span><span class="s2">"Invention, Intellectual Property and Business Models"</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="w">  </span><span class="nt">"Final Project"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a><span class="w">    </span><span class="s2">"Final Project"</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a><span class="w">  </span><span class="nt">"Other"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="p">}</span>
</span></code></pre></div>
<p>To classify the remaining ~19,500 references, I trained my own text-classification neural network off of the 1,000 characters before and after each of the ~13,000 already classified references using <code>Python</code> and <a href="https://pytorch.org/"><code>PyTorch</code></a>. I designed the neural network with 5,000 input nodes, a hidden layer of 200 nodes, and 18 output nodes (one for each Fab Academy subject area). To format the data for the neural network, I used the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html"><code>Sci-Kit Learn CountVectorizer</code></a> to tokenize the text surrounding each URL, and the resulting matrix was converted to a <a href="https://numpy.org/"><code>NumPy</code></a> array and then to a <a href="https://pytorch.org/docs/stable/tensors.html"><code>PyTorch tensor</code></a>. To train the neural network, I implemented <a href="https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html"><code>Cross-Entropy Loss</code></a> as the loss function to measure the model's performance in predicting the correct subject-area, and I employed the <a href="https://pytorch.org/docs/stable/generated/torch.optim.Adam.html"><code>Adam optimizer</code></a> to adjust the model's weights. After <a href="https://aws.amazon.com/what-is/hyperparameter-tuning/#:~:text=Hyperparameter%20tuning%20allows%20data%20scientists,the%20model%20as%20a%20hyperparameter.">hyperparameter tuning</a> using a grid-search algorithm, the model achieved its best accuracy of <strong>86.3%</strong> using a <em>learning rate of 0.01</em> and <em>dropout rate of 0.1</em>. You can see the gridsearch algorithm below.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Define grid of hyperparameters</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">learning_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">]</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">dropout_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># Perform the grid search</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">best_accuracy</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">best_lr</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">best_dropout_rate</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">learning_rates</span><span class="p">:</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="k">for</span> <span class="n">dropout_rate</span> <span class="ow">in</span> <span class="n">dropout_rates</span><span class="p">:</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>        <span class="c1"># train_model is defined earlier</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>        <span class="n">accuracy</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">)</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Learning rate: </span><span class="si">{</span><span class="n">lr</span><span class="si">}</span><span class="s1">, Dropout rate: </span><span class="si">{</span><span class="n">dropout_rate</span><span class="si">}</span><span class="s1">, Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>        <span class="k">if</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">best_accuracy</span><span class="p">:</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>            <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>            <span class="n">best_lr</span> <span class="o">=</span> <span class="n">lr</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>            <span class="n">best_dropout_rate</span> <span class="o">=</span> <span class="n">dropout_rate</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
</span></code></pre></div>
<p>The model successfully classified the remaining ~19,500 references. </p>
<p>After the data were collected, I ran a network density analysis for the global community, as well as each individual lab that had more than five members. The global network density was <code>~0.0024</code>, while <code>~91.3%</code> of the individual labs had a higher density than this, ranging from approximately <code>0.03</code> to <code>0.45</code> (with the exception of the <code>Rwanda</code> network density of <code>~0.013</code>), supporting my hypothesis that students frequently connected with experts in their own lab, but not in the global community. Next, for the network analysis to be useful, I calculated each student's in-degree centrality by subject area. Read more about this process <a href="#network-analysis">below</a>.</p>
<h3 id="step-3-data-visualization">Step 3: Data Visualization</h3>
<p>Lastly, I wanted to provide the global Fab community with an easy-to-use navigation tool to locate expert documentation by subject area, as identified in my network analysis. I consulted with Mr. Arroyo and decided to create an interactive force simulation graph using <a href="https://d3js.org/"><code>D3JS</code></a>. In the graph, each node represents a student and each edge represents references between students. </p>
<p><img alt="Student Node Example" src="../../assets/images/stem/expert-network-map/student-node-example.jpg"></p>
<p>The more times a student’s documentation website has been referenced, the larger the student’s node, corresponding to more expertise. Other data, such as a student’s Fab Lab location and graduation year, were encoded via other visual mediums. I added interactive features, such as filters for subject area, geography, and graduation year, to help students quickly identify experts based on their needs.</p>
<p><img alt="Filters" src="../../assets/images/stem/expert-network-map/filters.jpg"></p>
<p>Because the first version of the <code>Expert Network Map</code> had a large number of data points reloading in real-time, the tool was too slow to be usable. I made two modifications to optimize performance. First, I used D3JS’ enter-update-exit protocol to change the force simulation graph without reloading all of the data. Next, I collapsed multiple references between the same students into a single edge with greater force. The <code>Expert Network Map</code> is live and will be used by Fab Academy 2024 students.</p>
<h2 id="documentation">Documentation</h2>
<h3 id="step-1-data-collection_1">Step 1: Data Collection</h3>
<p><a href="../../assets/code/step1-python-no-cache.zip">Download the Python code for Step 1 here!</a></p>
<h4 id="scraping-overview-and-pagination-concerns">Scraping Overview and Pagination Concerns</h4>
<p>The first step of the project is to collect data on all of the references between Fab Academy students' documentation from 2018-2023. Since every student's documentation website is hosted from a GitLab repo, I wrote a Python script that uses the <a href="https://python-gitlab.readthedocs.io/en/stable/api-usage.html">Python-GitLab API</a> to scan each student's repo using a <a href="https://www.w3schools.com/python/python_regex.asp">RegEx</a>. </p>
<p>In my first iteration of the script, I did not realize that the <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/17329#:~:text=Description,to%20a%20maximum%20of%20100%20.">GitLab API paginates to the first twenty projects or repos by default</a>, and the RegEx failed to include links from students between years (for example, a student from 2023 referencing a student from 2018). I realized this error after I had completed part of <a href="#step-2-ai-sorting-data-analysis_1">Step 2</a> and successfully trained and hyperparameter tuned a neural network to categorize text by subject-area. So, I could have included more training data, however I decided not to re-run the training process since the model had a lot of data to train on even with the pagination and missing references (~13,000 blocks of 2,000 characters of text, approximately 18,000 pages) and achieved a satisfactory accuracy of 86.3%. Most importantly, these students' data and the extra references <em>were</em> included in the network analysis in <a href="#step-2-ai-sorting-data-analysis_1">Step 2</a>, as well as in the data visualization in <a href="#step-3-data-visualization_1">Step 3</a>. I will show the code with the errors first (the changes were minimal between the versions), then include the altered version in <a href="#step-2-ai-sorting-data-analysis_1">Step 2</a>.</p>
<h4 id="data-structure">Data Structure</h4>
<p>Data was stored in the below structure before being converted to a Pandas dataframe. There was an array of tuples that contained the GitLab ID of a student's lab's subgroup and a dictionary. The dictionary had one key, the name of the student, and had another dictionary as the value. The inner dictionary contained key-value pairs of how many times the student referenced other students' websites.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">[(</span><span class="n">lab_id</span><span class="p">:</span> <span class="nb">id</span> <span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="p">{</span><span class="s2">"Student Name"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"student-referenced"</span><span class="p">:</span> <span class="n">num_references</span> <span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="o">...</span><span class="p">}}),</span> <span class="o">...</span><span class="p">]</span>
</span></code></pre></div>
<h4 id="subject-area-keywords">Subject-Area Keywords</h4>
<p>Additionally, I wrote a list of keywords for each subject-area. If the 2,000 characters surrounding a link contained one of the keywords, a new object was stored in a <code>jsonl</code> file containing the text and categorized subject-area. Additionally, self-links were included in the training data. Here's a sample from the collected data.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"018/labs/fablabamsterdam/students/klein-xavier/pages/week8.html\"&gt;check here to know how i did it&lt;/a&gt;), i set the clock to &lt;i&gt;internal 8 mhz&lt;/i&gt;.\n\ni tried the code &lt;a href=\"https://github.com/maltesemants1/charlieplexing-the-arduino/blob/master/charlieplexing%20sketch\" target=\"_blank\"&gt;from the tutorial i followed&lt;/a&gt;.&lt;br&gt;\nnow, if you look at images of the board above, something is missing. the regulator. if you're already noticed it you win this \"very good eyes\" cup:&lt;br&gt;&lt;br&gt;\n&lt;img src=\"week11/img/cup.gif\" alt=\"\"&gt;&lt;br&gt;&lt;br&gt;\n\ni try first with the code above, i change the pins, looking to this type of datasheet: &lt;br&gt;&lt;br&gt;\n&lt;img src=\"http://fabacademy.org/2018/labs/fablabtrivandrum/students/aby-michael/week9/image/attinypinouts14.jpg\" alt=\"\"&gt;&lt;br&gt;&lt;br&gt;\n\n i've upload the code and nothing happened. the regulator started to fried!&lt;br&gt;\n it fried because i put it there to regulate a 9v from a battery to 5v. but there was no battery when i tested the code (using the programmer as power supply) and the regulator didn't enjoy it.&lt;br&gt;\n so for the next \"experiments\" i remove it and used only the programmer as power supply.&lt;br&gt;&lt;br&gt;\n\n i manage to make charlieplexing working with the good pins, i've made some mods to the code in order to have a back and forth movement (you check this code &lt;a href=\"http://archive.fabacademy.org/2018/labs/fablabamsterdam/students/klein-xavier/pages/week11/file/charlieplexing.ino\"&gt;here&lt;/a&gt;.):&lt;br&gt;&lt;br&gt;\n &lt;img src=\"week11/img/pins.png\" alt=\"\"&gt;&lt;br&gt;&lt;br&gt;\n here's the beast:&lt;br&gt;&lt;br&gt;\n&lt;iframe src=\"https://giphy.com/embed/1lxry3fbt0naiel2gn\" width=\"480\" height=\"266\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen&gt;&lt;/iframe&gt;&lt;br&gt;&lt;br&gt;\n\n&lt;b&gt;the code:&lt;/b&gt;&lt;br&gt;&lt;br&gt;\n\nt\n\n/*&lt;br&gt;\n * charlieplexing code for this board:&lt;br&gt;\n\n * http://archive.fabacademy.org/2018/labs/fablabamsterdam/students/klein-xavier/pages/week11/file/ledboard.zip &lt;br&gt;\n * wtfpl xavier klein &lt;br&gt;\n */ &lt;br&gt;\n\n&lt;br&gt;\n&lt;b&gt;here i have 3 variables related to the 3 pins i dedicated to for each row.&lt;/b&gt;&lt;br&gt;\n//setting the pin for each row.&lt;br&gt;\nconst int led_1 = 0;     //led"</span><span class="p">,</span><span class="w"> </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Embedded Programing"</span><span class="p">,</span><span class="w"> </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://fabacademy.org/2018/labs/fablabamsterdam/students/klein-xavier/"</span><span class="p">,</span><span class="w"> </span><span class="nt">"to"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://fabacademy.org/2018/labs/fablabtrivandrum/students/aby-michael/"</span><span class="p">}}</span>
</span></code></pre></div>
<p>Below is a list of the subject-areas and the corresponding keywords (later the subject-areas "Prefab" and "Other" were removed):</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">TOPICS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="s2">"Prefab"</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="s2">"Computer-Aided Design"</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="s2">"Computer-Controlled Cutting"</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="s2">"Embedded Programing"</span><span class="p">,</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="s2">"3D Scanning and Printing"</span><span class="p">,</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="s2">"Electronics Design"</span><span class="p">,</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="s2">"Computer-Controlled Machining"</span><span class="p">,</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="s2">"Electronics Production"</span><span class="p">,</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">,</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="s2">"Input Devices"</span><span class="p">,</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="s2">"Moulding and Casting"</span><span class="p">,</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="s2">"Output Devices"</span><span class="p">,</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="s2">"Embedded Networking and Communications"</span><span class="p">,</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="s2">"Interface and Application Programming"</span><span class="p">,</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="s2">"Wildcard Week"</span><span class="p">,</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="s2">"Applications and Implications"</span><span class="p">,</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>    <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">,</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="s2">"Final Project"</span><span class="p">,</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="s2">"Other"</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="p">]</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="n">TOPIC_SEARCH_TERMS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>    <span class="p">[],</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>    <span class="p">[</span><span class="s2">"Computer-Aided Design"</span><span class="p">,</span> <span class="s2">"freecad"</span><span class="p">],</span> 
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>    <span class="p">[</span><span class="s2">"Laser Cut"</span><span class="p">,</span> <span class="s2">"CCC week"</span><span class="p">,</span> <span class="s2">"Computer-Controlled Cutting"</span><span class="p">],</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>    <span class="p">[</span><span class="s2">"Embedded Programming"</span><span class="p">,</span> <span class="s2">"MicroPython"</span><span class="p">,</span> <span class="s2">"C\+\+"</span><span class="p">,</span> <span class="s2">"python"</span> <span class="s2">"cpp"</span><span class="p">,</span> <span class="s2">"ino"</span><span class="p">,</span> <span class="s2">"Arduino IDE"</span><span class="p">,</span> <span class="s2">"programming week"</span><span class="p">],</span> 
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>    <span class="p">[</span><span class="s2">"3D Printing"</span><span class="p">,</span> <span class="s2">"3D Scanning"</span><span class="p">,</span> <span class="s2">"TPU"</span><span class="p">,</span> <span class="s2">"PETG"</span><span class="p">,</span> <span class="s2">"filament"</span><span class="p">,</span> <span class="s2">"Prusa"</span><span class="p">,</span> <span class="s2">"3d printing week"</span><span class="p">,</span> <span class="s2">"polyCAM"</span><span class="p">,</span> <span class="s2">"3D Scanning and Printing"</span><span class="p">,</span> <span class="s2">"3d printers"</span><span class="p">,</span> <span class="s2">"3d printer"</span><span class="p">],</span> <span class="c1"># not PLA because in too many other words</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>    <span class="p">[</span><span class="s2">"EagleCAD"</span><span class="p">,</span> <span class="s2">"Eagle"</span><span class="p">,</span> <span class="s2">"KiCAD"</span><span class="p">,</span> <span class="s2">"Routing"</span><span class="p">,</span> <span class="s2">"Auto-Route"</span><span class="p">,</span> <span class="s2">"Trace"</span><span class="p">,</span> <span class="s2">"Footprint"</span><span class="p">,</span> <span class="s2">"electronic design"</span><span class="p">,</span> <span class="s2">"Electronics Design"</span><span class="p">],</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>    <span class="p">[</span><span class="s2">"CNC"</span><span class="p">,</span> <span class="s2">"Shopbot"</span><span class="p">,</span> <span class="s2">"Computer-Controlled Machining"</span><span class="p">],</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>    <span class="p">[</span><span class="s2">"Mill"</span><span class="p">,</span> <span class="s2">"Milling"</span><span class="p">,</span> <span class="s2">"copper"</span><span class="p">,</span> <span class="s2">"electronic production"</span><span class="p">,</span> <span class="s2">"Electronics Production"</span><span class="p">],</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>    <span class="p">[</span><span class="s2">"Machine week"</span><span class="p">,</span> <span class="s2">"actuation and automation"</span><span class="p">,</span> <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">],</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>    <span class="p">[</span><span class="s2">"Input Devices"</span><span class="p">,</span> <span class="s2">"Input Device"</span><span class="p">,</span> <span class="s2">"Inputs Devices"</span><span class="p">,</span> <span class="s2">"Electronic input"</span><span class="p">,</span> <span class="s2">"sensor"</span><span class="p">,</span> <span class="s2">"Input Devices"</span><span class="p">],</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>    <span class="p">[</span><span class="s2">"Part A"</span><span class="p">,</span> <span class="s2">"Part B"</span><span class="p">,</span> <span class="s2">"pot time"</span><span class="p">,</span> <span class="s2">"pottime"</span><span class="p">,</span> <span class="s2">"molding"</span><span class="p">,</span> <span class="s2">"moulding"</span><span class="p">,</span> <span class="s2">"casting"</span><span class="p">,</span> <span class="s2">"cast"</span><span class="p">,</span> <span class="s2">"Moulding and Casting"</span><span class="p">],</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>    <span class="p">[</span><span class="s2">"Output Device"</span><span class="p">,</span> <span class="s2">"Outputs Devices"</span><span class="p">,</span> <span class="s2">"Outputs Device"</span><span class="p">,</span> <span class="s2">"Servo"</span><span class="p">,</span> <span class="s2">"motor"</span><span class="p">,</span> <span class="s2">"Output Devices"</span><span class="p">],</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>    <span class="p">[</span><span class="s2">"SPI"</span><span class="p">,</span> <span class="s2">"UART"</span><span class="p">,</span> <span class="s2">"I2C"</span><span class="p">,</span> <span class="s2">"RX"</span><span class="p">,</span> <span class="s2">"TX"</span><span class="p">,</span> <span class="s2">"SCL"</span><span class="p">,</span> <span class="s2">"networking week"</span><span class="p">,</span> <span class="s2">"networking"</span><span class="p">,</span> <span class="s2">"network"</span><span class="p">,</span> <span class="s2">"networking and communications"</span><span class="p">,</span> <span class="s2">"Embedded Networking and Communications"</span><span class="p">],</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>    <span class="p">[</span><span class="s2">"Interfacing Week"</span><span class="p">,</span> <span class="s2">"interface week"</span><span class="p">,</span> <span class="s2">"Interface and Application Programming"</span><span class="p">],</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>    <span class="p">[</span><span class="s2">"Wildcard Week"</span><span class="p">],</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>    <span class="p">[</span><span class="s2">"Applications and Implications"</span><span class="p">,</span> <span class="s2">"Bill-of-Materials"</span><span class="p">,</span> <span class="s2">"Bill of materials"</span><span class="p">],</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>    <span class="p">[</span><span class="s2">"Patent"</span><span class="p">,</span> <span class="s2">"copyright"</span><span class="p">,</span> <span class="s2">"trademark"</span><span class="p">,</span> <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">],</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>    <span class="p">[</span><span class="s2">"Final Project"</span><span class="p">],</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>    <span class="p">[]</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="p">]</span>
</span></code></pre></div>
<h4 id="gitlab-structure">GitLab Structure</h4>
<p>The Fab Academy student GitLab repos are structured as follows:</p>
<p><img alt="GitLab Flowchart" src="../../assets/images/stem/expert-network-map/gitlab-flowchart.jpg"></p>
<p>So it worked down the tree, starting with each year's subgroup and traversing down the tree breadth-first. Helper functions are included in the full <code>main_collection.py</code> below.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">2024</span><span class="p">):</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Loading student names..."</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">all_student_names</span> <span class="o">=</span> <span class="n">get_all_people</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">all_student_names</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Collecting student repo IDs..."</span><span class="p">)</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">all_student_repo_ids</span> <span class="o">=</span> <span class="n">get_all_student_repo_ids</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">ALL_LAB_SUBGROUP_IDS</span><span class="p">[</span><span class="n">year</span><span class="p">],</span> <span class="n">all_student_names</span><span class="p">)</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="n">all_reference_dicts</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [(lab_id: id (int), {"Student Name": {"student-referenced": num_references (int), ...}}), ...]</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    <span class="k">for</span> <span class="n">lab_number</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">all_student_repo_ids</span><span class="p">:</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>        <span class="n">reference_dict_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>        <span class="n">compiled_reference_dict</span> <span class="o">=</span> <span class="n">get_all_reference_dicts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Adding reference dictionary to database..."</span><span class="p">)</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="n">all_reference_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lab_number</span><span class="p">,</span> <span class="p">{</span><span class="n">format_name</span><span class="p">(</span><span class="n">get_repo_name</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">year</span><span class="p">):</span> <span class="n">compiled_reference_dict</span><span class="p">}))</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"All reference dictionaries so far... </span><span class="si">{</span><span class="n">all_reference_dicts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    <span class="n">reference_dicts_across_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_reference_dicts</span><span class="p">)</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="n">matrix</span> <span class="o">=</span> <span class="n">format_data_to_matrix</span><span class="p">(</span><span class="n">reference_dicts_across_years</span><span class="p">)</span>
</span></code></pre></div>
<p>Since all links to another's website in documentation should be found in either an <code>HTML</code>, <code>TXT</code>, or <code>Markdown</code> file, I only scanned for references in these file types. I also provided the Subgroup IDs of the overal Fab Academy GitLab Projects for the years 2018-2023.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">VALID_EXTENSOINS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"html"</span><span class="p">,</span> <span class="s2">"txt"</span><span class="p">,</span> <span class="s2">"md"</span><span class="p">]</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">ALL_LAB_SUBGROUP_IDS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="mi">2023</span><span class="p">:</span> <span class="mi">8145</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="mi">2022</span><span class="p">:</span> <span class="mi">3632</span><span class="p">,</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="mi">2021</span><span class="p">:</span> <span class="mi">2917</span><span class="p">,</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="mi">2020</span><span class="p">:</span> <span class="mi">2140</span><span class="p">,</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="mi">2019</span><span class="p">:</span> <span class="mi">1619</span><span class="p">,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="mi">2018</span><span class="p">:</span> <span class="mi">852</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="p">}</span>
</span></code></pre></div>
<p>In order to decrease run-time when running the script multiple times, certain information, such as the list of every student's names from the fabacademy.org website, are pickled and stored locally.</p>
<h4 id="full-code">Full Code</h4>
<p>Here is the entire <code>main_collection.py</code> file with helper functions. </p>
<p><em>main_collection.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">urllib.parse</span><span class="o">,</span> <span class="nn">gitlab</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">json</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">GL</span> <span class="o">=</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">Gitlab</span><span class="p">(</span><span class="s1">'https://gitlab.fabcloud.org'</span><span class="p">,</span> <span class="n">api_version</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="n">VALID_EXTENSOINS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"html"</span><span class="p">,</span> <span class="s2">"txt"</span><span class="p">,</span> <span class="s2">"md"</span><span class="p">]</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="n">ALL_LAB_SUBGROUP_IDS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="mi">2023</span><span class="p">:</span> <span class="mi">8145</span><span class="p">,</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="mi">2022</span><span class="p">:</span> <span class="mi">3632</span><span class="p">,</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    <span class="mi">2021</span><span class="p">:</span> <span class="mi">2917</span><span class="p">,</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    <span class="mi">2020</span><span class="p">:</span> <span class="mi">2140</span><span class="p">,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="mi">2019</span><span class="p">:</span> <span class="mi">1619</span><span class="p">,</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    <span class="mi">2018</span><span class="p">:</span> <span class="mi">852</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="p">}</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="n">CHARACTERS_EACH_DIRECTION_TOPIC_DETECTION</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="n">TOPICS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    <span class="s2">"Prefab"</span><span class="p">,</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    <span class="s2">"Computer-Aided Design"</span><span class="p">,</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    <span class="s2">"Computer-Controlled Cutting"</span><span class="p">,</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    <span class="s2">"Embedded Programing"</span><span class="p">,</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>    <span class="s2">"3D Scanning and Printing"</span><span class="p">,</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>    <span class="s2">"Electronics Design"</span><span class="p">,</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>    <span class="s2">"Computer-Controlled Machining"</span><span class="p">,</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>    <span class="s2">"Electronics Production"</span><span class="p">,</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>    <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">,</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>    <span class="s2">"Input Devices"</span><span class="p">,</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>    <span class="s2">"Moulding and Casting"</span><span class="p">,</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>    <span class="s2">"Output Devices"</span><span class="p">,</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>    <span class="s2">"Embedded Networking and Communications"</span><span class="p">,</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>    <span class="s2">"Interface and Application Programming"</span><span class="p">,</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>    <span class="s2">"Wildcard Week"</span><span class="p">,</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>    <span class="s2">"Applications and Implications"</span><span class="p">,</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>    <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">,</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>    <span class="s2">"Final Project"</span><span class="p">,</span>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>    <span class="s2">"Other"</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="p">]</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="n">TOPIC_SEARCH_TERMS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>    <span class="p">[],</span>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>    <span class="p">[</span><span class="s2">"Computer-Aided Design"</span><span class="p">,</span> <span class="s2">"freecad"</span><span class="p">],</span> 
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>    <span class="p">[</span><span class="s2">"Laser Cut"</span><span class="p">,</span> <span class="s2">"CCC week"</span><span class="p">,</span> <span class="s2">"Computer-Controlled Cutting"</span><span class="p">],</span>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>    <span class="p">[</span><span class="s2">"Embedded Programming"</span><span class="p">,</span> <span class="s2">"MicroPython"</span><span class="p">,</span> <span class="s2">"C\+\+"</span><span class="p">,</span> <span class="s2">"python"</span> <span class="s2">"cpp"</span><span class="p">,</span> <span class="s2">"ino"</span><span class="p">,</span> <span class="s2">"Arduino IDE"</span><span class="p">,</span> <span class="s2">"programming week"</span><span class="p">],</span> 
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>    <span class="p">[</span><span class="s2">"3D Printing"</span><span class="p">,</span> <span class="s2">"3D Scanning"</span><span class="p">,</span> <span class="s2">"TPU"</span><span class="p">,</span> <span class="s2">"PETG"</span><span class="p">,</span> <span class="s2">"filament"</span><span class="p">,</span> <span class="s2">"Prusa"</span><span class="p">,</span> <span class="s2">"3d printing week"</span><span class="p">,</span> <span class="s2">"polyCAM"</span><span class="p">,</span> <span class="s2">"3D Scanning and Printing"</span><span class="p">,</span> <span class="s2">"3d printers"</span><span class="p">,</span> <span class="s2">"3d printer"</span><span class="p">],</span> <span class="c1"># not PLA because in too many other words</span>
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a>    <span class="p">[</span><span class="s2">"EagleCAD"</span><span class="p">,</span> <span class="s2">"Eagle"</span><span class="p">,</span> <span class="s2">"KiCAD"</span><span class="p">,</span> <span class="s2">"Routing"</span><span class="p">,</span> <span class="s2">"Auto-Route"</span><span class="p">,</span> <span class="s2">"Trace"</span><span class="p">,</span> <span class="s2">"Footprint"</span><span class="p">,</span> <span class="s2">"electronic design"</span><span class="p">,</span> <span class="s2">"Electronics Design"</span><span class="p">],</span>
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>    <span class="p">[</span><span class="s2">"CNC"</span><span class="p">,</span> <span class="s2">"Shopbot"</span><span class="p">,</span> <span class="s2">"Computer-Controlled Machining"</span><span class="p">],</span>
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>    <span class="p">[</span><span class="s2">"Mill"</span><span class="p">,</span> <span class="s2">"Milling"</span><span class="p">,</span> <span class="s2">"copper"</span><span class="p">,</span> <span class="s2">"electronic production"</span><span class="p">,</span> <span class="s2">"Electronics Production"</span><span class="p">],</span>
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>    <span class="p">[</span><span class="s2">"Machine week"</span><span class="p">,</span> <span class="s2">"actuation and automation"</span><span class="p">,</span> <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">],</span>
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>    <span class="p">[</span><span class="s2">"Input Devices"</span><span class="p">,</span> <span class="s2">"Input Device"</span><span class="p">,</span> <span class="s2">"Inputs Devices"</span><span class="p">,</span> <span class="s2">"Electronic input"</span><span class="p">,</span> <span class="s2">"sensor"</span><span class="p">,</span> <span class="s2">"Input Devices"</span><span class="p">],</span>
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>    <span class="p">[</span><span class="s2">"Part A"</span><span class="p">,</span> <span class="s2">"Part B"</span><span class="p">,</span> <span class="s2">"pot time"</span><span class="p">,</span> <span class="s2">"pottime"</span><span class="p">,</span> <span class="s2">"molding"</span><span class="p">,</span> <span class="s2">"moulding"</span><span class="p">,</span> <span class="s2">"casting"</span><span class="p">,</span> <span class="s2">"cast"</span><span class="p">,</span> <span class="s2">"Moulding and Casting"</span><span class="p">],</span>
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>    <span class="p">[</span><span class="s2">"Output Device"</span><span class="p">,</span> <span class="s2">"Outputs Devices"</span><span class="p">,</span> <span class="s2">"Outputs Device"</span><span class="p">,</span> <span class="s2">"Servo"</span><span class="p">,</span> <span class="s2">"motor"</span><span class="p">,</span> <span class="s2">"Output Devices"</span><span class="p">],</span>
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>    <span class="p">[</span><span class="s2">"SPI"</span><span class="p">,</span> <span class="s2">"UART"</span><span class="p">,</span> <span class="s2">"I2C"</span><span class="p">,</span> <span class="s2">"RX"</span><span class="p">,</span> <span class="s2">"TX"</span><span class="p">,</span> <span class="s2">"SCL"</span><span class="p">,</span> <span class="s2">"networking week"</span><span class="p">,</span> <span class="s2">"networking"</span><span class="p">,</span> <span class="s2">"network"</span><span class="p">,</span> <span class="s2">"networking and communications"</span><span class="p">,</span> <span class="s2">"Embedded Networking and Communications"</span><span class="p">],</span>
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>    <span class="p">[</span><span class="s2">"Interfacing Week"</span><span class="p">,</span> <span class="s2">"interface week"</span><span class="p">,</span> <span class="s2">"Interface and Application Programming"</span><span class="p">],</span>
</span><span id="__span-7-55"><a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>    <span class="p">[</span><span class="s2">"Wildcard Week"</span><span class="p">],</span>
</span><span id="__span-7-56"><a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>    <span class="p">[</span><span class="s2">"Applications and Implications"</span><span class="p">,</span> <span class="s2">"Bill-of-Materials"</span><span class="p">,</span> <span class="s2">"Bill of materials"</span><span class="p">],</span>
</span><span id="__span-7-57"><a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>    <span class="p">[</span><span class="s2">"Patent"</span><span class="p">,</span> <span class="s2">"copyright"</span><span class="p">,</span> <span class="s2">"trademark"</span><span class="p">,</span> <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">],</span>
</span><span id="__span-7-58"><a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>    <span class="p">[</span><span class="s2">"Final Project"</span><span class="p">],</span>
</span><span id="__span-7-59"><a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a>    <span class="p">[]</span>
</span><span id="__span-7-60"><a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a><span class="p">]</span> 
</span><span id="__span-7-61"><a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a>
</span><span id="__span-7-62"><a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a><span class="c1"># return file contents from GitLab repo</span>
</span><span id="__span-7-63"><a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a><span class="k">def</span> <span class="nf">get_file_content</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">default_branch_name</span><span class="p">):</span>
</span><span id="__span-7-64"><a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Getting file content: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-65"><a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a>    <span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/repository/files/</span><span class="si">{</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">safe</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span><span class="si">}</span><span class="s2">?ref=</span><span class="si">{</span><span class="n">default_branch_name</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-7-66"><a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span>
</span><span id="__span-7-67"><a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-7-68"><a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a>    <span class="k">if</span> <span class="s1">'message'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-7-69"><a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a>        <span class="k">if</span> <span class="s1">'404'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]:</span>
</span><span id="__span-7-70"><a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"404 ERROR from </span><span class="si">{</span><span class="n">safe_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-71"><a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a>            <span class="k">return</span>
</span><span id="__span-7-72"><a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a>    <span class="n">encrypted_blob</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span>
</span><span id="__span-7-73"><a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a>
</span><span id="__span-7-74"><a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a>    <span class="n">decrypted_text</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_blob</span><span class="p">)</span>
</span><span id="__span-7-75"><a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a>    <span class="k">return</span> <span class="n">decrypted_text</span>
</span><span id="__span-7-76"><a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a>
</span><span id="__span-7-77"><a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a><span class="c1"># get name of GitLab repo</span>
</span><span id="__span-7-78"><a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a><span class="k">def</span> <span class="nf">get_repo_name</span><span class="p">(</span><span class="n">project_id</span><span class="p">):</span>
</span><span id="__span-7-79"><a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a>    <span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-7-80"><a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span>
</span><span id="__span-7-81"><a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-7-82"><a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a>    <span class="n">web_url</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">'web_url'</span><span class="p">]</span>
</span><span id="__span-7-83"><a id="__codelineno-7-83" name="__codelineno-7-83" href="#__codelineno-7-83"></a>    <span class="k">if</span> <span class="s1">'message'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-7-84"><a id="__codelineno-7-84" name="__codelineno-7-84" href="#__codelineno-7-84"></a>        <span class="k">if</span> <span class="s1">'404'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]:</span>
</span><span id="__span-7-85"><a id="__codelineno-7-85" name="__codelineno-7-85" href="#__codelineno-7-85"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"404 ERROR from </span><span class="si">{</span><span class="n">safe_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-86"><a id="__codelineno-7-86" name="__codelineno-7-86" href="#__codelineno-7-86"></a>            <span class="k">return</span>
</span><span id="__span-7-87"><a id="__codelineno-7-87" name="__codelineno-7-87" href="#__codelineno-7-87"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span> <span class="n">gitlab_url_to_site_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">web_url</span><span class="si">}</span><span class="s2">/"</span><span class="p">)</span> <span class="c1"># / to make it consistent with the name lists with urljoin and the a's hrefs</span>
</span><span id="__span-7-88"><a id="__codelineno-7-88" name="__codelineno-7-88" href="#__codelineno-7-88"></a>
</span><span id="__span-7-89"><a id="__codelineno-7-89" name="__codelineno-7-89" href="#__codelineno-7-89"></a><span class="c1"># get a list of the subgroups of a GitLab project</span>
</span><span id="__span-7-90"><a id="__codelineno-7-90" name="__codelineno-7-90" href="#__codelineno-7-90"></a><span class="k">def</span> <span class="nf">get_file_repo_list</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
</span><span id="__span-7-91"><a id="__codelineno-7-91" name="__codelineno-7-91" href="#__codelineno-7-91"></a>    <span class="n">all_file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-92"><a id="__codelineno-7-92" name="__codelineno-7-92" href="#__codelineno-7-92"></a>    <span class="n">project</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="__span-7-93"><a id="__codelineno-7-93" name="__codelineno-7-93" href="#__codelineno-7-93"></a>    <span class="n">all_directories</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">repository_tree</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-7-94"><a id="__codelineno-7-94" name="__codelineno-7-94" href="#__codelineno-7-94"></a>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_directories</span><span class="p">:</span>
</span><span id="__span-7-95"><a id="__codelineno-7-95" name="__codelineno-7-95" href="#__codelineno-7-95"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]</span>
</span><span id="__span-7-96"><a id="__codelineno-7-96" name="__codelineno-7-96" href="#__codelineno-7-96"></a>        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">VALID_EXTENSOINS</span><span class="p">:</span>
</span><span id="__span-7-97"><a id="__codelineno-7-97" name="__codelineno-7-97" href="#__codelineno-7-97"></a>            <span class="n">all_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-7-98"><a id="__codelineno-7-98" name="__codelineno-7-98" href="#__codelineno-7-98"></a>    <span class="k">return</span> <span class="n">all_file_paths</span>
</span><span id="__span-7-99"><a id="__codelineno-7-99" name="__codelineno-7-99" href="#__codelineno-7-99"></a>
</span><span id="__span-7-100"><a id="__codelineno-7-100" name="__codelineno-7-100" href="#__codelineno-7-100"></a><span class="c1"># get the IDs of the subgroups of a GitLab project</span>
</span><span id="__span-7-101"><a id="__codelineno-7-101" name="__codelineno-7-101" href="#__codelineno-7-101"></a><span class="k">def</span> <span class="nf">get_subgroup_ids</span><span class="p">(</span><span class="n">group_id</span><span class="p">):</span>
</span><span id="__span-7-102"><a id="__codelineno-7-102" name="__codelineno-7-102" href="#__codelineno-7-102"></a>    <span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/subgroups"</span>
</span><span id="__span-7-103"><a id="__codelineno-7-103" name="__codelineno-7-103" href="#__codelineno-7-103"></a>    <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-7-104"><a id="__codelineno-7-104" name="__codelineno-7-104" href="#__codelineno-7-104"></a>    <span class="k">while</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-7-105"><a id="__codelineno-7-105" name="__codelineno-7-105" href="#__codelineno-7-105"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-7-106"><a id="__codelineno-7-106" name="__codelineno-7-106" href="#__codelineno-7-106"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-7-107"><a id="__codelineno-7-107" name="__codelineno-7-107" href="#__codelineno-7-107"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-7-108"><a id="__codelineno-7-108" name="__codelineno-7-108" href="#__codelineno-7-108"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Server timeout- </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-109"><a id="__codelineno-7-109" name="__codelineno-7-109" href="#__codelineno-7-109"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-7-110"><a id="__codelineno-7-110" name="__codelineno-7-110" href="#__codelineno-7-110"></a>    <span class="n">p_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-111"><a id="__codelineno-7-111" name="__codelineno-7-111" href="#__codelineno-7-111"></a>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-7-112"><a id="__codelineno-7-112" name="__codelineno-7-112" href="#__codelineno-7-112"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-7-113"><a id="__codelineno-7-113" name="__codelineno-7-113" href="#__codelineno-7-113"></a>            <span class="n">p_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span>
</span><span id="__span-7-114"><a id="__codelineno-7-114" name="__codelineno-7-114" href="#__codelineno-7-114"></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="__span-7-115"><a id="__codelineno-7-115" name="__codelineno-7-115" href="#__codelineno-7-115"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error finding subgroups -- skipping"</span><span class="p">)</span>
</span><span id="__span-7-116"><a id="__codelineno-7-116" name="__codelineno-7-116" href="#__codelineno-7-116"></a>    <span class="k">return</span> <span class="n">p_ids</span>
</span><span id="__span-7-117"><a id="__codelineno-7-117" name="__codelineno-7-117" href="#__codelineno-7-117"></a>
</span><span id="__span-7-118"><a id="__codelineno-7-118" name="__codelineno-7-118" href="#__codelineno-7-118"></a><span class="c1"># get the IDs of subgprojects of a GitLab project</span>
</span><span id="__span-7-119"><a id="__codelineno-7-119" name="__codelineno-7-119" href="#__codelineno-7-119"></a><span class="k">def</span> <span class="nf">get_subproject_ids</span><span class="p">(</span><span class="n">group_id</span><span class="p">):</span>
</span><span id="__span-7-120"><a id="__codelineno-7-120" name="__codelineno-7-120" href="#__codelineno-7-120"></a>    <span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/projects"</span>
</span><span id="__span-7-121"><a id="__codelineno-7-121" name="__codelineno-7-121" href="#__codelineno-7-121"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-7-122"><a id="__codelineno-7-122" name="__codelineno-7-122" href="#__codelineno-7-122"></a>    <span class="n">p_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-123"><a id="__codelineno-7-123" name="__codelineno-7-123" href="#__codelineno-7-123"></a>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-7-124"><a id="__codelineno-7-124" name="__codelineno-7-124" href="#__codelineno-7-124"></a>        <span class="n">p_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span>
</span><span id="__span-7-125"><a id="__codelineno-7-125" name="__codelineno-7-125" href="#__codelineno-7-125"></a>    <span class="k">return</span> <span class="n">p_ids</span>
</span><span id="__span-7-126"><a id="__codelineno-7-126" name="__codelineno-7-126" href="#__codelineno-7-126"></a>
</span><span id="__span-7-127"><a id="__codelineno-7-127" name="__codelineno-7-127" href="#__codelineno-7-127"></a><span class="k">def</span> <span class="nf">name_split_char</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
</span><span id="__span-7-128"><a id="__codelineno-7-128" name="__codelineno-7-128" href="#__codelineno-7-128"></a>    <span class="k">return</span> <span class="s2">"."</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2021</span> <span class="k">else</span> <span class="s2">" "</span>
</span><span id="__span-7-129"><a id="__codelineno-7-129" name="__codelineno-7-129" href="#__codelineno-7-129"></a>
</span><span id="__span-7-130"><a id="__codelineno-7-130" name="__codelineno-7-130" href="#__codelineno-7-130"></a><span class="c1"># convert a URL to a GitLab repo to a URL to the hosted website</span>
</span><span id="__span-7-131"><a id="__codelineno-7-131" name="__codelineno-7-131" href="#__codelineno-7-131"></a><span class="k">def</span> <span class="nf">gitlab_url_to_site_url</span><span class="p">(</span><span class="n">gitlab_url</span><span class="p">):</span>
</span><span id="__span-7-132"><a id="__codelineno-7-132" name="__codelineno-7-132" href="#__codelineno-7-132"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"https://fabacademy.org/</span><span class="si">{</span><span class="n">gitlab_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'https://gitlab.fabcloud.org/academany/fabacademy/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-7-133"><a id="__codelineno-7-133" name="__codelineno-7-133" href="#__codelineno-7-133"></a>
</span><span id="__span-7-134"><a id="__codelineno-7-134" name="__codelineno-7-134" href="#__codelineno-7-134"></a><span class="c1"># format student's name to create a unique identifier for each student</span>
</span><span id="__span-7-135"><a id="__codelineno-7-135" name="__codelineno-7-135" href="#__codelineno-7-135"></a><span class="k">def</span> <span class="nf">format_name</span><span class="p">(</span><span class="n">name_url_tup</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">tup</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-7-136"><a id="__codelineno-7-136" name="__codelineno-7-136" href="#__codelineno-7-136"></a>    <span class="k">if</span> <span class="n">tup</span><span class="p">:</span>
</span><span id="__span-7-137"><a id="__codelineno-7-137" name="__codelineno-7-137" href="#__codelineno-7-137"></a>        <span class="n">name</span><span class="p">,</span> <span class="n">web_url</span> <span class="o">=</span> <span class="n">name_url_tup</span>
</span><span id="__span-7-138"><a id="__codelineno-7-138" name="__codelineno-7-138" href="#__codelineno-7-138"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="s2">"-"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name_split_char</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span><span class="si">}</span><span class="s1">;</span><span class="si">{</span><span class="n">web_url</span><span class="si">}</span><span class="s1">'</span> 
</span><span id="__span-7-139"><a id="__codelineno-7-139" name="__codelineno-7-139" href="#__codelineno-7-139"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-7-140"><a id="__codelineno-7-140" name="__codelineno-7-140" href="#__codelineno-7-140"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Warning: name generated without URL"</span><span class="p">)</span>
</span><span id="__span-7-141"><a id="__codelineno-7-141" name="__codelineno-7-141" href="#__codelineno-7-141"></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">name_url_tup</span>
</span><span id="__span-7-142"><a id="__codelineno-7-142" name="__codelineno-7-142" href="#__codelineno-7-142"></a>        <span class="k">return</span> <span class="s2">"-"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name_split_char</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span>
</span><span id="__span-7-143"><a id="__codelineno-7-143" name="__codelineno-7-143" href="#__codelineno-7-143"></a>
</span><span id="__span-7-144"><a id="__codelineno-7-144" name="__codelineno-7-144" href="#__codelineno-7-144"></a><span class="c1"># remove all links to websites that are not students' repos</span>
</span><span id="__span-7-145"><a id="__codelineno-7-145" name="__codelineno-7-145" href="#__codelineno-7-145"></a><span class="k">def</span> <span class="nf">filter_only_student_repos</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">,</span> <span class="n">all_student_names</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
</span><span id="__span-7-146"><a id="__codelineno-7-146" name="__codelineno-7-146" href="#__codelineno-7-146"></a>    <span class="n">filtered_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-147"><a id="__codelineno-7-147" name="__codelineno-7-147" href="#__codelineno-7-147"></a>    <span class="n">all_student_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">all_student_names</span><span class="p">]</span>
</span><span id="__span-7-148"><a id="__codelineno-7-148" name="__codelineno-7-148" href="#__codelineno-7-148"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">id_list</span> <span class="ow">in</span> <span class="n">all_student_repo_ids</span><span class="p">:</span>
</span><span id="__span-7-149"><a id="__codelineno-7-149" name="__codelineno-7-149" href="#__codelineno-7-149"></a>        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
</span><span id="__span-7-150"><a id="__codelineno-7-150" name="__codelineno-7-150" href="#__codelineno-7-150"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">web_url</span> <span class="o">=</span> <span class="n">get_repo_name</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="__span-7-151"><a id="__codelineno-7-151" name="__codelineno-7-151" href="#__codelineno-7-151"></a>            <span class="k">if</span> <span class="n">web_url</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">all_student_urls</span> <span class="ow">or</span> <span class="n">web_url</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">all_student_urls</span><span class="p">:</span> <span class="c1"># [:-1] to remove ending slash</span>
</span><span id="__span-7-152"><a id="__codelineno-7-152" name="__codelineno-7-152" href="#__codelineno-7-152"></a>                <span class="n">filtered_ids</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
</span><span id="__span-7-153"><a id="__codelineno-7-153" name="__codelineno-7-153" href="#__codelineno-7-153"></a>    <span class="k">return</span> <span class="n">filtered_ids</span>
</span><span id="__span-7-154"><a id="__codelineno-7-154" name="__codelineno-7-154" href="#__codelineno-7-154"></a>
</span><span id="__span-7-155"><a id="__codelineno-7-155" name="__codelineno-7-155" href="#__codelineno-7-155"></a><span class="c1"># get the repo IDs of all fab Academy students</span>
</span><span id="__span-7-156"><a id="__codelineno-7-156" name="__codelineno-7-156" href="#__codelineno-7-156"></a><span class="k">def</span> <span class="nf">get_all_student_repo_ids</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year_subgroup_id</span><span class="p">,</span> <span class="n">all_student_names</span><span class="p">):</span>
</span><span id="__span-7-157"><a id="__codelineno-7-157" name="__codelineno-7-157" href="#__codelineno-7-157"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"student_repo_id_saves"</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
</span><span id="__span-7-158"><a id="__codelineno-7-158" name="__codelineno-7-158" href="#__codelineno-7-158"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"student_repo_id_saves"</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-7-159"><a id="__codelineno-7-159" name="__codelineno-7-159" href="#__codelineno-7-159"></a>    <span class="n">all_student_repo_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-160"><a id="__codelineno-7-160" name="__codelineno-7-160" href="#__codelineno-7-160"></a>    <span class="n">all_lab_ids</span> <span class="o">=</span> <span class="n">get_subgroup_ids</span><span class="p">(</span><span class="n">year_subgroup_id</span><span class="p">)</span>
</span><span id="__span-7-161"><a id="__codelineno-7-161" name="__codelineno-7-161" href="#__codelineno-7-161"></a>
</span><span id="__span-7-162"><a id="__codelineno-7-162" name="__codelineno-7-162" href="#__codelineno-7-162"></a>    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">all_lab_ids</span><span class="p">:</span>
</span><span id="__span-7-163"><a id="__codelineno-7-163" name="__codelineno-7-163" href="#__codelineno-7-163"></a>        <span class="k">for</span> <span class="n">sub_id</span> <span class="ow">in</span> <span class="n">get_subgroup_ids</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
</span><span id="__span-7-164"><a id="__codelineno-7-164" name="__codelineno-7-164" href="#__codelineno-7-164"></a>            <span class="n">all_student_repo_ids</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">id</span><span class="p">,</span> <span class="n">get_subproject_ids</span><span class="p">(</span><span class="n">sub_id</span><span class="p">)))</span> <span class="c1"># ((i, get_subproject_ids(sub_id)))</span>
</span><span id="__span-7-165"><a id="__codelineno-7-165" name="__codelineno-7-165" href="#__codelineno-7-165"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">)</span>
</span><span id="__span-7-166"><a id="__codelineno-7-166" name="__codelineno-7-166" href="#__codelineno-7-166"></a>    <span class="n">to_return</span> <span class="o">=</span> <span class="n">filter_only_student_repos</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">,</span> <span class="n">all_student_names</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-7-167"><a id="__codelineno-7-167" name="__codelineno-7-167" href="#__codelineno-7-167"></a>    <span class="n">save_obj</span><span class="p">(</span><span class="s2">"student_repo_id_saves"</span><span class="p">,</span> <span class="n">to_return</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-7-168"><a id="__codelineno-7-168" name="__codelineno-7-168" href="#__codelineno-7-168"></a>    <span class="k">return</span> <span class="n">to_return</span>
</span><span id="__span-7-169"><a id="__codelineno-7-169" name="__codelineno-7-169" href="#__codelineno-7-169"></a>
</span><span id="__span-7-170"><a id="__codelineno-7-170" name="__codelineno-7-170" href="#__codelineno-7-170"></a><span class="k">def</span> <span class="nf">save_exists</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="__span-7-171"><a id="__codelineno-7-171" name="__codelineno-7-171" href="#__codelineno-7-171"></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.obj"</span><span class="p">)</span>
</span><span id="__span-7-172"><a id="__codelineno-7-172" name="__codelineno-7-172" href="#__codelineno-7-172"></a>
</span><span id="__span-7-173"><a id="__codelineno-7-173" name="__codelineno-7-173" href="#__codelineno-7-173"></a><span class="k">def</span> <span class="nf">load_obj</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="__span-7-174"><a id="__codelineno-7-174" name="__codelineno-7-174" href="#__codelineno-7-174"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.obj"</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">filehandler</span><span class="p">:</span>
</span><span id="__span-7-175"><a id="__codelineno-7-175" name="__codelineno-7-175" href="#__codelineno-7-175"></a>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filehandler</span><span class="p">)</span>
</span><span id="__span-7-176"><a id="__codelineno-7-176" name="__codelineno-7-176" href="#__codelineno-7-176"></a>
</span><span id="__span-7-177"><a id="__codelineno-7-177" name="__codelineno-7-177" href="#__codelineno-7-177"></a><span class="k">def</span> <span class="nf">save_obj</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="__span-7-178"><a id="__codelineno-7-178" name="__codelineno-7-178" href="#__codelineno-7-178"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.obj"</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">filehandler</span><span class="p">:</span> 
</span><span id="__span-7-179"><a id="__codelineno-7-179" name="__codelineno-7-179" href="#__codelineno-7-179"></a>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filehandler</span><span class="p">)</span>
</span><span id="__span-7-180"><a id="__codelineno-7-180" name="__codelineno-7-180" href="#__codelineno-7-180"></a>
</span><span id="__span-7-181"><a id="__codelineno-7-181" name="__codelineno-7-181" href="#__codelineno-7-181"></a><span class="c1"># go to fabacademy.org website to find student roster and all students' names and links to their websites</span>
</span><span id="__span-7-182"><a id="__codelineno-7-182" name="__codelineno-7-182" href="#__codelineno-7-182"></a><span class="k">def</span> <span class="nf">get_all_people</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
</span><span id="__span-7-183"><a id="__codelineno-7-183" name="__codelineno-7-183" href="#__codelineno-7-183"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
</span><span id="__span-7-184"><a id="__codelineno-7-184" name="__codelineno-7-184" href="#__codelineno-7-184"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-7-185"><a id="__codelineno-7-185" name="__codelineno-7-185" href="#__codelineno-7-185"></a>
</span><span id="__span-7-186"><a id="__codelineno-7-186" name="__codelineno-7-186" href="#__codelineno-7-186"></a>    <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://fabacademy.org/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/people.html"</span>
</span><span id="__span-7-187"><a id="__codelineno-7-187" name="__codelineno-7-187" href="#__codelineno-7-187"></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>
</span><span id="__span-7-188"><a id="__codelineno-7-188" name="__codelineno-7-188" href="#__codelineno-7-188"></a>
</span><span id="__span-7-189"><a id="__codelineno-7-189" name="__codelineno-7-189" href="#__codelineno-7-189"></a>    <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2018</span><span class="p">:</span>
</span><span id="__span-7-190"><a id="__codelineno-7-190" name="__codelineno-7-190" href="#__codelineno-7-190"></a>        <span class="n">lab_divs</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"div"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"class"</span><span class="p">:</span> <span class="s2">"lab"</span><span class="p">})</span>
</span><span id="__span-7-191"><a id="__codelineno-7-191" name="__codelineno-7-191" href="#__codelineno-7-191"></a>
</span><span id="__span-7-192"><a id="__codelineno-7-192" name="__codelineno-7-192" href="#__codelineno-7-192"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-193"><a id="__codelineno-7-193" name="__codelineno-7-193" href="#__codelineno-7-193"></a>
</span><span id="__span-7-194"><a id="__codelineno-7-194" name="__codelineno-7-194" href="#__codelineno-7-194"></a>        <span class="k">for</span> <span class="n">lab_div</span> <span class="ow">in</span> <span class="n">lab_divs</span><span class="p">:</span>
</span><span id="__span-7-195"><a id="__codelineno-7-195" name="__codelineno-7-195" href="#__codelineno-7-195"></a>            <span class="n">lis</span> <span class="o">=</span> <span class="n">lab_div</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"li"</span><span class="p">)</span>
</span><span id="__span-7-196"><a id="__codelineno-7-196" name="__codelineno-7-196" href="#__codelineno-7-196"></a>
</span><span id="__span-7-197"><a id="__codelineno-7-197" name="__codelineno-7-197" href="#__codelineno-7-197"></a>            <span class="n">As</span> <span class="o">=</span> <span class="p">[</span><span class="n">li</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">]</span>
</span><span id="__span-7-198"><a id="__codelineno-7-198" name="__codelineno-7-198" href="#__codelineno-7-198"></a>
</span><span id="__span-7-199"><a id="__codelineno-7-199" name="__codelineno-7-199" href="#__codelineno-7-199"></a>            <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="w"> </span><span class="s1">'-'</span><span class="p">)</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="s1">'href'</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">As</span><span class="p">]</span>        
</span><span id="__span-7-200"><a id="__codelineno-7-200" name="__codelineno-7-200" href="#__codelineno-7-200"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-7-201"><a id="__codelineno-7-201" name="__codelineno-7-201" href="#__codelineno-7-201"></a>        <span class="n">lis</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"li"</span><span class="p">)</span>
</span><span id="__span-7-202"><a id="__codelineno-7-202" name="__codelineno-7-202" href="#__codelineno-7-202"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">li</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="w"> </span><span class="s1">'-'</span><span class="p">)</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="w"> </span><span class="n">li</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="s1">'href'</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">]</span>
</span><span id="__span-7-203"><a id="__codelineno-7-203" name="__codelineno-7-203" href="#__codelineno-7-203"></a>
</span><span id="__span-7-204"><a id="__codelineno-7-204" name="__codelineno-7-204" href="#__codelineno-7-204"></a>    <span class="n">save_obj</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-7-205"><a id="__codelineno-7-205" name="__codelineno-7-205" href="#__codelineno-7-205"></a>
</span><span id="__span-7-206"><a id="__codelineno-7-206" name="__codelineno-7-206" href="#__codelineno-7-206"></a>    <span class="k">return</span> <span class="n">names</span>
</span><span id="__span-7-207"><a id="__codelineno-7-207" name="__codelineno-7-207" href="#__codelineno-7-207"></a>
</span><span id="__span-7-208"><a id="__codelineno-7-208" name="__codelineno-7-208" href="#__codelineno-7-208"></a><span class="c1"># scan a repo for references to another student's documentation</span>
</span><span id="__span-7-209"><a id="__codelineno-7-209" name="__codelineno-7-209" href="#__codelineno-7-209"></a><span class="k">def</span> <span class="nf">get_references</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">from_url</span><span class="p">):</span>
</span><span id="__span-7-210"><a id="__codelineno-7-210" name="__codelineno-7-210" href="#__codelineno-7-210"></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">f</span><span class="s2">"\/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">\/labs\/[^\/]+\/students\/(\w|-)+\/"</span><span class="p">)</span>
</span><span id="__span-7-211"><a id="__codelineno-7-211" name="__codelineno-7-211" href="#__codelineno-7-211"></a>    <span class="n">people_linked</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-212"><a id="__codelineno-7-212" name="__codelineno-7-212" href="#__codelineno-7-212"></a>    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">)):</span>
</span><span id="__span-7-213"><a id="__codelineno-7-213" name="__codelineno-7-213" href="#__codelineno-7-213"></a>        <span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://fabacademy.org</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-7-214"><a id="__codelineno-7-214" name="__codelineno-7-214" href="#__codelineno-7-214"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"FULL URL </span><span class="si">{</span><span class="n">full_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-215"><a id="__codelineno-7-215" name="__codelineno-7-215" href="#__codelineno-7-215"></a>        <span class="n">person</span> <span class="o">=</span> <span class="n">format_name</span><span class="p">((</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">full_url</span><span class="p">),</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-7-216"><a id="__codelineno-7-216" name="__codelineno-7-216" href="#__codelineno-7-216"></a>
</span><span id="__span-7-217"><a id="__codelineno-7-217" name="__codelineno-7-217" href="#__codelineno-7-217"></a>        <span class="n">link_label</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-7-218"><a id="__codelineno-7-218" name="__codelineno-7-218" href="#__codelineno-7-218"></a>
</span><span id="__span-7-219"><a id="__codelineno-7-219" name="__codelineno-7-219" href="#__codelineno-7-219"></a>        <span class="n">topic_search_start_ind</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">-</span> <span class="n">CHARACTERS_EACH_DIRECTION_TOPIC_DETECTION</span>
</span><span id="__span-7-220"><a id="__codelineno-7-220" name="__codelineno-7-220" href="#__codelineno-7-220"></a>        <span class="k">if</span> <span class="n">topic_search_start_ind</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-7-221"><a id="__codelineno-7-221" name="__codelineno-7-221" href="#__codelineno-7-221"></a>            <span class="n">topic_search_start_ind</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-7-222"><a id="__codelineno-7-222" name="__codelineno-7-222" href="#__codelineno-7-222"></a>        <span class="n">topic_search_end_ind</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="o">+</span> <span class="n">CHARACTERS_EACH_DIRECTION_TOPIC_DETECTION</span>
</span><span id="__span-7-223"><a id="__codelineno-7-223" name="__codelineno-7-223" href="#__codelineno-7-223"></a>        <span class="k">if</span> <span class="n">topic_search_end_ind</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
</span><span id="__span-7-224"><a id="__codelineno-7-224" name="__codelineno-7-224" href="#__codelineno-7-224"></a>            <span class="n">topic_search_end_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="__span-7-225"><a id="__codelineno-7-225" name="__codelineno-7-225" href="#__codelineno-7-225"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="si">}</span><span class="s2">) -&gt; (</span><span class="si">{</span><span class="n">topic_search_start_ind</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">topic_search_end_ind</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-7-226"><a id="__codelineno-7-226" name="__codelineno-7-226" href="#__codelineno-7-226"></a>        <span class="n">topic_text</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="n">topic_search_start_ind</span><span class="p">:</span><span class="n">topic_search_end_ind</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="__span-7-227"><a id="__codelineno-7-227" name="__codelineno-7-227" href="#__codelineno-7-227"></a>
</span><span id="__span-7-228"><a id="__codelineno-7-228" name="__codelineno-7-228" href="#__codelineno-7-228"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"TOPIC TEXT"</span><span class="p">,</span> <span class="n">topic_text</span><span class="p">)</span>
</span><span id="__span-7-229"><a id="__codelineno-7-229" name="__codelineno-7-229" href="#__codelineno-7-229"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TOPICS</span><span class="p">)):</span>
</span><span id="__span-7-230"><a id="__codelineno-7-230" name="__codelineno-7-230" href="#__codelineno-7-230"></a>            <span class="n">topic</span> <span class="o">=</span> <span class="n">TOPICS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-7-231"><a id="__codelineno-7-231" name="__codelineno-7-231" href="#__codelineno-7-231"></a>            <span class="n">topic_search_terms</span> <span class="o">=</span> <span class="n">TOPIC_SEARCH_TERMS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-7-232"><a id="__codelineno-7-232" name="__codelineno-7-232" href="#__codelineno-7-232"></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">topic_search_terms</span><span class="p">:</span>
</span><span id="__span-7-233"><a id="__codelineno-7-233" name="__codelineno-7-233" href="#__codelineno-7-233"></a>                <span class="n">item_spaces</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-7-234"><a id="__codelineno-7-234" name="__codelineno-7-234" href="#__codelineno-7-234"></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">item_spaces</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"."</span><span class="p">)),</span> <span class="n">topic_text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">item_spaces</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"-"</span><span class="p">)),</span> <span class="n">topic_text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">item_spaces</span><span class="p">),</span> <span class="n">topic_text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">item_spaces</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">""</span><span class="p">)),</span> <span class="n">topic_text</span><span class="p">):</span>
</span><span id="__span-7-235"><a id="__codelineno-7-235" name="__codelineno-7-235" href="#__codelineno-7-235"></a>                    <span class="n">link_label</span> <span class="o">=</span> <span class="n">topic</span>
</span><span id="__span-7-236"><a id="__codelineno-7-236" name="__codelineno-7-236" href="#__codelineno-7-236"></a>
</span><span id="__span-7-237"><a id="__codelineno-7-237" name="__codelineno-7-237" href="#__codelineno-7-237"></a>        <span class="k">if</span> <span class="n">link_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-7-238"><a id="__codelineno-7-238" name="__codelineno-7-238" href="#__codelineno-7-238"></a>            <span class="k">continue</span>
</span><span id="__span-7-239"><a id="__codelineno-7-239" name="__codelineno-7-239" href="#__codelineno-7-239"></a>
</span><span id="__span-7-240"><a id="__codelineno-7-240" name="__codelineno-7-240" href="#__codelineno-7-240"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"NLP_data/train.jsonl"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-7-241"><a id="__codelineno-7-241" name="__codelineno-7-241" href="#__codelineno-7-241"></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'{'</span> <span class="o">+</span> <span class="s1">'"text": '</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">topic_text</span><span class="p">)</span> <span class="o">+</span> <span class="s1">', "label": "'</span> <span class="o">+</span> <span class="n">link_label</span> <span class="o">+</span> <span class="s1">'", "metadata": '</span><span class="o">+</span> <span class="s1">'{'</span> <span class="o">+</span> <span class="s1">'"from": "'</span> <span class="o">+</span> <span class="n">from_url</span> <span class="o">+</span> <span class="s1">'", "to": "'</span> <span class="o">+</span> <span class="n">full_url</span> <span class="o">+</span> <span class="s1">'"'</span> <span class="o">+</span> <span class="s1">'}'</span> <span class="o">+</span> <span class="s1">'}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</span><span id="__span-7-242"><a id="__codelineno-7-242" name="__codelineno-7-242" href="#__codelineno-7-242"></a>
</span><span id="__span-7-243"><a id="__codelineno-7-243" name="__codelineno-7-243" href="#__codelineno-7-243"></a>        <span class="k">if</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">people_linked</span><span class="p">:</span>
</span><span id="__span-7-244"><a id="__codelineno-7-244" name="__codelineno-7-244" href="#__codelineno-7-244"></a>            <span class="k">if</span> <span class="n">link_label</span> <span class="ow">in</span> <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>
</span><span id="__span-7-245"><a id="__codelineno-7-245" name="__codelineno-7-245" href="#__codelineno-7-245"></a>                <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">link_label</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-7-246"><a id="__codelineno-7-246" name="__codelineno-7-246" href="#__codelineno-7-246"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-7-247"><a id="__codelineno-7-247" name="__codelineno-7-247" href="#__codelineno-7-247"></a>            <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-248"><a id="__codelineno-7-248" name="__codelineno-7-248" href="#__codelineno-7-248"></a>            <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">link_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-7-249"><a id="__codelineno-7-249" name="__codelineno-7-249" href="#__codelineno-7-249"></a>
</span><span id="__span-7-250"><a id="__codelineno-7-250" name="__codelineno-7-250" href="#__codelineno-7-250"></a>    <span class="k">return</span> <span class="n">people_linked</span>
</span><span id="__span-7-251"><a id="__codelineno-7-251" name="__codelineno-7-251" href="#__codelineno-7-251"></a>
</span><span id="__span-7-252"><a id="__codelineno-7-252" name="__codelineno-7-252" href="#__codelineno-7-252"></a><span class="c1"># combine students' dictionaries of references to other's websites</span>
</span><span id="__span-7-253"><a id="__codelineno-7-253" name="__codelineno-7-253" href="#__codelineno-7-253"></a><span class="k">def</span> <span class="nf">combine_reference_dicts</span><span class="p">(</span><span class="n">reference_dict_list</span><span class="p">):</span>
</span><span id="__span-7-254"><a id="__codelineno-7-254" name="__codelineno-7-254" href="#__codelineno-7-254"></a>    <span class="n">combined_reference_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-7-255"><a id="__codelineno-7-255" name="__codelineno-7-255" href="#__codelineno-7-255"></a>    <span class="k">for</span> <span class="nb">dict</span> <span class="ow">in</span> <span class="n">reference_dict_list</span><span class="p">:</span>
</span><span id="__span-7-256"><a id="__codelineno-7-256" name="__codelineno-7-256" href="#__codelineno-7-256"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-7-257"><a id="__codelineno-7-257" name="__codelineno-7-257" href="#__codelineno-7-257"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">combined_reference_dict</span><span class="p">:</span>
</span><span id="__span-7-258"><a id="__codelineno-7-258" name="__codelineno-7-258" href="#__codelineno-7-258"></a>                <span class="k">for</span> <span class="n">topic_key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
</span><span id="__span-7-259"><a id="__codelineno-7-259" name="__codelineno-7-259" href="#__codelineno-7-259"></a>                    <span class="k">if</span> <span class="n">topic_key</span> <span class="ow">in</span> <span class="n">combined_reference_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
</span><span id="__span-7-260"><a id="__codelineno-7-260" name="__codelineno-7-260" href="#__codelineno-7-260"></a>                        <span class="n">combined_reference_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">topic_key</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">topic_key</span><span class="p">]</span>
</span><span id="__span-7-261"><a id="__codelineno-7-261" name="__codelineno-7-261" href="#__codelineno-7-261"></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-7-262"><a id="__codelineno-7-262" name="__codelineno-7-262" href="#__codelineno-7-262"></a>                        <span class="n">combined_reference_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">topic_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">topic_key</span><span class="p">]</span>
</span><span id="__span-7-263"><a id="__codelineno-7-263" name="__codelineno-7-263" href="#__codelineno-7-263"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-7-264"><a id="__codelineno-7-264" name="__codelineno-7-264" href="#__codelineno-7-264"></a>                <span class="n">combined_reference_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> 
</span><span id="__span-7-265"><a id="__codelineno-7-265" name="__codelineno-7-265" href="#__codelineno-7-265"></a>    <span class="k">return</span> <span class="n">combined_reference_dict</span>
</span><span id="__span-7-266"><a id="__codelineno-7-266" name="__codelineno-7-266" href="#__codelineno-7-266"></a>
</span><span id="__span-7-267"><a id="__codelineno-7-267" name="__codelineno-7-267" href="#__codelineno-7-267"></a><span class="c1"># convert data to Pandas crosstab matrix</span>
</span><span id="__span-7-268"><a id="__codelineno-7-268" name="__codelineno-7-268" href="#__codelineno-7-268"></a><span class="k">def</span> <span class="nf">format_data_to_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="__span-7-269"><a id="__codelineno-7-269" name="__codelineno-7-269" href="#__codelineno-7-269"></a>    <span class="n">students</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-270"><a id="__codelineno-7-270" name="__codelineno-7-270" href="#__codelineno-7-270"></a>
</span><span id="__span-7-271"><a id="__codelineno-7-271" name="__codelineno-7-271" href="#__codelineno-7-271"></a>    <span class="k">for</span> <span class="n">year_info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span> <span class="c1"># [(lab_id: int, {"Student Name": {"student-referenced": num_references: int, ...}}), ...]</span>
</span><span id="__span-7-272"><a id="__codelineno-7-272" name="__codelineno-7-272" href="#__codelineno-7-272"></a>        <span class="k">for</span> <span class="n">student_info</span> <span class="ow">in</span> <span class="n">year_info</span><span class="p">:</span> <span class="c1"># (lab_id: int, {"Student Name": {"student-referenced": num_references: int, ...}})</span>
</span><span id="__span-7-273"><a id="__codelineno-7-273" name="__codelineno-7-273" href="#__codelineno-7-273"></a>            <span class="n">lab_id</span> <span class="o">=</span> <span class="n">student_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
</span><span id="__span-7-274"><a id="__codelineno-7-274" name="__codelineno-7-274" href="#__codelineno-7-274"></a>            <span class="n">student_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-275"><a id="__codelineno-7-275" name="__codelineno-7-275" href="#__codelineno-7-275"></a>            <span class="n">reference_dict</span> <span class="o">=</span> <span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="__span-7-276"><a id="__codelineno-7-276" name="__codelineno-7-276" href="#__codelineno-7-276"></a>            <span class="n">students</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">student_name</span><span class="p">)</span> 
</span><span id="__span-7-277"><a id="__codelineno-7-277" name="__codelineno-7-277" href="#__codelineno-7-277"></a>
</span><span id="__span-7-278"><a id="__codelineno-7-278" name="__codelineno-7-278" href="#__codelineno-7-278"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"STUDENTS"</span><span class="p">,</span> <span class="n">students</span><span class="p">)</span>
</span><span id="__span-7-279"><a id="__codelineno-7-279" name="__codelineno-7-279" href="#__codelineno-7-279"></a>
</span><span id="__span-7-280"><a id="__codelineno-7-280" name="__codelineno-7-280" href="#__codelineno-7-280"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">students</span><span class="p">)</span>
</span><span id="__span-7-281"><a id="__codelineno-7-281" name="__codelineno-7-281" href="#__codelineno-7-281"></a>    <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">"Referencing Students"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-7-282"><a id="__codelineno-7-282" name="__codelineno-7-282" href="#__codelineno-7-282"></a>    <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">"Referenced Students"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-7-283"><a id="__codelineno-7-283" name="__codelineno-7-283" href="#__codelineno-7-283"></a>
</span><span id="__span-7-284"><a id="__codelineno-7-284" name="__codelineno-7-284" href="#__codelineno-7-284"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">TOPICS</span><span class="p">]))</span>
</span><span id="__span-7-285"><a id="__codelineno-7-285" name="__codelineno-7-285" href="#__codelineno-7-285"></a>
</span><span id="__span-7-286"><a id="__codelineno-7-286" name="__codelineno-7-286" href="#__codelineno-7-286"></a>    <span class="k">for</span> <span class="n">student1</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-7-287"><a id="__codelineno-7-287" name="__codelineno-7-287" href="#__codelineno-7-287"></a>        <span class="k">for</span> <span class="n">student2</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-7-288"><a id="__codelineno-7-288" name="__codelineno-7-288" href="#__codelineno-7-288"></a>            <span class="k">for</span> <span class="n">topic_name</span> <span class="ow">in</span> <span class="n">TOPICS</span><span class="p">:</span>
</span><span id="__span-7-289"><a id="__codelineno-7-289" name="__codelineno-7-289" href="#__codelineno-7-289"></a>                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">student1</span><span class="p">,</span> <span class="p">(</span><span class="n">student2</span><span class="p">,</span> <span class="n">topic_name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span> <span class="k">if</span> <span class="n">student1</span> <span class="o">==</span> <span class="n">student2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-7-290"><a id="__codelineno-7-290" name="__codelineno-7-290" href="#__codelineno-7-290"></a>
</span><span id="__span-7-291"><a id="__codelineno-7-291" name="__codelineno-7-291" href="#__codelineno-7-291"></a>    <span class="k">def</span> <span class="nf">assign_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-7-292"><a id="__codelineno-7-292" name="__codelineno-7-292" href="#__codelineno-7-292"></a>        <span class="k">if</span> <span class="n">referencer_student</span> <span class="o">==</span> <span class="n">referenced_student</span><span class="p">:</span>
</span><span id="__span-7-293"><a id="__codelineno-7-293" name="__codelineno-7-293" href="#__codelineno-7-293"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ignoring self-referenced student </span><span class="si">{</span><span class="n">referencer_student</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-294"><a id="__codelineno-7-294" name="__codelineno-7-294" href="#__codelineno-7-294"></a>        <span class="k">elif</span> <span class="n">referenced_student</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-7-295"><a id="__codelineno-7-295" name="__codelineno-7-295" href="#__codelineno-7-295"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Referenced student isn't a student - URL matched naming convention so regex caught but wasn't checked against student list - skipping"</span><span class="p">)</span>
</span><span id="__span-7-296"><a id="__codelineno-7-296" name="__codelineno-7-296" href="#__codelineno-7-296"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-7-297"><a id="__codelineno-7-297" name="__codelineno-7-297" href="#__codelineno-7-297"></a>            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">num_references</span>
</span><span id="__span-7-298"><a id="__codelineno-7-298" name="__codelineno-7-298" href="#__codelineno-7-298"></a>
</span><span id="__span-7-299"><a id="__codelineno-7-299" name="__codelineno-7-299" href="#__codelineno-7-299"></a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-7-300"><a id="__codelineno-7-300" name="__codelineno-7-300" href="#__codelineno-7-300"></a>        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span>
</span><span id="__span-7-301"><a id="__codelineno-7-301" name="__codelineno-7-301" href="#__codelineno-7-301"></a>
</span><span id="__span-7-302"><a id="__codelineno-7-302" name="__codelineno-7-302" href="#__codelineno-7-302"></a>    <span class="k">for</span> <span class="n">year_info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-7-303"><a id="__codelineno-7-303" name="__codelineno-7-303" href="#__codelineno-7-303"></a>        <span class="k">for</span> <span class="n">student_info</span> <span class="ow">in</span> <span class="n">year_info</span><span class="p">:</span>
</span><span id="__span-7-304"><a id="__codelineno-7-304" name="__codelineno-7-304" href="#__codelineno-7-304"></a>            <span class="n">student_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-305"><a id="__codelineno-7-305" name="__codelineno-7-305" href="#__codelineno-7-305"></a>            <span class="n">reference_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">student_name</span><span class="p">])</span>
</span><span id="__span-7-306"><a id="__codelineno-7-306" name="__codelineno-7-306" href="#__codelineno-7-306"></a>            <span class="k">for</span> <span class="n">referenced_student</span> <span class="ow">in</span> <span class="n">reference_dict</span><span class="p">:</span>
</span><span id="__span-7-307"><a id="__codelineno-7-307" name="__codelineno-7-307" href="#__codelineno-7-307"></a>                <span class="k">for</span> <span class="n">reference_type</span> <span class="ow">in</span> <span class="n">reference_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="p">]:</span>
</span><span id="__span-7-308"><a id="__codelineno-7-308" name="__codelineno-7-308" href="#__codelineno-7-308"></a>                    <span class="n">num_references</span> <span class="o">=</span> <span class="n">reference_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="p">][</span><span class="n">reference_type</span><span class="p">]</span>
</span><span id="__span-7-309"><a id="__codelineno-7-309" name="__codelineno-7-309" href="#__codelineno-7-309"></a>                    <span class="n">assign_value</span><span class="p">(</span><span class="n">student_name</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">reference_type</span><span class="p">)</span>
</span><span id="__span-7-310"><a id="__codelineno-7-310" name="__codelineno-7-310" href="#__codelineno-7-310"></a>
</span><span id="__span-7-311"><a id="__codelineno-7-311" name="__codelineno-7-311" href="#__codelineno-7-311"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"final_data.csv"</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">"Referencing Students|Referenced Students"</span><span class="p">)</span>
</span><span id="__span-7-312"><a id="__codelineno-7-312" name="__codelineno-7-312" href="#__codelineno-7-312"></a>
</span><span id="__span-7-313"><a id="__codelineno-7-313" name="__codelineno-7-313" href="#__codelineno-7-313"></a>    <span class="k">return</span> <span class="n">df</span>
</span><span id="__span-7-314"><a id="__codelineno-7-314" name="__codelineno-7-314" href="#__codelineno-7-314"></a>
</span><span id="__span-7-315"><a id="__codelineno-7-315" name="__codelineno-7-315" href="#__codelineno-7-315"></a><span class="c1"># get all of the reference dictionaries of different students for a given year</span>
</span><span id="__span-7-316"><a id="__codelineno-7-316" name="__codelineno-7-316" href="#__codelineno-7-316"></a><span class="k">def</span> <span class="nf">get_all_reference_dicts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
</span><span id="__span-7-317"><a id="__codelineno-7-317" name="__codelineno-7-317" href="#__codelineno-7-317"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-7-318"><a id="__codelineno-7-318" name="__codelineno-7-318" href="#__codelineno-7-318"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"reference_dict_saves"</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="__span-7-319"><a id="__codelineno-7-319" name="__codelineno-7-319" href="#__codelineno-7-319"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Save exists! </span><span class="si">{</span><span class="n">load_obj</span><span class="p">(</span><span class="s1">'reference_dict_saves'</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-320"><a id="__codelineno-7-320" name="__codelineno-7-320" href="#__codelineno-7-320"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"reference_dict_saves"</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-7-321"><a id="__codelineno-7-321" name="__codelineno-7-321" href="#__codelineno-7-321"></a>    <span class="n">reference_dict_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-322"><a id="__codelineno-7-322" name="__codelineno-7-322" href="#__codelineno-7-322"></a>    <span class="n">default_branch_name_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/projects/</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">/repository/branches"</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-7-323"><a id="__codelineno-7-323" name="__codelineno-7-323" href="#__codelineno-7-323"></a>    <span class="n">default_branch_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-7-324"><a id="__codelineno-7-324" name="__codelineno-7-324" href="#__codelineno-7-324"></a>    <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">default_branch_name_response</span><span class="p">:</span>
</span><span id="__span-7-325"><a id="__codelineno-7-325" name="__codelineno-7-325" href="#__codelineno-7-325"></a>        <span class="k">if</span> <span class="n">branch</span><span class="p">[</span><span class="s1">'default'</span><span class="p">]:</span>
</span><span id="__span-7-326"><a id="__codelineno-7-326" name="__codelineno-7-326" href="#__codelineno-7-326"></a>            <span class="n">default_branch_name</span> <span class="o">=</span> <span class="n">branch</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
</span><span id="__span-7-327"><a id="__codelineno-7-327" name="__codelineno-7-327" href="#__codelineno-7-327"></a>    <span class="k">if</span> <span class="n">default_branch_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-7-328"><a id="__codelineno-7-328" name="__codelineno-7-328" href="#__codelineno-7-328"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error: Default Branch Not Found (id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">default_branch_name_response</span><span class="si">}</span><span class="s2"> - leaving as None"</span><span class="p">)</span>
</span><span id="__span-7-329"><a id="__codelineno-7-329" name="__codelineno-7-329" href="#__codelineno-7-329"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-7-330"><a id="__codelineno-7-330" name="__codelineno-7-330" href="#__codelineno-7-330"></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">get_file_repo_list</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
</span><span id="__span-7-331"><a id="__codelineno-7-331" name="__codelineno-7-331" href="#__codelineno-7-331"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Checking </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
</span><span id="__span-7-332"><a id="__codelineno-7-332" name="__codelineno-7-332" href="#__codelineno-7-332"></a>            <span class="n">reference_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_references</span><span class="p">(</span><span class="n">get_file_content</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">default_branch_name</span><span class="p">),</span> <span class="n">year</span><span class="p">,</span> <span class="n">get_repo_name</span><span class="p">(</span><span class="nb">id</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="__span-7-333"><a id="__codelineno-7-333" name="__codelineno-7-333" href="#__codelineno-7-333"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Generating compiled reference dictionary..."</span><span class="p">)</span>
</span><span id="__span-7-334"><a id="__codelineno-7-334" name="__codelineno-7-334" href="#__codelineno-7-334"></a>        <span class="n">compiled_reference_dict</span> <span class="o">=</span> <span class="n">combine_reference_dicts</span><span class="p">(</span><span class="n">reference_dict_list</span><span class="p">)</span>
</span><span id="__span-7-335"><a id="__codelineno-7-335" name="__codelineno-7-335" href="#__codelineno-7-335"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">compiled_reference_dict</span><span class="p">)</span>
</span><span id="__span-7-336"><a id="__codelineno-7-336" name="__codelineno-7-336" href="#__codelineno-7-336"></a>        <span class="n">save_obj</span><span class="p">(</span><span class="s2">"reference_dict_saves"</span><span class="p">,</span> <span class="n">compiled_reference_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-7-337"><a id="__codelineno-7-337" name="__codelineno-7-337" href="#__codelineno-7-337"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"SAVING to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-338"><a id="__codelineno-7-338" name="__codelineno-7-338" href="#__codelineno-7-338"></a>        <span class="k">return</span> <span class="n">compiled_reference_dict</span>
</span><span id="__span-7-339"><a id="__codelineno-7-339" name="__codelineno-7-339" href="#__codelineno-7-339"></a>    <span class="k">except</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GitlabGetError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-7-340"><a id="__codelineno-7-340" name="__codelineno-7-340" href="#__codelineno-7-340"></a>        <span class="k">return</span> <span class="n">combine_reference_dicts</span><span class="p">(</span><span class="n">reference_dict_list</span><span class="p">)</span>
</span><span id="__span-7-341"><a id="__codelineno-7-341" name="__codelineno-7-341" href="#__codelineno-7-341"></a>
</span><span id="__span-7-342"><a id="__codelineno-7-342" name="__codelineno-7-342" href="#__codelineno-7-342"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-7-343"><a id="__codelineno-7-343" name="__codelineno-7-343" href="#__codelineno-7-343"></a>    <span class="n">reference_dicts_across_years</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [[(lab_id: id (int), {"Student Name": {"student-referenced": num_references: (int), ...}}), ...], ...]</span>
</span><span id="__span-7-344"><a id="__codelineno-7-344" name="__codelineno-7-344" href="#__codelineno-7-344"></a>
</span><span id="__span-7-345"><a id="__codelineno-7-345" name="__codelineno-7-345" href="#__codelineno-7-345"></a>    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">2024</span><span class="p">):</span>
</span><span id="__span-7-346"><a id="__codelineno-7-346" name="__codelineno-7-346" href="#__codelineno-7-346"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Loading student names..."</span><span class="p">)</span>
</span><span id="__span-7-347"><a id="__codelineno-7-347" name="__codelineno-7-347" href="#__codelineno-7-347"></a>        <span class="n">all_student_names</span> <span class="o">=</span> <span class="n">get_all_people</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
</span><span id="__span-7-348"><a id="__codelineno-7-348" name="__codelineno-7-348" href="#__codelineno-7-348"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">all_student_names</span><span class="p">)</span>
</span><span id="__span-7-349"><a id="__codelineno-7-349" name="__codelineno-7-349" href="#__codelineno-7-349"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Collecting student repo IDs..."</span><span class="p">)</span>
</span><span id="__span-7-350"><a id="__codelineno-7-350" name="__codelineno-7-350" href="#__codelineno-7-350"></a>        <span class="n">all_student_repo_ids</span> <span class="o">=</span> <span class="n">get_all_student_repo_ids</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">ALL_LAB_SUBGROUP_IDS</span><span class="p">[</span><span class="n">year</span><span class="p">],</span> <span class="n">all_student_names</span><span class="p">)</span>
</span><span id="__span-7-351"><a id="__codelineno-7-351" name="__codelineno-7-351" href="#__codelineno-7-351"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">)</span>
</span><span id="__span-7-352"><a id="__codelineno-7-352" name="__codelineno-7-352" href="#__codelineno-7-352"></a>
</span><span id="__span-7-353"><a id="__codelineno-7-353" name="__codelineno-7-353" href="#__codelineno-7-353"></a>        <span class="n">all_reference_dicts</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [(lab_id: id (int), {"Student Name": {"student-referenced": num_references: 9d (int), ...}}), ...]</span>
</span><span id="__span-7-354"><a id="__codelineno-7-354" name="__codelineno-7-354" href="#__codelineno-7-354"></a>
</span><span id="__span-7-355"><a id="__codelineno-7-355" name="__codelineno-7-355" href="#__codelineno-7-355"></a>        <span class="k">for</span> <span class="n">lab_number</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">all_student_repo_ids</span><span class="p">:</span>
</span><span id="__span-7-356"><a id="__codelineno-7-356" name="__codelineno-7-356" href="#__codelineno-7-356"></a>            <span class="n">reference_dict_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-357"><a id="__codelineno-7-357" name="__codelineno-7-357" href="#__codelineno-7-357"></a>
</span><span id="__span-7-358"><a id="__codelineno-7-358" name="__codelineno-7-358" href="#__codelineno-7-358"></a>            <span class="n">compiled_reference_dict</span> <span class="o">=</span> <span class="n">get_all_reference_dicts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</span><span id="__span-7-359"><a id="__codelineno-7-359" name="__codelineno-7-359" href="#__codelineno-7-359"></a>
</span><span id="__span-7-360"><a id="__codelineno-7-360" name="__codelineno-7-360" href="#__codelineno-7-360"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Adding reference dictionary to database..."</span><span class="p">)</span>
</span><span id="__span-7-361"><a id="__codelineno-7-361" name="__codelineno-7-361" href="#__codelineno-7-361"></a>            <span class="n">all_reference_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lab_number</span><span class="p">,</span> <span class="p">{</span><span class="n">format_name</span><span class="p">(</span><span class="n">get_repo_name</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">year</span><span class="p">):</span> <span class="n">compiled_reference_dict</span><span class="p">}))</span>
</span><span id="__span-7-362"><a id="__codelineno-7-362" name="__codelineno-7-362" href="#__codelineno-7-362"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"All reference dictionaries so far... </span><span class="si">{</span><span class="n">all_reference_dicts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-7-363"><a id="__codelineno-7-363" name="__codelineno-7-363" href="#__codelineno-7-363"></a>        <span class="n">reference_dicts_across_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_reference_dicts</span><span class="p">)</span>
</span><span id="__span-7-364"><a id="__codelineno-7-364" name="__codelineno-7-364" href="#__codelineno-7-364"></a>
</span><span id="__span-7-365"><a id="__codelineno-7-365" name="__codelineno-7-365" href="#__codelineno-7-365"></a>
</span><span id="__span-7-366"><a id="__codelineno-7-366" name="__codelineno-7-366" href="#__codelineno-7-366"></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">format_data_to_matrix</span><span class="p">(</span><span class="n">reference_dicts_across_years</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="step-2-ai-sorting-data-analysis_1">Step 2: AI, Sorting Data &amp; Analysis</h3>
<p><a href="../../assets/code/step2-python-cache-pickle-jsonl-csv.zip">Download the Python code and all other files for Step 2 here!</a> <em>(10.6 MB)</em></p>
<p><a href="../../assets/code/step2-pickle-jsonl-csv.zip">Download the neural network, training data, and final data for Step 2 here! (no cached pickle objects for data collection)</a> <em>(9.8 MB)</em></p>
<p><a href="../../assets/code/step2-python.zip">Download only the Python code for Step 2 here!</a></p>
<h4 id="training-the-model">Training the Model</h4>
<p>Before running the training, I had to format the trianing data from a <code>jsonl</code> to a <code>csv</code> file. So, I wrote <code>jsonl2csv.py</code> to convert the JSON objects into CSV format. I used a number to signify each subject-area (each will correspond to an output node in the neural network) and save the exported dataframe as <code>NLP_data/train.csv</code>.</p>
<p><em>jsonl2csv.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">string</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">DATA_LABELS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="s2">"Prefab"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="s2">"Computer-Aided Design"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="s2">"Computer-Controlled Cutting"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="s2">"Embedded Programing"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="s2">"3D Scanning and Printing"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="s2">"Electronics Design"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="s2">"Computer-Controlled Machining"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    <span class="s2">"Electronics Production"</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    <span class="s2">"Input Devices"</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    <span class="s2">"Moulding and Casting"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>    <span class="s2">"Output Devices"</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    <span class="s2">"Embedded Networking and Communications"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    <span class="s2">"Interface and Application Programming"</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>    <span class="s2">"Wildcard Week"</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    <span class="s2">"Applications and Implications"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    <span class="s2">"Final Project"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>    <span class="s2">"Other"</span><span class="p">:</span> <span class="mi">18</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="p">}</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>    <span class="n">txts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>    <span class="n">tos</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>    <span class="n">froms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'NLP_data/train.jsonl'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonl</span><span class="p">:</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">jsonl</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>            <span class="n">j</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>            <span class="n">txts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]</span> <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">printable</span><span class="p">)]))</span> <span class="c1"># string.printable removes non-ASCII chars to avoid writing errors</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DATA_LABELS</span><span class="p">[</span><span class="n">j</span><span class="p">[</span><span class="s1">'label'</span><span class="p">]])</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>            <span class="n">tos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s1">'metadata'</span><span class="p">][</span><span class="s1">'to'</span><span class="p">])</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>            <span class="n">froms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s1">'metadata'</span><span class="p">][</span><span class="s1">'from'</span><span class="p">])</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>    <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>        <span class="s2">"Text"</span><span class="p">:</span> <span class="n">txts</span><span class="p">,</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>        <span class="s2">"Labels"</span><span class="p">:</span> <span class="n">labels</span><span class="p">,</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>        <span class="s2">"To"</span><span class="p">:</span> <span class="n">tos</span><span class="p">,</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>        <span class="s2">"From"</span><span class="p">:</span> <span class="n">froms</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>    <span class="p">}</span>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"NLP_data/train.csv"</span><span class="p">)</span>
</span></code></pre></div>
<p>To train the model in <code>train_nn.py</code>, I used the Python machine-learning libraries <a href="https://pytorch.org/"><code>PyTorch</code></a> and <a href="https://scikit-learn.org/stable/"><code>Sci-Kit Learn</code></a>. I'll break the code into sections then provide the entire file below.</p>
<p>First, I loaded the CSV with Pandas, stored the 2,000 blocks and their lables in two series, and used <code>train_test_split</code> from <code>sklearn.model_selection</code> to put 80% of the data into a training set and 20% into a testing set.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Read the CSV file</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'NLP_data/train.csv'</span><span class="p">)</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># Columns are named 'Text' and 'Labels'</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">texts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Text'</span><span class="p">]</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="n">labels</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Labels'</span><span class="p">]</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="c1"># Split the dataset into training and test sets</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span></code></pre></div>
<p>Then, using the <code>CountVectorizer</code> from <code>sklearn.feature_extraction.text</code>, I vectorized the training and test data. You can read about the <a href="https://www.google.com/search?q=sklelarn+count+vectorizer&amp;rlz=1C1RXQR_enUS1018US1018&amp;oq=sklelarn+count+vectorizer&amp;gs_lcrp=EgZjaHJvbWUyBggAEEUYOTILCAEQABgKGA0YgAQyDQgCEAAYhgMYgAQYigUyDQgDEAAYhgMYgAQYigUyDQgEEAAYhgMYgAQYigUyDQgFEAAYhgMYgAQYigXSAQgyMTE4ajBqN6gCALACAA&amp;sourceid=chrome&amp;ie=UTF-8"><code>CountVectorizer</code> here</a>.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Convert the texts into vectors</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>  <span class="c1"># limit to 5000 most frequent words/tokens</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">X_train</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">X_test</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span></code></pre></div>
<p>I pickled and saved the vectorizer object.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Save the vectorizer</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">vectorizer</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"vectorizer.pickle"</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">))</span>
</span></code></pre></div>
<p>Next I converted the train and test data to <a href="https://numpy.org/doc/stable/reference/generated/numpy.array.html">NumPy arrays</a> then <a href="https://pytorch.org/docs/stable/tensors.html">PyTorch tensors</a>.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Convert the vectors and labels to numpy arrays</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="n">X_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">X_test</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">y_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">y_test</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
</span></code></pre></div>
<p>Then I defined the <code>TextClassifer</code> neural network class. There are three layers: input, hidden, and output. Adjacent layers are <a href="https://stanford.edu/~shervine/teaching/cs-230/cheatsheet-convolutional-neural-networks#:~:text=Fully%20Connected%20(FC)%20The%20fully,objectives%20such%20as%20class%20scores.">fully connected (FC)</a> (also called <a href="https://docs.nvidia.com/deeplearning/performance/dl-performance-fully-connected/index.html"><code>linear</code> layers</a>). The network also implements <a href="https://www.analyticsvidhya.com/blog/2022/08/dropout-regularization-in-deep-learning/#:~:text=Dropout%20is%20a%20regularization%20method,connectedness%20to%20the%20preceding%20layer.">dropout</a> and the <a href="https://pytorch.org/docs/stable/generated/torch.nn.ReLU.html">ReLU activaition function</a> before the hidden layer.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">class</span> <span class="nc">TextClassifier</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">,</span> <span class="n">dropout_prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">TextClassifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_prob</span><span class="p">)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        <span class="k">return</span> <span class="n">x</span>
</span></code></pre></div>
<p>Next, to begin finding the optimal hyperparameter combinations, I defined a list of values of <code>learning rate</code> and <code>dropout rate</code> to try, as well as a function to train the network with a specified value for each of these hyperparameters. The dimensions of the network are <code>5000x200x18</code>. The training runs 100 <a href="https://www.baeldung.com/cs/epoch-neural-networks">epochs</a> using the <a href="https://pytorch.org/docs/stable/generated/torch.optim.Adam.html"><code>Adam optimizer</code></a> and <a href="https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html"><code>CrossEntropyLoss</code> function</a>. Then the model performance evaluated. The <code>train_model</code> function returns the model accuracy (measured on the test set data) and the model itself.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># define grid of hyperparameters</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">learning_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">]</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">dropout_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1"># define a function for the training loop</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">):</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">TextClassifier</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">dropout_prob</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">)</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>  
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    <span class="c1"># Evaluate the model</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>        <span class="n">correct</span> <span class="o">=</span> <span class="p">(</span><span class="n">predicted</span> <span class="o">==</span> <span class="n">y_test</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">y_test</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>    <span class="k">return</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">model</span>
</span></code></pre></div>
<p>Then to implement the gridsearch, I loop through the combinations of <a href="https://deepchecks.com/glossary/learning-rate-in-machine-learning/#:~:text=The%20learning%20rate%2C%20denoted%20by,network%20concerning%20the%20loss%20gradient%3E."><code>learning rate</code></a> and <a href="https://pytorch.org/docs/stable/generated/torch.nn.Dropout.html"><code>dropout rate</code></a>, training and evaluating a neural network then storing its parameters and the model itself if the accuracy is better than all previous accuracies.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Perform the grid search</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">best_accuracy</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">best_lr</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">best_dropout_rate</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">learning_rates</span><span class="p">:</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="k">for</span> <span class="n">dropout_rate</span> <span class="ow">in</span> <span class="n">dropout_rates</span><span class="p">:</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>        <span class="n">accuracy</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">)</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Learning rate: </span><span class="si">{</span><span class="n">lr</span><span class="si">}</span><span class="s1">, Dropout rate: </span><span class="si">{</span><span class="n">dropout_rate</span><span class="si">}</span><span class="s1">, Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>        <span class="k">if</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">best_accuracy</span><span class="p">:</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>            <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>            <span class="n">best_lr</span> <span class="o">=</span> <span class="n">lr</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>            <span class="n">best_dropout_rate</span> <span class="o">=</span> <span class="n">dropout_rate</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
</span></code></pre></div>
<p>Finally, the results of the best model are printed, the best model is saved in the <code>best_model.pt</code> file, and the best parameters are pickled and saved in <code>best_params.pickle</code>.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Best learning rate: </span><span class="si">{</span><span class="n">best_lr</span><span class="si">}</span><span class="s1">, Best dropout rate: </span><span class="si">{</span><span class="n">best_dropout_rate</span><span class="si">}</span><span class="s1">, Best accuracy: </span><span class="si">{</span><span class="n">best_accuracy</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="c1"># Save the best model to a file</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">best_model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">'best_model.pt'</span><span class="p">)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="c1"># Also save the parameters in a dictionary</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"learning_rate"</span><span class="p">:</span> <span class="n">best_lr</span><span class="p">,</span> <span class="s2">"dropout_rate"</span><span class="p">:</span> <span class="n">best_dropout_rate</span><span class="p">,</span> <span class="s2">"accuracy"</span><span class="p">:</span> <span class="n">best_accuracy</span><span class="p">}</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'best_params.pickle'</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_params</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
</span></code></pre></div>
<p>All together, here is <code>train_nn.py</code>.</p>
<p><em>train_nn.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="c1"># Read the CSV file</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'NLP_data/train.csv'</span><span class="p">)</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="c1"># Columns are named 'Text' and 'Labels'</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="n">texts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Text'</span><span class="p">]</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="n">labels</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Labels'</span><span class="p">]</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="c1"># Split the dataset into training and test sets</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="c1"># Convert the texts into vectors</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>  <span class="c1"># limit to 5000 most frequent words/tokens</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="n">X_train</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="n">X_test</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="c1"># Save the vectorizer</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">vectorizer</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"vectorizer.pickle"</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">))</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="c1"># Convert the vectors and labels to numpy arrays</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="n">X_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="n">X_test</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="n">y_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="n">y_test</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="k">class</span> <span class="nc">TextClassifier</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">,</span> <span class="n">dropout_prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">TextClassifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_prob</span><span class="p">)</span>
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>
</span><span id="__span-17-45"><a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a>
</span><span id="__span-17-46"><a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-17-47"><a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="__span-17-48"><a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-17-49"><a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-17-50"><a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-17-51"><a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a>
</span><span id="__span-17-52"><a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a><span class="c1"># define grid of hyperparameters</span>
</span><span id="__span-17-53"><a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a><span class="n">learning_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">]</span>
</span><span id="__span-17-54"><a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="n">dropout_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</span><span id="__span-17-55"><a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a>
</span><span id="__span-17-56"><a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a><span class="c1"># define a function for the training loop</span>
</span><span id="__span-17-57"><a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">):</span>
</span><span id="__span-17-58"><a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">TextClassifier</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">dropout_prob</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">)</span>
</span><span id="__span-17-59"><a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a>    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
</span><span id="__span-17-60"><a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
</span><span id="__span-17-61"><a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a>
</span><span id="__span-17-62"><a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a>    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>  
</span><span id="__span-17-63"><a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-17-64"><a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</span><span id="__span-17-65"><a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span><span id="__span-17-66"><a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-17-67"><a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-17-68"><a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a>
</span><span id="__span-17-69"><a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a>    <span class="c1"># Evaluate the model</span>
</span><span id="__span-17-70"><a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a>    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="__span-17-71"><a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span><span id="__span-17-72"><a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-17-73"><a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a>        <span class="n">correct</span> <span class="o">=</span> <span class="p">(</span><span class="n">predicted</span> <span class="o">==</span> <span class="n">y_test</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-17-74"><a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a>        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">y_test</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-17-75"><a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a>
</span><span id="__span-17-76"><a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a>    <span class="k">return</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">model</span>
</span><span id="__span-17-77"><a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a>
</span><span id="__span-17-78"><a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a><span class="c1"># Perform the grid search</span>
</span><span id="__span-17-79"><a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a><span class="n">best_accuracy</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-17-80"><a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a><span class="n">best_lr</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-17-81"><a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a><span class="n">best_dropout_rate</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-17-82"><a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-17-83"><a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a>
</span><span id="__span-17-84"><a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a><span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">learning_rates</span><span class="p">:</span>
</span><span id="__span-17-85"><a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a>    <span class="k">for</span> <span class="n">dropout_rate</span> <span class="ow">in</span> <span class="n">dropout_rates</span><span class="p">:</span>
</span><span id="__span-17-86"><a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a>        <span class="n">accuracy</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">)</span>
</span><span id="__span-17-87"><a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Learning rate: </span><span class="si">{</span><span class="n">lr</span><span class="si">}</span><span class="s1">, Dropout rate: </span><span class="si">{</span><span class="n">dropout_rate</span><span class="si">}</span><span class="s1">, Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</span><span id="__span-17-88"><a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a>
</span><span id="__span-17-89"><a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a>        <span class="k">if</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">best_accuracy</span><span class="p">:</span>
</span><span id="__span-17-90"><a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a>            <span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">accuracy</span>
</span><span id="__span-17-91"><a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a>            <span class="n">best_lr</span> <span class="o">=</span> <span class="n">lr</span>
</span><span id="__span-17-92"><a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a>            <span class="n">best_dropout_rate</span> <span class="o">=</span> <span class="n">dropout_rate</span>
</span><span id="__span-17-93"><a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a>            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="__span-17-94"><a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a>
</span><span id="__span-17-95"><a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Best learning rate: </span><span class="si">{</span><span class="n">best_lr</span><span class="si">}</span><span class="s1">, Best dropout rate: </span><span class="si">{</span><span class="n">best_dropout_rate</span><span class="si">}</span><span class="s1">, Best accuracy: </span><span class="si">{</span><span class="n">best_accuracy</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</span><span id="__span-17-96"><a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a>
</span><span id="__span-17-97"><a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a><span class="c1"># Save the best model to a file</span>
</span><span id="__span-17-98"><a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a><span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">best_model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">'best_model.pt'</span><span class="p">)</span>
</span><span id="__span-17-99"><a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a>
</span><span id="__span-17-100"><a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a><span class="c1"># Also save the parameters in a dictionary</span>
</span><span id="__span-17-101"><a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a><span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"learning_rate"</span><span class="p">:</span> <span class="n">best_lr</span><span class="p">,</span> <span class="s2">"dropout_rate"</span><span class="p">:</span> <span class="n">best_dropout_rate</span><span class="p">,</span> <span class="s2">"accuracy"</span><span class="p">:</span> <span class="n">best_accuracy</span><span class="p">}</span>
</span><span id="__span-17-102"><a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a>
</span><span id="__span-17-103"><a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'best_params.pickle'</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
</span><span id="__span-17-104"><a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a>    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_params</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
</span></code></pre></div>
<p>To load the model, I wrote <code>load_model_and_classify.py</code>. The script defines classes for importing the pickled neural network and using it to classify references.</p>
<p><em>load_model_and_classify.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="k">class</span> <span class="nc">TextClassifier</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">,</span> <span class="n">dropout_prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">TextClassifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_prob</span><span class="p">)</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="k">class</span> <span class="nc">Classifier</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>        <span class="c1"># Load the saved parameters</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'best_params.pickle'</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_params</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>        <span class="c1"># Load the vectorizer</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">"vectorizer.pickle"</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">))</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>        <span class="c1"># Initialize and load the saved model</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">TextClassifier</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">dropout_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_params</span><span class="p">[</span><span class="s1">'dropout_rate'</span><span class="p">])</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'best_model.pt'</span><span class="p">))</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>    <span class="k">def</span> <span class="nf">ClassifyDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>        <span class="c1"># Let's assume your new data only has a 'Text' column</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>        <span class="n">texts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Text'</span><span class="p">]</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>        <span class="c1"># Convert the texts into vectors</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>        <span class="c1"># Convert the vectors to PyTorch tensors</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>        <span class="c1"># Predict labels for the new data</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>            <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a>        <span class="c1"># Add the predicted labels to the DataFrame</span>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>        <span class="n">df</span><span class="p">[</span><span class="s1">'Predicted Labels'</span><span class="p">]</span> <span class="o">=</span> <span class="n">predicted</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a>    <span class="k">def</span> <span class="nf">classifyItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a>        <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="p">]</span>
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a>
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a>        <span class="c1"># Convert the texts into vectors</span>
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a>        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a>
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a>        <span class="c1"># Convert the vectors to PyTorch tensors</span>
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a>
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a>        <span class="c1"># Predict labels for the new data</span>
</span><span id="__span-18-64"><a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="__span-18-65"><a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a>            <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="__span-18-66"><a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-18-67"><a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a>
</span><span id="__span-18-68"><a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a>        <span class="k">return</span> <span class="n">predicted</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></code></pre></div>
<h4 id="classifying-references">Classifying References</h4>
<p>Now that I have a neural network to classify references between students, I revised <code>main_collection.py</code> to <code>main.py</code>, implementing topic classification. I'll first point out the significant changes then display the entire file.</p>
<p>First, I fixed the pagination bug from <a href="#step-1-data-collection_1">Step 1</a> in three places:</p>
<ul>
<li><em><code>get_file_repo_list</code> function</em></li>
</ul>
<div class="language-py highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># original</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">all_directories</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">repository_tree</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1"># fixed</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="n">all_directories</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">repository_tree</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li><em><code>get_subgroup_ids</code> function</em></li>
</ul>
<div class="language-py highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># original</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/subgroups"</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1"># fixed</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/subgroups?per_page=999999"</span>
</span></code></pre></div>
<ul>
<li><em><code>get_subproject_ids</code> function</em></li>
</ul>
<div class="language-py highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># original</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/projects"</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1"># fixed</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/projects?per_page=99999"</span>
</span></code></pre></div>
<p>I also fixed the bug where only references between students of the same years are counted.</p>
<ul>
<li><em><code>get_references</code> function</em></li>
</ul>
<div class="language-py highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># original</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">f</span><span class="s2">"\/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">\/labs\/[^\/]+\/students\/(\w|-)+\/"</span><span class="p">)</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="c1"># fixed</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">f</span><span class="s2">"\/20[0-9][0-9]\/labs\/[^\/]+\/students\/(\w|-)+\/"</span><span class="p">)</span>
</span></code></pre></div>
<p>Second, the script no longer stores references that have a subject-area keyword in a <code>jsonl</code> file, and it uses the neural network to classify all of the references that don't have keywords.</p>
<p><em>in <code>get_references</code> function</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># original</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">if</span> <span class="n">link_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="k">continue</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"NLP_data/train.jsonl"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'{'</span> <span class="o">+</span> <span class="s1">'"text": '</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">topic_text</span><span class="p">)</span> <span class="o">+</span> <span class="s1">', "label": "'</span> <span class="o">+</span> <span class="n">link_label</span> <span class="o">+</span> <span class="s1">'", "metadata": '</span><span class="o">+</span> <span class="s1">'{'</span> <span class="o">+</span> <span class="s1">'"from": "'</span> <span class="o">+</span> <span class="n">from_url</span> <span class="o">+</span> <span class="s1">'", "to": "'</span> <span class="o">+</span> <span class="n">full_url</span> <span class="o">+</span> <span class="s1">'"'</span> <span class="o">+</span> <span class="s1">'}'</span> <span class="o">+</span> <span class="s1">'}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="k">if</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">people_linked</span><span class="p">:</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>    <span class="k">if</span> <span class="n">link_label</span> <span class="ow">in</span> <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">link_label</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">link_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="c1"># new</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="k">if</span> <span class="n">link_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>    <span class="n">link_label</span> <span class="o">=</span> <span class="n">TOPICS</span><span class="p">[</span><span class="n">classifier</span><span class="o">.</span><span class="n">classifyItem</span><span class="p">(</span><span class="n">content</span><span class="p">)]</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="k">if</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">people_linked</span><span class="p">:</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    <span class="k">if</span> <span class="n">link_label</span> <span class="ow">in</span> <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>        <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">link_label</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>    <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>    <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">link_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></code></pre></div>
<p>Finally, the output matrix, <code>final_data.csv</code>, now sorts references by subject-area.</p>
<p><em>in <code>format_data_to_matrix</code> function</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># original</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"STUDENTS"</span><span class="p">,</span> <span class="n">students</span><span class="p">)</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">students</span><span class="p">)</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">"Referencing Students"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">"Referenced Students"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">TOPICS</span><span class="p">]))</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="k">for</span> <span class="n">student1</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    <span class="k">for</span> <span class="n">student2</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>        <span class="k">for</span> <span class="n">topic_name</span> <span class="ow">in</span> <span class="n">TOPICS</span><span class="p">:</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">student1</span><span class="p">,</span> <span class="p">(</span><span class="n">student2</span><span class="p">,</span> <span class="n">topic_name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span> <span class="k">if</span> <span class="n">student1</span> <span class="o">==</span> <span class="n">student2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="k">def</span> <span class="nf">assign_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>    <span class="k">if</span> <span class="n">referencer_student</span> <span class="o">==</span> <span class="n">referenced_student</span><span class="p">:</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ignoring self-referenced student </span><span class="si">{</span><span class="n">referencer_student</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>    <span class="k">elif</span> <span class="n">referenced_student</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Referenced student isn't a student - URL matched naming convention so regex caught but wasn't checked against student list - skipping"</span><span class="p">)</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">num_references</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="k">for</span> <span class="n">year_info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>    <span class="k">for</span> <span class="n">student_info</span> <span class="ow">in</span> <span class="n">year_info</span><span class="p">:</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>        <span class="n">student_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>        <span class="n">reference_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">student_name</span><span class="p">])</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>        <span class="k">for</span> <span class="n">referenced_student</span> <span class="ow">in</span> <span class="n">reference_dict</span><span class="p">:</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>            <span class="k">for</span> <span class="n">reference_type</span> <span class="ow">in</span> <span class="n">reference_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="p">]:</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>                <span class="n">num_references</span> <span class="o">=</span> <span class="n">reference_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="p">][</span><span class="n">reference_type</span><span class="p">]</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>                <span class="n">assign_value</span><span class="p">(</span><span class="n">student_name</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">reference_type</span><span class="p">)</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"final_data.csv"</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">"Referencing Students|Referenced Students"</span><span class="p">)</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a><span class="k">return</span> <span class="n">df</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="c1"># new</span>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="n">students_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">students</span><span class="p">]</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a><span class="n">link_student_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">students</span><span class="p">)):</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a>    <span class="n">link_student_dict</span><span class="p">[</span><span class="n">students_links</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">students</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"STUDENTS"</span><span class="p">,</span> <span class="n">students</span><span class="p">)</span>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">students</span><span class="p">)</span>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a><span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">"Referencing Students"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a><span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">"Referenced Students"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">TOPICS</span><span class="p">]))</span>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a>
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a><span class="k">for</span> <span class="n">student1</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a>    <span class="k">for</span> <span class="n">student2</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a>        <span class="k">for</span> <span class="n">topic_name</span> <span class="ow">in</span> <span class="n">TOPICS</span><span class="p">:</span>
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a>            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">student1</span><span class="p">,</span> <span class="p">(</span><span class="n">student2</span><span class="p">,</span> <span class="n">topic_name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span> <span class="k">if</span> <span class="n">student1</span> <span class="o">==</span> <span class="n">student2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a>
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="k">def</span> <span class="nf">assign_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a>    <span class="k">if</span> <span class="n">referencer_student</span> <span class="o">==</span> <span class="n">referenced_student</span><span class="p">:</span>
</span><span id="__span-24-62"><a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ignoring self-referenced student </span><span class="si">{</span><span class="n">referencer_student</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-24-63"><a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a>    <span class="k">elif</span> <span class="n">referenced_student</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-24-64"><a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a>        <span class="k">if</span> <span class="n">referenced_student</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">students_links</span><span class="p">:</span>
</span><span id="__span-24-65"><a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a>            <span class="n">assign_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">link_student_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span>
</span><span id="__span-24-66"><a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-24-67"><a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Referenced student isn't a student - URL matched naming convention so regex caught but wasn't checked against student list - skipping"</span><span class="p">)</span>
</span><span id="__span-24-68"><a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-24-69"><a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a>        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">num_references</span>
</span><span id="__span-24-70"><a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a>
</span><span id="__span-24-71"><a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a><span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-24-72"><a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a>    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span>
</span><span id="__span-24-73"><a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a>
</span><span id="__span-24-74"><a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a><span class="k">for</span> <span class="n">year_info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-24-75"><a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a>    <span class="k">for</span> <span class="n">student_info</span> <span class="ow">in</span> <span class="n">year_info</span><span class="p">:</span>
</span><span id="__span-24-76"><a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a>        <span class="n">student_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-24-77"><a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a>        <span class="n">reference_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">student_name</span><span class="p">])</span>
</span><span id="__span-24-78"><a id="__codelineno-24-78" name="__codelineno-24-78" href="#__codelineno-24-78"></a>        <span class="k">for</span> <span class="n">referenced_student</span> <span class="ow">in</span> <span class="n">reference_dict</span><span class="p">:</span>
</span><span id="__span-24-79"><a id="__codelineno-24-79" name="__codelineno-24-79" href="#__codelineno-24-79"></a>            <span class="k">for</span> <span class="n">reference_type</span> <span class="ow">in</span> <span class="n">reference_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="p">]:</span>
</span><span id="__span-24-80"><a id="__codelineno-24-80" name="__codelineno-24-80" href="#__codelineno-24-80"></a>                <span class="n">num_references</span> <span class="o">=</span> <span class="n">reference_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="p">][</span><span class="n">reference_type</span><span class="p">]</span>
</span><span id="__span-24-81"><a id="__codelineno-24-81" name="__codelineno-24-81" href="#__codelineno-24-81"></a>                <span class="n">assign_value</span><span class="p">(</span><span class="n">student_name</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">reference_type</span><span class="p">)</span>
</span><span id="__span-24-82"><a id="__codelineno-24-82" name="__codelineno-24-82" href="#__codelineno-24-82"></a>
</span><span id="__span-24-83"><a id="__codelineno-24-83" name="__codelineno-24-83" href="#__codelineno-24-83"></a><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"final_data.csv"</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">"Referencing Students|Referenced Students"</span><span class="p">)</span>
</span><span id="__span-24-84"><a id="__codelineno-24-84" name="__codelineno-24-84" href="#__codelineno-24-84"></a>
</span><span id="__span-24-85"><a id="__codelineno-24-85" name="__codelineno-24-85" href="#__codelineno-24-85"></a><span class="k">return</span> <span class="n">df</span>
</span></code></pre></div>
<p>All together, here is <code>main.py</code>.</p>
<p><em>main.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">urllib.parse</span><span class="o">,</span> <span class="nn">gitlab</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">json</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="kn">from</span> <span class="nn">load_model_and_classify</span> <span class="kn">import</span> <span class="n">Classifier</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="n">GL</span> <span class="o">=</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">Gitlab</span><span class="p">(</span><span class="s1">'https://gitlab.fabcloud.org'</span><span class="p">,</span> <span class="n">api_version</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="n">VALID_EXTENSOINS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"html"</span><span class="p">,</span> <span class="s2">"txt"</span><span class="p">,</span> <span class="s2">"md"</span><span class="p">]</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="n">ALL_LAB_SUBGROUP_IDS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="mi">2023</span><span class="p">:</span> <span class="mi">8145</span><span class="p">,</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="mi">2022</span><span class="p">:</span> <span class="mi">3632</span><span class="p">,</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>    <span class="mi">2021</span><span class="p">:</span> <span class="mi">2917</span><span class="p">,</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>    <span class="mi">2020</span><span class="p">:</span> <span class="mi">2140</span><span class="p">,</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>    <span class="mi">2019</span><span class="p">:</span> <span class="mi">1619</span><span class="p">,</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>    <span class="mi">2018</span><span class="p">:</span> <span class="mi">852</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="p">}</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="n">CHARACTERS_EACH_DIRECTION_TOPIC_DETECTION</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="n">TOPICS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>    <span class="s2">"Prefab"</span><span class="p">,</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>    <span class="s2">"Computer-Aided Design"</span><span class="p">,</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    <span class="s2">"Computer-Controlled Cutting"</span><span class="p">,</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>    <span class="s2">"Embedded Programing"</span><span class="p">,</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>    <span class="s2">"3D Scanning and Printing"</span><span class="p">,</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>    <span class="s2">"Electronics Design"</span><span class="p">,</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>    <span class="s2">"Computer-Controlled Machining"</span><span class="p">,</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>    <span class="s2">"Electronics Production"</span><span class="p">,</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>    <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">,</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>    <span class="s2">"Input Devices"</span><span class="p">,</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>    <span class="s2">"Moulding and Casting"</span><span class="p">,</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>    <span class="s2">"Output Devices"</span><span class="p">,</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>    <span class="s2">"Embedded Networking and Communications"</span><span class="p">,</span>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>    <span class="s2">"Interface and Application Programming"</span><span class="p">,</span>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>    <span class="s2">"Wildcard Week"</span><span class="p">,</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>    <span class="s2">"Applications and Implications"</span><span class="p">,</span>
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>    <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">,</span>
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>    <span class="s2">"Final Project"</span><span class="p">,</span>
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>    <span class="s2">"Other"</span>
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a><span class="p">]</span>
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a>
</span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a><span class="n">TOPIC_SEARCH_TERMS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a>    <span class="p">[],</span>
</span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a>    <span class="p">[</span><span class="s2">"Computer-Aided Design"</span><span class="p">,</span> <span class="s2">"freecad"</span><span class="p">],</span> 
</span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>    <span class="p">[</span><span class="s2">"Laser Cut"</span><span class="p">,</span> <span class="s2">"CCC week"</span><span class="p">,</span> <span class="s2">"Computer-Controlled Cutting"</span><span class="p">],</span>
</span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>    <span class="p">[</span><span class="s2">"Embedded Programming"</span><span class="p">,</span> <span class="s2">"MicroPython"</span><span class="p">,</span> <span class="s2">"C\+\+"</span><span class="p">,</span> <span class="s2">"python"</span> <span class="s2">"cpp"</span><span class="p">,</span> <span class="s2">"ino"</span><span class="p">,</span> <span class="s2">"Arduino IDE"</span><span class="p">,</span> <span class="s2">"programming week"</span><span class="p">],</span> 
</span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a>    <span class="p">[</span><span class="s2">"3D Printing"</span><span class="p">,</span> <span class="s2">"3D Scanning"</span><span class="p">,</span> <span class="s2">"TPU"</span><span class="p">,</span> <span class="s2">"PETG"</span><span class="p">,</span> <span class="s2">"filament"</span><span class="p">,</span> <span class="s2">"Prusa"</span><span class="p">,</span> <span class="s2">"3d printing week"</span><span class="p">,</span> <span class="s2">"polyCAM"</span><span class="p">,</span> <span class="s2">"3D Scanning and Printing"</span><span class="p">,</span> <span class="s2">"3d printers"</span><span class="p">,</span> <span class="s2">"3d printer"</span><span class="p">],</span> <span class="c1"># not PLA because in too many other words</span>
</span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a>    <span class="p">[</span><span class="s2">"EagleCAD"</span><span class="p">,</span> <span class="s2">"Eagle"</span><span class="p">,</span> <span class="s2">"KiCAD"</span><span class="p">,</span> <span class="s2">"Routing"</span><span class="p">,</span> <span class="s2">"Auto-Route"</span><span class="p">,</span> <span class="s2">"Trace"</span><span class="p">,</span> <span class="s2">"Footprint"</span><span class="p">,</span> <span class="s2">"electronic design"</span><span class="p">,</span> <span class="s2">"Electronics Design"</span><span class="p">],</span>
</span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>    <span class="p">[</span><span class="s2">"CNC"</span><span class="p">,</span> <span class="s2">"Shopbot"</span><span class="p">,</span> <span class="s2">"Computer-Controlled Machining"</span><span class="p">],</span>
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a>    <span class="p">[</span><span class="s2">"Mill"</span><span class="p">,</span> <span class="s2">"Milling"</span><span class="p">,</span> <span class="s2">"copper"</span><span class="p">,</span> <span class="s2">"electronic production"</span><span class="p">,</span> <span class="s2">"Electronics Production"</span><span class="p">],</span>
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a>    <span class="p">[</span><span class="s2">"Machine week"</span><span class="p">,</span> <span class="s2">"actuation and automation"</span><span class="p">,</span> <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">],</span>
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>    <span class="p">[</span><span class="s2">"Input Devices"</span><span class="p">,</span> <span class="s2">"Input Device"</span><span class="p">,</span> <span class="s2">"Inputs Devices"</span><span class="p">,</span> <span class="s2">"Electronic input"</span><span class="p">,</span> <span class="s2">"sensor"</span><span class="p">,</span> <span class="s2">"Input Devices"</span><span class="p">],</span>
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a>    <span class="p">[</span><span class="s2">"Part A"</span><span class="p">,</span> <span class="s2">"Part B"</span><span class="p">,</span> <span class="s2">"pot time"</span><span class="p">,</span> <span class="s2">"pottime"</span><span class="p">,</span> <span class="s2">"molding"</span><span class="p">,</span> <span class="s2">"moulding"</span><span class="p">,</span> <span class="s2">"casting"</span><span class="p">,</span> <span class="s2">"cast"</span><span class="p">,</span> <span class="s2">"Moulding and Casting"</span><span class="p">],</span>
</span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a>    <span class="p">[</span><span class="s2">"Output Device"</span><span class="p">,</span> <span class="s2">"Outputs Devices"</span><span class="p">,</span> <span class="s2">"Outputs Device"</span><span class="p">,</span> <span class="s2">"Servo"</span><span class="p">,</span> <span class="s2">"motor"</span><span class="p">,</span> <span class="s2">"Output Devices"</span><span class="p">],</span>
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a>    <span class="p">[</span><span class="s2">"SPI"</span><span class="p">,</span> <span class="s2">"UART"</span><span class="p">,</span> <span class="s2">"I2C"</span><span class="p">,</span> <span class="s2">"RX"</span><span class="p">,</span> <span class="s2">"TX"</span><span class="p">,</span> <span class="s2">"SCL"</span><span class="p">,</span> <span class="s2">"networking week"</span><span class="p">,</span> <span class="s2">"networking"</span><span class="p">,</span> <span class="s2">"network"</span><span class="p">,</span> <span class="s2">"networking and communications"</span><span class="p">,</span> <span class="s2">"Embedded Networking and Communications"</span><span class="p">],</span>
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a>    <span class="p">[</span><span class="s2">"Interfacing Week"</span><span class="p">,</span> <span class="s2">"interface week"</span><span class="p">,</span> <span class="s2">"Interface and Application Programming"</span><span class="p">],</span>
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>    <span class="p">[</span><span class="s2">"Wildcard Week"</span><span class="p">],</span>
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a>    <span class="p">[</span><span class="s2">"Applications and Implications"</span><span class="p">,</span> <span class="s2">"Bill-of-Materials"</span><span class="p">,</span> <span class="s2">"Bill of materials"</span><span class="p">],</span>
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>    <span class="p">[</span><span class="s2">"Patent"</span><span class="p">,</span> <span class="s2">"copyright"</span><span class="p">,</span> <span class="s2">"trademark"</span><span class="p">,</span> <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">],</span>
</span><span id="__span-25-59"><a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a>    <span class="p">[</span><span class="s2">"Final Project"</span><span class="p">],</span>
</span><span id="__span-25-60"><a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a>    <span class="p">[]</span>
</span><span id="__span-25-61"><a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a>
</span><span id="__span-25-62"><a id="__codelineno-25-62" name="__codelineno-25-62" href="#__codelineno-25-62"></a><span class="p">]</span> 
</span><span id="__span-25-63"><a id="__codelineno-25-63" name="__codelineno-25-63" href="#__codelineno-25-63"></a>
</span><span id="__span-25-64"><a id="__codelineno-25-64" name="__codelineno-25-64" href="#__codelineno-25-64"></a><span class="c1"># returns file content from a repo</span>
</span><span id="__span-25-65"><a id="__codelineno-25-65" name="__codelineno-25-65" href="#__codelineno-25-65"></a><span class="k">def</span> <span class="nf">get_file_content</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">default_branch_name</span><span class="p">):</span>
</span><span id="__span-25-66"><a id="__codelineno-25-66" name="__codelineno-25-66" href="#__codelineno-25-66"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Getting file content: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-67"><a id="__codelineno-25-67" name="__codelineno-25-67" href="#__codelineno-25-67"></a>    <span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/repository/files/</span><span class="si">{</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">safe</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span><span class="si">}</span><span class="s2">?ref=</span><span class="si">{</span><span class="n">default_branch_name</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-25-68"><a id="__codelineno-25-68" name="__codelineno-25-68" href="#__codelineno-25-68"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span>
</span><span id="__span-25-69"><a id="__codelineno-25-69" name="__codelineno-25-69" href="#__codelineno-25-69"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-25-70"><a id="__codelineno-25-70" name="__codelineno-25-70" href="#__codelineno-25-70"></a>    <span class="k">if</span> <span class="s1">'message'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-25-71"><a id="__codelineno-25-71" name="__codelineno-25-71" href="#__codelineno-25-71"></a>        <span class="k">if</span> <span class="s1">'404'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]:</span>
</span><span id="__span-25-72"><a id="__codelineno-25-72" name="__codelineno-25-72" href="#__codelineno-25-72"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"404 ERROR from </span><span class="si">{</span><span class="n">safe_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-73"><a id="__codelineno-25-73" name="__codelineno-25-73" href="#__codelineno-25-73"></a>            <span class="k">return</span>
</span><span id="__span-25-74"><a id="__codelineno-25-74" name="__codelineno-25-74" href="#__codelineno-25-74"></a>    <span class="n">encrypted_blob</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span>
</span><span id="__span-25-75"><a id="__codelineno-25-75" name="__codelineno-25-75" href="#__codelineno-25-75"></a>
</span><span id="__span-25-76"><a id="__codelineno-25-76" name="__codelineno-25-76" href="#__codelineno-25-76"></a>    <span class="n">decrypted_text</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_blob</span><span class="p">)</span>
</span><span id="__span-25-77"><a id="__codelineno-25-77" name="__codelineno-25-77" href="#__codelineno-25-77"></a>    <span class="k">return</span> <span class="n">decrypted_text</span>
</span><span id="__span-25-78"><a id="__codelineno-25-78" name="__codelineno-25-78" href="#__codelineno-25-78"></a>
</span><span id="__span-25-79"><a id="__codelineno-25-79" name="__codelineno-25-79" href="#__codelineno-25-79"></a><span class="c1"># get name of GitLab repo</span>
</span><span id="__span-25-80"><a id="__codelineno-25-80" name="__codelineno-25-80" href="#__codelineno-25-80"></a><span class="k">def</span> <span class="nf">get_repo_name</span><span class="p">(</span><span class="n">project_id</span><span class="p">):</span>
</span><span id="__span-25-81"><a id="__codelineno-25-81" name="__codelineno-25-81" href="#__codelineno-25-81"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"repo_names"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">"</span><span class="p">):</span>
</span><span id="__span-25-82"><a id="__codelineno-25-82" name="__codelineno-25-82" href="#__codelineno-25-82"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"repo_names"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-83"><a id="__codelineno-25-83" name="__codelineno-25-83" href="#__codelineno-25-83"></a>    <span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-25-84"><a id="__codelineno-25-84" name="__codelineno-25-84" href="#__codelineno-25-84"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span>
</span><span id="__span-25-85"><a id="__codelineno-25-85" name="__codelineno-25-85" href="#__codelineno-25-85"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-25-86"><a id="__codelineno-25-86" name="__codelineno-25-86" href="#__codelineno-25-86"></a>    <span class="n">web_url</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">'web_url'</span><span class="p">]</span>
</span><span id="__span-25-87"><a id="__codelineno-25-87" name="__codelineno-25-87" href="#__codelineno-25-87"></a>    <span class="k">if</span> <span class="s1">'message'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-25-88"><a id="__codelineno-25-88" name="__codelineno-25-88" href="#__codelineno-25-88"></a>        <span class="k">if</span> <span class="s1">'404'</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]:</span>
</span><span id="__span-25-89"><a id="__codelineno-25-89" name="__codelineno-25-89" href="#__codelineno-25-89"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"404 ERROR from </span><span class="si">{</span><span class="n">safe_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-90"><a id="__codelineno-25-90" name="__codelineno-25-90" href="#__codelineno-25-90"></a>            <span class="k">return</span>
</span><span id="__span-25-91"><a id="__codelineno-25-91" name="__codelineno-25-91" href="#__codelineno-25-91"></a>
</span><span id="__span-25-92"><a id="__codelineno-25-92" name="__codelineno-25-92" href="#__codelineno-25-92"></a>    <span class="n">to_return</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span> <span class="n">gitlab_url_to_site_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">web_url</span><span class="si">}</span><span class="s2">/"</span><span class="p">)</span> <span class="c1"># / to make it consistent with the name lists with urljoin and the a's hrefs</span>
</span><span id="__span-25-93"><a id="__codelineno-25-93" name="__codelineno-25-93" href="#__codelineno-25-93"></a>
</span><span id="__span-25-94"><a id="__codelineno-25-94" name="__codelineno-25-94" href="#__codelineno-25-94"></a>    <span class="n">save_obj</span><span class="p">(</span><span class="s2">"repo_names"</span><span class="p">,</span> <span class="n">to_return</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-95"><a id="__codelineno-25-95" name="__codelineno-25-95" href="#__codelineno-25-95"></a>
</span><span id="__span-25-96"><a id="__codelineno-25-96" name="__codelineno-25-96" href="#__codelineno-25-96"></a>    <span class="k">return</span> <span class="n">to_return</span>
</span><span id="__span-25-97"><a id="__codelineno-25-97" name="__codelineno-25-97" href="#__codelineno-25-97"></a>
</span><span id="__span-25-98"><a id="__codelineno-25-98" name="__codelineno-25-98" href="#__codelineno-25-98"></a><span class="c1"># get a list of the subgroups of a GitLab project</span>
</span><span id="__span-25-99"><a id="__codelineno-25-99" name="__codelineno-25-99" href="#__codelineno-25-99"></a><span class="k">def</span> <span class="nf">get_file_repo_list</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
</span><span id="__span-25-100"><a id="__codelineno-25-100" name="__codelineno-25-100" href="#__codelineno-25-100"></a>    <span class="n">all_file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-101"><a id="__codelineno-25-101" name="__codelineno-25-101" href="#__codelineno-25-101"></a>    <span class="n">project</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="__span-25-102"><a id="__codelineno-25-102" name="__codelineno-25-102" href="#__codelineno-25-102"></a>    <span class="n">all_directories</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">repository_tree</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span> <span class="c1"># pagination bug patched</span>
</span><span id="__span-25-103"><a id="__codelineno-25-103" name="__codelineno-25-103" href="#__codelineno-25-103"></a>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_directories</span><span class="p">:</span>
</span><span id="__span-25-104"><a id="__codelineno-25-104" name="__codelineno-25-104" href="#__codelineno-25-104"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-25-105"><a id="__codelineno-25-105" name="__codelineno-25-105" href="#__codelineno-25-105"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]</span>
</span><span id="__span-25-106"><a id="__codelineno-25-106" name="__codelineno-25-106" href="#__codelineno-25-106"></a>        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">VALID_EXTENSOINS</span><span class="p">:</span>
</span><span id="__span-25-107"><a id="__codelineno-25-107" name="__codelineno-25-107" href="#__codelineno-25-107"></a>            <span class="n">all_file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-25-108"><a id="__codelineno-25-108" name="__codelineno-25-108" href="#__codelineno-25-108"></a>    <span class="k">return</span> <span class="n">all_file_paths</span>
</span><span id="__span-25-109"><a id="__codelineno-25-109" name="__codelineno-25-109" href="#__codelineno-25-109"></a>
</span><span id="__span-25-110"><a id="__codelineno-25-110" name="__codelineno-25-110" href="#__codelineno-25-110"></a><span class="c1"># get the IDs of the subgroups of a GitLab project</span>
</span><span id="__span-25-111"><a id="__codelineno-25-111" name="__codelineno-25-111" href="#__codelineno-25-111"></a><span class="k">def</span> <span class="nf">get_subgroup_ids</span><span class="p">(</span><span class="n">group_id</span><span class="p">):</span>
</span><span id="__span-25-112"><a id="__codelineno-25-112" name="__codelineno-25-112" href="#__codelineno-25-112"></a>    <span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/subgroups?per_page=999999"</span> <span class="c1"># pagination bug patched</span>
</span><span id="__span-25-113"><a id="__codelineno-25-113" name="__codelineno-25-113" href="#__codelineno-25-113"></a>    <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-25-114"><a id="__codelineno-25-114" name="__codelineno-25-114" href="#__codelineno-25-114"></a>    <span class="k">while</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-25-115"><a id="__codelineno-25-115" name="__codelineno-25-115" href="#__codelineno-25-115"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-25-116"><a id="__codelineno-25-116" name="__codelineno-25-116" href="#__codelineno-25-116"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-25-117"><a id="__codelineno-25-117" name="__codelineno-25-117" href="#__codelineno-25-117"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-25-118"><a id="__codelineno-25-118" name="__codelineno-25-118" href="#__codelineno-25-118"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Server timeout- </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-119"><a id="__codelineno-25-119" name="__codelineno-25-119" href="#__codelineno-25-119"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-25-120"><a id="__codelineno-25-120" name="__codelineno-25-120" href="#__codelineno-25-120"></a>    <span class="n">p_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-121"><a id="__codelineno-25-121" name="__codelineno-25-121" href="#__codelineno-25-121"></a>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-25-122"><a id="__codelineno-25-122" name="__codelineno-25-122" href="#__codelineno-25-122"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-25-123"><a id="__codelineno-25-123" name="__codelineno-25-123" href="#__codelineno-25-123"></a>            <span class="n">p_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span>
</span><span id="__span-25-124"><a id="__codelineno-25-124" name="__codelineno-25-124" href="#__codelineno-25-124"></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="__span-25-125"><a id="__codelineno-25-125" name="__codelineno-25-125" href="#__codelineno-25-125"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error finding subgroups -- skipping"</span><span class="p">)</span>
</span><span id="__span-25-126"><a id="__codelineno-25-126" name="__codelineno-25-126" href="#__codelineno-25-126"></a>    <span class="k">return</span> <span class="n">p_ids</span>
</span><span id="__span-25-127"><a id="__codelineno-25-127" name="__codelineno-25-127" href="#__codelineno-25-127"></a>
</span><span id="__span-25-128"><a id="__codelineno-25-128" name="__codelineno-25-128" href="#__codelineno-25-128"></a><span class="c1"># get the IDs of subgprojects of a GitLab project</span>
</span><span id="__span-25-129"><a id="__codelineno-25-129" name="__codelineno-25-129" href="#__codelineno-25-129"></a><span class="k">def</span> <span class="nf">get_subproject_ids</span><span class="p">(</span><span class="n">group_id</span><span class="p">):</span>
</span><span id="__span-25-130"><a id="__codelineno-25-130" name="__codelineno-25-130" href="#__codelineno-25-130"></a>    <span class="n">safe_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/groups/</span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2">/projects?per_page=99999"</span> <span class="c1"># pagination bug patched</span>
</span><span id="__span-25-131"><a id="__codelineno-25-131" name="__codelineno-25-131" href="#__codelineno-25-131"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">safe_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-25-132"><a id="__codelineno-25-132" name="__codelineno-25-132" href="#__codelineno-25-132"></a>    <span class="n">p_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-133"><a id="__codelineno-25-133" name="__codelineno-25-133" href="#__codelineno-25-133"></a>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="__span-25-134"><a id="__codelineno-25-134" name="__codelineno-25-134" href="#__codelineno-25-134"></a>        <span class="n">p_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span>
</span><span id="__span-25-135"><a id="__codelineno-25-135" name="__codelineno-25-135" href="#__codelineno-25-135"></a>    <span class="k">return</span> <span class="n">p_ids</span>
</span><span id="__span-25-136"><a id="__codelineno-25-136" name="__codelineno-25-136" href="#__codelineno-25-136"></a>
</span><span id="__span-25-137"><a id="__codelineno-25-137" name="__codelineno-25-137" href="#__codelineno-25-137"></a><span class="k">def</span> <span class="nf">name_split_char</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
</span><span id="__span-25-138"><a id="__codelineno-25-138" name="__codelineno-25-138" href="#__codelineno-25-138"></a>    <span class="k">return</span> <span class="s2">"."</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2021</span> <span class="k">else</span> <span class="s2">" "</span>
</span><span id="__span-25-139"><a id="__codelineno-25-139" name="__codelineno-25-139" href="#__codelineno-25-139"></a>
</span><span id="__span-25-140"><a id="__codelineno-25-140" name="__codelineno-25-140" href="#__codelineno-25-140"></a><span class="c1"># convert a URL to a GitLab repo to a URL to the hosted website</span>
</span><span id="__span-25-141"><a id="__codelineno-25-141" name="__codelineno-25-141" href="#__codelineno-25-141"></a><span class="k">def</span> <span class="nf">gitlab_url_to_site_url</span><span class="p">(</span><span class="n">gitlab_url</span><span class="p">):</span>
</span><span id="__span-25-142"><a id="__codelineno-25-142" name="__codelineno-25-142" href="#__codelineno-25-142"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"https://fabacademy.org/</span><span class="si">{</span><span class="n">gitlab_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'https://gitlab.fabcloud.org/academany/fabacademy/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-25-143"><a id="__codelineno-25-143" name="__codelineno-25-143" href="#__codelineno-25-143"></a>
</span><span id="__span-25-144"><a id="__codelineno-25-144" name="__codelineno-25-144" href="#__codelineno-25-144"></a><span class="c1"># format student's name to create a unique identifier for each student</span>
</span><span id="__span-25-145"><a id="__codelineno-25-145" name="__codelineno-25-145" href="#__codelineno-25-145"></a><span class="k">def</span> <span class="nf">format_name</span><span class="p">(</span><span class="n">name_url_tup</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">tup</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-25-146"><a id="__codelineno-25-146" name="__codelineno-25-146" href="#__codelineno-25-146"></a>    <span class="k">if</span> <span class="n">tup</span><span class="p">:</span>
</span><span id="__span-25-147"><a id="__codelineno-25-147" name="__codelineno-25-147" href="#__codelineno-25-147"></a>        <span class="n">name</span><span class="p">,</span> <span class="n">web_url</span> <span class="o">=</span> <span class="n">name_url_tup</span>
</span><span id="__span-25-148"><a id="__codelineno-25-148" name="__codelineno-25-148" href="#__codelineno-25-148"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="s2">"-"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name_split_char</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span><span class="si">}</span><span class="s1">;</span><span class="si">{</span><span class="n">web_url</span><span class="si">}</span><span class="s1">'</span> 
</span><span id="__span-25-149"><a id="__codelineno-25-149" name="__codelineno-25-149" href="#__codelineno-25-149"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-25-150"><a id="__codelineno-25-150" name="__codelineno-25-150" href="#__codelineno-25-150"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Warning: name generated without URL"</span><span class="p">)</span>
</span><span id="__span-25-151"><a id="__codelineno-25-151" name="__codelineno-25-151" href="#__codelineno-25-151"></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">name_url_tup</span>
</span><span id="__span-25-152"><a id="__codelineno-25-152" name="__codelineno-25-152" href="#__codelineno-25-152"></a>        <span class="k">return</span> <span class="s2">"-"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name_split_char</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span>
</span><span id="__span-25-153"><a id="__codelineno-25-153" name="__codelineno-25-153" href="#__codelineno-25-153"></a>
</span><span id="__span-25-154"><a id="__codelineno-25-154" name="__codelineno-25-154" href="#__codelineno-25-154"></a><span class="c1"># remove all links to websites that are not students' repos</span>
</span><span id="__span-25-155"><a id="__codelineno-25-155" name="__codelineno-25-155" href="#__codelineno-25-155"></a><span class="k">def</span> <span class="nf">filter_only_student_repos</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">,</span> <span class="n">all_student_names</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
</span><span id="__span-25-156"><a id="__codelineno-25-156" name="__codelineno-25-156" href="#__codelineno-25-156"></a>    <span class="n">filtered_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-157"><a id="__codelineno-25-157" name="__codelineno-25-157" href="#__codelineno-25-157"></a>    <span class="n">all_student_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">all_student_names</span><span class="p">]</span>
</span><span id="__span-25-158"><a id="__codelineno-25-158" name="__codelineno-25-158" href="#__codelineno-25-158"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">id_list</span> <span class="ow">in</span> <span class="n">all_student_repo_ids</span><span class="p">:</span>
</span><span id="__span-25-159"><a id="__codelineno-25-159" name="__codelineno-25-159" href="#__codelineno-25-159"></a>        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
</span><span id="__span-25-160"><a id="__codelineno-25-160" name="__codelineno-25-160" href="#__codelineno-25-160"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">web_url</span> <span class="o">=</span> <span class="n">get_repo_name</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="__span-25-161"><a id="__codelineno-25-161" name="__codelineno-25-161" href="#__codelineno-25-161"></a>            <span class="k">if</span> <span class="n">web_url</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">all_student_urls</span> <span class="ow">or</span> <span class="n">web_url</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">all_student_urls</span><span class="p">:</span> <span class="c1"># [:-1] to remove ending slash</span>
</span><span id="__span-25-162"><a id="__codelineno-25-162" name="__codelineno-25-162" href="#__codelineno-25-162"></a>                <span class="n">filtered_ids</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
</span><span id="__span-25-163"><a id="__codelineno-25-163" name="__codelineno-25-163" href="#__codelineno-25-163"></a>    <span class="k">return</span> <span class="n">filtered_ids</span>
</span><span id="__span-25-164"><a id="__codelineno-25-164" name="__codelineno-25-164" href="#__codelineno-25-164"></a>
</span><span id="__span-25-165"><a id="__codelineno-25-165" name="__codelineno-25-165" href="#__codelineno-25-165"></a><span class="c1"># get the repo IDs of all fab Academy students</span>
</span><span id="__span-25-166"><a id="__codelineno-25-166" name="__codelineno-25-166" href="#__codelineno-25-166"></a><span class="k">def</span> <span class="nf">get_all_student_repo_ids</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year_subgroup_id</span><span class="p">,</span> <span class="n">all_student_names</span><span class="p">):</span>
</span><span id="__span-25-167"><a id="__codelineno-25-167" name="__codelineno-25-167" href="#__codelineno-25-167"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"student_repo_id_saves"</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
</span><span id="__span-25-168"><a id="__codelineno-25-168" name="__codelineno-25-168" href="#__codelineno-25-168"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"student_repo_id_saves"</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-25-169"><a id="__codelineno-25-169" name="__codelineno-25-169" href="#__codelineno-25-169"></a>    <span class="n">all_student_repo_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-170"><a id="__codelineno-25-170" name="__codelineno-25-170" href="#__codelineno-25-170"></a>    <span class="n">all_lab_ids</span> <span class="o">=</span> <span class="n">get_subgroup_ids</span><span class="p">(</span><span class="n">year_subgroup_id</span><span class="p">)</span>
</span><span id="__span-25-171"><a id="__codelineno-25-171" name="__codelineno-25-171" href="#__codelineno-25-171"></a>    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">all_lab_ids</span><span class="p">:</span>
</span><span id="__span-25-172"><a id="__codelineno-25-172" name="__codelineno-25-172" href="#__codelineno-25-172"></a>        <span class="k">for</span> <span class="n">sub_id</span> <span class="ow">in</span> <span class="n">get_subgroup_ids</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
</span><span id="__span-25-173"><a id="__codelineno-25-173" name="__codelineno-25-173" href="#__codelineno-25-173"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">sub_id</span><span class="p">)</span>
</span><span id="__span-25-174"><a id="__codelineno-25-174" name="__codelineno-25-174" href="#__codelineno-25-174"></a>            <span class="n">all_student_repo_ids</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">id</span><span class="p">,</span> <span class="n">get_subproject_ids</span><span class="p">(</span><span class="n">sub_id</span><span class="p">)))</span> <span class="c1"># ((i, get_subproject_ids(sub_id)))</span>
</span><span id="__span-25-175"><a id="__codelineno-25-175" name="__codelineno-25-175" href="#__codelineno-25-175"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"ALL STUDENT REPO IDs"</span><span class="p">,</span> <span class="n">all_student_repo_ids</span><span class="p">)</span>
</span><span id="__span-25-176"><a id="__codelineno-25-176" name="__codelineno-25-176" href="#__codelineno-25-176"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">)</span>
</span><span id="__span-25-177"><a id="__codelineno-25-177" name="__codelineno-25-177" href="#__codelineno-25-177"></a>    <span class="n">to_return</span> <span class="o">=</span> <span class="n">filter_only_student_repos</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">,</span> <span class="n">all_student_names</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-25-178"><a id="__codelineno-25-178" name="__codelineno-25-178" href="#__codelineno-25-178"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"FILTERED"</span><span class="p">,</span> <span class="n">to_return</span><span class="p">)</span>
</span><span id="__span-25-179"><a id="__codelineno-25-179" name="__codelineno-25-179" href="#__codelineno-25-179"></a>    <span class="n">save_obj</span><span class="p">(</span><span class="s2">"student_repo_id_saves"</span><span class="p">,</span> <span class="n">to_return</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-25-180"><a id="__codelineno-25-180" name="__codelineno-25-180" href="#__codelineno-25-180"></a>    <span class="k">return</span> <span class="n">to_return</span>
</span><span id="__span-25-181"><a id="__codelineno-25-181" name="__codelineno-25-181" href="#__codelineno-25-181"></a>
</span><span id="__span-25-182"><a id="__codelineno-25-182" name="__codelineno-25-182" href="#__codelineno-25-182"></a><span class="k">def</span> <span class="nf">save_exists</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="__span-25-183"><a id="__codelineno-25-183" name="__codelineno-25-183" href="#__codelineno-25-183"></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.obj"</span><span class="p">)</span>
</span><span id="__span-25-184"><a id="__codelineno-25-184" name="__codelineno-25-184" href="#__codelineno-25-184"></a>
</span><span id="__span-25-185"><a id="__codelineno-25-185" name="__codelineno-25-185" href="#__codelineno-25-185"></a><span class="k">def</span> <span class="nf">load_obj</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="__span-25-186"><a id="__codelineno-25-186" name="__codelineno-25-186" href="#__codelineno-25-186"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.obj"</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">filehandler</span><span class="p">:</span>
</span><span id="__span-25-187"><a id="__codelineno-25-187" name="__codelineno-25-187" href="#__codelineno-25-187"></a>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filehandler</span><span class="p">)</span>
</span><span id="__span-25-188"><a id="__codelineno-25-188" name="__codelineno-25-188" href="#__codelineno-25-188"></a>
</span><span id="__span-25-189"><a id="__codelineno-25-189" name="__codelineno-25-189" href="#__codelineno-25-189"></a><span class="k">def</span> <span class="nf">save_obj</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="__span-25-190"><a id="__codelineno-25-190" name="__codelineno-25-190" href="#__codelineno-25-190"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.obj"</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">filehandler</span><span class="p">:</span> 
</span><span id="__span-25-191"><a id="__codelineno-25-191" name="__codelineno-25-191" href="#__codelineno-25-191"></a>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filehandler</span><span class="p">)</span>
</span><span id="__span-25-192"><a id="__codelineno-25-192" name="__codelineno-25-192" href="#__codelineno-25-192"></a>
</span><span id="__span-25-193"><a id="__codelineno-25-193" name="__codelineno-25-193" href="#__codelineno-25-193"></a><span class="c1"># go to fabacademy.org website to find student roster and all students' names and links to their websites</span>
</span><span id="__span-25-194"><a id="__codelineno-25-194" name="__codelineno-25-194" href="#__codelineno-25-194"></a><span class="k">def</span> <span class="nf">get_all_people</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
</span><span id="__span-25-195"><a id="__codelineno-25-195" name="__codelineno-25-195" href="#__codelineno-25-195"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
</span><span id="__span-25-196"><a id="__codelineno-25-196" name="__codelineno-25-196" href="#__codelineno-25-196"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-25-197"><a id="__codelineno-25-197" name="__codelineno-25-197" href="#__codelineno-25-197"></a>
</span><span id="__span-25-198"><a id="__codelineno-25-198" name="__codelineno-25-198" href="#__codelineno-25-198"></a>    <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://fabacademy.org/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/people.html"</span>
</span><span id="__span-25-199"><a id="__codelineno-25-199" name="__codelineno-25-199" href="#__codelineno-25-199"></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>
</span><span id="__span-25-200"><a id="__codelineno-25-200" name="__codelineno-25-200" href="#__codelineno-25-200"></a>
</span><span id="__span-25-201"><a id="__codelineno-25-201" name="__codelineno-25-201" href="#__codelineno-25-201"></a>    <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2018</span><span class="p">:</span>
</span><span id="__span-25-202"><a id="__codelineno-25-202" name="__codelineno-25-202" href="#__codelineno-25-202"></a>        <span class="n">lab_divs</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"div"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"class"</span><span class="p">:</span> <span class="s2">"lab"</span><span class="p">})</span>
</span><span id="__span-25-203"><a id="__codelineno-25-203" name="__codelineno-25-203" href="#__codelineno-25-203"></a>
</span><span id="__span-25-204"><a id="__codelineno-25-204" name="__codelineno-25-204" href="#__codelineno-25-204"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-205"><a id="__codelineno-25-205" name="__codelineno-25-205" href="#__codelineno-25-205"></a>
</span><span id="__span-25-206"><a id="__codelineno-25-206" name="__codelineno-25-206" href="#__codelineno-25-206"></a>        <span class="k">for</span> <span class="n">lab_div</span> <span class="ow">in</span> <span class="n">lab_divs</span><span class="p">:</span>
</span><span id="__span-25-207"><a id="__codelineno-25-207" name="__codelineno-25-207" href="#__codelineno-25-207"></a>            <span class="n">lis</span> <span class="o">=</span> <span class="n">lab_div</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"li"</span><span class="p">)</span>
</span><span id="__span-25-208"><a id="__codelineno-25-208" name="__codelineno-25-208" href="#__codelineno-25-208"></a>
</span><span id="__span-25-209"><a id="__codelineno-25-209" name="__codelineno-25-209" href="#__codelineno-25-209"></a>            <span class="n">As</span> <span class="o">=</span> <span class="p">[</span><span class="n">li</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">]</span>
</span><span id="__span-25-210"><a id="__codelineno-25-210" name="__codelineno-25-210" href="#__codelineno-25-210"></a>
</span><span id="__span-25-211"><a id="__codelineno-25-211" name="__codelineno-25-211" href="#__codelineno-25-211"></a>            <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="w"> </span><span class="s1">'-'</span><span class="p">)</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="s1">'href'</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">As</span><span class="p">]</span>        
</span><span id="__span-25-212"><a id="__codelineno-25-212" name="__codelineno-25-212" href="#__codelineno-25-212"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-25-213"><a id="__codelineno-25-213" name="__codelineno-25-213" href="#__codelineno-25-213"></a>        <span class="n">lis</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"li"</span><span class="p">)</span>
</span><span id="__span-25-214"><a id="__codelineno-25-214" name="__codelineno-25-214" href="#__codelineno-25-214"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">li</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="w"> </span><span class="s1">'-'</span><span class="p">)</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="w"> </span><span class="n">li</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="s1">'href'</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">]</span>
</span><span id="__span-25-215"><a id="__codelineno-25-215" name="__codelineno-25-215" href="#__codelineno-25-215"></a>
</span><span id="__span-25-216"><a id="__codelineno-25-216" name="__codelineno-25-216" href="#__codelineno-25-216"></a>    <span class="n">save_obj</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-25-217"><a id="__codelineno-25-217" name="__codelineno-25-217" href="#__codelineno-25-217"></a>
</span><span id="__span-25-218"><a id="__codelineno-25-218" name="__codelineno-25-218" href="#__codelineno-25-218"></a>    <span class="k">return</span> <span class="n">names</span>
</span><span id="__span-25-219"><a id="__codelineno-25-219" name="__codelineno-25-219" href="#__codelineno-25-219"></a>
</span><span id="__span-25-220"><a id="__codelineno-25-220" name="__codelineno-25-220" href="#__codelineno-25-220"></a><span class="c1"># scan a repo for references to another student's documentation</span>
</span><span id="__span-25-221"><a id="__codelineno-25-221" name="__codelineno-25-221" href="#__codelineno-25-221"></a><span class="k">def</span> <span class="nf">get_references</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">from_url</span><span class="p">):</span>
</span><span id="__span-25-222"><a id="__codelineno-25-222" name="__codelineno-25-222" href="#__codelineno-25-222"></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">f</span><span class="s2">"\/20[0-9][0-9]\/labs\/[^\/]+\/students\/(\w|-)+\/"</span><span class="p">)</span>
</span><span id="__span-25-223"><a id="__codelineno-25-223" name="__codelineno-25-223" href="#__codelineno-25-223"></a>    <span class="n">people_linked</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-25-224"><a id="__codelineno-25-224" name="__codelineno-25-224" href="#__codelineno-25-224"></a>    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">)):</span>
</span><span id="__span-25-225"><a id="__codelineno-25-225" name="__codelineno-25-225" href="#__codelineno-25-225"></a>        <span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://fabacademy.org</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-25-226"><a id="__codelineno-25-226" name="__codelineno-25-226" href="#__codelineno-25-226"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"FULL URL </span><span class="si">{</span><span class="n">full_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-227"><a id="__codelineno-25-227" name="__codelineno-25-227" href="#__codelineno-25-227"></a>        <span class="n">person</span> <span class="o">=</span> <span class="n">format_name</span><span class="p">((</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">full_url</span><span class="p">),</span> <span class="n">year</span><span class="p">)</span>
</span><span id="__span-25-228"><a id="__codelineno-25-228" name="__codelineno-25-228" href="#__codelineno-25-228"></a>
</span><span id="__span-25-229"><a id="__codelineno-25-229" name="__codelineno-25-229" href="#__codelineno-25-229"></a>        <span class="n">link_label</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-25-230"><a id="__codelineno-25-230" name="__codelineno-25-230" href="#__codelineno-25-230"></a>
</span><span id="__span-25-231"><a id="__codelineno-25-231" name="__codelineno-25-231" href="#__codelineno-25-231"></a>        <span class="n">topic_search_start_ind</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">-</span> <span class="n">CHARACTERS_EACH_DIRECTION_TOPIC_DETECTION</span>
</span><span id="__span-25-232"><a id="__codelineno-25-232" name="__codelineno-25-232" href="#__codelineno-25-232"></a>        <span class="k">if</span> <span class="n">topic_search_start_ind</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-25-233"><a id="__codelineno-25-233" name="__codelineno-25-233" href="#__codelineno-25-233"></a>            <span class="n">topic_search_start_ind</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-25-234"><a id="__codelineno-25-234" name="__codelineno-25-234" href="#__codelineno-25-234"></a>        <span class="n">topic_search_end_ind</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="o">+</span> <span class="n">CHARACTERS_EACH_DIRECTION_TOPIC_DETECTION</span>
</span><span id="__span-25-235"><a id="__codelineno-25-235" name="__codelineno-25-235" href="#__codelineno-25-235"></a>        <span class="k">if</span> <span class="n">topic_search_end_ind</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
</span><span id="__span-25-236"><a id="__codelineno-25-236" name="__codelineno-25-236" href="#__codelineno-25-236"></a>            <span class="n">topic_search_end_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="__span-25-237"><a id="__codelineno-25-237" name="__codelineno-25-237" href="#__codelineno-25-237"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="si">}</span><span class="s2">) -&gt; (</span><span class="si">{</span><span class="n">topic_search_start_ind</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">topic_search_end_ind</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-25-238"><a id="__codelineno-25-238" name="__codelineno-25-238" href="#__codelineno-25-238"></a>        <span class="n">topic_text</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="n">topic_search_start_ind</span><span class="p">:</span><span class="n">topic_search_end_ind</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="__span-25-239"><a id="__codelineno-25-239" name="__codelineno-25-239" href="#__codelineno-25-239"></a>
</span><span id="__span-25-240"><a id="__codelineno-25-240" name="__codelineno-25-240" href="#__codelineno-25-240"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"TOPIC TEXT"</span><span class="p">,</span> <span class="n">topic_text</span><span class="p">)</span>
</span><span id="__span-25-241"><a id="__codelineno-25-241" name="__codelineno-25-241" href="#__codelineno-25-241"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TOPICS</span><span class="p">)):</span>
</span><span id="__span-25-242"><a id="__codelineno-25-242" name="__codelineno-25-242" href="#__codelineno-25-242"></a>            <span class="n">topic</span> <span class="o">=</span> <span class="n">TOPICS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-25-243"><a id="__codelineno-25-243" name="__codelineno-25-243" href="#__codelineno-25-243"></a>            <span class="n">topic_search_terms</span> <span class="o">=</span> <span class="n">TOPIC_SEARCH_TERMS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-25-244"><a id="__codelineno-25-244" name="__codelineno-25-244" href="#__codelineno-25-244"></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">topic_search_terms</span><span class="p">:</span>
</span><span id="__span-25-245"><a id="__codelineno-25-245" name="__codelineno-25-245" href="#__codelineno-25-245"></a>                <span class="n">item_spaces</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-25-246"><a id="__codelineno-25-246" name="__codelineno-25-246" href="#__codelineno-25-246"></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">item_spaces</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"."</span><span class="p">)),</span> <span class="n">topic_text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">item_spaces</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">"-"</span><span class="p">)),</span> <span class="n">topic_text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">item_spaces</span><span class="p">),</span> <span class="n">topic_text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">item_spaces</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="s2">""</span><span class="p">)),</span> <span class="n">topic_text</span><span class="p">):</span>
</span><span id="__span-25-247"><a id="__codelineno-25-247" name="__codelineno-25-247" href="#__codelineno-25-247"></a>                    <span class="n">link_label</span> <span class="o">=</span> <span class="n">topic</span>
</span><span id="__span-25-248"><a id="__codelineno-25-248" name="__codelineno-25-248" href="#__codelineno-25-248"></a>
</span><span id="__span-25-249"><a id="__codelineno-25-249" name="__codelineno-25-249" href="#__codelineno-25-249"></a>        <span class="k">if</span> <span class="n">link_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-25-250"><a id="__codelineno-25-250" name="__codelineno-25-250" href="#__codelineno-25-250"></a>            <span class="n">link_label</span> <span class="o">=</span> <span class="n">TOPICS</span><span class="p">[</span><span class="n">classifier</span><span class="o">.</span><span class="n">classifyItem</span><span class="p">(</span><span class="n">content</span><span class="p">)]</span>
</span><span id="__span-25-251"><a id="__codelineno-25-251" name="__codelineno-25-251" href="#__codelineno-25-251"></a>
</span><span id="__span-25-252"><a id="__codelineno-25-252" name="__codelineno-25-252" href="#__codelineno-25-252"></a>        <span class="k">if</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">people_linked</span><span class="p">:</span>
</span><span id="__span-25-253"><a id="__codelineno-25-253" name="__codelineno-25-253" href="#__codelineno-25-253"></a>            <span class="k">if</span> <span class="n">link_label</span> <span class="ow">in</span> <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>
</span><span id="__span-25-254"><a id="__codelineno-25-254" name="__codelineno-25-254" href="#__codelineno-25-254"></a>                <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">link_label</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-25-255"><a id="__codelineno-25-255" name="__codelineno-25-255" href="#__codelineno-25-255"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-25-256"><a id="__codelineno-25-256" name="__codelineno-25-256" href="#__codelineno-25-256"></a>            <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-25-257"><a id="__codelineno-25-257" name="__codelineno-25-257" href="#__codelineno-25-257"></a>            <span class="n">people_linked</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">link_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-25-258"><a id="__codelineno-25-258" name="__codelineno-25-258" href="#__codelineno-25-258"></a>
</span><span id="__span-25-259"><a id="__codelineno-25-259" name="__codelineno-25-259" href="#__codelineno-25-259"></a>    <span class="k">return</span> <span class="n">people_linked</span>
</span><span id="__span-25-260"><a id="__codelineno-25-260" name="__codelineno-25-260" href="#__codelineno-25-260"></a>
</span><span id="__span-25-261"><a id="__codelineno-25-261" name="__codelineno-25-261" href="#__codelineno-25-261"></a><span class="c1"># combine students' dictionaries of references to other's websites</span>
</span><span id="__span-25-262"><a id="__codelineno-25-262" name="__codelineno-25-262" href="#__codelineno-25-262"></a><span class="k">def</span> <span class="nf">combine_reference_dicts</span><span class="p">(</span><span class="n">reference_dict_list</span><span class="p">):</span>
</span><span id="__span-25-263"><a id="__codelineno-25-263" name="__codelineno-25-263" href="#__codelineno-25-263"></a>    <span class="n">combined_reference_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-25-264"><a id="__codelineno-25-264" name="__codelineno-25-264" href="#__codelineno-25-264"></a>    <span class="k">for</span> <span class="nb">dict</span> <span class="ow">in</span> <span class="n">reference_dict_list</span><span class="p">:</span>
</span><span id="__span-25-265"><a id="__codelineno-25-265" name="__codelineno-25-265" href="#__codelineno-25-265"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-25-266"><a id="__codelineno-25-266" name="__codelineno-25-266" href="#__codelineno-25-266"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">combined_reference_dict</span><span class="p">:</span>
</span><span id="__span-25-267"><a id="__codelineno-25-267" name="__codelineno-25-267" href="#__codelineno-25-267"></a>                <span class="k">for</span> <span class="n">topic_key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
</span><span id="__span-25-268"><a id="__codelineno-25-268" name="__codelineno-25-268" href="#__codelineno-25-268"></a>                    <span class="k">if</span> <span class="n">topic_key</span> <span class="ow">in</span> <span class="n">combined_reference_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
</span><span id="__span-25-269"><a id="__codelineno-25-269" name="__codelineno-25-269" href="#__codelineno-25-269"></a>                        <span class="n">combined_reference_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">topic_key</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">topic_key</span><span class="p">]</span>
</span><span id="__span-25-270"><a id="__codelineno-25-270" name="__codelineno-25-270" href="#__codelineno-25-270"></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-25-271"><a id="__codelineno-25-271" name="__codelineno-25-271" href="#__codelineno-25-271"></a>                        <span class="n">combined_reference_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">topic_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">topic_key</span><span class="p">]</span>
</span><span id="__span-25-272"><a id="__codelineno-25-272" name="__codelineno-25-272" href="#__codelineno-25-272"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-25-273"><a id="__codelineno-25-273" name="__codelineno-25-273" href="#__codelineno-25-273"></a>                <span class="n">combined_reference_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> 
</span><span id="__span-25-274"><a id="__codelineno-25-274" name="__codelineno-25-274" href="#__codelineno-25-274"></a>    <span class="k">return</span> <span class="n">combined_reference_dict</span>
</span><span id="__span-25-275"><a id="__codelineno-25-275" name="__codelineno-25-275" href="#__codelineno-25-275"></a>
</span><span id="__span-25-276"><a id="__codelineno-25-276" name="__codelineno-25-276" href="#__codelineno-25-276"></a><span class="c1"># convert data to Pandas crosstab matrix, now including subject-area</span>
</span><span id="__span-25-277"><a id="__codelineno-25-277" name="__codelineno-25-277" href="#__codelineno-25-277"></a><span class="k">def</span> <span class="nf">format_data_to_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="__span-25-278"><a id="__codelineno-25-278" name="__codelineno-25-278" href="#__codelineno-25-278"></a>    <span class="n">students</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-279"><a id="__codelineno-25-279" name="__codelineno-25-279" href="#__codelineno-25-279"></a>
</span><span id="__span-25-280"><a id="__codelineno-25-280" name="__codelineno-25-280" href="#__codelineno-25-280"></a>    <span class="k">for</span> <span class="n">year_info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span> <span class="c1"># [(lab_id: (int), {"Student Name": {"student-referenced": num_references (int), ...}}), ...]</span>
</span><span id="__span-25-281"><a id="__codelineno-25-281" name="__codelineno-25-281" href="#__codelineno-25-281"></a>        <span class="k">for</span> <span class="n">student_info</span> <span class="ow">in</span> <span class="n">year_info</span><span class="p">:</span> <span class="c1"># (lab_id: (int), {"Student Name": {"student-referenced": num_references (int), ...}})</span>
</span><span id="__span-25-282"><a id="__codelineno-25-282" name="__codelineno-25-282" href="#__codelineno-25-282"></a>            <span class="n">lab_id</span> <span class="o">=</span> <span class="n">student_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
</span><span id="__span-25-283"><a id="__codelineno-25-283" name="__codelineno-25-283" href="#__codelineno-25-283"></a>            <span class="n">student_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-25-284"><a id="__codelineno-25-284" name="__codelineno-25-284" href="#__codelineno-25-284"></a>            <span class="n">reference_dict</span> <span class="o">=</span> <span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="__span-25-285"><a id="__codelineno-25-285" name="__codelineno-25-285" href="#__codelineno-25-285"></a>            <span class="n">students</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">student_name</span><span class="p">)</span> 
</span><span id="__span-25-286"><a id="__codelineno-25-286" name="__codelineno-25-286" href="#__codelineno-25-286"></a>
</span><span id="__span-25-287"><a id="__codelineno-25-287" name="__codelineno-25-287" href="#__codelineno-25-287"></a>    <span class="n">students_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">students</span><span class="p">]</span>
</span><span id="__span-25-288"><a id="__codelineno-25-288" name="__codelineno-25-288" href="#__codelineno-25-288"></a>
</span><span id="__span-25-289"><a id="__codelineno-25-289" name="__codelineno-25-289" href="#__codelineno-25-289"></a>    <span class="n">link_student_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-25-290"><a id="__codelineno-25-290" name="__codelineno-25-290" href="#__codelineno-25-290"></a>
</span><span id="__span-25-291"><a id="__codelineno-25-291" name="__codelineno-25-291" href="#__codelineno-25-291"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">students</span><span class="p">)):</span>
</span><span id="__span-25-292"><a id="__codelineno-25-292" name="__codelineno-25-292" href="#__codelineno-25-292"></a>        <span class="n">link_student_dict</span><span class="p">[</span><span class="n">students_links</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">students</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-25-293"><a id="__codelineno-25-293" name="__codelineno-25-293" href="#__codelineno-25-293"></a>
</span><span id="__span-25-294"><a id="__codelineno-25-294" name="__codelineno-25-294" href="#__codelineno-25-294"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">"STUDENTS"</span><span class="p">,</span> <span class="n">students</span><span class="p">)</span>
</span><span id="__span-25-295"><a id="__codelineno-25-295" name="__codelineno-25-295" href="#__codelineno-25-295"></a>
</span><span id="__span-25-296"><a id="__codelineno-25-296" name="__codelineno-25-296" href="#__codelineno-25-296"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">students</span><span class="p">,</span> <span class="n">students</span><span class="p">)</span>
</span><span id="__span-25-297"><a id="__codelineno-25-297" name="__codelineno-25-297" href="#__codelineno-25-297"></a>    <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">"Referencing Students"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-298"><a id="__codelineno-25-298" name="__codelineno-25-298" href="#__codelineno-25-298"></a>    <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">"Referenced Students"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-299"><a id="__codelineno-25-299" name="__codelineno-25-299" href="#__codelineno-25-299"></a>
</span><span id="__span-25-300"><a id="__codelineno-25-300" name="__codelineno-25-300" href="#__codelineno-25-300"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">TOPICS</span><span class="p">]))</span>
</span><span id="__span-25-301"><a id="__codelineno-25-301" name="__codelineno-25-301" href="#__codelineno-25-301"></a>
</span><span id="__span-25-302"><a id="__codelineno-25-302" name="__codelineno-25-302" href="#__codelineno-25-302"></a>    <span class="k">for</span> <span class="n">student1</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-25-303"><a id="__codelineno-25-303" name="__codelineno-25-303" href="#__codelineno-25-303"></a>        <span class="k">for</span> <span class="n">student2</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-25-304"><a id="__codelineno-25-304" name="__codelineno-25-304" href="#__codelineno-25-304"></a>            <span class="k">for</span> <span class="n">topic_name</span> <span class="ow">in</span> <span class="n">TOPICS</span><span class="p">:</span>
</span><span id="__span-25-305"><a id="__codelineno-25-305" name="__codelineno-25-305" href="#__codelineno-25-305"></a>                <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">student1</span><span class="p">,</span> <span class="p">(</span><span class="n">student2</span><span class="p">,</span> <span class="n">topic_name</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span> <span class="k">if</span> <span class="n">student1</span> <span class="o">==</span> <span class="n">student2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-25-306"><a id="__codelineno-25-306" name="__codelineno-25-306" href="#__codelineno-25-306"></a>
</span><span id="__span-25-307"><a id="__codelineno-25-307" name="__codelineno-25-307" href="#__codelineno-25-307"></a>    <span class="k">def</span> <span class="nf">assign_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-25-308"><a id="__codelineno-25-308" name="__codelineno-25-308" href="#__codelineno-25-308"></a>        <span class="k">if</span> <span class="n">referencer_student</span> <span class="o">==</span> <span class="n">referenced_student</span><span class="p">:</span>
</span><span id="__span-25-309"><a id="__codelineno-25-309" name="__codelineno-25-309" href="#__codelineno-25-309"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ignoring self-referenced student </span><span class="si">{</span><span class="n">referencer_student</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-310"><a id="__codelineno-25-310" name="__codelineno-25-310" href="#__codelineno-25-310"></a>        <span class="k">elif</span> <span class="n">referenced_student</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">students</span><span class="p">:</span>
</span><span id="__span-25-311"><a id="__codelineno-25-311" name="__codelineno-25-311" href="#__codelineno-25-311"></a>            <span class="k">if</span> <span class="n">referenced_student</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">students_links</span><span class="p">:</span>
</span><span id="__span-25-312"><a id="__codelineno-25-312" name="__codelineno-25-312" href="#__codelineno-25-312"></a>                <span class="n">assign_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">link_student_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span>
</span><span id="__span-25-313"><a id="__codelineno-25-313" name="__codelineno-25-313" href="#__codelineno-25-313"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-25-314"><a id="__codelineno-25-314" name="__codelineno-25-314" href="#__codelineno-25-314"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Referenced student isn't a student - URL matched naming convention so regex caught but wasn't checked against student list - skipping"</span><span class="p">)</span>
</span><span id="__span-25-315"><a id="__codelineno-25-315" name="__codelineno-25-315" href="#__codelineno-25-315"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-25-316"><a id="__codelineno-25-316" name="__codelineno-25-316" href="#__codelineno-25-316"></a>            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span> <span class="o">=</span> <span class="n">num_references</span>
</span><span id="__span-25-317"><a id="__codelineno-25-317" name="__codelineno-25-317" href="#__codelineno-25-317"></a>
</span><span id="__span-25-318"><a id="__codelineno-25-318" name="__codelineno-25-318" href="#__codelineno-25-318"></a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-25-319"><a id="__codelineno-25-319" name="__codelineno-25-319" href="#__codelineno-25-319"></a>        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span>
</span><span id="__span-25-320"><a id="__codelineno-25-320" name="__codelineno-25-320" href="#__codelineno-25-320"></a>
</span><span id="__span-25-321"><a id="__codelineno-25-321" name="__codelineno-25-321" href="#__codelineno-25-321"></a>    <span class="k">for</span> <span class="n">year_info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-25-322"><a id="__codelineno-25-322" name="__codelineno-25-322" href="#__codelineno-25-322"></a>        <span class="k">for</span> <span class="n">student_info</span> <span class="ow">in</span> <span class="n">year_info</span><span class="p">:</span>
</span><span id="__span-25-323"><a id="__codelineno-25-323" name="__codelineno-25-323" href="#__codelineno-25-323"></a>            <span class="n">student_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-25-324"><a id="__codelineno-25-324" name="__codelineno-25-324" href="#__codelineno-25-324"></a>            <span class="n">reference_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">student_info</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">student_name</span><span class="p">])</span>
</span><span id="__span-25-325"><a id="__codelineno-25-325" name="__codelineno-25-325" href="#__codelineno-25-325"></a>            <span class="k">for</span> <span class="n">referenced_student</span> <span class="ow">in</span> <span class="n">reference_dict</span><span class="p">:</span>
</span><span id="__span-25-326"><a id="__codelineno-25-326" name="__codelineno-25-326" href="#__codelineno-25-326"></a>                <span class="k">for</span> <span class="n">reference_type</span> <span class="ow">in</span> <span class="n">reference_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="p">]:</span>
</span><span id="__span-25-327"><a id="__codelineno-25-327" name="__codelineno-25-327" href="#__codelineno-25-327"></a>                    <span class="n">num_references</span> <span class="o">=</span> <span class="n">reference_dict</span><span class="p">[</span><span class="n">referenced_student</span><span class="p">][</span><span class="n">reference_type</span><span class="p">]</span>
</span><span id="__span-25-328"><a id="__codelineno-25-328" name="__codelineno-25-328" href="#__codelineno-25-328"></a>                    <span class="n">assign_value</span><span class="p">(</span><span class="n">student_name</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">num_references</span><span class="p">,</span> <span class="n">reference_type</span><span class="p">)</span>
</span><span id="__span-25-329"><a id="__codelineno-25-329" name="__codelineno-25-329" href="#__codelineno-25-329"></a>
</span><span id="__span-25-330"><a id="__codelineno-25-330" name="__codelineno-25-330" href="#__codelineno-25-330"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"final_data.csv"</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">"Referencing Students|Referenced Students"</span><span class="p">)</span>
</span><span id="__span-25-331"><a id="__codelineno-25-331" name="__codelineno-25-331" href="#__codelineno-25-331"></a>
</span><span id="__span-25-332"><a id="__codelineno-25-332" name="__codelineno-25-332" href="#__codelineno-25-332"></a>    <span class="k">return</span> <span class="n">df</span>
</span><span id="__span-25-333"><a id="__codelineno-25-333" name="__codelineno-25-333" href="#__codelineno-25-333"></a>
</span><span id="__span-25-334"><a id="__codelineno-25-334" name="__codelineno-25-334" href="#__codelineno-25-334"></a><span class="c1"># get all of the reference dictionaries of different students for a given year</span>
</span><span id="__span-25-335"><a id="__codelineno-25-335" name="__codelineno-25-335" href="#__codelineno-25-335"></a><span class="k">def</span> <span class="nf">get_all_reference_dicts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
</span><span id="__span-25-336"><a id="__codelineno-25-336" name="__codelineno-25-336" href="#__codelineno-25-336"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-25-337"><a id="__codelineno-25-337" name="__codelineno-25-337" href="#__codelineno-25-337"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"reference_dict_saves"</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="__span-25-338"><a id="__codelineno-25-338" name="__codelineno-25-338" href="#__codelineno-25-338"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Save exists! </span><span class="si">{</span><span class="n">load_obj</span><span class="p">(</span><span class="s1">'reference_dict_saves'</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-339"><a id="__codelineno-25-339" name="__codelineno-25-339" href="#__codelineno-25-339"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"reference_dict_saves"</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-25-340"><a id="__codelineno-25-340" name="__codelineno-25-340" href="#__codelineno-25-340"></a>    <span class="n">reference_dict_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-341"><a id="__codelineno-25-341" name="__codelineno-25-341" href="#__codelineno-25-341"></a>    <span class="n">default_branch_name_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"https://gitlab.fabcloud.org/api/v4/projects/</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">/repository/branches"</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-25-342"><a id="__codelineno-25-342" name="__codelineno-25-342" href="#__codelineno-25-342"></a>    <span class="n">default_branch_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-25-343"><a id="__codelineno-25-343" name="__codelineno-25-343" href="#__codelineno-25-343"></a>    <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">default_branch_name_response</span><span class="p">:</span>
</span><span id="__span-25-344"><a id="__codelineno-25-344" name="__codelineno-25-344" href="#__codelineno-25-344"></a>        <span class="k">if</span> <span class="n">branch</span><span class="p">[</span><span class="s1">'default'</span><span class="p">]:</span>
</span><span id="__span-25-345"><a id="__codelineno-25-345" name="__codelineno-25-345" href="#__codelineno-25-345"></a>            <span class="n">default_branch_name</span> <span class="o">=</span> <span class="n">branch</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
</span><span id="__span-25-346"><a id="__codelineno-25-346" name="__codelineno-25-346" href="#__codelineno-25-346"></a>    <span class="k">if</span> <span class="n">default_branch_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-25-347"><a id="__codelineno-25-347" name="__codelineno-25-347" href="#__codelineno-25-347"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error: Default Branch Not Found (id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">default_branch_name_response</span><span class="si">}</span><span class="s2"> - leaving as None"</span><span class="p">)</span>
</span><span id="__span-25-348"><a id="__codelineno-25-348" name="__codelineno-25-348" href="#__codelineno-25-348"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-25-349"><a id="__codelineno-25-349" name="__codelineno-25-349" href="#__codelineno-25-349"></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">get_file_repo_list</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
</span><span id="__span-25-350"><a id="__codelineno-25-350" name="__codelineno-25-350" href="#__codelineno-25-350"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Checking </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
</span><span id="__span-25-351"><a id="__codelineno-25-351" name="__codelineno-25-351" href="#__codelineno-25-351"></a>            <span class="n">reference_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_references</span><span class="p">(</span><span class="n">get_file_content</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">default_branch_name</span><span class="p">),</span> <span class="n">year</span><span class="p">,</span> <span class="n">get_repo_name</span><span class="p">(</span><span class="nb">id</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="__span-25-352"><a id="__codelineno-25-352" name="__codelineno-25-352" href="#__codelineno-25-352"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Generating compiled reference dictionary..."</span><span class="p">)</span>
</span><span id="__span-25-353"><a id="__codelineno-25-353" name="__codelineno-25-353" href="#__codelineno-25-353"></a>        <span class="n">compiled_reference_dict</span> <span class="o">=</span> <span class="n">combine_reference_dicts</span><span class="p">(</span><span class="n">reference_dict_list</span><span class="p">)</span>
</span><span id="__span-25-354"><a id="__codelineno-25-354" name="__codelineno-25-354" href="#__codelineno-25-354"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">compiled_reference_dict</span><span class="p">)</span>
</span><span id="__span-25-355"><a id="__codelineno-25-355" name="__codelineno-25-355" href="#__codelineno-25-355"></a>        <span class="n">save_obj</span><span class="p">(</span><span class="s2">"reference_dict_saves"</span><span class="p">,</span> <span class="n">compiled_reference_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-25-356"><a id="__codelineno-25-356" name="__codelineno-25-356" href="#__codelineno-25-356"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"SAVING to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-357"><a id="__codelineno-25-357" name="__codelineno-25-357" href="#__codelineno-25-357"></a>        <span class="k">return</span> <span class="n">compiled_reference_dict</span>
</span><span id="__span-25-358"><a id="__codelineno-25-358" name="__codelineno-25-358" href="#__codelineno-25-358"></a>    <span class="k">except</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GitlabGetError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-25-359"><a id="__codelineno-25-359" name="__codelineno-25-359" href="#__codelineno-25-359"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error, returning combined reference dicts:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-25-360"><a id="__codelineno-25-360" name="__codelineno-25-360" href="#__codelineno-25-360"></a>        <span class="k">return</span> <span class="n">combine_reference_dicts</span><span class="p">(</span><span class="n">reference_dict_list</span><span class="p">)</span>
</span><span id="__span-25-361"><a id="__codelineno-25-361" name="__codelineno-25-361" href="#__codelineno-25-361"></a>
</span><span id="__span-25-362"><a id="__codelineno-25-362" name="__codelineno-25-362" href="#__codelineno-25-362"></a><span class="k">def</span> <span class="nf">get_people_soup</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
</span><span id="__span-25-363"><a id="__codelineno-25-363" name="__codelineno-25-363" href="#__codelineno-25-363"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-soup"</span>
</span><span id="__span-25-364"><a id="__codelineno-25-364" name="__codelineno-25-364" href="#__codelineno-25-364"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="__span-25-365"><a id="__codelineno-25-365" name="__codelineno-25-365" href="#__codelineno-25-365"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-25-366"><a id="__codelineno-25-366" name="__codelineno-25-366" href="#__codelineno-25-366"></a>
</span><span id="__span-25-367"><a id="__codelineno-25-367" name="__codelineno-25-367" href="#__codelineno-25-367"></a>    <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://fabacademy.org/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/people.html"</span>
</span><span id="__span-25-368"><a id="__codelineno-25-368" name="__codelineno-25-368" href="#__codelineno-25-368"></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>
</span><span id="__span-25-369"><a id="__codelineno-25-369" name="__codelineno-25-369" href="#__codelineno-25-369"></a>
</span><span id="__span-25-370"><a id="__codelineno-25-370" name="__codelineno-25-370" href="#__codelineno-25-370"></a>    <span class="n">save_obj</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">soup</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-25-371"><a id="__codelineno-25-371" name="__codelineno-25-371" href="#__codelineno-25-371"></a>
</span><span id="__span-25-372"><a id="__codelineno-25-372" name="__codelineno-25-372" href="#__codelineno-25-372"></a>    <span class="k">return</span> <span class="n">soup</span>
</span><span id="__span-25-373"><a id="__codelineno-25-373" name="__codelineno-25-373" href="#__codelineno-25-373"></a>
</span><span id="__span-25-374"><a id="__codelineno-25-374" name="__codelineno-25-374" href="#__codelineno-25-374"></a><span class="k">def</span> <span class="nf">repo_name_to_student_name</span><span class="p">(</span><span class="n">name_and_web_url_tup</span><span class="p">):</span>
</span><span id="__span-25-375"><a id="__codelineno-25-375" name="__codelineno-25-375" href="#__codelineno-25-375"></a>    <span class="n">name</span><span class="p">,</span> <span class="n">web_url</span> <span class="o">=</span> <span class="n">name_and_web_url_tup</span>
</span><span id="__span-25-376"><a id="__codelineno-25-376" name="__codelineno-25-376" href="#__codelineno-25-376"></a>    <span class="n">year</span> <span class="o">=</span> <span class="n">web_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-25-377"><a id="__codelineno-25-377" name="__codelineno-25-377" href="#__codelineno-25-377"></a>    <span class="n">href</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'/</span><span class="si">{</span><span class="s2">"/"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">web_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">3</span><span class="p">:])</span><span class="si">}</span><span class="s1">'</span>
</span><span id="__span-25-378"><a id="__codelineno-25-378" name="__codelineno-25-378" href="#__codelineno-25-378"></a>    <span class="n">people_soup</span> <span class="o">=</span> <span class="n">get_people_soup</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
</span><span id="__span-25-379"><a id="__codelineno-25-379" name="__codelineno-25-379" href="#__codelineno-25-379"></a>    <span class="n">As</span> <span class="o">=</span> <span class="n">people_soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-380"><a id="__codelineno-25-380" name="__codelineno-25-380" href="#__codelineno-25-380"></a>    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">As</span> <span class="k">if</span> <span class="n">_</span><span class="p">[</span><span class="s1">'href'</span><span class="p">]</span> <span class="o">==</span> <span class="n">href</span> <span class="ow">or</span> <span class="n">_</span><span class="p">[</span><span class="s1">'href'</span><span class="p">]</span> <span class="o">==</span> <span class="n">href</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># or to account for ending slash</span>
</span><span id="__span-25-381"><a id="__codelineno-25-381" name="__codelineno-25-381" href="#__codelineno-25-381"></a>    <span class="n">name_final</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-25-382"><a id="__codelineno-25-382" name="__codelineno-25-382" href="#__codelineno-25-382"></a>    <span class="k">return</span> <span class="n">name_final</span><span class="p">,</span> <span class="n">web_url</span>
</span><span id="__span-25-383"><a id="__codelineno-25-383" name="__codelineno-25-383" href="#__codelineno-25-383"></a>
</span><span id="__span-25-384"><a id="__codelineno-25-384" name="__codelineno-25-384" href="#__codelineno-25-384"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-25-385"><a id="__codelineno-25-385" name="__codelineno-25-385" href="#__codelineno-25-385"></a>    <span class="n">classifier</span> <span class="o">=</span> <span class="n">Classifier</span><span class="p">()</span>
</span><span id="__span-25-386"><a id="__codelineno-25-386" name="__codelineno-25-386" href="#__codelineno-25-386"></a>
</span><span id="__span-25-387"><a id="__codelineno-25-387" name="__codelineno-25-387" href="#__codelineno-25-387"></a>    <span class="n">reference_dicts_across_years</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [[(lab_id: (int), {"Student Name": {"student-referenced": num_references (int), ...}}), ...], ...]</span>
</span><span id="__span-25-388"><a id="__codelineno-25-388" name="__codelineno-25-388" href="#__codelineno-25-388"></a>
</span><span id="__span-25-389"><a id="__codelineno-25-389" name="__codelineno-25-389" href="#__codelineno-25-389"></a>    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">2024</span><span class="p">):</span>
</span><span id="__span-25-390"><a id="__codelineno-25-390" name="__codelineno-25-390" href="#__codelineno-25-390"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Loading student names..."</span><span class="p">)</span>
</span><span id="__span-25-391"><a id="__codelineno-25-391" name="__codelineno-25-391" href="#__codelineno-25-391"></a>        <span class="n">all_student_names</span> <span class="o">=</span> <span class="n">get_all_people</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
</span><span id="__span-25-392"><a id="__codelineno-25-392" name="__codelineno-25-392" href="#__codelineno-25-392"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">all_student_names</span><span class="p">)</span>
</span><span id="__span-25-393"><a id="__codelineno-25-393" name="__codelineno-25-393" href="#__codelineno-25-393"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Collecting student repo IDs..."</span><span class="p">)</span>
</span><span id="__span-25-394"><a id="__codelineno-25-394" name="__codelineno-25-394" href="#__codelineno-25-394"></a>        <span class="n">all_student_repo_ids</span> <span class="o">=</span> <span class="n">get_all_student_repo_ids</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">ALL_LAB_SUBGROUP_IDS</span><span class="p">[</span><span class="n">year</span><span class="p">],</span> <span class="n">all_student_names</span><span class="p">)</span>
</span><span id="__span-25-395"><a id="__codelineno-25-395" name="__codelineno-25-395" href="#__codelineno-25-395"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">all_student_repo_ids</span><span class="p">)</span>
</span><span id="__span-25-396"><a id="__codelineno-25-396" name="__codelineno-25-396" href="#__codelineno-25-396"></a>
</span><span id="__span-25-397"><a id="__codelineno-25-397" name="__codelineno-25-397" href="#__codelineno-25-397"></a>        <span class="n">all_reference_dicts</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [(lab_id: (int), {"Student Name": {"student-referenced": num_references (int), ...}}), ...]</span>
</span><span id="__span-25-398"><a id="__codelineno-25-398" name="__codelineno-25-398" href="#__codelineno-25-398"></a>
</span><span id="__span-25-399"><a id="__codelineno-25-399" name="__codelineno-25-399" href="#__codelineno-25-399"></a>        <span class="k">for</span> <span class="n">lab_number</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">all_student_repo_ids</span><span class="p">:</span>
</span><span id="__span-25-400"><a id="__codelineno-25-400" name="__codelineno-25-400" href="#__codelineno-25-400"></a><span class="w">            </span><span class="sd">"""temp_i += 1</span>
</span><span id="__span-25-401"><a id="__codelineno-25-401" name="__codelineno-25-401" href="#__codelineno-25-401"></a><span class="sd">            if temp_i &gt; 3:</span>
</span><span id="__span-25-402"><a id="__codelineno-25-402" name="__codelineno-25-402" href="#__codelineno-25-402"></a><span class="sd">                break"""</span>
</span><span id="__span-25-403"><a id="__codelineno-25-403" name="__codelineno-25-403" href="#__codelineno-25-403"></a>            <span class="n">reference_dict_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-404"><a id="__codelineno-25-404" name="__codelineno-25-404" href="#__codelineno-25-404"></a>
</span><span id="__span-25-405"><a id="__codelineno-25-405" name="__codelineno-25-405" href="#__codelineno-25-405"></a>            <span class="n">compiled_reference_dict</span> <span class="o">=</span> <span class="n">get_all_reference_dicts</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</span><span id="__span-25-406"><a id="__codelineno-25-406" name="__codelineno-25-406" href="#__codelineno-25-406"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">compiled_reference_dict</span><span class="p">)</span>
</span><span id="__span-25-407"><a id="__codelineno-25-407" name="__codelineno-25-407" href="#__codelineno-25-407"></a>
</span><span id="__span-25-408"><a id="__codelineno-25-408" name="__codelineno-25-408" href="#__codelineno-25-408"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Adding reference dictionary to database..."</span><span class="p">)</span>
</span><span id="__span-25-409"><a id="__codelineno-25-409" name="__codelineno-25-409" href="#__codelineno-25-409"></a>            <span class="n">all_reference_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lab_number</span><span class="p">,</span> <span class="p">{</span><span class="n">format_name</span><span class="p">(</span><span class="n">get_repo_name</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">year</span><span class="p">):</span> <span class="n">compiled_reference_dict</span><span class="p">}))</span>
</span><span id="__span-25-410"><a id="__codelineno-25-410" name="__codelineno-25-410" href="#__codelineno-25-410"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"All reference dictionaries so far... </span><span class="si">{</span><span class="n">all_reference_dicts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-25-411"><a id="__codelineno-25-411" name="__codelineno-25-411" href="#__codelineno-25-411"></a>        <span class="n">reference_dicts_across_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_reference_dicts</span><span class="p">)</span>
</span><span id="__span-25-412"><a id="__codelineno-25-412" name="__codelineno-25-412" href="#__codelineno-25-412"></a>
</span><span id="__span-25-413"><a id="__codelineno-25-413" name="__codelineno-25-413" href="#__codelineno-25-413"></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">format_data_to_matrix</span><span class="p">(</span><span class="n">reference_dicts_across_years</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="network-analysis">Network Analysis</h4>
<p><strong>Code</strong></p>
<p><a href="../../assets/code/step2-analysis-python.zip">Download the network analysis code here!</a></p>
<p><code>density.py</code> calculates the global network density.</p>
<p><em>density.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="kn">import</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">json</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"final_data.json"</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    <span class="n">final_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="c1"># Add nodes to the graph</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">final_data</span><span class="p">[</span><span class="s2">"nodes"</span><span class="p">]:</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>    <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">"id"</span><span class="p">])</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="c1"># Add edges (links) to the graph</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">final_data</span><span class="p">[</span><span class="s2">"links"</span><span class="p">]:</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>    <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">"source"</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="s2">"target"</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="s2">"value"</span><span class="p">],</span> <span class="n">topic</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="s2">"topic"</span><span class="p">])</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="c1"># Calculate density</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="n">density</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"density.obj"</span><span class="p">,</span><span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="nb">print</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
</span></code></pre></div>
<p><code>density_by_lab.py</code> creates a data table of the network density of each lab.</p>
<p><em>density_by_lab.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="kn">import</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">json</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="n">lab_names_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'aachen'</span><span class="p">,</span> <span class="s1">'aalto'</span><span class="p">,</span> <span class="s1">'agrilab'</span><span class="p">,</span> <span class="s1">'akgec'</span><span class="p">,</span> <span class="s1">'akureyri'</span><span class="p">,</span> <span class="s1">'algarve'</span><span class="p">,</span> <span class="s1">'bahrain'</span><span class="p">,</span> <span class="s1">'bangalore'</span><span class="p">,</span> <span class="s1">'barcelona'</span><span class="p">,</span> <span class="s1">'benfica'</span><span class="p">,</span> <span class="s1">'berytech'</span><span class="p">,</span> <span class="s1">'bhubaneswar'</span><span class="p">,</span> <span class="s1">'bhutan'</span><span class="p">,</span> <span class="s1">'boldseoul'</span><span class="p">,</span> <span class="s1">'bottrop'</span><span class="p">,</span> <span class="s1">'brighton'</span><span class="p">,</span> <span class="s1">'cept'</span><span class="p">,</span> <span class="s1">'chaihuo'</span><span class="p">,</span> <span class="s1">'chandigarh'</span><span class="p">,</span> <span class="s1">'charlotte'</span><span class="p">,</span> <span class="s1">'cidi'</span><span class="p">,</span> <span class="s1">'cit'</span><span class="p">,</span> <span class="s1">'ciudadmexico'</span><span class="p">,</span> <span class="s1">'cpcc'</span><span class="p">,</span> <span class="s1">'crunchlab'</span><span class="p">,</span> <span class="s1">'dassault'</span><span class="p">,</span> <span class="s1">'deusto'</span><span class="p">,</span> <span class="s1">'dhahran'</span><span class="p">,</span> <span class="s1">'digiscope'</span><span class="p">,</span> <span class="s1">'dilijan'</span><span class="p">,</span> <span class="s1">'ecae'</span><span class="p">,</span> <span class="s1">'echofab'</span><span class="p">,</span> <span class="s1">'ecostudio'</span><span class="p">,</span> <span class="s1">'egypt'</span><span class="p">,</span> <span class="s1">'energylab'</span><span class="p">,</span> <span class="s1">'esan'</span><span class="p">,</span> <span class="s1">'esne'</span><span class="p">,</span> <span class="s1">'fablabaachen'</span><span class="p">,</span> <span class="s1">'fablabaalto'</span><span class="p">,</span> <span class="s1">'fablabakgec'</span><span class="p">,</span> <span class="s1">'fablabamsterdam'</span><span class="p">,</span> <span class="s1">'fablabat3flo'</span><span class="p">,</span> <span class="s1">'fablabbahrain'</span><span class="p">,</span> <span class="s1">'fablabbeijing'</span><span class="p">,</span> <span class="s1">'fablabberytech'</span><span class="p">,</span> <span class="s1">'fablabbottrop'</span><span class="p">,</span> <span class="s1">'fablabbrighton'</span><span class="p">,</span> <span class="s1">'fablabcept'</span><span class="p">,</span> <span class="s1">'fablabcharlottelatin'</span><span class="p">,</span> <span class="s1">'fablabdassault'</span><span class="p">,</span> <span class="s1">'fablabdigiscope'</span><span class="p">,</span> <span class="s1">'fablabechofab'</span><span class="p">,</span> <span class="s1">'fablabecostudio'</span><span class="p">,</span> <span class="s1">'fablabegypt'</span><span class="p">,</span> <span class="s1">'fablaberfindergarden'</span><span class="p">,</span> <span class="s1">'fablabesan'</span><span class="p">,</span> <span class="s1">'fablabfacens'</span><span class="p">,</span> <span class="s1">'fablabfct'</span><span class="p">,</span> <span class="s1">'fablabgearbox'</span><span class="p">,</span> <span class="s1">'fablabincitefocus'</span><span class="p">,</span> <span class="s1">'fablabirbid'</span><span class="p">,</span> <span class="s1">'fablabisafjorour'</span><span class="p">,</span> <span class="s1">'fablabkamakura'</span><span class="p">,</span> <span class="s1">'fablabkamplintfort'</span><span class="p">,</span> <span class="s1">'fablabkhairpur'</span><span class="p">,</span> <span class="s1">'fablabkochi'</span><span class="p">,</span> <span class="s1">'fablabkromlaboro'</span><span class="p">,</span> <span class="s1">'fablablccc'</span><span class="p">,</span> <span class="s1">'fablableon'</span><span class="p">,</span> <span class="s1">'fablabmadridceu'</span><span class="p">,</span> <span class="s1">'fablabmexico'</span><span class="p">,</span> <span class="s1">'fablabodessa'</span><span class="p">,</span> <span class="s1">'fablabopendot'</span><span class="p">,</span> <span class="s1">'fablaboshanghai'</span><span class="p">,</span> <span class="s1">'fablaboulu'</span><span class="p">,</span> <span class="s1">'fablabpuebla'</span><span class="p">,</span> <span class="s1">'fablabreykjavik'</span><span class="p">,</span> <span class="s1">'fablabrwanda'</span><span class="p">,</span> <span class="s1">'fablabsantiago'</span><span class="p">,</span> <span class="s1">'fablabseoul'</span><span class="p">,</span> <span class="s1">'fablabseoulinnovation'</span><span class="p">,</span> <span class="s1">'fablabsiena'</span><span class="p">,</span> <span class="s1">'fablabsocom'</span><span class="p">,</span> <span class="s1">'fablabsorbonne'</span><span class="p">,</span> <span class="s1">'fablabspinderihallerne'</span><span class="p">,</span> <span class="s1">'fablabszoil'</span><span class="p">,</span> <span class="s1">'fablabtechworks'</span><span class="p">,</span> <span class="s1">'fablabtecsup'</span><span class="p">,</span> <span class="s1">'fablabtembisa'</span><span class="p">,</span> <span class="s1">'fablabtrivandrum'</span><span class="p">,</span> <span class="s1">'fablabuae'</span><span class="p">,</span> <span class="s1">'fablabulb'</span><span class="p">,</span> <span class="s1">'fablabutec'</span><span class="p">,</span> <span class="s1">'fablabvigyanasharm'</span><span class="p">,</span> <span class="s1">'fablabwgtn'</span><span class="p">,</span> <span class="s1">'fablabyachay'</span><span class="p">,</span> <span class="s1">'fablabyucatan'</span><span class="p">,</span> <span class="s1">'fablabzoi'</span><span class="p">,</span> <span class="s1">'falabdeusto'</span><span class="p">,</span> <span class="s1">'falabvestmannaeyjar'</span><span class="p">,</span> <span class="s1">'farmlabalgarve'</span><span class="p">,</span> <span class="s1">'fct'</span><span class="p">,</span> <span class="s1">'formshop'</span><span class="p">,</span> <span class="s1">'hkispace'</span><span class="p">,</span> <span class="s1">'ied'</span><span class="p">,</span> <span class="s1">'incitefocus'</span><span class="p">,</span> <span class="s1">'ingegno'</span><span class="p">,</span> <span class="s1">'inphb'</span><span class="p">,</span> <span class="s1">'insper'</span><span class="p">,</span> <span class="s1">'ioannina'</span><span class="p">,</span> <span class="s1">'irbid'</span><span class="p">,</span> <span class="s1">'isafjordur'</span><span class="p">,</span> <span class="s1">'jubail'</span><span class="p">,</span> <span class="s1">'kamakura'</span><span class="p">,</span> <span class="s1">'kamplintfort'</span><span class="p">,</span> <span class="s1">'kannai'</span><span class="p">,</span> <span class="s1">'kaust'</span><span class="p">,</span> <span class="s1">'keolab'</span><span class="p">,</span> <span class="s1">'khairpur'</span><span class="p">,</span> <span class="s1">'kitakagaya'</span><span class="p">,</span> <span class="s1">'kochi'</span><span class="p">,</span> <span class="s1">'lakazlab'</span><span class="p">,</span> <span class="s1">'lamachinerie'</span><span class="p">,</span> <span class="s1">'lccc'</span><span class="p">,</span> <span class="s1">'leon'</span><span class="p">,</span> <span class="s1">'libya'</span><span class="p">,</span> <span class="s1">'lima'</span><span class="p">,</span> <span class="s1">'napoli'</span><span class="p">,</span> <span class="s1">'newcairo'</span><span class="p">,</span> <span class="s1">'ningbo'</span><span class="p">,</span> <span class="s1">'opendot'</span><span class="p">,</span> <span class="s1">'oshanghai'</span><span class="p">,</span> <span class="s1">'oulu'</span><span class="p">,</span> <span class="s1">'plusx'</span><span class="p">,</span> <span class="s1">'polytech'</span><span class="p">,</span> <span class="s1">'puebla'</span><span class="p">,</span> <span class="s1">'qbic'</span><span class="p">,</span> <span class="s1">'reykjavik'</span><span class="p">,</span> <span class="s1">'riidl'</span><span class="p">,</span> <span class="s1">'rwanda'</span><span class="p">,</span> <span class="s1">'santachiara'</span><span class="p">,</span> <span class="s1">'sedi'</span><span class="p">,</span> <span class="s1">'seoul'</span><span class="p">,</span> <span class="s1">'seoulinnovation'</span><span class="p">,</span> <span class="s1">'singapore'</span><span class="p">,</span> <span class="s1">'sorbonne'</span><span class="p">,</span> <span class="s1">'stjude'</span><span class="p">,</span> <span class="s1">'szoil'</span><span class="p">,</span> <span class="s1">'taipei'</span><span class="p">,</span> <span class="s1">'talents'</span><span class="p">,</span> <span class="s1">'techworks'</span><span class="p">,</span> <span class="s1">'tecsup'</span><span class="p">,</span> <span class="s1">'tecsupaqp'</span><span class="p">,</span> <span class="s1">'tianhelab'</span><span class="p">,</span> <span class="s1">'tinkerers'</span><span class="p">,</span> <span class="s1">'trivandrum'</span><span class="p">,</span> <span class="s1">'twarda'</span><span class="p">,</span> <span class="s1">'uae'</span><span class="p">,</span> <span class="s1">'ucal'</span><span class="p">,</span> <span class="s1">'ucontinental'</span><span class="p">,</span> <span class="s1">'uemadrid'</span><span class="p">,</span> <span class="s1">'ulb'</span><span class="p">,</span> <span class="s1">'ulima'</span><span class="p">,</span> <span class="s1">'utec'</span><span class="p">,</span> <span class="s1">'vancouver'</span><span class="p">,</span> <span class="s1">'vestmannaeyjar'</span><span class="p">,</span> <span class="s1">'vigyanashram'</span><span class="p">,</span> <span class="s1">'waag'</span><span class="p">,</span> <span class="s1">'wheaton'</span><span class="p">,</span> <span class="s1">'winam'</span><span class="p">,</span> <span class="s1">'yucatan'</span><span class="p">,</span> <span class="s1">'zoi'</span><span class="p">]</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="n">MIN_STUDENTS</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="n">labs_by_continent</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>    <span class="s2">"vigyanashram"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>    <span class="s2">"oulu"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Finland</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>    <span class="s2">"kamplintfort"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Germany</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    <span class="s2">"charlotte"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>    <span class="s2">"lccc"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>    <span class="s2">"bahrain"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Bahrain</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>    <span class="s2">"uae"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># United Arab Emirates</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>    <span class="s2">"libya"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Libya</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>    <span class="s2">"techworks"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>    <span class="s2">"newcairo"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Egypt</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>    <span class="s2">"egypt"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Egypt</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>    <span class="s2">"lakazlab"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Mauritius (Assumed)</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>    <span class="s2">"tecsup"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>    <span class="s2">"wheaton"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>    <span class="s2">"fablabuae"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># United Arab Emirates</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>    <span class="s2">"qbic"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Qatar (Assumed)</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a>    <span class="s2">"kochi"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>    <span class="s2">"ied"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Italy (Assumed)</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a>    <span class="s2">"fablabtrivandrum"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a>    <span class="s2">"fablabakgec"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>    <span class="s2">"barcelona"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Spain</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a>    <span class="s2">"fablabsorbonne"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># France</span>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a>    <span class="s2">"fablabcept"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a>    <span class="s2">"rwanda"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Rwanda</span>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a>    <span class="s2">"leon"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Spain (Assumed)</span>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a>    <span class="s2">"lamachinerie"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># France (Assumed)</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a>    <span class="s2">"fablabdigiscope"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># France (Assumed)</span>
</span><span id="__span-27-38"><a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a>    <span class="s2">"energylab"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Denmark (Assumed)</span>
</span><span id="__span-27-39"><a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a>    <span class="s2">"akgec"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-40"><a id="__codelineno-27-40" name="__codelineno-27-40" href="#__codelineno-27-40"></a>    <span class="s2">"irbid"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Jordan</span>
</span><span id="__span-27-41"><a id="__codelineno-27-41" name="__codelineno-27-41" href="#__codelineno-27-41"></a>    <span class="s2">"reykjavik"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Iceland</span>
</span><span id="__span-27-42"><a id="__codelineno-27-42" name="__codelineno-27-42" href="#__codelineno-27-42"></a>    <span class="s2">"sorbonne"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># France</span>
</span><span id="__span-27-43"><a id="__codelineno-27-43" name="__codelineno-27-43" href="#__codelineno-27-43"></a>    <span class="s2">"incitefocus"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-44"><a id="__codelineno-27-44" name="__codelineno-27-44" href="#__codelineno-27-44"></a>    <span class="s2">"puebla"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Mexico</span>
</span><span id="__span-27-45"><a id="__codelineno-27-45" name="__codelineno-27-45" href="#__codelineno-27-45"></a>    <span class="s2">"tecsupaqp"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-46"><a id="__codelineno-27-46" name="__codelineno-27-46" href="#__codelineno-27-46"></a>    <span class="s2">"ucontinental"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-47"><a id="__codelineno-27-47" name="__codelineno-27-47" href="#__codelineno-27-47"></a>    <span class="s2">"fablabopendot"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Italy</span>
</span><span id="__span-27-48"><a id="__codelineno-27-48" name="__codelineno-27-48" href="#__codelineno-27-48"></a>    <span class="s2">"santachiara"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Italy</span>
</span><span id="__span-27-49"><a id="__codelineno-27-49" name="__codelineno-27-49" href="#__codelineno-27-49"></a>    <span class="s2">"fablabechofab"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Canada</span>
</span><span id="__span-27-50"><a id="__codelineno-27-50" name="__codelineno-27-50" href="#__codelineno-27-50"></a>    <span class="s2">"zoi"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China (Assumed)</span>
</span><span id="__span-27-51"><a id="__codelineno-27-51" name="__codelineno-27-51" href="#__codelineno-27-51"></a>    <span class="s2">"cidi"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-52"><a id="__codelineno-27-52" name="__codelineno-27-52" href="#__codelineno-27-52"></a>    <span class="s2">"dassault"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># France (Assumed)</span>
</span><span id="__span-27-53"><a id="__codelineno-27-53" name="__codelineno-27-53" href="#__codelineno-27-53"></a>    <span class="s2">"stjude"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-54"><a id="__codelineno-27-54" name="__codelineno-27-54" href="#__codelineno-27-54"></a>    <span class="s2">"aalto"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Finland</span>
</span><span id="__span-27-55"><a id="__codelineno-27-55" name="__codelineno-27-55" href="#__codelineno-27-55"></a>    <span class="s2">"fablabzoi"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China (Assumed)</span>
</span><span id="__span-27-56"><a id="__codelineno-27-56" name="__codelineno-27-56" href="#__codelineno-27-56"></a>    <span class="s2">"ecae"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># United Arab Emirates</span>
</span><span id="__span-27-57"><a id="__codelineno-27-57" name="__codelineno-27-57" href="#__codelineno-27-57"></a>    <span class="s2">"fablabbahrain"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Bahrain</span>
</span><span id="__span-27-58"><a id="__codelineno-27-58" name="__codelineno-27-58" href="#__codelineno-27-58"></a>    <span class="s2">"khairpur"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Pakistan</span>
</span><span id="__span-27-59"><a id="__codelineno-27-59" name="__codelineno-27-59" href="#__codelineno-27-59"></a>    <span class="s2">"insper"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Brazil</span>
</span><span id="__span-27-60"><a id="__codelineno-27-60" name="__codelineno-27-60" href="#__codelineno-27-60"></a>    <span class="s2">"trivandrum"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-61"><a id="__codelineno-27-61" name="__codelineno-27-61" href="#__codelineno-27-61"></a>    <span class="s2">"inphb"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Ivory Coast</span>
</span><span id="__span-27-62"><a id="__codelineno-27-62" name="__codelineno-27-62" href="#__codelineno-27-62"></a>    <span class="s2">"digiscope"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># France (Assumed)</span>
</span><span id="__span-27-63"><a id="__codelineno-27-63" name="__codelineno-27-63" href="#__codelineno-27-63"></a>    <span class="s2">"ulb"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Belgium (Assumed)</span>
</span><span id="__span-27-64"><a id="__codelineno-27-64" name="__codelineno-27-64" href="#__codelineno-27-64"></a>    <span class="s2">"lima"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-65"><a id="__codelineno-27-65" name="__codelineno-27-65" href="#__codelineno-27-65"></a>    <span class="s2">"fablabspinderihallerne"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Denmark</span>
</span><span id="__span-27-66"><a id="__codelineno-27-66" name="__codelineno-27-66" href="#__codelineno-27-66"></a>    <span class="s2">"fablabfct"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Portugal (Assumed)</span>
</span><span id="__span-27-67"><a id="__codelineno-27-67" name="__codelineno-27-67" href="#__codelineno-27-67"></a>    <span class="s2">"fct"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Nigeria (Assumed)</span>
</span><span id="__span-27-68"><a id="__codelineno-27-68" name="__codelineno-27-68" href="#__codelineno-27-68"></a>    <span class="s2">"opendot"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Italy</span>
</span><span id="__span-27-69"><a id="__codelineno-27-69" name="__codelineno-27-69" href="#__codelineno-27-69"></a>    <span class="s2">"fablabtecsup"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-70"><a id="__codelineno-27-70" name="__codelineno-27-70" href="#__codelineno-27-70"></a>    <span class="s2">"vancouver"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Canada</span>
</span><span id="__span-27-71"><a id="__codelineno-27-71" name="__codelineno-27-71" href="#__codelineno-27-71"></a>    <span class="s2">"fablabbrighton"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># UK</span>
</span><span id="__span-27-72"><a id="__codelineno-27-72" name="__codelineno-27-72" href="#__codelineno-27-72"></a>    <span class="s2">"akureyri"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Iceland</span>
</span><span id="__span-27-73"><a id="__codelineno-27-73" name="__codelineno-27-73" href="#__codelineno-27-73"></a>    <span class="s2">"yucatan"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Mexico</span>
</span><span id="__span-27-74"><a id="__codelineno-27-74" name="__codelineno-27-74" href="#__codelineno-27-74"></a>    <span class="s2">"bhutan"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Bhutan</span>
</span><span id="__span-27-75"><a id="__codelineno-27-75" name="__codelineno-27-75" href="#__codelineno-27-75"></a>    <span class="s2">"fablabaachen"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Germany</span>
</span><span id="__span-27-76"><a id="__codelineno-27-76" name="__codelineno-27-76" href="#__codelineno-27-76"></a>    <span class="s2">"waag"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Netherlands</span>
</span><span id="__span-27-77"><a id="__codelineno-27-77" name="__codelineno-27-77" href="#__codelineno-27-77"></a>    <span class="s2">"echofab"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Canada</span>
</span><span id="__span-27-78"><a id="__codelineno-27-78" name="__codelineno-27-78" href="#__codelineno-27-78"></a>    <span class="s2">"dilijan"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Armenia</span>
</span><span id="__span-27-79"><a id="__codelineno-27-79" name="__codelineno-27-79" href="#__codelineno-27-79"></a>    <span class="s2">"polytech"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># France (Assumed)</span>
</span><span id="__span-27-80"><a id="__codelineno-27-80" name="__codelineno-27-80" href="#__codelineno-27-80"></a>    <span class="s2">"agrilab"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Armenia</span>
</span><span id="__span-27-81"><a id="__codelineno-27-81" name="__codelineno-27-81" href="#__codelineno-27-81"></a>    <span class="s2">"fablabsiena"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Italy -- ChatGPT changed "fablabsiena" to "siena" -- corrected by hand</span>
</span><span id="__span-27-82"><a id="__codelineno-27-82" name="__codelineno-27-82" href="#__codelineno-27-82"></a>    <span class="s2">"winam"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Kenya (Assumed)</span>
</span><span id="__span-27-83"><a id="__codelineno-27-83" name="__codelineno-27-83" href="#__codelineno-27-83"></a>    <span class="s2">"fablaboulu"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Finland</span>
</span><span id="__span-27-84"><a id="__codelineno-27-84" name="__codelineno-27-84" href="#__codelineno-27-84"></a>    <span class="s2">"fablabreykjavik"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Iceland</span>
</span><span id="__span-27-85"><a id="__codelineno-27-85" name="__codelineno-27-85" href="#__codelineno-27-85"></a>    <span class="s2">"kamakura"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Japan</span>
</span><span id="__span-27-86"><a id="__codelineno-27-86" name="__codelineno-27-86" href="#__codelineno-27-86"></a>    <span class="s2">"falabvestmannaeyjar"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Iceland</span>
</span><span id="__span-27-87"><a id="__codelineno-27-87" name="__codelineno-27-87" href="#__codelineno-27-87"></a>    <span class="s2">"singapore"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Singapore</span>
</span><span id="__span-27-88"><a id="__codelineno-27-88" name="__codelineno-27-88" href="#__codelineno-27-88"></a>    <span class="s2">"oshanghai"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China</span>
</span><span id="__span-27-89"><a id="__codelineno-27-89" name="__codelineno-27-89" href="#__codelineno-27-89"></a>    <span class="s2">"fablaboshanghai"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China</span>
</span><span id="__span-27-90"><a id="__codelineno-27-90" name="__codelineno-27-90" href="#__codelineno-27-90"></a>    <span class="s2">"fablabutec"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-91"><a id="__codelineno-27-91" name="__codelineno-27-91" href="#__codelineno-27-91"></a>    <span class="s2">"fablabodessa"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Ukraine</span>
</span><span id="__span-27-92"><a id="__codelineno-27-92" name="__codelineno-27-92" href="#__codelineno-27-92"></a>    <span class="s2">"esan"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-93"><a id="__codelineno-27-93" name="__codelineno-27-93" href="#__codelineno-27-93"></a>    <span class="s2">"fablabvigyanasharm"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-94"><a id="__codelineno-27-94" name="__codelineno-27-94" href="#__codelineno-27-94"></a>    <span class="s2">"hkispace"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Hong Kong</span>
</span><span id="__span-27-95"><a id="__codelineno-27-95" name="__codelineno-27-95" href="#__codelineno-27-95"></a>    <span class="s2">"taipei"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Taiwan</span>
</span><span id="__span-27-96"><a id="__codelineno-27-96" name="__codelineno-27-96" href="#__codelineno-27-96"></a>    <span class="s2">"fablabmexico"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Mexico</span>
</span><span id="__span-27-97"><a id="__codelineno-27-97" name="__codelineno-27-97" href="#__codelineno-27-97"></a>    <span class="s2">"ciudadmexico"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Mexico</span>
</span><span id="__span-27-98"><a id="__codelineno-27-98" name="__codelineno-27-98" href="#__codelineno-27-98"></a>    <span class="s2">"aachen"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Germany</span>
</span><span id="__span-27-99"><a id="__codelineno-27-99" name="__codelineno-27-99" href="#__codelineno-27-99"></a>    <span class="s2">"fablabbottrop"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Germany</span>
</span><span id="__span-27-100"><a id="__codelineno-27-100" name="__codelineno-27-100" href="#__codelineno-27-100"></a>    <span class="s2">"fablabaalto"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Finland</span>
</span><span id="__span-27-101"><a id="__codelineno-27-101" name="__codelineno-27-101" href="#__codelineno-27-101"></a>    <span class="s2">"keolab"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Japan (Assumed)</span>
</span><span id="__span-27-102"><a id="__codelineno-27-102" name="__codelineno-27-102" href="#__codelineno-27-102"></a>    <span class="s2">"cpcc"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-103"><a id="__codelineno-27-103" name="__codelineno-27-103" href="#__codelineno-27-103"></a>    <span class="s2">"fablabkamplintfort"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Germany</span>
</span><span id="__span-27-104"><a id="__codelineno-27-104" name="__codelineno-27-104" href="#__codelineno-27-104"></a>    <span class="s2">"ingegno"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Italy (Assumed)</span>
</span><span id="__span-27-105"><a id="__codelineno-27-105" name="__codelineno-27-105" href="#__codelineno-27-105"></a>    <span class="s2">"fablabkamakura"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Japan</span>
</span><span id="__span-27-106"><a id="__codelineno-27-106" name="__codelineno-27-106" href="#__codelineno-27-106"></a>    <span class="s2">"tinkerers"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># United Arab Emirates (Assumed)</span>
</span><span id="__span-27-107"><a id="__codelineno-27-107" name="__codelineno-27-107" href="#__codelineno-27-107"></a>    <span class="s2">"cit"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Ireland (Assumed)</span>
</span><span id="__span-27-108"><a id="__codelineno-27-108" name="__codelineno-27-108" href="#__codelineno-27-108"></a>    <span class="s2">"utec"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-109"><a id="__codelineno-27-109" name="__codelineno-27-109" href="#__codelineno-27-109"></a>    <span class="s2">"fablabamsterdam"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Netherlands</span>
</span><span id="__span-27-110"><a id="__codelineno-27-110" name="__codelineno-27-110" href="#__codelineno-27-110"></a>    <span class="s2">"tianhelab"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China (Assumed)</span>
</span><span id="__span-27-111"><a id="__codelineno-27-111" name="__codelineno-27-111" href="#__codelineno-27-111"></a>    <span class="s2">"bhubaneswar"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-112"><a id="__codelineno-27-112" name="__codelineno-27-112" href="#__codelineno-27-112"></a>    <span class="s2">"cept"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-113"><a id="__codelineno-27-113" name="__codelineno-27-113" href="#__codelineno-27-113"></a>    <span class="s2">"fablabbeijing"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China</span>
</span><span id="__span-27-114"><a id="__codelineno-27-114" name="__codelineno-27-114" href="#__codelineno-27-114"></a>    <span class="s2">"talents"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Germany (Assumed)</span>
</span><span id="__span-27-115"><a id="__codelineno-27-115" name="__codelineno-27-115" href="#__codelineno-27-115"></a>    <span class="s2">"fablabyachay"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Ecuador</span>
</span><span id="__span-27-116"><a id="__codelineno-27-116" name="__codelineno-27-116" href="#__codelineno-27-116"></a>    <span class="s2">"fablabdassault"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># France (Assumed)</span>
</span><span id="__span-27-117"><a id="__codelineno-27-117" name="__codelineno-27-117" href="#__codelineno-27-117"></a>    <span class="s2">"ecostudio"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-118"><a id="__codelineno-27-118" name="__codelineno-27-118" href="#__codelineno-27-118"></a>    <span class="s2">"fablabseoul"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># South Korea</span>
</span><span id="__span-27-119"><a id="__codelineno-27-119" name="__codelineno-27-119" href="#__codelineno-27-119"></a>    <span class="s2">"kaust"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Saudi Arabia</span>
</span><span id="__span-27-120"><a id="__codelineno-27-120" name="__codelineno-27-120" href="#__codelineno-27-120"></a>    <span class="s2">"berytech"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Lebanon</span>
</span><span id="__span-27-121"><a id="__codelineno-27-121" name="__codelineno-27-121" href="#__codelineno-27-121"></a>    <span class="s2">"fablabpuebla"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Mexico</span>
</span><span id="__span-27-122"><a id="__codelineno-27-122" name="__codelineno-27-122" href="#__codelineno-27-122"></a>    <span class="s2">"fablabrwanda"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Rwanda</span>
</span><span id="__span-27-123"><a id="__codelineno-27-123" name="__codelineno-27-123" href="#__codelineno-27-123"></a>    <span class="s2">"fablabesan"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-124"><a id="__codelineno-27-124" name="__codelineno-27-124" href="#__codelineno-27-124"></a>    <span class="s2">"fablabberytech"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Lebanon</span>
</span><span id="__span-27-125"><a id="__codelineno-27-125" name="__codelineno-27-125" href="#__codelineno-27-125"></a>    <span class="s2">"crunchlab"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Portugal (Assumed)</span>
</span><span id="__span-27-126"><a id="__codelineno-27-126" name="__codelineno-27-126" href="#__codelineno-27-126"></a>    <span class="s2">"ucal"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-127"><a id="__codelineno-27-127" name="__codelineno-27-127" href="#__codelineno-27-127"></a>    <span class="s2">"vestmannaeyjar"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Iceland</span>
</span><span id="__span-27-128"><a id="__codelineno-27-128" name="__codelineno-27-128" href="#__codelineno-27-128"></a>    <span class="s2">"sedi"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Italy (Assumed)</span>
</span><span id="__span-27-129"><a id="__codelineno-27-129" name="__codelineno-27-129" href="#__codelineno-27-129"></a>    <span class="s2">"isafjordur"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Iceland</span>
</span><span id="__span-27-130"><a id="__codelineno-27-130" name="__codelineno-27-130" href="#__codelineno-27-130"></a>    <span class="s2">"fablabegypt"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Egypt</span>
</span><span id="__span-27-131"><a id="__codelineno-27-131" name="__codelineno-27-131" href="#__codelineno-27-131"></a>    <span class="s2">"szoil"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China</span>
</span><span id="__span-27-132"><a id="__codelineno-27-132" name="__codelineno-27-132" href="#__codelineno-27-132"></a>    <span class="s2">"formshop"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China (Assumed)</span>
</span><span id="__span-27-133"><a id="__codelineno-27-133" name="__codelineno-27-133" href="#__codelineno-27-133"></a>    <span class="s2">"fablabkochi"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-134"><a id="__codelineno-27-134" name="__codelineno-27-134" href="#__codelineno-27-134"></a>    <span class="s2">"fablabincitefocus"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-135"><a id="__codelineno-27-135" name="__codelineno-27-135" href="#__codelineno-27-135"></a>    <span class="s2">"kitakagaya"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Japan</span>
</span><span id="__span-27-136"><a id="__codelineno-27-136" name="__codelineno-27-136" href="#__codelineno-27-136"></a>    <span class="s2">"kannai"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Japan</span>
</span><span id="__span-27-137"><a id="__codelineno-27-137" name="__codelineno-27-137" href="#__codelineno-27-137"></a>    <span class="s2">"dhahran"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Saudi Arabia</span>
</span><span id="__span-27-138"><a id="__codelineno-27-138" name="__codelineno-27-138" href="#__codelineno-27-138"></a>    <span class="s2">"seoulinnovation"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># South Korea</span>
</span><span id="__span-27-139"><a id="__codelineno-27-139" name="__codelineno-27-139" href="#__codelineno-27-139"></a>    <span class="s2">"ioannina"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Greece</span>
</span><span id="__span-27-140"><a id="__codelineno-27-140" name="__codelineno-27-140" href="#__codelineno-27-140"></a>    <span class="s2">"fablabyucatan"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># Mexico</span>
</span><span id="__span-27-141"><a id="__codelineno-27-141" name="__codelineno-27-141" href="#__codelineno-27-141"></a>    <span class="s2">"fablabirbid"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Jordan</span>
</span><span id="__span-27-142"><a id="__codelineno-27-142" name="__codelineno-27-142" href="#__codelineno-27-142"></a>    <span class="s2">"deusto"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Spain</span>
</span><span id="__span-27-143"><a id="__codelineno-27-143" name="__codelineno-27-143" href="#__codelineno-27-143"></a>    <span class="s2">"falabdeusto"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Spain</span>
</span><span id="__span-27-144"><a id="__codelineno-27-144" name="__codelineno-27-144" href="#__codelineno-27-144"></a>    <span class="s2">"riidl"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-145"><a id="__codelineno-27-145" name="__codelineno-27-145" href="#__codelineno-27-145"></a>    <span class="s2">"bottrop"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Germany</span>
</span><span id="__span-27-146"><a id="__codelineno-27-146" name="__codelineno-27-146" href="#__codelineno-27-146"></a>    <span class="s2">"fablabisafjorour"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Iceland</span>
</span><span id="__span-27-147"><a id="__codelineno-27-147" name="__codelineno-27-147" href="#__codelineno-27-147"></a>    <span class="s2">"plusx"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># South Korea (Assumed)</span>
</span><span id="__span-27-148"><a id="__codelineno-27-148" name="__codelineno-27-148" href="#__codelineno-27-148"></a>    <span class="s2">"fablaberfindergarden"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Germany (Assumed)</span>
</span><span id="__span-27-149"><a id="__codelineno-27-149" name="__codelineno-27-149" href="#__codelineno-27-149"></a>    <span class="s2">"uemadrid"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Spain</span>
</span><span id="__span-27-150"><a id="__codelineno-27-150" name="__codelineno-27-150" href="#__codelineno-27-150"></a>    <span class="s2">"fablabtembisa"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># South Africa</span>
</span><span id="__span-27-151"><a id="__codelineno-27-151" name="__codelineno-27-151" href="#__codelineno-27-151"></a>    <span class="s2">"brighton"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># UK</span>
</span><span id="__span-27-152"><a id="__codelineno-27-152" name="__codelineno-27-152" href="#__codelineno-27-152"></a>    <span class="s2">"fablabfacens"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Brazil</span>
</span><span id="__span-27-153"><a id="__codelineno-27-153" name="__codelineno-27-153" href="#__codelineno-27-153"></a>    <span class="s2">"fablableon"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Spain (Assumed)</span>
</span><span id="__span-27-154"><a id="__codelineno-27-154" name="__codelineno-27-154" href="#__codelineno-27-154"></a>    <span class="s2">"fablabszoil"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China</span>
</span><span id="__span-27-155"><a id="__codelineno-27-155" name="__codelineno-27-155" href="#__codelineno-27-155"></a>    <span class="s2">"fablabgearbox"</span><span class="p">:</span><span class="s2">"Africa"</span><span class="p">,</span> <span class="c1"># Kenya (Assumed)</span>
</span><span id="__span-27-156"><a id="__codelineno-27-156" name="__codelineno-27-156" href="#__codelineno-27-156"></a>    <span class="s2">"farmlabalgarve"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Portugal</span>
</span><span id="__span-27-157"><a id="__codelineno-27-157" name="__codelineno-27-157" href="#__codelineno-27-157"></a>    <span class="s2">"algarve"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Portugal</span>
</span><span id="__span-27-158"><a id="__codelineno-27-158" name="__codelineno-27-158" href="#__codelineno-27-158"></a>    <span class="s2">"twarda"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Poland (Assumed)</span>
</span><span id="__span-27-159"><a id="__codelineno-27-159" name="__codelineno-27-159" href="#__codelineno-27-159"></a>    <span class="s2">"bangalore"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-160"><a id="__codelineno-27-160" name="__codelineno-27-160" href="#__codelineno-27-160"></a>    <span class="s2">"fablabsantiago"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Chile</span>
</span><span id="__span-27-161"><a id="__codelineno-27-161" name="__codelineno-27-161" href="#__codelineno-27-161"></a>    <span class="s2">"fablablccc"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-162"><a id="__codelineno-27-162" name="__codelineno-27-162" href="#__codelineno-27-162"></a>    <span class="s2">"fablabcharlottelatin"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA</span>
</span><span id="__span-27-163"><a id="__codelineno-27-163" name="__codelineno-27-163" href="#__codelineno-27-163"></a>    <span class="s2">"fablabat3flo"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Hungary (Assumed)</span>
</span><span id="__span-27-164"><a id="__codelineno-27-164" name="__codelineno-27-164" href="#__codelineno-27-164"></a>    <span class="s2">"fablabecostudio"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-165"><a id="__codelineno-27-165" name="__codelineno-27-165" href="#__codelineno-27-165"></a>    <span class="s2">"fablabsocom"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China (Assumed)</span>
</span><span id="__span-27-166"><a id="__codelineno-27-166" name="__codelineno-27-166" href="#__codelineno-27-166"></a>    <span class="s2">"boldseoul"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># South Korea</span>
</span><span id="__span-27-167"><a id="__codelineno-27-167" name="__codelineno-27-167" href="#__codelineno-27-167"></a>    <span class="s2">"napoli"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Italy</span>
</span><span id="__span-27-168"><a id="__codelineno-27-168" name="__codelineno-27-168" href="#__codelineno-27-168"></a>    <span class="s2">"fablabkromlaboro"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Slovenia (Assumed)</span>
</span><span id="__span-27-169"><a id="__codelineno-27-169" name="__codelineno-27-169" href="#__codelineno-27-169"></a>    <span class="s2">"seoul"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># South Korea</span>
</span><span id="__span-27-170"><a id="__codelineno-27-170" name="__codelineno-27-170" href="#__codelineno-27-170"></a>    <span class="s2">"fablabtechworks"</span><span class="p">:</span><span class="s2">"North America"</span><span class="p">,</span> <span class="c1"># USA (Assumed)</span>
</span><span id="__span-27-171"><a id="__codelineno-27-171" name="__codelineno-27-171" href="#__codelineno-27-171"></a>    <span class="s2">"fablabkhairpur"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Pakistan</span>
</span><span id="__span-27-172"><a id="__codelineno-27-172" name="__codelineno-27-172" href="#__codelineno-27-172"></a>    <span class="s2">"chaihuo"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China (Assumed)</span>
</span><span id="__span-27-173"><a id="__codelineno-27-173" name="__codelineno-27-173" href="#__codelineno-27-173"></a>    <span class="s2">"fablabulb"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Belgium (Assumed)</span>
</span><span id="__span-27-174"><a id="__codelineno-27-174" name="__codelineno-27-174" href="#__codelineno-27-174"></a>    <span class="s2">"esne"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Spain (Assumed)</span>
</span><span id="__span-27-175"><a id="__codelineno-27-175" name="__codelineno-27-175" href="#__codelineno-27-175"></a>    <span class="s2">"ulima"</span><span class="p">:</span><span class="s2">"South America"</span><span class="p">,</span> <span class="c1"># Peru</span>
</span><span id="__span-27-176"><a id="__codelineno-27-176" name="__codelineno-27-176" href="#__codelineno-27-176"></a>    <span class="s2">"fablabseoulinnovation"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># South Korea</span>
</span><span id="__span-27-177"><a id="__codelineno-27-177" name="__codelineno-27-177" href="#__codelineno-27-177"></a>    <span class="s2">"benfica"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Portugal (Assumed)</span>
</span><span id="__span-27-178"><a id="__codelineno-27-178" name="__codelineno-27-178" href="#__codelineno-27-178"></a>    <span class="s2">"fablabmadridceu"</span><span class="p">:</span><span class="s2">"Europe"</span><span class="p">,</span> <span class="c1"># Spain</span>
</span><span id="__span-27-179"><a id="__codelineno-27-179" name="__codelineno-27-179" href="#__codelineno-27-179"></a>    <span class="s2">"chandigarh"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># India</span>
</span><span id="__span-27-180"><a id="__codelineno-27-180" name="__codelineno-27-180" href="#__codelineno-27-180"></a>    <span class="s2">"jubail"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># Saudi Arabia</span>
</span><span id="__span-27-181"><a id="__codelineno-27-181" name="__codelineno-27-181" href="#__codelineno-27-181"></a>    <span class="s2">"ningbo"</span><span class="p">:</span><span class="s2">"Asia"</span><span class="p">,</span> <span class="c1"># China</span>
</span><span id="__span-27-182"><a id="__codelineno-27-182" name="__codelineno-27-182" href="#__codelineno-27-182"></a>    <span class="s2">"fablabwgtn"</span><span class="p">:</span><span class="s2">"Oceania"</span> <span class="c1"># New Zealand</span>
</span><span id="__span-27-183"><a id="__codelineno-27-183" name="__codelineno-27-183" href="#__codelineno-27-183"></a><span class="p">}</span>
</span><span id="__span-27-184"><a id="__codelineno-27-184" name="__codelineno-27-184" href="#__codelineno-27-184"></a>
</span><span id="__span-27-185"><a id="__codelineno-27-185" name="__codelineno-27-185" href="#__codelineno-27-185"></a><span class="n">grouped_lab_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-27-186"><a id="__codelineno-27-186" name="__codelineno-27-186" href="#__codelineno-27-186"></a>    <span class="p">[</span><span class="s1">'aachen'</span><span class="p">,</span> <span class="s1">'fablabaachen'</span><span class="p">],</span>
</span><span id="__span-27-187"><a id="__codelineno-27-187" name="__codelineno-27-187" href="#__codelineno-27-187"></a>    <span class="p">[</span><span class="s1">'aalto'</span><span class="p">,</span> <span class="s1">'fablabaalto'</span><span class="p">],</span>
</span><span id="__span-27-188"><a id="__codelineno-27-188" name="__codelineno-27-188" href="#__codelineno-27-188"></a>    <span class="p">[</span><span class="s1">'agrilab'</span><span class="p">],</span>
</span><span id="__span-27-189"><a id="__codelineno-27-189" name="__codelineno-27-189" href="#__codelineno-27-189"></a>    <span class="p">[</span><span class="s1">'akgec'</span><span class="p">,</span> <span class="s1">'fablabakgec'</span><span class="p">],</span>
</span><span id="__span-27-190"><a id="__codelineno-27-190" name="__codelineno-27-190" href="#__codelineno-27-190"></a>    <span class="p">[</span><span class="s1">'akureyri'</span><span class="p">],</span>
</span><span id="__span-27-191"><a id="__codelineno-27-191" name="__codelineno-27-191" href="#__codelineno-27-191"></a>    <span class="p">[</span><span class="s1">'algarve'</span><span class="p">,</span> <span class="s1">'farmlabalgarve'</span><span class="p">],</span>
</span><span id="__span-27-192"><a id="__codelineno-27-192" name="__codelineno-27-192" href="#__codelineno-27-192"></a>    <span class="p">[</span><span class="s1">'bahrain'</span><span class="p">,</span> <span class="s1">'fablabbahrain'</span><span class="p">],</span>
</span><span id="__span-27-193"><a id="__codelineno-27-193" name="__codelineno-27-193" href="#__codelineno-27-193"></a>    <span class="p">[</span><span class="s1">'bangalore'</span><span class="p">],</span>
</span><span id="__span-27-194"><a id="__codelineno-27-194" name="__codelineno-27-194" href="#__codelineno-27-194"></a>    <span class="p">[</span><span class="s1">'barcelona'</span><span class="p">],</span>
</span><span id="__span-27-195"><a id="__codelineno-27-195" name="__codelineno-27-195" href="#__codelineno-27-195"></a>    <span class="p">[</span><span class="s1">'benfica'</span><span class="p">],</span>
</span><span id="__span-27-196"><a id="__codelineno-27-196" name="__codelineno-27-196" href="#__codelineno-27-196"></a>    <span class="p">[</span><span class="s1">'berytech'</span><span class="p">,</span> <span class="s1">'fablabberytech'</span><span class="p">],</span>
</span><span id="__span-27-197"><a id="__codelineno-27-197" name="__codelineno-27-197" href="#__codelineno-27-197"></a>    <span class="p">[</span><span class="s1">'bhubaneswar'</span><span class="p">],</span>
</span><span id="__span-27-198"><a id="__codelineno-27-198" name="__codelineno-27-198" href="#__codelineno-27-198"></a>    <span class="p">[</span><span class="s1">'bhutan'</span><span class="p">],</span>
</span><span id="__span-27-199"><a id="__codelineno-27-199" name="__codelineno-27-199" href="#__codelineno-27-199"></a>    <span class="p">[</span><span class="s1">'seoul'</span><span class="p">,</span> <span class="s1">'fablabseoul'</span><span class="p">,</span> <span class="s1">'fablabseoulinnovation'</span><span class="p">,</span> <span class="s1">'boldseoul'</span><span class="p">,</span> <span class="s1">'seoulinnovation'</span><span class="p">],</span>
</span><span id="__span-27-200"><a id="__codelineno-27-200" name="__codelineno-27-200" href="#__codelineno-27-200"></a>    <span class="p">[</span><span class="s1">'bottrop'</span><span class="p">,</span> <span class="s1">'fablabbottrop'</span><span class="p">],</span>
</span><span id="__span-27-201"><a id="__codelineno-27-201" name="__codelineno-27-201" href="#__codelineno-27-201"></a>    <span class="p">[</span><span class="s1">'brighton'</span><span class="p">,</span> <span class="s1">'fablabbrighton'</span><span class="p">],</span>
</span><span id="__span-27-202"><a id="__codelineno-27-202" name="__codelineno-27-202" href="#__codelineno-27-202"></a>    <span class="p">[</span><span class="s1">'cept'</span><span class="p">,</span> <span class="s1">'fablabcept'</span><span class="p">],</span>
</span><span id="__span-27-203"><a id="__codelineno-27-203" name="__codelineno-27-203" href="#__codelineno-27-203"></a>    <span class="p">[</span><span class="s1">'chaihuo'</span><span class="p">],</span>
</span><span id="__span-27-204"><a id="__codelineno-27-204" name="__codelineno-27-204" href="#__codelineno-27-204"></a>    <span class="p">[</span><span class="s1">'chandigarh'</span><span class="p">],</span>
</span><span id="__span-27-205"><a id="__codelineno-27-205" name="__codelineno-27-205" href="#__codelineno-27-205"></a>    <span class="p">[</span><span class="s1">'charlotte'</span><span class="p">,</span> <span class="s1">'fablabcharlottelatin'</span><span class="p">],</span>
</span><span id="__span-27-206"><a id="__codelineno-27-206" name="__codelineno-27-206" href="#__codelineno-27-206"></a>    <span class="p">[</span><span class="s1">'cidi'</span><span class="p">],</span>
</span><span id="__span-27-207"><a id="__codelineno-27-207" name="__codelineno-27-207" href="#__codelineno-27-207"></a>    <span class="p">[</span><span class="s1">'cit'</span><span class="p">],</span>
</span><span id="__span-27-208"><a id="__codelineno-27-208" name="__codelineno-27-208" href="#__codelineno-27-208"></a>    <span class="p">[</span><span class="s1">'ciudadmexico'</span><span class="p">],</span>
</span><span id="__span-27-209"><a id="__codelineno-27-209" name="__codelineno-27-209" href="#__codelineno-27-209"></a>    <span class="p">[</span><span class="s1">'cpcc'</span><span class="p">],</span>
</span><span id="__span-27-210"><a id="__codelineno-27-210" name="__codelineno-27-210" href="#__codelineno-27-210"></a>    <span class="p">[</span><span class="s1">'crunchlab'</span><span class="p">],</span>
</span><span id="__span-27-211"><a id="__codelineno-27-211" name="__codelineno-27-211" href="#__codelineno-27-211"></a>    <span class="p">[</span><span class="s1">'dassault'</span><span class="p">,</span> <span class="s1">'fablabdassault'</span><span class="p">],</span>
</span><span id="__span-27-212"><a id="__codelineno-27-212" name="__codelineno-27-212" href="#__codelineno-27-212"></a>    <span class="p">[</span><span class="s1">'deusto'</span><span class="p">,</span> <span class="s1">'falabdeusto'</span><span class="p">],</span>
</span><span id="__span-27-213"><a id="__codelineno-27-213" name="__codelineno-27-213" href="#__codelineno-27-213"></a>    <span class="p">[</span><span class="s1">'dhahran'</span><span class="p">],</span>
</span><span id="__span-27-214"><a id="__codelineno-27-214" name="__codelineno-27-214" href="#__codelineno-27-214"></a>    <span class="p">[</span><span class="s1">'digiscope'</span><span class="p">,</span> <span class="s1">'fablabdigiscope'</span><span class="p">],</span>
</span><span id="__span-27-215"><a id="__codelineno-27-215" name="__codelineno-27-215" href="#__codelineno-27-215"></a>    <span class="p">[</span><span class="s1">'dilijan'</span><span class="p">],</span>
</span><span id="__span-27-216"><a id="__codelineno-27-216" name="__codelineno-27-216" href="#__codelineno-27-216"></a>    <span class="p">[</span><span class="s1">'ecae'</span><span class="p">],</span>
</span><span id="__span-27-217"><a id="__codelineno-27-217" name="__codelineno-27-217" href="#__codelineno-27-217"></a>    <span class="p">[</span><span class="s1">'echofab'</span><span class="p">,</span> <span class="s1">'fablabechofab'</span><span class="p">],</span>
</span><span id="__span-27-218"><a id="__codelineno-27-218" name="__codelineno-27-218" href="#__codelineno-27-218"></a>    <span class="p">[</span><span class="s1">'ecostudio'</span><span class="p">,</span> <span class="s1">'fablabecostudio'</span><span class="p">],</span>
</span><span id="__span-27-219"><a id="__codelineno-27-219" name="__codelineno-27-219" href="#__codelineno-27-219"></a>    <span class="p">[</span><span class="s1">'egypt'</span><span class="p">,</span> <span class="s1">'fablabegypt'</span><span class="p">],</span>
</span><span id="__span-27-220"><a id="__codelineno-27-220" name="__codelineno-27-220" href="#__codelineno-27-220"></a>    <span class="p">[</span><span class="s1">'energylab'</span><span class="p">],</span>
</span><span id="__span-27-221"><a id="__codelineno-27-221" name="__codelineno-27-221" href="#__codelineno-27-221"></a>    <span class="p">[</span><span class="s1">'esan'</span><span class="p">,</span> <span class="s1">'fablabesan'</span><span class="p">],</span>
</span><span id="__span-27-222"><a id="__codelineno-27-222" name="__codelineno-27-222" href="#__codelineno-27-222"></a>    <span class="p">[</span><span class="s1">'esne'</span><span class="p">],</span>
</span><span id="__span-27-223"><a id="__codelineno-27-223" name="__codelineno-27-223" href="#__codelineno-27-223"></a>    <span class="p">[</span><span class="s1">'fablabamsterdam'</span><span class="p">],</span>
</span><span id="__span-27-224"><a id="__codelineno-27-224" name="__codelineno-27-224" href="#__codelineno-27-224"></a>    <span class="p">[</span><span class="s1">'fablabat3flo'</span><span class="p">],</span>
</span><span id="__span-27-225"><a id="__codelineno-27-225" name="__codelineno-27-225" href="#__codelineno-27-225"></a>    <span class="p">[</span><span class="s1">'fablabbeijing'</span><span class="p">],</span>
</span><span id="__span-27-226"><a id="__codelineno-27-226" name="__codelineno-27-226" href="#__codelineno-27-226"></a>    <span class="p">[</span><span class="s1">'fablabfacens'</span><span class="p">],</span>
</span><span id="__span-27-227"><a id="__codelineno-27-227" name="__codelineno-27-227" href="#__codelineno-27-227"></a>    <span class="p">[</span><span class="s1">'fablabfct'</span><span class="p">],</span>
</span><span id="__span-27-228"><a id="__codelineno-27-228" name="__codelineno-27-228" href="#__codelineno-27-228"></a>    <span class="p">[</span><span class="s1">'fablabgearbox'</span><span class="p">],</span>
</span><span id="__span-27-229"><a id="__codelineno-27-229" name="__codelineno-27-229" href="#__codelineno-27-229"></a>    <span class="p">[</span><span class="s1">'fablabincitefocus'</span><span class="p">],</span>
</span><span id="__span-27-230"><a id="__codelineno-27-230" name="__codelineno-27-230" href="#__codelineno-27-230"></a>    <span class="p">[</span><span class="s1">'fablabirbid'</span><span class="p">,</span> <span class="s1">'irbid'</span><span class="p">],</span>
</span><span id="__span-27-231"><a id="__codelineno-27-231" name="__codelineno-27-231" href="#__codelineno-27-231"></a>    <span class="p">[</span><span class="s1">'fablabisafjorour'</span><span class="p">,</span> <span class="s1">'isafjordur'</span><span class="p">],</span>
</span><span id="__span-27-232"><a id="__codelineno-27-232" name="__codelineno-27-232" href="#__codelineno-27-232"></a>    <span class="p">[</span><span class="s1">'fablabkamakura'</span><span class="p">,</span> <span class="s1">'kamakura'</span><span class="p">],</span>
</span><span id="__span-27-233"><a id="__codelineno-27-233" name="__codelineno-27-233" href="#__codelineno-27-233"></a>    <span class="p">[</span><span class="s1">'fablabkamplintfort'</span><span class="p">,</span> <span class="s1">'kamplintfort'</span><span class="p">],</span>
</span><span id="__span-27-234"><a id="__codelineno-27-234" name="__codelineno-27-234" href="#__codelineno-27-234"></a>    <span class="p">[</span><span class="s1">'fablabkhairpur'</span><span class="p">,</span> <span class="s1">'khairpur'</span><span class="p">],</span>
</span><span id="__span-27-235"><a id="__codelineno-27-235" name="__codelineno-27-235" href="#__codelineno-27-235"></a>    <span class="p">[</span><span class="s1">'fablabkochi'</span><span class="p">,</span> <span class="s1">'kochi'</span><span class="p">],</span>
</span><span id="__span-27-236"><a id="__codelineno-27-236" name="__codelineno-27-236" href="#__codelineno-27-236"></a>    <span class="p">[</span><span class="s1">'fablabkromlaboro'</span><span class="p">],</span>
</span><span id="__span-27-237"><a id="__codelineno-27-237" name="__codelineno-27-237" href="#__codelineno-27-237"></a>    <span class="p">[</span><span class="s1">'fablablccc'</span><span class="p">,</span> <span class="s1">'lccc'</span><span class="p">],</span>
</span><span id="__span-27-238"><a id="__codelineno-27-238" name="__codelineno-27-238" href="#__codelineno-27-238"></a>    <span class="p">[</span><span class="s1">'fablableon'</span><span class="p">,</span> <span class="s1">'leon'</span><span class="p">],</span>
</span><span id="__span-27-239"><a id="__codelineno-27-239" name="__codelineno-27-239" href="#__codelineno-27-239"></a>    <span class="p">[</span><span class="s1">'fablabmadridceu'</span><span class="p">],</span>
</span><span id="__span-27-240"><a id="__codelineno-27-240" name="__codelineno-27-240" href="#__codelineno-27-240"></a>    <span class="p">[</span><span class="s1">'fablabmexico'</span><span class="p">,</span> <span class="s1">'ciudadmexico'</span><span class="p">],</span>
</span><span id="__span-27-241"><a id="__codelineno-27-241" name="__codelineno-27-241" href="#__codelineno-27-241"></a>    <span class="p">[</span><span class="s1">'fablaberfindergarden'</span><span class="p">],</span>
</span><span id="__span-27-242"><a id="__codelineno-27-242" name="__codelineno-27-242" href="#__codelineno-27-242"></a>    <span class="p">[</span><span class="s1">'fablabodessa'</span><span class="p">],</span>
</span><span id="__span-27-243"><a id="__codelineno-27-243" name="__codelineno-27-243" href="#__codelineno-27-243"></a>    <span class="p">[</span><span class="s1">'fablabopendot'</span><span class="p">,</span> <span class="s1">'opendot'</span><span class="p">],</span>
</span><span id="__span-27-244"><a id="__codelineno-27-244" name="__codelineno-27-244" href="#__codelineno-27-244"></a>    <span class="p">[</span><span class="s1">'fablaboshanghai'</span><span class="p">,</span> <span class="s1">'oshanghai'</span><span class="p">],</span>
</span><span id="__span-27-245"><a id="__codelineno-27-245" name="__codelineno-27-245" href="#__codelineno-27-245"></a>    <span class="p">[</span><span class="s1">'fablaboulu'</span><span class="p">,</span> <span class="s1">'oulu'</span><span class="p">],</span>
</span><span id="__span-27-246"><a id="__codelineno-27-246" name="__codelineno-27-246" href="#__codelineno-27-246"></a>    <span class="p">[</span><span class="s1">'fablabpuebla'</span><span class="p">,</span> <span class="s1">'puebla'</span><span class="p">],</span>
</span><span id="__span-27-247"><a id="__codelineno-27-247" name="__codelineno-27-247" href="#__codelineno-27-247"></a>    <span class="p">[</span><span class="s1">'fablabreykjavik'</span><span class="p">,</span> <span class="s1">'reykjavik'</span><span class="p">],</span>
</span><span id="__span-27-248"><a id="__codelineno-27-248" name="__codelineno-27-248" href="#__codelineno-27-248"></a>    <span class="p">[</span><span class="s1">'fablabrwanda'</span><span class="p">,</span> <span class="s1">'rwanda'</span><span class="p">],</span>
</span><span id="__span-27-249"><a id="__codelineno-27-249" name="__codelineno-27-249" href="#__codelineno-27-249"></a>    <span class="p">[</span><span class="s1">'fablabsantiago'</span><span class="p">],</span>
</span><span id="__span-27-250"><a id="__codelineno-27-250" name="__codelineno-27-250" href="#__codelineno-27-250"></a>    <span class="p">[</span><span class="s1">'fablabsiena'</span><span class="p">,</span> <span class="s1">'santachiara'</span><span class="p">],</span>
</span><span id="__span-27-251"><a id="__codelineno-27-251" name="__codelineno-27-251" href="#__codelineno-27-251"></a>    <span class="p">[</span><span class="s1">'fablabsocom'</span><span class="p">],</span>
</span><span id="__span-27-252"><a id="__codelineno-27-252" name="__codelineno-27-252" href="#__codelineno-27-252"></a>    <span class="p">[</span><span class="s1">'fablabsorbonne'</span><span class="p">,</span> <span class="s1">'sorbonne'</span><span class="p">],</span>
</span><span id="__span-27-253"><a id="__codelineno-27-253" name="__codelineno-27-253" href="#__codelineno-27-253"></a>    <span class="p">[</span><span class="s1">'fablabspinderihallerne'</span><span class="p">],</span>
</span><span id="__span-27-254"><a id="__codelineno-27-254" name="__codelineno-27-254" href="#__codelineno-27-254"></a>    <span class="p">[</span><span class="s1">'fablabszoil'</span><span class="p">,</span> <span class="s1">'szoil'</span><span class="p">],</span>
</span><span id="__span-27-255"><a id="__codelineno-27-255" name="__codelineno-27-255" href="#__codelineno-27-255"></a>    <span class="p">[</span><span class="s1">'fablabtechworks'</span><span class="p">,</span> <span class="s1">'techworks'</span><span class="p">],</span>
</span><span id="__span-27-256"><a id="__codelineno-27-256" name="__codelineno-27-256" href="#__codelineno-27-256"></a>    <span class="p">[</span><span class="s1">'fablabtecsup'</span><span class="p">,</span> <span class="s1">'tecsup'</span><span class="p">,</span> <span class="s1">'tecsupaqp'</span><span class="p">],</span>
</span><span id="__span-27-257"><a id="__codelineno-27-257" name="__codelineno-27-257" href="#__codelineno-27-257"></a>    <span class="p">[</span><span class="s1">'fablabtembisa'</span><span class="p">],</span>
</span><span id="__span-27-258"><a id="__codelineno-27-258" name="__codelineno-27-258" href="#__codelineno-27-258"></a>    <span class="p">[</span><span class="s1">'fablabtrivandrum'</span><span class="p">,</span> <span class="s1">'trivandrum'</span><span class="p">],</span>
</span><span id="__span-27-259"><a id="__codelineno-27-259" name="__codelineno-27-259" href="#__codelineno-27-259"></a>    <span class="p">[</span><span class="s1">'fablabuae'</span><span class="p">,</span> <span class="s1">'uae'</span><span class="p">],</span>
</span><span id="__span-27-260"><a id="__codelineno-27-260" name="__codelineno-27-260" href="#__codelineno-27-260"></a>    <span class="p">[</span><span class="s1">'fablabulb'</span><span class="p">,</span> <span class="s1">'ulb'</span><span class="p">],</span>
</span><span id="__span-27-261"><a id="__codelineno-27-261" name="__codelineno-27-261" href="#__codelineno-27-261"></a>    <span class="p">[</span><span class="s1">'fablabutec'</span><span class="p">,</span> <span class="s1">'utec'</span><span class="p">],</span>
</span><span id="__span-27-262"><a id="__codelineno-27-262" name="__codelineno-27-262" href="#__codelineno-27-262"></a>    <span class="p">[</span><span class="s1">'fablabvigyanasharm'</span><span class="p">,</span> <span class="s1">'vigyanashram'</span><span class="p">],</span>
</span><span id="__span-27-263"><a id="__codelineno-27-263" name="__codelineno-27-263" href="#__codelineno-27-263"></a>    <span class="p">[</span><span class="s1">'fablabwgtn'</span><span class="p">],</span>
</span><span id="__span-27-264"><a id="__codelineno-27-264" name="__codelineno-27-264" href="#__codelineno-27-264"></a>    <span class="p">[</span><span class="s1">'fablabyachay'</span><span class="p">],</span>
</span><span id="__span-27-265"><a id="__codelineno-27-265" name="__codelineno-27-265" href="#__codelineno-27-265"></a>    <span class="p">[</span><span class="s1">'fablabyucatan'</span><span class="p">,</span> <span class="s1">'yucatan'</span><span class="p">],</span>
</span><span id="__span-27-266"><a id="__codelineno-27-266" name="__codelineno-27-266" href="#__codelineno-27-266"></a>    <span class="p">[</span><span class="s1">'fablabzoi'</span><span class="p">,</span> <span class="s1">'zoi'</span><span class="p">],</span>
</span><span id="__span-27-267"><a id="__codelineno-27-267" name="__codelineno-27-267" href="#__codelineno-27-267"></a>    <span class="p">[</span><span class="s1">'falabvestmannaeyjar'</span><span class="p">,</span> <span class="s1">'vestmannaeyjar'</span><span class="p">],</span>
</span><span id="__span-27-268"><a id="__codelineno-27-268" name="__codelineno-27-268" href="#__codelineno-27-268"></a>    <span class="p">[</span><span class="s1">'fct'</span><span class="p">],</span>
</span><span id="__span-27-269"><a id="__codelineno-27-269" name="__codelineno-27-269" href="#__codelineno-27-269"></a>    <span class="p">[</span><span class="s1">'formshop'</span><span class="p">],</span>
</span><span id="__span-27-270"><a id="__codelineno-27-270" name="__codelineno-27-270" href="#__codelineno-27-270"></a>    <span class="p">[</span><span class="s1">'hkispace'</span><span class="p">],</span>
</span><span id="__span-27-271"><a id="__codelineno-27-271" name="__codelineno-27-271" href="#__codelineno-27-271"></a>    <span class="p">[</span><span class="s1">'ied'</span><span class="p">],</span>
</span><span id="__span-27-272"><a id="__codelineno-27-272" name="__codelineno-27-272" href="#__codelineno-27-272"></a>    <span class="p">[</span><span class="s1">'incitefocus'</span><span class="p">],</span>
</span><span id="__span-27-273"><a id="__codelineno-27-273" name="__codelineno-27-273" href="#__codelineno-27-273"></a>    <span class="p">[</span><span class="s1">'ingegno'</span><span class="p">],</span>
</span><span id="__span-27-274"><a id="__codelineno-27-274" name="__codelineno-27-274" href="#__codelineno-27-274"></a>    <span class="p">[</span><span class="s1">'inphb'</span><span class="p">],</span>
</span><span id="__span-27-275"><a id="__codelineno-27-275" name="__codelineno-27-275" href="#__codelineno-27-275"></a>    <span class="p">[</span><span class="s1">'insper'</span><span class="p">],</span>
</span><span id="__span-27-276"><a id="__codelineno-27-276" name="__codelineno-27-276" href="#__codelineno-27-276"></a>    <span class="p">[</span><span class="s1">'ioannina'</span><span class="p">],</span>
</span><span id="__span-27-277"><a id="__codelineno-27-277" name="__codelineno-27-277" href="#__codelineno-27-277"></a>    <span class="p">[</span><span class="s1">'jubail'</span><span class="p">],</span>
</span><span id="__span-27-278"><a id="__codelineno-27-278" name="__codelineno-27-278" href="#__codelineno-27-278"></a>    <span class="p">[</span><span class="s1">'kannai'</span><span class="p">],</span>
</span><span id="__span-27-279"><a id="__codelineno-27-279" name="__codelineno-27-279" href="#__codelineno-27-279"></a>    <span class="p">[</span><span class="s1">'kaust'</span><span class="p">],</span>
</span><span id="__span-27-280"><a id="__codelineno-27-280" name="__codelineno-27-280" href="#__codelineno-27-280"></a>    <span class="p">[</span><span class="s1">'keolab'</span><span class="p">],</span>
</span><span id="__span-27-281"><a id="__codelineno-27-281" name="__codelineno-27-281" href="#__codelineno-27-281"></a>    <span class="p">[</span><span class="s1">'kitakagaya'</span><span class="p">],</span>
</span><span id="__span-27-282"><a id="__codelineno-27-282" name="__codelineno-27-282" href="#__codelineno-27-282"></a>    <span class="p">[</span><span class="s1">'lakazlab'</span><span class="p">],</span>
</span><span id="__span-27-283"><a id="__codelineno-27-283" name="__codelineno-27-283" href="#__codelineno-27-283"></a>    <span class="p">[</span><span class="s1">'lamachinerie'</span><span class="p">],</span>
</span><span id="__span-27-284"><a id="__codelineno-27-284" name="__codelineno-27-284" href="#__codelineno-27-284"></a>    <span class="p">[</span><span class="s1">'libya'</span><span class="p">],</span>
</span><span id="__span-27-285"><a id="__codelineno-27-285" name="__codelineno-27-285" href="#__codelineno-27-285"></a>    <span class="p">[</span><span class="s1">'lima'</span><span class="p">],</span>
</span><span id="__span-27-286"><a id="__codelineno-27-286" name="__codelineno-27-286" href="#__codelineno-27-286"></a>    <span class="p">[</span><span class="s1">'napoli'</span><span class="p">],</span>
</span><span id="__span-27-287"><a id="__codelineno-27-287" name="__codelineno-27-287" href="#__codelineno-27-287"></a>    <span class="p">[</span><span class="s1">'newcairo'</span><span class="p">],</span>
</span><span id="__span-27-288"><a id="__codelineno-27-288" name="__codelineno-27-288" href="#__codelineno-27-288"></a>    <span class="p">[</span><span class="s1">'ningbo'</span><span class="p">],</span>
</span><span id="__span-27-289"><a id="__codelineno-27-289" name="__codelineno-27-289" href="#__codelineno-27-289"></a>    <span class="p">[</span><span class="s1">'plusx'</span><span class="p">],</span>
</span><span id="__span-27-290"><a id="__codelineno-27-290" name="__codelineno-27-290" href="#__codelineno-27-290"></a>    <span class="p">[</span><span class="s1">'polytech'</span><span class="p">],</span>
</span><span id="__span-27-291"><a id="__codelineno-27-291" name="__codelineno-27-291" href="#__codelineno-27-291"></a>    <span class="p">[</span><span class="s1">'qbic'</span><span class="p">],</span>
</span><span id="__span-27-292"><a id="__codelineno-27-292" name="__codelineno-27-292" href="#__codelineno-27-292"></a>    <span class="p">[</span><span class="s1">'riidl'</span><span class="p">],</span>
</span><span id="__span-27-293"><a id="__codelineno-27-293" name="__codelineno-27-293" href="#__codelineno-27-293"></a>    <span class="p">[</span><span class="s1">'sedi'</span><span class="p">],</span>
</span><span id="__span-27-294"><a id="__codelineno-27-294" name="__codelineno-27-294" href="#__codelineno-27-294"></a>    <span class="p">[</span><span class="s1">'singapore'</span><span class="p">],</span>
</span><span id="__span-27-295"><a id="__codelineno-27-295" name="__codelineno-27-295" href="#__codelineno-27-295"></a>    <span class="p">[</span><span class="s1">'stjude'</span><span class="p">],</span>
</span><span id="__span-27-296"><a id="__codelineno-27-296" name="__codelineno-27-296" href="#__codelineno-27-296"></a>    <span class="p">[</span><span class="s1">'taipei'</span><span class="p">],</span>
</span><span id="__span-27-297"><a id="__codelineno-27-297" name="__codelineno-27-297" href="#__codelineno-27-297"></a>    <span class="p">[</span><span class="s1">'talents'</span><span class="p">],</span>
</span><span id="__span-27-298"><a id="__codelineno-27-298" name="__codelineno-27-298" href="#__codelineno-27-298"></a>    <span class="p">[</span><span class="s1">'tianhelab'</span><span class="p">],</span>
</span><span id="__span-27-299"><a id="__codelineno-27-299" name="__codelineno-27-299" href="#__codelineno-27-299"></a>    <span class="p">[</span><span class="s1">'tinkerers'</span><span class="p">],</span>
</span><span id="__span-27-300"><a id="__codelineno-27-300" name="__codelineno-27-300" href="#__codelineno-27-300"></a>    <span class="p">[</span><span class="s1">'twarda'</span><span class="p">],</span>
</span><span id="__span-27-301"><a id="__codelineno-27-301" name="__codelineno-27-301" href="#__codelineno-27-301"></a>    <span class="p">[</span><span class="s1">'ucal'</span><span class="p">],</span>
</span><span id="__span-27-302"><a id="__codelineno-27-302" name="__codelineno-27-302" href="#__codelineno-27-302"></a>    <span class="p">[</span><span class="s1">'ucontinental'</span><span class="p">],</span>
</span><span id="__span-27-303"><a id="__codelineno-27-303" name="__codelineno-27-303" href="#__codelineno-27-303"></a>    <span class="p">[</span><span class="s1">'uemadrid'</span><span class="p">],</span>
</span><span id="__span-27-304"><a id="__codelineno-27-304" name="__codelineno-27-304" href="#__codelineno-27-304"></a>    <span class="p">[</span><span class="s1">'ulima'</span><span class="p">],</span>
</span><span id="__span-27-305"><a id="__codelineno-27-305" name="__codelineno-27-305" href="#__codelineno-27-305"></a>    <span class="p">[</span><span class="s1">'vancouver'</span><span class="p">],</span>
</span><span id="__span-27-306"><a id="__codelineno-27-306" name="__codelineno-27-306" href="#__codelineno-27-306"></a>    <span class="p">[</span><span class="s1">'waag'</span><span class="p">],</span>
</span><span id="__span-27-307"><a id="__codelineno-27-307" name="__codelineno-27-307" href="#__codelineno-27-307"></a>    <span class="p">[</span><span class="s1">'wheaton'</span><span class="p">],</span>
</span><span id="__span-27-308"><a id="__codelineno-27-308" name="__codelineno-27-308" href="#__codelineno-27-308"></a>    <span class="p">[</span><span class="s1">'winam'</span><span class="p">]</span>
</span><span id="__span-27-309"><a id="__codelineno-27-309" name="__codelineno-27-309" href="#__codelineno-27-309"></a><span class="p">]</span>
</span><span id="__span-27-310"><a id="__codelineno-27-310" name="__codelineno-27-310" href="#__codelineno-27-310"></a>
</span><span id="__span-27-311"><a id="__codelineno-27-311" name="__codelineno-27-311" href="#__codelineno-27-311"></a><span class="k">def</span> <span class="nf">format_lab_group</span><span class="p">(</span><span class="n">lab_group</span><span class="p">):</span>
</span><span id="__span-27-312"><a id="__codelineno-27-312" name="__codelineno-27-312" href="#__codelineno-27-312"></a>    <span class="k">return</span> <span class="s2">"/"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lab_group</span><span class="p">)</span>
</span><span id="__span-27-313"><a id="__codelineno-27-313" name="__codelineno-27-313" href="#__codelineno-27-313"></a>
</span><span id="__span-27-314"><a id="__codelineno-27-314" name="__codelineno-27-314" href="#__codelineno-27-314"></a><span class="k">def</span> <span class="nf">get_continent</span><span class="p">(</span><span class="n">lab_group</span><span class="p">):</span>
</span><span id="__span-27-315"><a id="__codelineno-27-315" name="__codelineno-27-315" href="#__codelineno-27-315"></a>    <span class="k">for</span> <span class="n">lab_name</span> <span class="ow">in</span> <span class="n">lab_group</span><span class="p">:</span>
</span><span id="__span-27-316"><a id="__codelineno-27-316" name="__codelineno-27-316" href="#__codelineno-27-316"></a>        <span class="k">if</span> <span class="n">lab_name</span> <span class="ow">in</span> <span class="n">labs_by_continent</span><span class="p">:</span>
</span><span id="__span-27-317"><a id="__codelineno-27-317" name="__codelineno-27-317" href="#__codelineno-27-317"></a>            <span class="k">return</span> <span class="n">labs_by_continent</span><span class="p">[</span><span class="n">lab_name</span><span class="p">]</span>
</span><span id="__span-27-318"><a id="__codelineno-27-318" name="__codelineno-27-318" href="#__codelineno-27-318"></a>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Lab Not Found"</span><span class="p">)</span>
</span><span id="__span-27-319"><a id="__codelineno-27-319" name="__codelineno-27-319" href="#__codelineno-27-319"></a>
</span><span id="__span-27-320"><a id="__codelineno-27-320" name="__codelineno-27-320" href="#__codelineno-27-320"></a><span class="k">def</span> <span class="nf">node_is_lab</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">lab_sort</span><span class="p">,</span> <span class="n">year_sort</span><span class="p">):</span>
</span><span id="__span-27-321"><a id="__codelineno-27-321" name="__codelineno-27-321" href="#__codelineno-27-321"></a>    <span class="n">url</span> <span class="o">=</span> <span class="n">node_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-27-322"><a id="__codelineno-27-322" name="__codelineno-27-322" href="#__codelineno-27-322"></a>
</span><span id="__span-27-323"><a id="__codelineno-27-323" name="__codelineno-27-323" href="#__codelineno-27-323"></a>    <span class="n">lab</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-27-324"><a id="__codelineno-27-324" name="__codelineno-27-324" href="#__codelineno-27-324"></a>
</span><span id="__span-27-325"><a id="__codelineno-27-325" name="__codelineno-27-325" href="#__codelineno-27-325"></a>    <span class="k">if</span> <span class="n">year_sort</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-27-326"><a id="__codelineno-27-326" name="__codelineno-27-326" href="#__codelineno-27-326"></a>        <span class="n">year</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-27-327"><a id="__codelineno-27-327" name="__codelineno-27-327" href="#__codelineno-27-327"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-328"><a id="__codelineno-27-328" name="__codelineno-27-328" href="#__codelineno-27-328"></a>        <span class="n">year</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-27-329"><a id="__codelineno-27-329" name="__codelineno-27-329" href="#__codelineno-27-329"></a>
</span><span id="__span-27-330"><a id="__codelineno-27-330" name="__codelineno-27-330" href="#__codelineno-27-330"></a>    <span class="n">lab_group_current</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-27-331"><a id="__codelineno-27-331" name="__codelineno-27-331" href="#__codelineno-27-331"></a>    <span class="k">for</span> <span class="n">lab_group</span> <span class="ow">in</span> <span class="n">grouped_lab_names</span><span class="p">:</span>
</span><span id="__span-27-332"><a id="__codelineno-27-332" name="__codelineno-27-332" href="#__codelineno-27-332"></a>        <span class="k">if</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">lab_group</span><span class="p">:</span>
</span><span id="__span-27-333"><a id="__codelineno-27-333" name="__codelineno-27-333" href="#__codelineno-27-333"></a>            <span class="n">lab_group_current</span> <span class="o">=</span> <span class="n">lab_group</span>
</span><span id="__span-27-334"><a id="__codelineno-27-334" name="__codelineno-27-334" href="#__codelineno-27-334"></a>            <span class="k">break</span>  
</span><span id="__span-27-335"><a id="__codelineno-27-335" name="__codelineno-27-335" href="#__codelineno-27-335"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-336"><a id="__codelineno-27-336" name="__codelineno-27-336" href="#__codelineno-27-336"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Lab Not Found"</span><span class="p">)</span>
</span><span id="__span-27-337"><a id="__codelineno-27-337" name="__codelineno-27-337" href="#__codelineno-27-337"></a>    <span class="k">if</span> <span class="n">people_per_lab</span><span class="p">[</span><span class="n">format_lab_group</span><span class="p">(</span><span class="n">lab_group_current</span><span class="p">)]</span> <span class="o">&lt;</span> <span class="n">MIN_STUDENTS</span><span class="p">:</span>
</span><span id="__span-27-338"><a id="__codelineno-27-338" name="__codelineno-27-338" href="#__codelineno-27-338"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-27-339"><a id="__codelineno-27-339" name="__codelineno-27-339" href="#__codelineno-27-339"></a>
</span><span id="__span-27-340"><a id="__codelineno-27-340" name="__codelineno-27-340" href="#__codelineno-27-340"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">lab</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">lab_sort</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">year</span> <span class="ow">or</span> <span class="p">(</span><span class="n">year</span> <span class="ow">in</span> <span class="n">year_sort</span><span class="p">))</span>
</span><span id="__span-27-341"><a id="__codelineno-27-341" name="__codelineno-27-341" href="#__codelineno-27-341"></a>
</span><span id="__span-27-342"><a id="__codelineno-27-342" name="__codelineno-27-342" href="#__codelineno-27-342"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"final_data.json"</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-27-343"><a id="__codelineno-27-343" name="__codelineno-27-343" href="#__codelineno-27-343"></a>    <span class="n">final_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-27-344"><a id="__codelineno-27-344" name="__codelineno-27-344" href="#__codelineno-27-344"></a>
</span><span id="__span-27-345"><a id="__codelineno-27-345" name="__codelineno-27-345" href="#__codelineno-27-345"></a><span class="n">people_per_lab</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-27-346"><a id="__codelineno-27-346" name="__codelineno-27-346" href="#__codelineno-27-346"></a>
</span><span id="__span-27-347"><a id="__codelineno-27-347" name="__codelineno-27-347" href="#__codelineno-27-347"></a><span class="k">for</span> <span class="n">lab_group</span> <span class="ow">in</span> <span class="n">grouped_lab_names</span><span class="p">:</span>
</span><span id="__span-27-348"><a id="__codelineno-27-348" name="__codelineno-27-348" href="#__codelineno-27-348"></a>    <span class="n">formatted</span> <span class="o">=</span> <span class="n">format_lab_group</span><span class="p">(</span><span class="n">lab_group</span><span class="p">)</span>
</span><span id="__span-27-349"><a id="__codelineno-27-349" name="__codelineno-27-349" href="#__codelineno-27-349"></a>    <span class="n">people_per_lab</span><span class="p">[</span><span class="n">formatted</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-27-350"><a id="__codelineno-27-350" name="__codelineno-27-350" href="#__codelineno-27-350"></a><span class="k">for</span> <span class="n">student</span> <span class="ow">in</span> <span class="n">final_data</span><span class="p">[</span><span class="s1">'nodes'</span><span class="p">]:</span>
</span><span id="__span-27-351"><a id="__codelineno-27-351" name="__codelineno-27-351" href="#__codelineno-27-351"></a>    <span class="n">lab</span> <span class="o">=</span> <span class="n">student</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="__span-27-352"><a id="__codelineno-27-352" name="__codelineno-27-352" href="#__codelineno-27-352"></a>    <span class="n">lab_group_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-27-353"><a id="__codelineno-27-353" name="__codelineno-27-353" href="#__codelineno-27-353"></a>    <span class="k">for</span> <span class="n">lab_group</span> <span class="ow">in</span> <span class="n">grouped_lab_names</span><span class="p">:</span>
</span><span id="__span-27-354"><a id="__codelineno-27-354" name="__codelineno-27-354" href="#__codelineno-27-354"></a>        <span class="k">if</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">lab_group</span><span class="p">:</span>
</span><span id="__span-27-355"><a id="__codelineno-27-355" name="__codelineno-27-355" href="#__codelineno-27-355"></a>            <span class="n">lab_group_name</span> <span class="o">=</span> <span class="n">format_lab_group</span><span class="p">(</span><span class="n">lab_group</span><span class="p">)</span>
</span><span id="__span-27-356"><a id="__codelineno-27-356" name="__codelineno-27-356" href="#__codelineno-27-356"></a>            <span class="k">break</span>
</span><span id="__span-27-357"><a id="__codelineno-27-357" name="__codelineno-27-357" href="#__codelineno-27-357"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-358"><a id="__codelineno-27-358" name="__codelineno-27-358" href="#__codelineno-27-358"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
</span><span id="__span-27-359"><a id="__codelineno-27-359" name="__codelineno-27-359" href="#__codelineno-27-359"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Lab Not Found"</span><span class="p">)</span>
</span><span id="__span-27-360"><a id="__codelineno-27-360" name="__codelineno-27-360" href="#__codelineno-27-360"></a>    <span class="n">people_per_lab</span><span class="p">[</span><span class="n">lab_group_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-27-361"><a id="__codelineno-27-361" name="__codelineno-27-361" href="#__codelineno-27-361"></a>
</span><span id="__span-27-362"><a id="__codelineno-27-362" name="__codelineno-27-362" href="#__codelineno-27-362"></a><span class="n">densities</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'lab'</span><span class="p">:[],</span> <span class="s1">'density'</span><span class="p">:[],</span> <span class="s1">'geography'</span><span class="p">:[]}</span>
</span><span id="__span-27-363"><a id="__codelineno-27-363" name="__codelineno-27-363" href="#__codelineno-27-363"></a>
</span><span id="__span-27-364"><a id="__codelineno-27-364" name="__codelineno-27-364" href="#__codelineno-27-364"></a><span class="k">for</span> <span class="n">lab_group</span> <span class="ow">in</span> <span class="n">grouped_lab_names</span><span class="p">:</span>
</span><span id="__span-27-365"><a id="__codelineno-27-365" name="__codelineno-27-365" href="#__codelineno-27-365"></a>    <span class="k">if</span> <span class="n">people_per_lab</span><span class="p">[</span><span class="n">format_lab_group</span><span class="p">(</span><span class="n">lab_group</span><span class="p">)]</span> <span class="o">&lt;</span> <span class="n">MIN_STUDENTS</span><span class="p">:</span>
</span><span id="__span-27-366"><a id="__codelineno-27-366" name="__codelineno-27-366" href="#__codelineno-27-366"></a>        <span class="k">continue</span>
</span><span id="__span-27-367"><a id="__codelineno-27-367" name="__codelineno-27-367" href="#__codelineno-27-367"></a>    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="__span-27-368"><a id="__codelineno-27-368" name="__codelineno-27-368" href="#__codelineno-27-368"></a>
</span><span id="__span-27-369"><a id="__codelineno-27-369" name="__codelineno-27-369" href="#__codelineno-27-369"></a>    <span class="n">students</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-27-370"><a id="__codelineno-27-370" name="__codelineno-27-370" href="#__codelineno-27-370"></a>
</span><span id="__span-27-371"><a id="__codelineno-27-371" name="__codelineno-27-371" href="#__codelineno-27-371"></a>    <span class="n">LAB</span> <span class="o">=</span> <span class="n">lab_group</span>
</span><span id="__span-27-372"><a id="__codelineno-27-372" name="__codelineno-27-372" href="#__codelineno-27-372"></a>    <span class="n">YEAR</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-27-373"><a id="__codelineno-27-373" name="__codelineno-27-373" href="#__codelineno-27-373"></a>
</span><span id="__span-27-374"><a id="__codelineno-27-374" name="__codelineno-27-374" href="#__codelineno-27-374"></a>    <span class="c1"># Add nodes to the graph</span>
</span><span id="__span-27-375"><a id="__codelineno-27-375" name="__codelineno-27-375" href="#__codelineno-27-375"></a>    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">final_data</span><span class="p">[</span><span class="s2">"nodes"</span><span class="p">]:</span>
</span><span id="__span-27-376"><a id="__codelineno-27-376" name="__codelineno-27-376" href="#__codelineno-27-376"></a>        <span class="n">students</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">"id"</span><span class="p">])</span>
</span><span id="__span-27-377"><a id="__codelineno-27-377" name="__codelineno-27-377" href="#__codelineno-27-377"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_is_lab</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">"id"</span><span class="p">],</span> <span class="n">LAB</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">):</span>
</span><span id="__span-27-378"><a id="__codelineno-27-378" name="__codelineno-27-378" href="#__codelineno-27-378"></a>            <span class="k">continue</span>
</span><span id="__span-27-379"><a id="__codelineno-27-379" name="__codelineno-27-379" href="#__codelineno-27-379"></a>        <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">"id"</span><span class="p">])</span>
</span><span id="__span-27-380"><a id="__codelineno-27-380" name="__codelineno-27-380" href="#__codelineno-27-380"></a>
</span><span id="__span-27-381"><a id="__codelineno-27-381" name="__codelineno-27-381" href="#__codelineno-27-381"></a>    <span class="c1"># Add edges (links) to the graph</span>
</span><span id="__span-27-382"><a id="__codelineno-27-382" name="__codelineno-27-382" href="#__codelineno-27-382"></a>    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">final_data</span><span class="p">[</span><span class="s2">"links"</span><span class="p">]:</span>
</span><span id="__span-27-383"><a id="__codelineno-27-383" name="__codelineno-27-383" href="#__codelineno-27-383"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">node_is_lab</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">"source"</span><span class="p">],</span> <span class="n">LAB</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">node_is_lab</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">"target"</span><span class="p">],</span> <span class="n">LAB</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">)):</span>
</span><span id="__span-27-384"><a id="__codelineno-27-384" name="__codelineno-27-384" href="#__codelineno-27-384"></a>            <span class="k">continue</span>
</span><span id="__span-27-385"><a id="__codelineno-27-385" name="__codelineno-27-385" href="#__codelineno-27-385"></a>        <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">"source"</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="s2">"target"</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="s2">"value"</span><span class="p">],</span> <span class="n">topic</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="s2">"topic"</span><span class="p">])</span>
</span><span id="__span-27-386"><a id="__codelineno-27-386" name="__codelineno-27-386" href="#__codelineno-27-386"></a>
</span><span id="__span-27-387"><a id="__codelineno-27-387" name="__codelineno-27-387" href="#__codelineno-27-387"></a>    <span class="c1"># Calculate density</span>
</span><span id="__span-27-388"><a id="__codelineno-27-388" name="__codelineno-27-388" href="#__codelineno-27-388"></a>    <span class="n">density</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</span><span id="__span-27-389"><a id="__codelineno-27-389" name="__codelineno-27-389" href="#__codelineno-27-389"></a>    <span class="n">densities</span><span class="p">[</span><span class="s1">'lab'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_lab_group</span><span class="p">(</span><span class="n">lab_group</span><span class="p">))</span>
</span><span id="__span-27-390"><a id="__codelineno-27-390" name="__codelineno-27-390" href="#__codelineno-27-390"></a>    <span class="n">densities</span><span class="p">[</span><span class="s1">'density'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
</span><span id="__span-27-391"><a id="__codelineno-27-391" name="__codelineno-27-391" href="#__codelineno-27-391"></a>    <span class="n">densities</span><span class="p">[</span><span class="s1">'geography'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_continent</span><span class="p">(</span><span class="n">lab_group</span><span class="p">))</span>
</span><span id="__span-27-392"><a id="__codelineno-27-392" name="__codelineno-27-392" href="#__codelineno-27-392"></a>
</span><span id="__span-27-393"><a id="__codelineno-27-393" name="__codelineno-27-393" href="#__codelineno-27-393"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">densities</span><span class="p">)</span>
</span><span id="__span-27-394"><a id="__codelineno-27-394" name="__codelineno-27-394" href="#__codelineno-27-394"></a><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">"density_by_lab_minimum_5_students.csv"</span><span class="p">)</span>
</span></code></pre></div>
<p><code>in_degree_centrality_by_subject.py</code> creates a data table of each student's <a href="https://networkx.org/documentation/networkx-2.4/reference/algorithms/generated/networkx.algorithms.centrality.in_degree_centrality.html"><code>in-degree centrality</code></a> for each subject area.</p>
<p><em>in_degree_centrality_by_subject.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kn">import</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">json</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="n">TOPICS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="s2">"Computer-Aided Design"</span><span class="p">,</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>    <span class="s2">"Computer-Controlled Cutting"</span><span class="p">,</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>    <span class="s2">"Embedded Programing"</span><span class="p">,</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>    <span class="s2">"3D Scanning and Printing"</span><span class="p">,</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>    <span class="s2">"Electronics Design"</span><span class="p">,</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>    <span class="s2">"Computer-Controlled Machining"</span><span class="p">,</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>    <span class="s2">"Electronics Production"</span><span class="p">,</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>    <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">,</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>    <span class="s2">"Input Devices"</span><span class="p">,</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>    <span class="s2">"Moulding and Casting"</span><span class="p">,</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>    <span class="s2">"Output Devices"</span><span class="p">,</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>    <span class="s2">"Embedded Networking and Communications"</span><span class="p">,</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>    <span class="s2">"Interface and Application Programming"</span><span class="p">,</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>    <span class="s2">"Wildcard Week"</span><span class="p">,</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>    <span class="s2">"Applications and Implications"</span><span class="p">,</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>    <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">,</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>    <span class="s2">"Final Project"</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="p">]</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"final_data.json"</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>    <span class="n">final_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">TOPICS</span><span class="p">:</span>
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>    <span class="c1"># Add nodes to the graph</span>
</span><span id="__span-28-32"><a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a>    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">final_data</span><span class="p">[</span><span class="s2">"nodes"</span><span class="p">]:</span>
</span><span id="__span-28-33"><a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>        <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s2">"id"</span><span class="p">])</span>
</span><span id="__span-28-34"><a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>
</span><span id="__span-28-35"><a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>    <span class="c1"># Add edges (links) to the graph</span>
</span><span id="__span-28-36"><a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">final_data</span><span class="p">[</span><span class="s2">"links"</span><span class="p">]:</span>
</span><span id="__span-28-37"><a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a>        <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">"topic"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">topic</span><span class="p">:</span>
</span><span id="__span-28-38"><a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a>            <span class="k">continue</span>
</span><span id="__span-28-39"><a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a>        <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">"source"</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="s2">"target"</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="s2">"value"</span><span class="p">],</span> <span class="n">topic</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="s2">"topic"</span><span class="p">])</span>
</span><span id="__span-28-40"><a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a>
</span><span id="__span-28-41"><a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a>    <span class="c1"># Calculate degree centrality</span>
</span><span id="__span-28-42"><a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a>    <span class="n">degree_centrality</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</span><span id="__span-28-43"><a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a>
</span><span id="__span-28-44"><a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a>    <span class="n">table_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"student"</span><span class="p">:[],</span><span class="s2">"degree_centrality"</span><span class="p">:[]}</span>
</span><span id="__span-28-45"><a id="__codelineno-28-45" name="__codelineno-28-45" href="#__codelineno-28-45"></a>
</span><span id="__span-28-46"><a id="__codelineno-28-46" name="__codelineno-28-46" href="#__codelineno-28-46"></a>    <span class="k">for</span> <span class="n">student</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">degree_centrality</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="__span-28-47"><a id="__codelineno-28-47" name="__codelineno-28-47" href="#__codelineno-28-47"></a>        <span class="n">table_data</span><span class="p">[</span><span class="s2">"student"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">student</span><span class="p">)</span>
</span><span id="__span-28-48"><a id="__codelineno-28-48" name="__codelineno-28-48" href="#__codelineno-28-48"></a>        <span class="n">table_data</span><span class="p">[</span><span class="s2">"degree_centrality"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">degree_centrality</span><span class="p">[</span><span class="n">student</span><span class="p">])</span>
</span><span id="__span-28-49"><a id="__codelineno-28-49" name="__codelineno-28-49" href="#__codelineno-28-49"></a>
</span><span id="__span-28-50"><a id="__codelineno-28-50" name="__codelineno-28-50" href="#__codelineno-28-50"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">table_data</span><span class="p">)</span>
</span><span id="__span-28-51"><a id="__codelineno-28-51" name="__codelineno-28-51" href="#__codelineno-28-51"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">"in_degree_centrality_topic_</span><span class="si">{</span><span class="n">topic</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="s1">'_'</span><span class="p">)</span><span class="si">}</span><span class="s2">_all_labs_years.csv"</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Ranked Top 10 In-Degree Centrality</strong></p>
<p>Click on the image below to see the data table for all students who were ranked in the top 10 for their <a href="https://networkx.org/documentation/networkx-2.4/reference/algorithms/generated/networkx.algorithms.centrality.in_degree_centrality.html"><code>in-degree centrality</code></a> in a subject area. The table includes the students' ranks across all subject areas and highlights in green whenever they were in the top 10. Only <code>111 students</code> were ranked in the top 10 for at least one of the 17 subject areas because several students were ranked top 10 in multiple categories.</p>
<p><a href="../../../assets/xlsx/ExpertNetworkMapTop10.htm" target="_blank"><img alt="ExNM Top 10 Thumb" src="../../assets/images/stem/expert-network-map/ExNMTop10Thumb.jpg"></a></p>
<ul>
<li><a href="../../assets/xlsx/ExpertNetworkMapTop10.xlsx">Click here to download an <code>xlsx</code> Excel file of the data</a></li>
</ul>
<p><strong>Full In-Degree Centrality Data</strong></p>
<p>Click on the image below to see the data table for all students' <a href="https://networkx.org/documentation/networkx-2.4/reference/algorithms/generated/networkx.algorithms.centrality.in_degree_centrality.html"><code>in-degree centrality</code></a> value and ranking by subject area. These data are the basis for ranking students' expertise in a subject area.</p>
<p><a href="../../../assets/xlsx/ExpertNetworkMapTop10InDegree.htm" target="_blank"><img alt="ExNM Top 10 In-Degree Thumb" src="../../assets/images/stem/expert-network-map/ExNMTop10NDThumb.jpg"></a></p>
<ul>
<li><a href="../../assets/xlsx/In-DegreeCentralityBySubjectArea.xlsx">Click here to download an <code>xlsx</code> Excel file of the data</a></li>
</ul>
<p><strong>Density by Lab and Continent</strong></p>
<p>Below is a graph of the <a href="https://www.ibm.com/docs/en/spss-modeler/18.0.0?topic=networks-network-density"><code>density</code></a> of each lab's network, color coded by continent. Only labs with five or more students since 2018 were included in the analysis since very small labs skew the results (for example, a lab that only had one student has a network density of <code>1</code>). The dark blue vertical line represents the global network density of <code>0.00237457479499778</code>. <code>~91.3%</code> of the individual labs had a higher density than this, ranging from approximately <code>0.03</code> to <code>0.45</code> (with the exception of the <code>Rwanda</code> network density of <code>~0.013</code>), supporting my hypothesis that students frequently connected with experts in their own lab, but not in the global community. Click on the graph to open a spreadsheet with all of the data.</p>
<p><a href="../../../assets/xlsx/DensitiesByLabAndContinent.htm" target="_blank"><img alt="Densities By Lab and Continent" src="../../assets/images/stem/expert-network-map/DensityChart.jpg"></a></p>
<ul>
<li><a href="../../assets/xlsx/DensitiesByLabAndContinent.xlsx">Click here to download an <code>xlsx</code> Excel file of the data</a></li>
<li><a href="../../assets/images/stem/expert-network-map/DensityChart.jpg" target="_blank">Click here to download open or download the chart as a <code>jpg</code></a></li>
</ul>
<h3 id="step-3-data-visualization_1">Step 3: Data Visualization</h3>
<p><a href="../../assets/code/step3-webpage.zip">Download the webpage code for Step 3 here!</a></p>
<p><a href="../../assets/code/step3-python-data.zip">Download the Python code and data files for Step 3 here!</a></p>
<p><a href="../../assets/code/step3-python-no-data.zip">Download only the Python code for Step 3 here!</a></p>
<h4 id="library-and-data-structure">Library and Data Structure</h4>
<p>I employed <a href="https://d3js.org/">D3JS</a>, a JavaScript library, to create the data visualization. I started off by browsing the <a href="https://observablehq.com/@d3/gallery?utm_source=d3js-org&amp;utm_medium=hero&amp;utm_campaign=try-observable">D3 Gallery</a> to select the format for my visualization. I was choosing between a <a href="https://observablehq.com/@d3/disjoint-force-directed-graph/2?intent=fork"><code>Disjoint Force-Directed Graph</code></a> and a <a href="https://observablehq.com/@brunolaranjeira/d3-v6-force-directed-graph-with-directional-straight-arrow"><code>Force Directed Graph with Arrows</code></a>. Due to frequent two-way connections between nodes and a large amount of data (so very small lines for each individual connection, making arrowheads hard to discern), I decided on the <code>Disjoint Force-Directed Graph</code>.</p>
<p><img alt="Force-Directed Graph" src="../../assets/images/stem/expert-network-map/f-dg.jpg" style="width:300px;">
<img alt="Force-Directed Graph with Arrows" src="../../assets/images/stem/expert-network-map/f-dga.jpg" style="width:300px;"></p>
<p>So I read through the <a href="https://observablehq.com/@d3/disjoint-force-directed-graph/2?intent=fork">example code</a> from D3JS carefully and found that the input data was a JSON with the following format:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="nt">"nodes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"radius"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID2"</span><span class="p">,</span><span class="w"> </span><span class="nt">"radius"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="p">{</span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID3"</span><span class="p">,</span><span class="w"> </span><span class="nt">"radius"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">  </span><span class="nt">"links"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="p">{</span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID3"</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">    </span><span class="p">{</span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID2"</span><span class="p">,</span><span class="w"> </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID3"</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">},</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">    </span><span class="p">{</span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID2"</span><span class="p">,</span><span class="w"> </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>nodes</code> object contains every node's ID as well as other data, such as the node's radius. The <code>links</code> object contains each edge, in my case connection between students, and an associated value which can be used to control strength or thickness.</p>
<h4 id="transforming-data">Transforming Data</h4>
<p>So the first step was to transform my <code>Pandas</code> dataframe into a JSON file of this format. I wrote <code>matrix2d3js.py</code>. When this script is run, it takes <code>final_data.csv</code> (the output from <a href="#step-2-ai-sorting-data-analysis_1">Step 2</a>) and moves all of the data into a JSON file matching the structure outline above. This is then saved as <code>final_data.json</code>.</p>
<p><em>matrix2d3js.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="n">INPUT_FILE</span> <span class="o">=</span> <span class="s2">"final_data.csv"</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="n">OUTPUT_FILE</span> <span class="o">=</span> <span class="s2">"final_data.json"</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">INPUT_FILE</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="n">STUDENTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="n">TOPICS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>    <span class="s2">"Prefab"</span><span class="p">,</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>    <span class="s2">"Computer-Aided Design"</span><span class="p">,</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>    <span class="s2">"Computer-Controlled Cutting"</span><span class="p">,</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>    <span class="s2">"Embedded Programing"</span><span class="p">,</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>    <span class="s2">"3D Scanning and Printing"</span><span class="p">,</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>    <span class="s2">"Electronics Design"</span><span class="p">,</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>    <span class="s2">"Computer-Controlled Machining"</span><span class="p">,</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>    <span class="s2">"Electronics Production"</span><span class="p">,</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>    <span class="s2">"Mechanical Design, Machine Design"</span><span class="p">,</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>    <span class="s2">"Input Devices"</span><span class="p">,</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>    <span class="s2">"Moulding and Casting"</span><span class="p">,</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>    <span class="s2">"Output Devices"</span><span class="p">,</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>    <span class="s2">"Embedded Networking and Communications"</span><span class="p">,</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>    <span class="s2">"Interface and Application Programming"</span><span class="p">,</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>    <span class="s2">"Wildcard Week"</span><span class="p">,</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>    <span class="s2">"Applications and Implications"</span><span class="p">,</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>    <span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">,</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a>    <span class="s2">"Final Project"</span><span class="p">,</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a>    <span class="s2">"Other"</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="p">]</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a>    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">referencer_student</span><span class="p">,</span> <span class="p">(</span><span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)]</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a><span class="k">def</span> <span class="nf">generate_node_obj</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a>        <span class="s2">"id"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a>        <span class="s2">"group"</span><span class="p">:</span> <span class="n">group</span>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a>    <span class="p">}</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a>
</span><span id="__span-30-42"><a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a><span class="k">def</span> <span class="nf">generate_link_obj</span><span class="p">(</span><span class="n">name_from</span><span class="p">,</span> <span class="n">name_to</span><span class="p">,</span> <span class="n">strength</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
</span><span id="__span-30-43"><a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-30-44"><a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a>        <span class="s2">"source"</span><span class="p">:</span> <span class="n">name_from</span><span class="p">,</span>
</span><span id="__span-30-45"><a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a>        <span class="s2">"target"</span><span class="p">:</span> <span class="n">name_to</span><span class="p">,</span>
</span><span id="__span-30-46"><a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a>        <span class="s2">"value"</span><span class="p">:</span> <span class="n">strength</span><span class="p">,</span>
</span><span id="__span-30-47"><a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a>        <span class="s2">"topic"</span><span class="p">:</span> <span class="n">topic</span>
</span><span id="__span-30-48"><a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a>    <span class="p">}</span>
</span><span id="__span-30-49"><a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a>
</span><span id="__span-30-50"><a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a><span class="n">final_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-30-51"><a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a>    <span class="s2">"nodes"</span><span class="p">:</span> <span class="p">[</span> <span class="p">],</span>
</span><span id="__span-30-52"><a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a>    <span class="s2">"links"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
</span><span id="__span-30-53"><a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a><span class="p">}</span>
</span><span id="__span-30-54"><a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a>
</span><span id="__span-30-55"><a id="__codelineno-30-55" name="__codelineno-30-55" href="#__codelineno-30-55"></a><span class="k">def</span> <span class="nf">split_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="__span-30-56"><a id="__codelineno-30-56" name="__codelineno-30-56" href="#__codelineno-30-56"></a>    <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)</span>
</span><span id="__span-30-57"><a id="__codelineno-30-57" name="__codelineno-30-57" href="#__codelineno-30-57"></a>
</span><span id="__span-30-58"><a id="__codelineno-30-58" name="__codelineno-30-58" href="#__codelineno-30-58"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-30-59"><a id="__codelineno-30-59" name="__codelineno-30-59" href="#__codelineno-30-59"></a>    <span class="c1"># create `nodes` object in final JSON</span>
</span><span id="__span-30-60"><a id="__codelineno-30-60" name="__codelineno-30-60" href="#__codelineno-30-60"></a>    <span class="k">for</span> <span class="n">student</span> <span class="ow">in</span> <span class="n">STUDENTS</span><span class="p">:</span>
</span><span id="__span-30-61"><a id="__codelineno-30-61" name="__codelineno-30-61" href="#__codelineno-30-61"></a>        <span class="n">student_name</span><span class="p">,</span> <span class="n">student_link</span> <span class="o">=</span> <span class="n">split_name</span><span class="p">(</span><span class="n">student</span><span class="p">)</span>
</span><span id="__span-30-62"><a id="__codelineno-30-62" name="__codelineno-30-62" href="#__codelineno-30-62"></a>        <span class="n">final_data</span><span class="p">[</span><span class="s1">'nodes'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generate_node_obj</span><span class="p">(</span><span class="n">student</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-30-63"><a id="__codelineno-30-63" name="__codelineno-30-63" href="#__codelineno-30-63"></a>
</span><span id="__span-30-64"><a id="__codelineno-30-64" name="__codelineno-30-64" href="#__codelineno-30-64"></a>    <span class="c1"># for each link between students, add a link object in the final JSON under the `links` object</span>
</span><span id="__span-30-65"><a id="__codelineno-30-65" name="__codelineno-30-65" href="#__codelineno-30-65"></a>    <span class="k">for</span> <span class="n">referencer_student</span> <span class="ow">in</span> <span class="n">STUDENTS</span><span class="p">:</span>
</span><span id="__span-30-66"><a id="__codelineno-30-66" name="__codelineno-30-66" href="#__codelineno-30-66"></a>        <span class="n">referencer_student_name</span><span class="p">,</span> <span class="n">referencer_student_link</span> <span class="o">=</span> <span class="n">split_name</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">)</span>
</span><span id="__span-30-67"><a id="__codelineno-30-67" name="__codelineno-30-67" href="#__codelineno-30-67"></a>        <span class="k">for</span> <span class="n">referenced_student</span> <span class="ow">in</span> <span class="n">STUDENTS</span><span class="p">:</span>
</span><span id="__span-30-68"><a id="__codelineno-30-68" name="__codelineno-30-68" href="#__codelineno-30-68"></a>            <span class="n">referenced_student_name</span><span class="p">,</span> <span class="n">referenced_student_link</span> <span class="o">=</span> <span class="n">split_name</span><span class="p">(</span><span class="n">referenced_student</span><span class="p">)</span>
</span><span id="__span-30-69"><a id="__codelineno-30-69" name="__codelineno-30-69" href="#__codelineno-30-69"></a>            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">TOPICS</span><span class="p">:</span>
</span><span id="__span-30-70"><a id="__codelineno-30-70" name="__codelineno-30-70" href="#__codelineno-30-70"></a>                <span class="n">val</span> <span class="o">=</span> <span class="n">get_value</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span>
</span><span id="__span-30-71"><a id="__codelineno-30-71" name="__codelineno-30-71" href="#__codelineno-30-71"></a>
</span><span id="__span-30-72"><a id="__codelineno-30-72" name="__codelineno-30-72" href="#__codelineno-30-72"></a>                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">val</span><span class="p">):</span> <span class="k">continue</span>
</span><span id="__span-30-73"><a id="__codelineno-30-73" name="__codelineno-30-73" href="#__codelineno-30-73"></a>
</span><span id="__span-30-74"><a id="__codelineno-30-74" name="__codelineno-30-74" href="#__codelineno-30-74"></a>                <span class="n">final_data</span><span class="p">[</span><span class="s1">'links'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generate_link_obj</span><span class="p">(</span><span class="n">referencer_student</span><span class="p">,</span> <span class="n">referenced_student</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">topic</span><span class="p">))</span>
</span><span id="__span-30-75"><a id="__codelineno-30-75" name="__codelineno-30-75" href="#__codelineno-30-75"></a>
</span><span id="__span-30-76"><a id="__codelineno-30-76" name="__codelineno-30-76" href="#__codelineno-30-76"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"final_data.json"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
</span><span id="__span-30-77"><a id="__codelineno-30-77" name="__codelineno-30-77" href="#__codelineno-30-77"></a>        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">final_data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="name-conflicts">Name Conflicts</h4>
<p>Upon inspecting the data, I noticed that several students with longer names had names that did not reflect their listing on the Fab Academy Student Rosters (for example, click <a href="https://fabacademy.org/2023/people.html">here</a> to see the 2023 roster). To resolve this, I wrote <code>resolve_name_conflicts.py</code>. This identifies students based on the URL to their website (which acts as a unique identifier for every student) and checkes it against the webpage. This was especially challenging since some students whose names have diacritic marks or accent marks are sometimes displayed as characters and other times as unicode beginning with <code>\u</code>, so I checked for both. The webpage name overrides the name collected during <a href="#step-2-ai-sorting-data-analysis_1">Step 2</a>.</p>
<p>So I ran <code>resolve_name_conflicts.py</code>, which takes <code>final_data.json</code> as an input and outputs <code>final_data_name_fixed.json</code>.</p>
<p>Below is <code>resolve_name_conflicts.py</code>. Before that codeblock I include four functions that are imported from <code>main.py</code> (see <a href="#step-2-ai-sorting-data-analysis_1">Step 2</a>) for reference. I did not include the libraries included in <code>main.py</code> as it is detailed above.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># check if an object exists at the specified filepath</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">def</span> <span class="nf">save_exists</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.obj"</span><span class="p">)</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="c1"># return the pickled object saved in the specifed filepath</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="k">def</span> <span class="nf">load_obj</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.obj"</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">filehandler</span><span class="p">:</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filehandler</span><span class="p">)</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="c1"># return the webpage of fabacademy.org that includes every student's names from the specified year (and if this has already been downloaded and saved in a pickled object, load that instead of sending an HTTP request)</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="k">def</span> <span class="nf">get_people_soup</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-soup"</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>    <span class="k">if</span> <span class="n">save_exists</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>        <span class="k">return</span> <span class="n">load_obj</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>    <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://fabacademy.org/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/people.html"</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>    <span class="n">save_obj</span><span class="p">(</span><span class="s2">"people_saves"</span><span class="p">,</span> <span class="n">soup</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>    <span class="k">return</span> <span class="n">soup</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="c1"># formats a student's ID by accessing their name as detailed on the fabacademy.org students list, as well as the URL to their website</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="k">def</span> <span class="nf">repo_name_to_student_name</span><span class="p">(</span><span class="n">name_and_web_url_tup</span><span class="p">):</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>    <span class="n">name</span><span class="p">,</span> <span class="n">web_url</span> <span class="o">=</span> <span class="n">name_and_web_url_tup</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>    <span class="n">year</span> <span class="o">=</span> <span class="n">web_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>    <span class="n">href</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'/</span><span class="si">{</span><span class="s2">"/"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">web_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">3</span><span class="p">:])</span><span class="si">}</span><span class="s1">'</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>    <span class="n">people_soup</span> <span class="o">=</span> <span class="n">get_people_soup</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>    <span class="n">As</span> <span class="o">=</span> <span class="n">people_soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">As</span> <span class="k">if</span> <span class="n">_</span><span class="p">[</span><span class="s1">'href'</span><span class="p">]</span> <span class="o">==</span> <span class="n">href</span> <span class="ow">or</span> <span class="n">_</span><span class="p">[</span><span class="s1">'href'</span><span class="p">]</span> <span class="o">==</span> <span class="n">href</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># or to account for ending slash</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>    <span class="n">name_final</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>    <span class="k">return</span> <span class="n">name_final</span><span class="p">,</span> <span class="n">web_url</span>
</span></code></pre></div>
<p><em>resolve_name_conflicts.py</em></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kn">from</span> <span class="nn">main</span> <span class="kn">import</span> <span class="n">repo_name_to_student_name</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"final_data.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="n">STUDENTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="n">regexes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="n">normal_chars</span> <span class="o">=</span> <span class="s2">"abcdefghijklmnopqrstuvwxyz-"</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="c1"># convert a char from a character with an accent/dialectic into unicode</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="k">def</span> <span class="nf">accent_to_code</span><span class="p">(</span><span class="n">char</span><span class="p">):</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>    <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">),</span> <span class="s2">"#06x"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"0x"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">u"</span><span class="p">)</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="c1"># convert a char from unicode into a character with an accent/dialectic</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="k">def</span> <span class="nf">code_to_accent</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>    <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">u"</span><span class="p">,</span> <span class="s2">"0x"</span><span class="p">),</span> <span class="mi">16</span><span class="p">))</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="c1"># takes a name, converts it to a list of chars, then converts all characters with accents/dialectics to unicode</span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="k">def</span> <span class="nf">non_letters_into_codes</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>    <span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]</span>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)):</span>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>        <span class="n">char</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>        <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normal_chars</span><span class="p">:</span>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>            <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accent_to_code</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>    <span class="k">return</span> <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>
</span><span id="__span-32-30"><a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-32-31"><a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>    <span class="c1"># create a dictionary where keys are regexes of the student's previous names as standard text and as text where diacritics/accents are replaced with unicode, and values are the corrected names</span>
</span><span id="__span-32-32"><a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a>    <span class="k">for</span> <span class="n">student</span> <span class="ow">in</span> <span class="n">STUDENTS</span><span class="p">:</span>
</span><span id="__span-32-33"><a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a>        <span class="n">val</span> <span class="o">=</span> <span class="s2">";"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_name_to_student_name</span><span class="p">(</span><span class="n">student</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)))</span>
</span><span id="__span-32-34"><a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a>        <span class="n">regexes</span><span class="p">[</span><span class="n">student</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="__span-32-35"><a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a>        <span class="n">regexes</span><span class="p">[</span><span class="n">non_letters_into_codes</span><span class="p">(</span><span class="n">student</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">";"</span> <span class="o">+</span> <span class="n">student</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="__span-32-36"><a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a>
</span><span id="__span-32-37"><a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a>    <span class="c1"># run the regex on final_data.json (literally replace the text, don't load as an object)</span>
</span><span id="__span-32-38"><a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'final_data.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-32-39"><a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="__span-32-40"><a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">regexes</span><span class="p">:</span>
</span><span id="__span-32-41"><a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">regexes</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">content</span><span class="p">)</span>
</span><span id="__span-32-42"><a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a>
</span><span id="__span-32-43"><a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a>    <span class="c1"># store the corrected data</span>
</span><span id="__span-32-44"><a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'final_data_name_fixed.json'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span> <span class="c1"># encoding='utf-8' so that special characters in names can be written without UnicodeEncodeError</span>
</span><span id="__span-32-45"><a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a>        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="code-structure">Code Structure</h4>
<p>The JavaScript is spread out among several files, but is it centered around <code>app.js</code>. <code>app.js</code> loads the JSON data and initializes the visualization, setting up callbacks in other files to be run when the user interacts with the website. These callbacks are handled by <code>update_data.js</code> which has a three-part system for updating the visualization based off of user interactions. Read about <code>app.js</code> in detail <a href="#app-js">here</a>, and read about <code>update_data.js</code> in detail <a href="#update-data">here</a>.</p>
<p>The project directory is structured as follows:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>public
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>│   app.js
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>│   carousel.js
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>│   combined.js
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>│   constants.js
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>│   d3js_download.js
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>│   dial.js
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>│   final_data.json
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>│   force_boundary_download.js
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>│   helper_functions.js
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>│   index.html
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>│   jquery_download.js
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>│   lab_region.js
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>│   multiselect_dropdown.js
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>│   overlay_text.js
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>│   style.css
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>│   update_data.js
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>│   vars.js
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>│
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>└───img
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>    └───favicon
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a>        └───favicon.ico
</span></code></pre></div>
<h4 id="visualization-constants-and-global-variables">Visualization Constants and Global Variables</h4>
<p><code>constants.js</code> defines almost all of the constant variables, include color palletes, opacity levels, etc. I've compiled these into a separate file so that tweaking the visual appeal is consolidated to editing one file.</p>
<p><em>constants.js</em></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">NODE_STROKE_WIDTH_HIGHLIGHTED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1.5px"</span><span class="p">,</span><span class="w"> </span><span class="c1">// width of circle around node circle on hover</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="nx">HOVER_NODE_STROKE_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="c1">// color of circle around node circle on hover</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="nx">NOT_HOVERING_NODE_STROKE_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0px"</span><span class="p">,</span><span class="w"> </span><span class="c1">// width of circle around node circle when not hovering</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="nx">NOT_HOVERING_NODE_STROKE_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="c1">// color of circle around node circle when not hovering</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="nx">RGB_LINE_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0,0,0"</span><span class="p">,</span><span class="w"> </span><span class="c1">// color of edges</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">    </span><span class="nx">LINE_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.3px"</span><span class="p">,</span><span class="w"> </span><span class="c1">// width of edges</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="nx">CAROUSEL_RECT_STROKE_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="c1">// color of rectangular outline of each rectangle in the subject-area-selection carousel</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">    </span><span class="nx">CAROUSEL_RECT_STROKE_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0px"</span><span class="p">,</span><span class="w"> </span><span class="c1">// width of rectangular outline of each rectangle in the subject-area-selection carousel</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">    </span><span class="nx">CAROUSEL_SELECTOR_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="c1">// color of the rectangular path that displays which subject area you have selected</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">    </span><span class="nx">DIAL_OUTLINE_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey"</span><span class="p">,</span><span class="w"> </span><span class="c1">// color of the outline of the minimum times referenced dial</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">    </span><span class="nx">DIAL_TEXT_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="c1">// color of the text labeling the minimum times referenced dial</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">    </span><span class="nx">OVERLAY_TEXT_LINK_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#7e7eed"</span><span class="p">;</span><span class="w"> </span><span class="c1">// color of the links</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="c1">// all CSS customizable values not controlled through JS/D3JS are included as variables under :root in style.css</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="kd">const</span><span class="w"> </span><span class="nx">SCALE_FACTOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// factor that the strength of edges in the force-simulation are multiplied by (higher number = nodes are pulled closer together)</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">    </span><span class="nx">forceBoundaryMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">30</span><span class="p">;</span><span class="w"> </span><span class="c1">// margin along the defined edges of the force simulation </span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="kd">const</span><span class="w"> </span><span class="nx">minOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.15</span><span class="p">;</span><span class="w"> </span><span class="c1">// opacity of a node if the selected filters do not include the node</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="kd">const</span><span class="w"> </span><span class="nx">NODE_HIGHLIGHTED_OPACITY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// opacity of a node if the selected filters do include the node</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="kd">const</span><span class="w"> </span><span class="nx">MINIMUM_STRENGTH_CONSTANT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// lowest possible strength of edges (increasing this will linearly increase the strength of all edges in the graph)</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="c1">// colors of years-pie and subject-area-selection carousel</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="kd">const</span><span class="w"> </span><span class="nx">PIE_SLICE_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'grey'</span><span class="p">,</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="w">    </span><span class="nx">PIE_TEXT_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'white'</span><span class="p">,</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w">    </span><span class="nx">DIAL_STICK_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'grey'</span><span class="p">,</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">    </span><span class="nx">CAROUSEL_OPTION_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'grey'</span><span class="p">,</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">    </span><span class="nx">CAROUSEL_TEXT_COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'white'</span><span class="p">;</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="c1">// color pallete of Fab Academy</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="kd">const</span><span class="w"> </span><span class="nx">FAB_PALETTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="w">    </span><span class="s2">"#f1f2f2"</span><span class="p">,</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="w">    </span><span class="s2">"#f1d2f2"</span><span class="p">,</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="w">    </span><span class="s2">"#f1b2f2"</span><span class="p">,</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="w">    </span><span class="s2">"#f04260"</span><span class="p">,</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="w">    </span><span class="s2">"#4abfbd"</span><span class="p">,</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="w">    </span><span class="s2">"#284fb5"</span><span class="p">,</span>
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="w">    </span><span class="s2">"#f05c71"</span>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="p">];</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="c1">// color pallete of nodes by continent - encodes geographical data</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="kd">const</span><span class="w"> </span><span class="nx">NODE_REGION_PALETTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-44"><a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a><span class="w">    </span><span class="s2">"#1da619"</span><span class="p">,</span>
</span><span id="__span-34-45"><a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a><span class="w">    </span><span class="s2">"#f04260"</span><span class="p">,</span>
</span><span id="__span-34-46"><a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a><span class="w">    </span><span class="s2">"#4abfbd"</span><span class="p">,</span>
</span><span id="__span-34-47"><a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a><span class="w">    </span><span class="s2">"#284fb5"</span><span class="p">,</span>
</span><span id="__span-34-48"><a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a><span class="w">    </span><span class="s2">"#f05be1"</span><span class="p">,</span>
</span><span id="__span-34-49"><a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a><span class="w">    </span><span class="s2">"#87743d"</span>
</span><span id="__span-34-50"><a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a><span class="p">];</span>
</span><span id="__span-34-51"><a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a>
</span><span id="__span-34-52"><a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a><span class="c1">// list of continent names</span>
</span><span id="__span-34-53"><a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a><span class="kd">const</span><span class="w"> </span><span class="nx">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-54"><a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a><span class="w">    </span><span class="s2">"Africa"</span><span class="p">,</span>
</span><span id="__span-34-55"><a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a><span class="w">    </span><span class="s2">"Asia"</span><span class="p">,</span>
</span><span id="__span-34-56"><a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a><span class="w">    </span><span class="s2">"Europe"</span><span class="p">,</span>
</span><span id="__span-34-57"><a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a><span class="w">    </span><span class="s2">"North America"</span><span class="p">,</span>
</span><span id="__span-34-58"><a id="__codelineno-34-58" name="__codelineno-34-58" href="#__codelineno-34-58"></a><span class="w">    </span><span class="s2">"South America"</span><span class="p">,</span>
</span><span id="__span-34-59"><a id="__codelineno-34-59" name="__codelineno-34-59" href="#__codelineno-34-59"></a><span class="w">    </span><span class="s2">"Oceania"</span>
</span><span id="__span-34-60"><a id="__codelineno-34-60" name="__codelineno-34-60" href="#__codelineno-34-60"></a><span class="p">];</span>
</span><span id="__span-34-61"><a id="__codelineno-34-61" name="__codelineno-34-61" href="#__codelineno-34-61"></a>
</span><span id="__span-34-62"><a id="__codelineno-34-62" name="__codelineno-34-62" href="#__codelineno-34-62"></a><span class="c1">// zips the continent color pallete and list of continents above into an object</span>
</span><span id="__span-34-63"><a id="__codelineno-34-63" name="__codelineno-34-63" href="#__codelineno-34-63"></a><span class="kd">const</span><span class="w"> </span><span class="nx">continentColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-34-64"><a id="__codelineno-34-64" name="__codelineno-34-64" href="#__codelineno-34-64"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">NODE_REGION_PALETTE</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="nx">continentColor</span><span class="p">[</span><span class="nx">continent</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">NODE_REGION_PALETTE</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span id="__span-34-65"><a id="__codelineno-34-65" name="__codelineno-34-65" href="#__codelineno-34-65"></a>
</span><span id="__span-34-66"><a id="__codelineno-34-66" name="__codelineno-34-66" href="#__codelineno-34-66"></a><span class="c1">// node radius parameters</span>
</span><span id="__span-34-67"><a id="__codelineno-34-67" name="__codelineno-34-67" href="#__codelineno-34-67"></a><span class="kd">const</span><span class="w"> </span><span class="nx">NODE_SIZE_MULTIPLIER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">50</span><span class="p">;</span>
</span><span id="__span-34-68"><a id="__codelineno-34-68" name="__codelineno-34-68" href="#__codelineno-34-68"></a><span class="kd">const</span><span class="w"> </span><span class="nx">NODE_SIZE_MINIMUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
</span><span id="__span-34-69"><a id="__codelineno-34-69" name="__codelineno-34-69" href="#__codelineno-34-69"></a>
</span><span id="__span-34-70"><a id="__codelineno-34-70" name="__codelineno-34-70" href="#__codelineno-34-70"></a><span class="c1">// list of Fab Academy subject-areas</span>
</span><span id="__span-34-71"><a id="__codelineno-34-71" name="__codelineno-34-71" href="#__codelineno-34-71"></a><span class="kd">const</span><span class="w"> </span><span class="nx">TOPICS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-72"><a id="__codelineno-34-72" name="__codelineno-34-72" href="#__codelineno-34-72"></a><span class="w">    </span><span class="s2">"Prefab"</span><span class="p">,</span>
</span><span id="__span-34-73"><a id="__codelineno-34-73" name="__codelineno-34-73" href="#__codelineno-34-73"></a><span class="w">    </span><span class="s2">"Computer-Aided Design"</span><span class="p">,</span>
</span><span id="__span-34-74"><a id="__codelineno-34-74" name="__codelineno-34-74" href="#__codelineno-34-74"></a><span class="w">    </span><span class="s2">"Computer-Controlled Cutting"</span><span class="p">,</span>
</span><span id="__span-34-75"><a id="__codelineno-34-75" name="__codelineno-34-75" href="#__codelineno-34-75"></a><span class="w">    </span><span class="s2">"Embedded Programing"</span><span class="p">,</span>
</span><span id="__span-34-76"><a id="__codelineno-34-76" name="__codelineno-34-76" href="#__codelineno-34-76"></a><span class="w">    </span><span class="s2">"3D Scanning and Printing"</span><span class="p">,</span>
</span><span id="__span-34-77"><a id="__codelineno-34-77" name="__codelineno-34-77" href="#__codelineno-34-77"></a><span class="w">    </span><span class="s2">"Electronics Design"</span><span class="p">,</span>
</span><span id="__span-34-78"><a id="__codelineno-34-78" name="__codelineno-34-78" href="#__codelineno-34-78"></a><span class="w">    </span><span class="s2">"Computer-Controlled Machining"</span><span class="p">,</span>
</span><span id="__span-34-79"><a id="__codelineno-34-79" name="__codelineno-34-79" href="#__codelineno-34-79"></a><span class="w">    </span><span class="s2">"Electronics Production"</span><span class="p">,</span>
</span><span id="__span-34-80"><a id="__codelineno-34-80" name="__codelineno-34-80" href="#__codelineno-34-80"></a><span class="w">    </span><span class="s2">"Mechanical Design, Machine Design"</span><span class="p">,</span>
</span><span id="__span-34-81"><a id="__codelineno-34-81" name="__codelineno-34-81" href="#__codelineno-34-81"></a><span class="w">    </span><span class="s2">"Input Devices"</span><span class="p">,</span>
</span><span id="__span-34-82"><a id="__codelineno-34-82" name="__codelineno-34-82" href="#__codelineno-34-82"></a><span class="w">    </span><span class="s2">"Moulding and Casting"</span><span class="p">,</span>
</span><span id="__span-34-83"><a id="__codelineno-34-83" name="__codelineno-34-83" href="#__codelineno-34-83"></a><span class="w">    </span><span class="s2">"Output Devices"</span><span class="p">,</span>
</span><span id="__span-34-84"><a id="__codelineno-34-84" name="__codelineno-34-84" href="#__codelineno-34-84"></a><span class="w">    </span><span class="s2">"Embedded Networking and Communications"</span><span class="p">,</span>
</span><span id="__span-34-85"><a id="__codelineno-34-85" name="__codelineno-34-85" href="#__codelineno-34-85"></a><span class="w">    </span><span class="s2">"Interface and Application Programming"</span><span class="p">,</span>
</span><span id="__span-34-86"><a id="__codelineno-34-86" name="__codelineno-34-86" href="#__codelineno-34-86"></a><span class="w">    </span><span class="s2">"Wildcard Week"</span><span class="p">,</span>
</span><span id="__span-34-87"><a id="__codelineno-34-87" name="__codelineno-34-87" href="#__codelineno-34-87"></a><span class="w">    </span><span class="s2">"Applications and Implications"</span><span class="p">,</span>
</span><span id="__span-34-88"><a id="__codelineno-34-88" name="__codelineno-34-88" href="#__codelineno-34-88"></a><span class="w">    </span><span class="s2">"Invention, Intellectual Property and Business Models"</span><span class="p">,</span>
</span><span id="__span-34-89"><a id="__codelineno-34-89" name="__codelineno-34-89" href="#__codelineno-34-89"></a><span class="w">    </span><span class="s2">"Final Project"</span><span class="p">,</span>
</span><span id="__span-34-90"><a id="__codelineno-34-90" name="__codelineno-34-90" href="#__codelineno-34-90"></a><span class="w">    </span><span class="s2">"Other"</span>
</span><span id="__span-34-91"><a id="__codelineno-34-91" name="__codelineno-34-91" href="#__codelineno-34-91"></a><span class="p">]</span>
</span><span id="__span-34-92"><a id="__codelineno-34-92" name="__codelineno-34-92" href="#__codelineno-34-92"></a>
</span><span id="__span-34-93"><a id="__codelineno-34-93" name="__codelineno-34-93" href="#__codelineno-34-93"></a><span class="c1">// dictionary with keys of lab names and values of a list of the corresponding URL codes</span>
</span><span id="__span-34-94"><a id="__codelineno-34-94" name="__codelineno-34-94" href="#__codelineno-34-94"></a><span class="kd">const</span><span class="w"> </span><span class="nx">codesFromNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">"Talents"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"talents"</span><span class="p">],</span><span class="w"> </span><span class="s2">"AgriLab"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"agrilab"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Amsterdam"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabamsterdam"</span><span class="p">],</span><span class="w"> </span><span class="s2">"IED Madrid"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ied"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Bhutan"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"bhutan"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Sorbonne University"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabsorbonne"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sorbonne"</span><span class="p">],</span><span class="w"> </span><span class="s2">"ULB"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabulb"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ulb"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Leon"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablableon"</span><span class="p">,</span><span class="w"> </span><span class="s2">"leon"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Dilijan"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"dilijan"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Universitario CIDi"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cidi"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Vestmannaeyjar"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"falabvestmannaeyjar"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vestmannaeyjar"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Vancouver"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"vancouver"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Waag"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"waag"</span><span class="p">],</span><span class="w"> </span><span class="s2">"EnergyLab-Lomé"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"energylab"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Spinderihallerne"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabspinderihallerne"</span><span class="p">],</span><span class="w"> </span><span class="s2">"New Cairo"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"newcairo"</span><span class="p">],</span><span class="w"> </span><span class="s2">"EchoFab"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"echofab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabechofab"</span><span class="p">],</span><span class="w"> </span><span class="s2">"CEPT"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cept"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabcept"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Khairpur"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabkhairpur"</span><span class="p">,</span><span class="w"> </span><span class="s2">"khairpur"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Reykjavik"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabreykjavik"</span><span class="p">,</span><span class="w"> </span><span class="s2">"reykjavik"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Egypt"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"egypt"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabegypt"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Oulu"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablaboulu"</span><span class="p">,</span><span class="w"> </span><span class="s2">"oulu"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Berytech"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"berytech"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabberytech"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Bahrain"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"bahrain"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabbahrain"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Charlotte Latin"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"charlotte"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabcharlottelatin"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Santa Chiara"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabsiena"</span><span class="p">,</span><span class="w"> </span><span class="s2">"santachiara"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Digiscope"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"digiscope"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabdigiscope"</span><span class="p">],</span><span class="w"> </span><span class="s2">"BoldLab"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"seoul"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabseoul"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabseoulinnovation"</span><span class="p">,</span><span class="w"> </span><span class="s2">"boldseoul"</span><span class="p">,</span><span class="w"> </span><span class="s2">"seoulinnovation"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Beijing"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabbeijing"</span><span class="p">],</span><span class="w"> </span><span class="s2">"O Shanghai"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablaboshanghai"</span><span class="p">,</span><span class="w"> </span><span class="s2">"oshanghai"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Aalto"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"aalto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabaalto"</span><span class="p">],</span><span class="w"> </span><span class="s2">"La Machinerie"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"lamachinerie"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Dassault Systemes"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"dassault"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabdassault"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Kannai"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"kannai"</span><span class="p">],</span><span class="w"> </span><span class="s2">"ZOI"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabzoi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"zoi"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Irbid"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabirbid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"irbid"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Kamakura"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabkamakura"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kamakura"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Brighton"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"brighton"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabbrighton"</span><span class="p">],</span><span class="w"> </span><span class="s2">"AKGEC"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"akgec"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabakgec"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Opendot"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabopendot"</span><span class="p">,</span><span class="w"> </span><span class="s2">"opendot"</span><span class="p">],</span><span class="w"> </span><span class="s2">"EcoStudio"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ecostudio"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabecostudio"</span><span class="p">],</span><span class="w"> </span><span class="s2">"FCT"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fct"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabfct"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Bottrop"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"bottrop"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabbottrop"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Aachen"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"aachen"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabaachen"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Trivandrum"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabtrivandrum"</span><span class="p">,</span><span class="w"> </span><span class="s2">"trivandrum"</span><span class="p">],</span><span class="w"> </span><span class="s2">"UAE"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabuae"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uae"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Kochi"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabkochi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kochi"</span><span class="p">],</span><span class="w"> </span><span class="s2">"TechWorks Amman"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabtechworks"</span><span class="p">,</span><span class="w"> </span><span class="s2">"techworks"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Singapore"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"singapore"</span><span class="p">],</span><span class="w"> </span><span class="s2">"LazLab"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"lakazlab"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Vigyan Asharm"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabvigyanasharm"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vigyanashram"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Puebla"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabpuebla"</span><span class="p">,</span><span class="w"> </span><span class="s2">"puebla"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Wheaton"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"wheaton"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Ciudad Mexico"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ciudadmexico"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Barcelona"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"barcelona"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Incite Focus"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"incitefocus"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabincitefocus"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Santiago"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabsantiago"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Winam"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"winam"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Kamp-Lintfort"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabkamplintfort"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kamplintfort"</span><span class="p">],</span><span class="w"> </span><span class="s2">"TECSUP"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabtecsup"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tecsup"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tecsupaqp"</span><span class="p">],</span><span class="w"> </span><span class="s2">"QBIC"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"qbic"</span><span class="p">],</span><span class="w"> </span><span class="s2">"ESAN"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"esan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabesan"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Rwanda"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabrwanda"</span><span class="p">,</span><span class="w"> </span><span class="s2">"rwanda"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Lorain College"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablablccc"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lccc"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Bhubaneswar"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"bhubaneswar"</span><span class="p">],</span><span class="w"> </span><span class="s2">"SZOIL"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabszoil"</span><span class="p">,</span><span class="w"> </span><span class="s2">"szoil"</span><span class="p">],</span><span class="w"> </span><span class="s2">"UTEC"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabutec"</span><span class="p">,</span><span class="w"> </span><span class="s2">"utec"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Lima"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"lima"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Taipei"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"taipei"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Ucontinental"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ucontinental"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Akureyri"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"akureyri"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Algarve"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"algarve"</span><span class="p">,</span><span class="w"> </span><span class="s2">"farmlabalgarve"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Bangalore"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"bangalore"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Benfica"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"benfica"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Chaihuo"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"chaihuo"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Chandigarh"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"chandigarh"</span><span class="p">],</span><span class="w"> </span><span class="s2">"CIT"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cit"</span><span class="p">],</span><span class="w"> </span><span class="s2">"CPCC"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"cpcc"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Crunchlab"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"crunchlab"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Deusto"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"deusto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"falabdeusto"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Dhahran"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"dhahran"</span><span class="p">],</span><span class="w"> </span><span class="s2">"ECAE"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ecae"</span><span class="p">],</span><span class="w"> </span><span class="s2">"ESNE"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"esne"</span><span class="p">],</span><span class="w"> </span><span class="s2">"At3flo"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabat3flo"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Erfindergarden"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablaberfindergarden"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Facens"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabfacens"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Gearbox"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabgearbox"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Isafjorour"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabisafjorour"</span><span class="p">,</span><span class="w"> </span><span class="s2">"isafjorour"</span><span class="p">],</span><span class="w"> </span><span class="s2">"KromLaboro"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabkromlaboro"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Madrid CEU"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabmadridceu"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Odessa"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabodessa"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Tembisa"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabtembisa"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Wgtn"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabwgtn"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Yachay"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabyachay"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Yucatán"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabyucatan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"yucatan"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Formshop Shanghai"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"formshop"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Hong Kong iSPACE"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"hkispace"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Ingegno"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ingegno"</span><span class="p">],</span><span class="w"> </span><span class="s2">"INP-HB"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"inphb"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Insper"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"insper"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Ioannina"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ioannina"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Jubail"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"jubail"</span><span class="p">],</span><span class="w"> </span><span class="s2">"KAUST"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"kaust"</span><span class="p">],</span><span class="w"> </span><span class="s2">"KeoLAB"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"keolab"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Kitakagaya"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"kitakagaya"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Libya"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"libya"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Napoli"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"napoli"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Ningbo-NexMaker"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ningbo"</span><span class="p">],</span><span class="w"> </span><span class="s2">"PlusX"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"plusx"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Polytech"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"polytech"</span><span class="p">],</span><span class="w"> </span><span class="s2">"RIIDL"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"riidl"</span><span class="p">],</span><span class="w"> </span><span class="s2">"SEDI-Cup-ct"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"sedi"</span><span class="p">],</span><span class="w"> </span><span class="s2">"St. Jude"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"stjude"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Tianhe Lab"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"tianhelab"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Tinkerers"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"tinkerers"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Twarda"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"twarda"</span><span class="p">],</span><span class="w"> </span><span class="s2">"UCAL"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ucal"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Universidad Europea"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"uemadrid"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Ulima"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ulima"</span><span class="p">],</span><span class="w"> </span><span class="s2">"SOCOM"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"fablabsocom"</span><span class="p">],</span><span class="w"> </span><span class="s2">"Isafjordur"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"isafjordur"</span><span class="p">]};</span>
</span><span id="__span-34-95"><a id="__codelineno-34-95" name="__codelineno-34-95" href="#__codelineno-34-95"></a>
</span><span id="__span-34-96"><a id="__codelineno-34-96" name="__codelineno-34-96" href="#__codelineno-34-96"></a><span class="c1">// dictionary with keys of URL codes and values of a list of the corresponding lab names</span>
</span><span id="__span-34-97"><a id="__codelineno-34-97" name="__codelineno-34-97" href="#__codelineno-34-97"></a><span class="kd">const</span><span class="w"> </span><span class="nx">namesFromCodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">"talents"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Talents"</span><span class="p">,</span><span class="w"> </span><span class="s2">"agrilab"</span><span class="o">:</span><span class="w"> </span><span class="s2">"AgriLab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabamsterdam"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Amsterdam"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ied"</span><span class="o">:</span><span class="w"> </span><span class="s2">"IED Madrid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bhutan"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Bhutan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabsorbonne"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Sorbonne University"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sorbonne"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Sorbonne University"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabulb"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ULB"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ulb"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ULB"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablableon"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Leon"</span><span class="p">,</span><span class="w"> </span><span class="s2">"leon"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Leon"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dilijan"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Dilijan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cidi"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Universitario CIDi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"falabvestmannaeyjar"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Vestmannaeyjar"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vestmannaeyjar"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Vestmannaeyjar"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vancouver"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Vancouver"</span><span class="p">,</span><span class="w"> </span><span class="s2">"waag"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Waag"</span><span class="p">,</span><span class="w"> </span><span class="s2">"energylab"</span><span class="o">:</span><span class="w"> </span><span class="s2">"EnergyLab-Lomé"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabspinderihallerne"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Spinderihallerne"</span><span class="p">,</span><span class="w"> </span><span class="s2">"newcairo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"New Cairo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"echofab"</span><span class="o">:</span><span class="w"> </span><span class="s2">"EchoFab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabechofab"</span><span class="o">:</span><span class="w"> </span><span class="s2">"EchoFab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cept"</span><span class="o">:</span><span class="w"> </span><span class="s2">"CEPT"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabcept"</span><span class="o">:</span><span class="w"> </span><span class="s2">"CEPT"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabkhairpur"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Khairpur"</span><span class="p">,</span><span class="w"> </span><span class="s2">"khairpur"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Khairpur"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabreykjavik"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Reykjavik"</span><span class="p">,</span><span class="w"> </span><span class="s2">"reykjavik"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Reykjavik"</span><span class="p">,</span><span class="w"> </span><span class="s2">"egypt"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Egypt"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabegypt"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Egypt"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablaboulu"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oulu"</span><span class="p">,</span><span class="w"> </span><span class="s2">"oulu"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Oulu"</span><span class="p">,</span><span class="w"> </span><span class="s2">"berytech"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Berytech"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabberytech"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Berytech"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bahrain"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Bahrain"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabbahrain"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Bahrain"</span><span class="p">,</span><span class="w"> </span><span class="s2">"charlotte"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Charlotte Latin"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabcharlottelatin"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Charlotte Latin"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabsiena"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Santa Chiara"</span><span class="p">,</span><span class="w"> </span><span class="s2">"santachiara"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Santa Chiara"</span><span class="p">,</span><span class="w"> </span><span class="s2">"digiscope"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Digiscope"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabdigiscope"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Digiscope"</span><span class="p">,</span><span class="w"> </span><span class="s2">"seoul"</span><span class="o">:</span><span class="w"> </span><span class="s2">"BoldLab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabseoul"</span><span class="o">:</span><span class="w"> </span><span class="s2">"BoldLab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabseoulinnovation"</span><span class="o">:</span><span class="w"> </span><span class="s2">"BoldLab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"boldseoul"</span><span class="o">:</span><span class="w"> </span><span class="s2">"BoldLab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"seoulinnovation"</span><span class="o">:</span><span class="w"> </span><span class="s2">"BoldLab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabbeijing"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Beijing"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablaboshanghai"</span><span class="o">:</span><span class="w"> </span><span class="s2">"O Shanghai"</span><span class="p">,</span><span class="w"> </span><span class="s2">"oshanghai"</span><span class="o">:</span><span class="w"> </span><span class="s2">"O Shanghai"</span><span class="p">,</span><span class="w"> </span><span class="s2">"aalto"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Aalto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabaalto"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Aalto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lamachinerie"</span><span class="o">:</span><span class="w"> </span><span class="s2">"La Machinerie"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dassault"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Dassault Systemes"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabdassault"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Dassault Systemes"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kannai"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kannai"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabzoi"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ZOI"</span><span class="p">,</span><span class="w"> </span><span class="s2">"zoi"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ZOI"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabirbid"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Irbid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"irbid"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Irbid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabkamakura"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kamakura"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kamakura"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kamakura"</span><span class="p">,</span><span class="w"> </span><span class="s2">"brighton"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Brighton"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabbrighton"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Brighton"</span><span class="p">,</span><span class="w"> </span><span class="s2">"akgec"</span><span class="o">:</span><span class="w"> </span><span class="s2">"AKGEC"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabakgec"</span><span class="o">:</span><span class="w"> </span><span class="s2">"AKGEC"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabopendot"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Opendot"</span><span class="p">,</span><span class="w"> </span><span class="s2">"opendot"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Opendot"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ecostudio"</span><span class="o">:</span><span class="w"> </span><span class="s2">"EcoStudio"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabecostudio"</span><span class="o">:</span><span class="w"> </span><span class="s2">"EcoStudio"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fct"</span><span class="o">:</span><span class="w"> </span><span class="s2">"FCT"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabfct"</span><span class="o">:</span><span class="w"> </span><span class="s2">"FCT"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bottrop"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Bottrop"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabbottrop"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Bottrop"</span><span class="p">,</span><span class="w"> </span><span class="s2">"aachen"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Aachen"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabaachen"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Aachen"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabtrivandrum"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Trivandrum"</span><span class="p">,</span><span class="w"> </span><span class="s2">"trivandrum"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Trivandrum"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabuae"</span><span class="o">:</span><span class="w"> </span><span class="s2">"UAE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uae"</span><span class="o">:</span><span class="w"> </span><span class="s2">"UAE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabkochi"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kochi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kochi"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kochi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabtechworks"</span><span class="o">:</span><span class="w"> </span><span class="s2">"TechWorks Amman"</span><span class="p">,</span><span class="w"> </span><span class="s2">"techworks"</span><span class="o">:</span><span class="w"> </span><span class="s2">"TechWorks Amman"</span><span class="p">,</span><span class="w"> </span><span class="s2">"singapore"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Singapore"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lakazlab"</span><span class="o">:</span><span class="w"> </span><span class="s2">"LazLab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabvigyanasharm"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Vigyan Asharm"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vigyanashram"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Vigyan Asharm"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabpuebla"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Puebla"</span><span class="p">,</span><span class="w"> </span><span class="s2">"puebla"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Puebla"</span><span class="p">,</span><span class="w"> </span><span class="s2">"wheaton"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Wheaton"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ciudadmexico"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Ciudad Mexico"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabmexico"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Ciudad Mexico"</span><span class="p">,</span><span class="w"> </span><span class="s2">"barcelona"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Barcelona"</span><span class="p">,</span><span class="w"> </span><span class="s2">"incitefocus"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Incite Focus"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabincitefocus"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Incite Focus"</span><span class="p">,</span><span class="w"> </span><span class="s2">"winam"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Winam"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabkamplintfort"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kamp-Lintfort"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kamplintfort"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kamp-Lintfort"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabtecsup"</span><span class="o">:</span><span class="w"> </span><span class="s2">"TECSUP"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tecsup"</span><span class="o">:</span><span class="w"> </span><span class="s2">"TECSUP"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tecsupaqp"</span><span class="o">:</span><span class="w"> </span><span class="s2">"TECSUP"</span><span class="p">,</span><span class="w"> </span><span class="s2">"qbic"</span><span class="o">:</span><span class="w"> </span><span class="s2">"QBIC"</span><span class="p">,</span><span class="w"> </span><span class="s2">"esan"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ESAN"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabesan"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ESAN"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabrwanda"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Rwanda"</span><span class="p">,</span><span class="w"> </span><span class="s2">"rwanda"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Rwanda"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablablccc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Lorain College"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lccc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Lorain College"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bhubaneswar"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Bhubaneswar"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabszoil"</span><span class="o">:</span><span class="w"> </span><span class="s2">"SZOIL"</span><span class="p">,</span><span class="w"> </span><span class="s2">"szoil"</span><span class="o">:</span><span class="w"> </span><span class="s2">"SZOIL"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabutec"</span><span class="o">:</span><span class="w"> </span><span class="s2">"UTEC"</span><span class="p">,</span><span class="w"> </span><span class="s2">"utec"</span><span class="o">:</span><span class="w"> </span><span class="s2">"UTEC"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lima"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Lima"</span><span class="p">,</span><span class="w"> </span><span class="s2">"taipei"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Taipei"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ucontinental"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Ucontinental"</span><span class="p">,</span><span class="w"> </span><span class="s2">"akureyri"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Akureyri"</span><span class="p">,</span><span class="w"> </span><span class="s2">"algarve"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Algarve"</span><span class="p">,</span><span class="w"> </span><span class="s2">"farmlabalgarve"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Algarve"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bangalore"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Bangalore"</span><span class="p">,</span><span class="w"> </span><span class="s2">"benfica"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Benfica"</span><span class="p">,</span><span class="w"> </span><span class="s2">"chaihuo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Chaihuo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"chandigarh"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Chandigarh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cit"</span><span class="o">:</span><span class="w"> </span><span class="s2">"CIT"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cpcc"</span><span class="o">:</span><span class="w"> </span><span class="s2">"CPCC"</span><span class="p">,</span><span class="w"> </span><span class="s2">"crunchlab"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Crunchlab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"deusto"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Deusto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"falabdeusto"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Deusto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dhahran"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Dhahran"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ecae"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ECAE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"esne"</span><span class="o">:</span><span class="w"> </span><span class="s2">"ESNE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabat3flo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"At3flo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablaberfindergarden"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Erfindergarden"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabfacens"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Facens"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabgearbox"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Gearbox"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabisafjorour"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Isafjorour"</span><span class="p">,</span><span class="w"> </span><span class="s2">"isafjorour"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Isafjorour"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabkromlaboro"</span><span class="o">:</span><span class="w"> </span><span class="s2">"KromLaboro"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabmadridceu"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Madrid CEU"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabodessa"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Odessa"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabtembisa"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Tembisa"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabwgtn"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Wgtn"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabyachay"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Yachay"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabyucatan"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Yucatán"</span><span class="p">,</span><span class="w"> </span><span class="s2">"yucatan"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Yucatán"</span><span class="p">,</span><span class="w"> </span><span class="s2">"formshop"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Formshop Shanghai"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hkispace"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Hong Kong iSPACE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ingegno"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Ingegno"</span><span class="p">,</span><span class="w"> </span><span class="s2">"inphb"</span><span class="o">:</span><span class="w"> </span><span class="s2">"INP-HB"</span><span class="p">,</span><span class="w"> </span><span class="s2">"insper"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Insper"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ioannina"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Ioannina"</span><span class="p">,</span><span class="w"> </span><span class="s2">"jubail"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Jubail"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kaust"</span><span class="o">:</span><span class="w"> </span><span class="s2">"KAUST"</span><span class="p">,</span><span class="w"> </span><span class="s2">"keolab"</span><span class="o">:</span><span class="w"> </span><span class="s2">"KeoLAB"</span><span class="p">,</span><span class="w"> </span><span class="s2">"kitakagaya"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kitakagaya"</span><span class="p">,</span><span class="w"> </span><span class="s2">"libya"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Libya"</span><span class="p">,</span><span class="w"> </span><span class="s2">"napoli"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Napoli"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ningbo"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Ningbo-NexMaker"</span><span class="p">,</span><span class="w"> </span><span class="s2">"plusx"</span><span class="o">:</span><span class="w"> </span><span class="s2">"PlusX"</span><span class="p">,</span><span class="w"> </span><span class="s2">"polytech"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Polytech"</span><span class="p">,</span><span class="w"> </span><span class="s2">"riidl"</span><span class="o">:</span><span class="w"> </span><span class="s2">"RIIDL"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sedi"</span><span class="o">:</span><span class="w"> </span><span class="s2">"SEDI-Cup-ct"</span><span class="p">,</span><span class="w"> </span><span class="s2">"stjude"</span><span class="o">:</span><span class="w"> </span><span class="s2">"St. Jude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tianhelab"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Tianhe Lab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tinkerers"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Tinkerers"</span><span class="p">,</span><span class="w"> </span><span class="s2">"twarda"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Twarda"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ucal"</span><span class="o">:</span><span class="w"> </span><span class="s2">"UCAL"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uemadrid"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Universidad Europea"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ulima"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Ulima"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabsantiago"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Santiago"</span><span class="p">,</span><span class="w"> </span><span class="s2">"fablabsocom"</span><span class="o">:</span><span class="w"> </span><span class="s2">"SOCOM"</span><span class="p">,</span><span class="w"> </span><span class="s2">"isafjordur"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Isafjordur"</span><span class="p">};</span>
</span><span id="__span-34-98"><a id="__codelineno-34-98" name="__codelineno-34-98" href="#__codelineno-34-98"></a>
</span><span id="__span-34-99"><a id="__codelineno-34-99" name="__codelineno-34-99" href="#__codelineno-34-99"></a><span class="kd">const</span><span class="w"> </span><span class="nx">nonDiacriticLetters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"abcdefghijklmnopqrstuvwxyz"</span><span class="p">;</span>
</span><span id="__span-34-100"><a id="__codelineno-34-100" name="__codelineno-34-100" href="#__codelineno-34-100"></a>
</span><span id="__span-34-101"><a id="__codelineno-34-101" name="__codelineno-34-101" href="#__codelineno-34-101"></a><span class="c1">// simulation dimensions</span>
</span><span id="__span-34-102"><a id="__codelineno-34-102" name="__codelineno-34-102" href="#__codelineno-34-102"></a><span class="kd">const</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">928</span><span class="p">;</span>
</span><span id="__span-34-103"><a id="__codelineno-34-103" name="__codelineno-34-103" href="#__codelineno-34-103"></a><span class="kd">const</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">600</span><span class="p">;</span>
</span><span id="__span-34-104"><a id="__codelineno-34-104" name="__codelineno-34-104" href="#__codelineno-34-104"></a>
</span><span id="__span-34-105"><a id="__codelineno-34-105" name="__codelineno-34-105" href="#__codelineno-34-105"></a><span class="c1">// function to access zipped continent color pallete list</span>
</span><span id="__span-34-106"><a id="__codelineno-34-106" name="__codelineno-34-106" href="#__codelineno-34-106"></a><span class="kd">const</span><span class="w"> </span><span class="nx">colorRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-107"><a id="__codelineno-34-107" name="__codelineno-34-107" href="#__codelineno-34-107"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">continentColor</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
</span><span id="__span-34-108"><a id="__codelineno-34-108" name="__codelineno-34-108" href="#__codelineno-34-108"></a><span class="p">};</span>
</span><span id="__span-34-109"><a id="__codelineno-34-109" name="__codelineno-34-109" href="#__codelineno-34-109"></a>
</span><span id="__span-34-110"><a id="__codelineno-34-110" name="__codelineno-34-110" href="#__codelineno-34-110"></a><span class="c1">// D3JS scaleOrdinal to access color and node shape pallets</span>
</span><span id="__span-34-111"><a id="__codelineno-34-111" name="__codelineno-34-111" href="#__codelineno-34-111"></a><span class="kd">const</span><span class="w"> </span><span class="nx">colorFab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">scaleOrdinal</span><span class="p">().</span><span class="nx">range</span><span class="p">(</span><span class="nx">FAB_PALETTE</span><span class="p">);</span>
</span><span id="__span-34-112"><a id="__codelineno-34-112" name="__codelineno-34-112" href="#__codelineno-34-112"></a><span class="kd">const</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">scaleOrdinal</span><span class="p">().</span><span class="nx">range</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">symbols</span><span class="p">);</span>
</span><span id="__span-34-113"><a id="__codelineno-34-113" name="__codelineno-34-113" href="#__codelineno-34-113"></a>
</span><span id="__span-34-114"><a id="__codelineno-34-114" name="__codelineno-34-114" href="#__codelineno-34-114"></a><span class="c1">// define empty object that stores radiuses of each student/node based on their ID</span>
</span><span id="__span-34-115"><a id="__codelineno-34-115" name="__codelineno-34-115" href="#__codelineno-34-115"></a><span class="kd">const</span><span class="w"> </span><span class="nx">radius_dict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-34-116"><a id="__codelineno-34-116" name="__codelineno-34-116" href="#__codelineno-34-116"></a>
</span><span id="__span-34-117"><a id="__codelineno-34-117" name="__codelineno-34-117" href="#__codelineno-34-117"></a><span class="c1">// declare D3JS forceCollide</span>
</span><span id="__span-34-118"><a id="__codelineno-34-118" name="__codelineno-34-118" href="#__codelineno-34-118"></a><span class="kd">const</span><span class="w"> </span><span class="nx">forceCollide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceCollide</span><span class="p">();</span>
</span><span id="__span-34-119"><a id="__codelineno-34-119" name="__codelineno-34-119" href="#__codelineno-34-119"></a>
</span><span id="__span-34-120"><a id="__codelineno-34-120" name="__codelineno-34-120" href="#__codelineno-34-120"></a><span class="c1">// coordinates and radius of year-select pie</span>
</span><span id="__span-34-121"><a id="__codelineno-34-121" name="__codelineno-34-121" href="#__codelineno-34-121"></a><span class="kd">const</span><span class="w"> </span><span class="nx">pieX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">210</span><span class="p">,</span>
</span><span id="__span-34-122"><a id="__codelineno-34-122" name="__codelineno-34-122" href="#__codelineno-34-122"></a><span class="w">    </span><span class="nx">pieY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">720</span><span class="p">;</span>
</span><span id="__span-34-123"><a id="__codelineno-34-123" name="__codelineno-34-123" href="#__codelineno-34-123"></a><span class="kd">const</span><span class="w"> </span><span class="nx">pieRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>
</span><span id="__span-34-124"><a id="__codelineno-34-124" name="__codelineno-34-124" href="#__codelineno-34-124"></a>
</span><span id="__span-34-125"><a id="__codelineno-34-125" name="__codelineno-34-125" href="#__codelineno-34-125"></a><span class="c1">// list of subject-area carousel options</span>
</span><span id="__span-34-126"><a id="__codelineno-34-126" name="__codelineno-34-126" href="#__codelineno-34-126"></a><span class="kd">const</span><span class="w"> </span><span class="nx">topicCarouselList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"All"</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">TOPICS</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)];</span>
</span></code></pre></div>
<p>I initialized all of the global mutable variables that needed to be accessed by multiple code in multiple files in <code>vars.js</code>.</p>
<p><em>vars.js</em></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">minMaxMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">    </span><span class="nx">numLinksDict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="nx">links_not_filtered</span><span class="p">,</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="nx">nodes_not_filtered</span><span class="p">,</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="nx">nodes</span><span class="p">,</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="nx">node_ids</span><span class="p">,</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">    </span><span class="nx">links</span><span class="p">,</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">    </span><span class="nx">currentLabHighlightList</span><span class="p">,</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">    </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"All"</span><span class="p">,</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="nx">maxStrength</span><span class="p">,</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="nx">labs</span><span class="p">,</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">    </span><span class="nx">simulation</span><span class="p">,</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">    </span><span class="nx">svg</span><span class="p">,</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">    </span><span class="nx">link</span><span class="p">,</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">    </span><span class="nx">node</span><span class="p">,</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="w">    </span><span class="nx">defs</span><span class="p">,</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">    </span><span class="nx">pieG</span><span class="p">,</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">    </span><span class="nx">minNumConnections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span><span class="p">,</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="w">    </span><span class="nx">g</span><span class="p">,</span><span class="w"> </span><span class="nx">gl</span><span class="p">,</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">    </span><span class="nx">referenceCache</span><span class="p">,</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">    </span><span class="nx">currentTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"All"</span><span class="p">,</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="w">    </span><span class="nx">mapMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// Start of the output range</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="w">    </span><span class="nx">mapMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60</span><span class="p">,</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="w">    </span><span class="nx">startDegree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">135</span><span class="p">,</span><span class="w"> </span><span class="c1">// Start of the dial in degrees</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="w">    </span><span class="nx">endDegree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">135</span><span class="p">,</span><span class="w"> </span><span class="c1">// End of the dial in degrees</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="w">    </span><span class="nx">startPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">48</span><span class="p">,</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="w">    </span><span class="nx">currentDialDeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">startPos</span><span class="p">,</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a><span class="w">    </span><span class="nx">numText</span><span class="p">,</span>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="w">    </span><span class="nx">dialGroup</span><span class="p">,</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a><span class="w">    </span><span class="nx">mousePos</span><span class="p">,</span>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a><span class="w">    </span><span class="nx">linearGradient</span><span class="p">,</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a><span class="w">    </span><span class="nx">gl_</span><span class="p">,</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a><span class="w">    </span><span class="nx">linearGradientDict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a><span class="w">    </span><span class="nx">Tooltip</span><span class="p">,</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a><span class="w">    </span><span class="nx">transformation</span><span class="p">,</span>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a><span class="w">    </span><span class="nx">svgPoint</span><span class="p">,</span>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a><span class="w">    </span><span class="nx">boundingRect</span><span class="p">,</span>
</span><span id="__span-35-38"><a id="__codelineno-35-38" name="__codelineno-35-38" href="#__codelineno-35-38"></a><span class="w">    </span><span class="nx">mouseIsDragging</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-35-39"><a id="__codelineno-35-39" name="__codelineno-35-39" href="#__codelineno-35-39"></a><span class="w">    </span><span class="nx">body</span><span class="p">,</span>
</span><span id="__span-35-40"><a id="__codelineno-35-40" name="__codelineno-35-40" href="#__codelineno-35-40"></a><span class="w">    </span><span class="nx">tooltipFlippedX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="c1">// Track whether tooltip is flipped horizontally</span>
</span><span id="__span-35-41"><a id="__codelineno-35-41" name="__codelineno-35-41" href="#__codelineno-35-41"></a><span class="w">    </span><span class="nx">tooltipFlippedY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-35-42"><a id="__codelineno-35-42" name="__codelineno-35-42" href="#__codelineno-35-42"></a><span class="w">    </span><span class="nx">mouseIsOver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-35-43"><a id="__codelineno-35-43" name="__codelineno-35-43" href="#__codelineno-35-43"></a><span class="w">    </span><span class="nx">objectBeingDragged</span><span class="p">;</span><span class="w"> </span><span class="c1">// Track whether tooltip is flipped vertically; </span>
</span></code></pre></div>
<p>Additionally, <code>lab_region.js</code> includes the mapping of every Fab Lab globally to their continent. This was originally generating using ChatGPT 4.0 and checked manually. It was stunningly accurate outside of a typo on <code>fablabsiena</code>. I also had to go back and add a color to the color pallete for <code>Oceania</code> where <code>fablabwgtn</code> is located.</p>
<p><em>lab_region.js</em></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">// mapping dictionary generated by ChatGPT 4.0</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="nx">LABS_CONTINENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="s2">"vigyanashram"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">    </span><span class="s2">"oulu"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Finland</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">    </span><span class="s2">"kamplintfort"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Germany</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">    </span><span class="s2">"charlotte"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="s2">"lccc"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span><span class="s2">"bahrain"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Bahrain</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="s2">"uae"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// United Arab Emirates</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="w">    </span><span class="s2">"libya"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Libya</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">    </span><span class="s2">"techworks"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">    </span><span class="s2">"newcairo"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Egypt</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">    </span><span class="s2">"egypt"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Egypt</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">    </span><span class="s2">"lakazlab"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Mauritius (Assumed)</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">    </span><span class="s2">"tecsup"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">    </span><span class="s2">"wheaton"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">    </span><span class="s2">"fablabuae"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// United Arab Emirates</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">    </span><span class="s2">"qbic"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Qatar (Assumed)</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">    </span><span class="s2">"kochi"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="w">    </span><span class="s2">"ied"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Italy (Assumed)</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="w">    </span><span class="s2">"fablabtrivandrum"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="w">    </span><span class="s2">"fablabakgec"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="w">    </span><span class="s2">"barcelona"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spain</span>
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a><span class="w">    </span><span class="s2">"fablabsorbonne"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// France</span>
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a><span class="w">    </span><span class="s2">"fablabcept"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a><span class="w">    </span><span class="s2">"rwanda"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Rwanda</span>
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a><span class="w">    </span><span class="s2">"leon"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spain (Assumed)</span>
</span><span id="__span-36-28"><a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a><span class="w">    </span><span class="s2">"lamachinerie"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// France (Assumed)</span>
</span><span id="__span-36-29"><a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a><span class="w">    </span><span class="s2">"fablabdigiscope"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// France (Assumed)</span>
</span><span id="__span-36-30"><a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a><span class="w">    </span><span class="s2">"energylab"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Denmark (Assumed)</span>
</span><span id="__span-36-31"><a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a><span class="w">    </span><span class="s2">"akgec"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-32"><a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a><span class="w">    </span><span class="s2">"irbid"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Jordan</span>
</span><span id="__span-36-33"><a id="__codelineno-36-33" name="__codelineno-36-33" href="#__codelineno-36-33"></a><span class="w">    </span><span class="s2">"reykjavik"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Iceland</span>
</span><span id="__span-36-34"><a id="__codelineno-36-34" name="__codelineno-36-34" href="#__codelineno-36-34"></a><span class="w">    </span><span class="s2">"sorbonne"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// France</span>
</span><span id="__span-36-35"><a id="__codelineno-36-35" name="__codelineno-36-35" href="#__codelineno-36-35"></a><span class="w">    </span><span class="s2">"incitefocus"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-36"><a id="__codelineno-36-36" name="__codelineno-36-36" href="#__codelineno-36-36"></a><span class="w">    </span><span class="s2">"puebla"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Mexico</span>
</span><span id="__span-36-37"><a id="__codelineno-36-37" name="__codelineno-36-37" href="#__codelineno-36-37"></a><span class="w">    </span><span class="s2">"tecsupaqp"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-38"><a id="__codelineno-36-38" name="__codelineno-36-38" href="#__codelineno-36-38"></a><span class="w">    </span><span class="s2">"ucontinental"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-39"><a id="__codelineno-36-39" name="__codelineno-36-39" href="#__codelineno-36-39"></a><span class="w">    </span><span class="s2">"fablabopendot"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Italy</span>
</span><span id="__span-36-40"><a id="__codelineno-36-40" name="__codelineno-36-40" href="#__codelineno-36-40"></a><span class="w">    </span><span class="s2">"santachiara"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Italy</span>
</span><span id="__span-36-41"><a id="__codelineno-36-41" name="__codelineno-36-41" href="#__codelineno-36-41"></a><span class="w">    </span><span class="s2">"fablabechofab"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Canada</span>
</span><span id="__span-36-42"><a id="__codelineno-36-42" name="__codelineno-36-42" href="#__codelineno-36-42"></a><span class="w">    </span><span class="s2">"zoi"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China (Assumed)</span>
</span><span id="__span-36-43"><a id="__codelineno-36-43" name="__codelineno-36-43" href="#__codelineno-36-43"></a><span class="w">    </span><span class="s2">"cidi"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-44"><a id="__codelineno-36-44" name="__codelineno-36-44" href="#__codelineno-36-44"></a><span class="w">    </span><span class="s2">"dassault"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// France (Assumed)</span>
</span><span id="__span-36-45"><a id="__codelineno-36-45" name="__codelineno-36-45" href="#__codelineno-36-45"></a><span class="w">    </span><span class="s2">"stjude"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-46"><a id="__codelineno-36-46" name="__codelineno-36-46" href="#__codelineno-36-46"></a><span class="w">    </span><span class="s2">"aalto"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Finland</span>
</span><span id="__span-36-47"><a id="__codelineno-36-47" name="__codelineno-36-47" href="#__codelineno-36-47"></a><span class="w">    </span><span class="s2">"fablabzoi"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China (Assumed)</span>
</span><span id="__span-36-48"><a id="__codelineno-36-48" name="__codelineno-36-48" href="#__codelineno-36-48"></a><span class="w">    </span><span class="s2">"ecae"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// United Arab Emirates</span>
</span><span id="__span-36-49"><a id="__codelineno-36-49" name="__codelineno-36-49" href="#__codelineno-36-49"></a><span class="w">    </span><span class="s2">"fablabbahrain"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Bahrain</span>
</span><span id="__span-36-50"><a id="__codelineno-36-50" name="__codelineno-36-50" href="#__codelineno-36-50"></a><span class="w">    </span><span class="s2">"khairpur"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Pakistan</span>
</span><span id="__span-36-51"><a id="__codelineno-36-51" name="__codelineno-36-51" href="#__codelineno-36-51"></a><span class="w">    </span><span class="s2">"insper"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Brazil</span>
</span><span id="__span-36-52"><a id="__codelineno-36-52" name="__codelineno-36-52" href="#__codelineno-36-52"></a><span class="w">    </span><span class="s2">"trivandrum"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-53"><a id="__codelineno-36-53" name="__codelineno-36-53" href="#__codelineno-36-53"></a><span class="w">    </span><span class="s2">"inphb"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Ivory Coast</span>
</span><span id="__span-36-54"><a id="__codelineno-36-54" name="__codelineno-36-54" href="#__codelineno-36-54"></a><span class="w">    </span><span class="s2">"digiscope"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// France (Assumed)</span>
</span><span id="__span-36-55"><a id="__codelineno-36-55" name="__codelineno-36-55" href="#__codelineno-36-55"></a><span class="w">    </span><span class="s2">"ulb"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Belgium (Assumed)</span>
</span><span id="__span-36-56"><a id="__codelineno-36-56" name="__codelineno-36-56" href="#__codelineno-36-56"></a><span class="w">    </span><span class="s2">"lima"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-57"><a id="__codelineno-36-57" name="__codelineno-36-57" href="#__codelineno-36-57"></a><span class="w">    </span><span class="s2">"fablabspinderihallerne"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Denmark</span>
</span><span id="__span-36-58"><a id="__codelineno-36-58" name="__codelineno-36-58" href="#__codelineno-36-58"></a><span class="w">    </span><span class="s2">"fablabfct"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Portugal (Assumed)</span>
</span><span id="__span-36-59"><a id="__codelineno-36-59" name="__codelineno-36-59" href="#__codelineno-36-59"></a><span class="w">    </span><span class="s2">"fct"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Nigeria (Assumed)</span>
</span><span id="__span-36-60"><a id="__codelineno-36-60" name="__codelineno-36-60" href="#__codelineno-36-60"></a><span class="w">    </span><span class="s2">"opendot"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Italy</span>
</span><span id="__span-36-61"><a id="__codelineno-36-61" name="__codelineno-36-61" href="#__codelineno-36-61"></a><span class="w">    </span><span class="s2">"fablabtecsup"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-62"><a id="__codelineno-36-62" name="__codelineno-36-62" href="#__codelineno-36-62"></a><span class="w">    </span><span class="s2">"vancouver"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Canada</span>
</span><span id="__span-36-63"><a id="__codelineno-36-63" name="__codelineno-36-63" href="#__codelineno-36-63"></a><span class="w">    </span><span class="s2">"fablabbrighton"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// UK</span>
</span><span id="__span-36-64"><a id="__codelineno-36-64" name="__codelineno-36-64" href="#__codelineno-36-64"></a><span class="w">    </span><span class="s2">"akureyri"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Iceland</span>
</span><span id="__span-36-65"><a id="__codelineno-36-65" name="__codelineno-36-65" href="#__codelineno-36-65"></a><span class="w">    </span><span class="s2">"yucatan"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Mexico</span>
</span><span id="__span-36-66"><a id="__codelineno-36-66" name="__codelineno-36-66" href="#__codelineno-36-66"></a><span class="w">    </span><span class="s2">"bhutan"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Bhutan</span>
</span><span id="__span-36-67"><a id="__codelineno-36-67" name="__codelineno-36-67" href="#__codelineno-36-67"></a><span class="w">    </span><span class="s2">"fablabaachen"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Germany</span>
</span><span id="__span-36-68"><a id="__codelineno-36-68" name="__codelineno-36-68" href="#__codelineno-36-68"></a><span class="w">    </span><span class="s2">"waag"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Netherlands</span>
</span><span id="__span-36-69"><a id="__codelineno-36-69" name="__codelineno-36-69" href="#__codelineno-36-69"></a><span class="w">    </span><span class="s2">"echofab"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Canada</span>
</span><span id="__span-36-70"><a id="__codelineno-36-70" name="__codelineno-36-70" href="#__codelineno-36-70"></a><span class="w">    </span><span class="s2">"dilijan"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Armenia</span>
</span><span id="__span-36-71"><a id="__codelineno-36-71" name="__codelineno-36-71" href="#__codelineno-36-71"></a><span class="w">    </span><span class="s2">"polytech"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// France (Assumed)</span>
</span><span id="__span-36-72"><a id="__codelineno-36-72" name="__codelineno-36-72" href="#__codelineno-36-72"></a><span class="w">    </span><span class="s2">"agrilab"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Armenia</span>
</span><span id="__span-36-73"><a id="__codelineno-36-73" name="__codelineno-36-73" href="#__codelineno-36-73"></a><span class="w">    </span><span class="s2">"fablabsiena"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Italy -- ChatGPT changed "fablabsiena" to "siena" -- corrected by hand</span>
</span><span id="__span-36-74"><a id="__codelineno-36-74" name="__codelineno-36-74" href="#__codelineno-36-74"></a><span class="w">    </span><span class="s2">"winam"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Kenya (Assumed)</span>
</span><span id="__span-36-75"><a id="__codelineno-36-75" name="__codelineno-36-75" href="#__codelineno-36-75"></a><span class="w">    </span><span class="s2">"fablaboulu"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Finland</span>
</span><span id="__span-36-76"><a id="__codelineno-36-76" name="__codelineno-36-76" href="#__codelineno-36-76"></a><span class="w">    </span><span class="s2">"fablabreykjavik"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Iceland</span>
</span><span id="__span-36-77"><a id="__codelineno-36-77" name="__codelineno-36-77" href="#__codelineno-36-77"></a><span class="w">    </span><span class="s2">"kamakura"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Japan</span>
</span><span id="__span-36-78"><a id="__codelineno-36-78" name="__codelineno-36-78" href="#__codelineno-36-78"></a><span class="w">    </span><span class="s2">"falabvestmannaeyjar"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Iceland</span>
</span><span id="__span-36-79"><a id="__codelineno-36-79" name="__codelineno-36-79" href="#__codelineno-36-79"></a><span class="w">    </span><span class="s2">"singapore"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Singapore</span>
</span><span id="__span-36-80"><a id="__codelineno-36-80" name="__codelineno-36-80" href="#__codelineno-36-80"></a><span class="w">    </span><span class="s2">"oshanghai"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China</span>
</span><span id="__span-36-81"><a id="__codelineno-36-81" name="__codelineno-36-81" href="#__codelineno-36-81"></a><span class="w">    </span><span class="s2">"fablaboshanghai"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China</span>
</span><span id="__span-36-82"><a id="__codelineno-36-82" name="__codelineno-36-82" href="#__codelineno-36-82"></a><span class="w">    </span><span class="s2">"fablabutec"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-83"><a id="__codelineno-36-83" name="__codelineno-36-83" href="#__codelineno-36-83"></a><span class="w">    </span><span class="s2">"fablabodessa"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Ukraine</span>
</span><span id="__span-36-84"><a id="__codelineno-36-84" name="__codelineno-36-84" href="#__codelineno-36-84"></a><span class="w">    </span><span class="s2">"esan"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-85"><a id="__codelineno-36-85" name="__codelineno-36-85" href="#__codelineno-36-85"></a><span class="w">    </span><span class="s2">"fablabvigyanasharm"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-86"><a id="__codelineno-36-86" name="__codelineno-36-86" href="#__codelineno-36-86"></a><span class="w">    </span><span class="s2">"hkispace"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Hong Kong</span>
</span><span id="__span-36-87"><a id="__codelineno-36-87" name="__codelineno-36-87" href="#__codelineno-36-87"></a><span class="w">    </span><span class="s2">"taipei"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Taiwan</span>
</span><span id="__span-36-88"><a id="__codelineno-36-88" name="__codelineno-36-88" href="#__codelineno-36-88"></a><span class="w">    </span><span class="s2">"fablabmexico"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Mexico</span>
</span><span id="__span-36-89"><a id="__codelineno-36-89" name="__codelineno-36-89" href="#__codelineno-36-89"></a><span class="w">    </span><span class="s2">"ciudadmexico"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Mexico</span>
</span><span id="__span-36-90"><a id="__codelineno-36-90" name="__codelineno-36-90" href="#__codelineno-36-90"></a><span class="w">    </span><span class="s2">"aachen"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Germany</span>
</span><span id="__span-36-91"><a id="__codelineno-36-91" name="__codelineno-36-91" href="#__codelineno-36-91"></a><span class="w">    </span><span class="s2">"fablabbottrop"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Germany</span>
</span><span id="__span-36-92"><a id="__codelineno-36-92" name="__codelineno-36-92" href="#__codelineno-36-92"></a><span class="w">    </span><span class="s2">"fablabaalto"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Finland</span>
</span><span id="__span-36-93"><a id="__codelineno-36-93" name="__codelineno-36-93" href="#__codelineno-36-93"></a><span class="w">    </span><span class="s2">"keolab"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Japan (Assumed)</span>
</span><span id="__span-36-94"><a id="__codelineno-36-94" name="__codelineno-36-94" href="#__codelineno-36-94"></a><span class="w">    </span><span class="s2">"cpcc"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-95"><a id="__codelineno-36-95" name="__codelineno-36-95" href="#__codelineno-36-95"></a><span class="w">    </span><span class="s2">"fablabkamplintfort"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Germany</span>
</span><span id="__span-36-96"><a id="__codelineno-36-96" name="__codelineno-36-96" href="#__codelineno-36-96"></a><span class="w">    </span><span class="s2">"ingegno"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Italy (Assumed)</span>
</span><span id="__span-36-97"><a id="__codelineno-36-97" name="__codelineno-36-97" href="#__codelineno-36-97"></a><span class="w">    </span><span class="s2">"fablabkamakura"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Japan</span>
</span><span id="__span-36-98"><a id="__codelineno-36-98" name="__codelineno-36-98" href="#__codelineno-36-98"></a><span class="w">    </span><span class="s2">"tinkerers"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// United Arab Emirates (Assumed)</span>
</span><span id="__span-36-99"><a id="__codelineno-36-99" name="__codelineno-36-99" href="#__codelineno-36-99"></a><span class="w">    </span><span class="s2">"cit"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Ireland (Assumed)</span>
</span><span id="__span-36-100"><a id="__codelineno-36-100" name="__codelineno-36-100" href="#__codelineno-36-100"></a><span class="w">    </span><span class="s2">"utec"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-101"><a id="__codelineno-36-101" name="__codelineno-36-101" href="#__codelineno-36-101"></a><span class="w">    </span><span class="s2">"fablabamsterdam"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Netherlands</span>
</span><span id="__span-36-102"><a id="__codelineno-36-102" name="__codelineno-36-102" href="#__codelineno-36-102"></a><span class="w">    </span><span class="s2">"tianhelab"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China (Assumed)</span>
</span><span id="__span-36-103"><a id="__codelineno-36-103" name="__codelineno-36-103" href="#__codelineno-36-103"></a><span class="w">    </span><span class="s2">"bhubaneswar"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-104"><a id="__codelineno-36-104" name="__codelineno-36-104" href="#__codelineno-36-104"></a><span class="w">    </span><span class="s2">"cept"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-105"><a id="__codelineno-36-105" name="__codelineno-36-105" href="#__codelineno-36-105"></a><span class="w">    </span><span class="s2">"fablabbeijing"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China</span>
</span><span id="__span-36-106"><a id="__codelineno-36-106" name="__codelineno-36-106" href="#__codelineno-36-106"></a><span class="w">    </span><span class="s2">"talents"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Germany (Assumed)</span>
</span><span id="__span-36-107"><a id="__codelineno-36-107" name="__codelineno-36-107" href="#__codelineno-36-107"></a><span class="w">    </span><span class="s2">"fablabyachay"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Ecuador</span>
</span><span id="__span-36-108"><a id="__codelineno-36-108" name="__codelineno-36-108" href="#__codelineno-36-108"></a><span class="w">    </span><span class="s2">"fablabdassault"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// France (Assumed)</span>
</span><span id="__span-36-109"><a id="__codelineno-36-109" name="__codelineno-36-109" href="#__codelineno-36-109"></a><span class="w">    </span><span class="s2">"ecostudio"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-110"><a id="__codelineno-36-110" name="__codelineno-36-110" href="#__codelineno-36-110"></a><span class="w">    </span><span class="s2">"fablabseoul"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// South Korea</span>
</span><span id="__span-36-111"><a id="__codelineno-36-111" name="__codelineno-36-111" href="#__codelineno-36-111"></a><span class="w">    </span><span class="s2">"kaust"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Saudi Arabia</span>
</span><span id="__span-36-112"><a id="__codelineno-36-112" name="__codelineno-36-112" href="#__codelineno-36-112"></a><span class="w">    </span><span class="s2">"berytech"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Lebanon</span>
</span><span id="__span-36-113"><a id="__codelineno-36-113" name="__codelineno-36-113" href="#__codelineno-36-113"></a><span class="w">    </span><span class="s2">"fablabpuebla"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Mexico</span>
</span><span id="__span-36-114"><a id="__codelineno-36-114" name="__codelineno-36-114" href="#__codelineno-36-114"></a><span class="w">    </span><span class="s2">"fablabrwanda"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Rwanda</span>
</span><span id="__span-36-115"><a id="__codelineno-36-115" name="__codelineno-36-115" href="#__codelineno-36-115"></a><span class="w">    </span><span class="s2">"fablabesan"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-116"><a id="__codelineno-36-116" name="__codelineno-36-116" href="#__codelineno-36-116"></a><span class="w">    </span><span class="s2">"fablabberytech"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Lebanon</span>
</span><span id="__span-36-117"><a id="__codelineno-36-117" name="__codelineno-36-117" href="#__codelineno-36-117"></a><span class="w">    </span><span class="s2">"crunchlab"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Portugal (Assumed)</span>
</span><span id="__span-36-118"><a id="__codelineno-36-118" name="__codelineno-36-118" href="#__codelineno-36-118"></a><span class="w">    </span><span class="s2">"ucal"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-119"><a id="__codelineno-36-119" name="__codelineno-36-119" href="#__codelineno-36-119"></a><span class="w">    </span><span class="s2">"vestmannaeyjar"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Iceland</span>
</span><span id="__span-36-120"><a id="__codelineno-36-120" name="__codelineno-36-120" href="#__codelineno-36-120"></a><span class="w">    </span><span class="s2">"sedi"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Italy (Assumed)</span>
</span><span id="__span-36-121"><a id="__codelineno-36-121" name="__codelineno-36-121" href="#__codelineno-36-121"></a><span class="w">    </span><span class="s2">"isafjordur"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Iceland</span>
</span><span id="__span-36-122"><a id="__codelineno-36-122" name="__codelineno-36-122" href="#__codelineno-36-122"></a><span class="w">    </span><span class="s2">"fablabegypt"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Egypt</span>
</span><span id="__span-36-123"><a id="__codelineno-36-123" name="__codelineno-36-123" href="#__codelineno-36-123"></a><span class="w">    </span><span class="s2">"szoil"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China</span>
</span><span id="__span-36-124"><a id="__codelineno-36-124" name="__codelineno-36-124" href="#__codelineno-36-124"></a><span class="w">    </span><span class="s2">"formshop"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China (Assumed)</span>
</span><span id="__span-36-125"><a id="__codelineno-36-125" name="__codelineno-36-125" href="#__codelineno-36-125"></a><span class="w">    </span><span class="s2">"fablabkochi"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-126"><a id="__codelineno-36-126" name="__codelineno-36-126" href="#__codelineno-36-126"></a><span class="w">    </span><span class="s2">"fablabincitefocus"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-127"><a id="__codelineno-36-127" name="__codelineno-36-127" href="#__codelineno-36-127"></a><span class="w">    </span><span class="s2">"kitakagaya"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Japan</span>
</span><span id="__span-36-128"><a id="__codelineno-36-128" name="__codelineno-36-128" href="#__codelineno-36-128"></a><span class="w">    </span><span class="s2">"kannai"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Japan</span>
</span><span id="__span-36-129"><a id="__codelineno-36-129" name="__codelineno-36-129" href="#__codelineno-36-129"></a><span class="w">    </span><span class="s2">"dhahran"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Saudi Arabia</span>
</span><span id="__span-36-130"><a id="__codelineno-36-130" name="__codelineno-36-130" href="#__codelineno-36-130"></a><span class="w">    </span><span class="s2">"seoulinnovation"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// South Korea</span>
</span><span id="__span-36-131"><a id="__codelineno-36-131" name="__codelineno-36-131" href="#__codelineno-36-131"></a><span class="w">    </span><span class="s2">"ioannina"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Greece</span>
</span><span id="__span-36-132"><a id="__codelineno-36-132" name="__codelineno-36-132" href="#__codelineno-36-132"></a><span class="w">    </span><span class="s2">"fablabyucatan"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Mexico</span>
</span><span id="__span-36-133"><a id="__codelineno-36-133" name="__codelineno-36-133" href="#__codelineno-36-133"></a><span class="w">    </span><span class="s2">"fablabirbid"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Jordan</span>
</span><span id="__span-36-134"><a id="__codelineno-36-134" name="__codelineno-36-134" href="#__codelineno-36-134"></a><span class="w">    </span><span class="s2">"deusto"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spain</span>
</span><span id="__span-36-135"><a id="__codelineno-36-135" name="__codelineno-36-135" href="#__codelineno-36-135"></a><span class="w">    </span><span class="s2">"falabdeusto"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spain</span>
</span><span id="__span-36-136"><a id="__codelineno-36-136" name="__codelineno-36-136" href="#__codelineno-36-136"></a><span class="w">    </span><span class="s2">"riidl"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-137"><a id="__codelineno-36-137" name="__codelineno-36-137" href="#__codelineno-36-137"></a><span class="w">    </span><span class="s2">"bottrop"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Germany</span>
</span><span id="__span-36-138"><a id="__codelineno-36-138" name="__codelineno-36-138" href="#__codelineno-36-138"></a><span class="w">    </span><span class="s2">"fablabisafjorour"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Iceland</span>
</span><span id="__span-36-139"><a id="__codelineno-36-139" name="__codelineno-36-139" href="#__codelineno-36-139"></a><span class="w">    </span><span class="s2">"plusx"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// South Korea (Assumed)</span>
</span><span id="__span-36-140"><a id="__codelineno-36-140" name="__codelineno-36-140" href="#__codelineno-36-140"></a><span class="w">    </span><span class="s2">"fablaberfindergarden"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Germany (Assumed)</span>
</span><span id="__span-36-141"><a id="__codelineno-36-141" name="__codelineno-36-141" href="#__codelineno-36-141"></a><span class="w">    </span><span class="s2">"uemadrid"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spain</span>
</span><span id="__span-36-142"><a id="__codelineno-36-142" name="__codelineno-36-142" href="#__codelineno-36-142"></a><span class="w">    </span><span class="s2">"fablabtembisa"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// South Africa</span>
</span><span id="__span-36-143"><a id="__codelineno-36-143" name="__codelineno-36-143" href="#__codelineno-36-143"></a><span class="w">    </span><span class="s2">"brighton"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// UK</span>
</span><span id="__span-36-144"><a id="__codelineno-36-144" name="__codelineno-36-144" href="#__codelineno-36-144"></a><span class="w">    </span><span class="s2">"fablabfacens"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Brazil</span>
</span><span id="__span-36-145"><a id="__codelineno-36-145" name="__codelineno-36-145" href="#__codelineno-36-145"></a><span class="w">    </span><span class="s2">"fablableon"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spain (Assumed)</span>
</span><span id="__span-36-146"><a id="__codelineno-36-146" name="__codelineno-36-146" href="#__codelineno-36-146"></a><span class="w">    </span><span class="s2">"fablabszoil"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China</span>
</span><span id="__span-36-147"><a id="__codelineno-36-147" name="__codelineno-36-147" href="#__codelineno-36-147"></a><span class="w">    </span><span class="s2">"fablabgearbox"</span><span class="o">:</span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Kenya (Assumed)</span>
</span><span id="__span-36-148"><a id="__codelineno-36-148" name="__codelineno-36-148" href="#__codelineno-36-148"></a><span class="w">    </span><span class="s2">"farmlabalgarve"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Portugal</span>
</span><span id="__span-36-149"><a id="__codelineno-36-149" name="__codelineno-36-149" href="#__codelineno-36-149"></a><span class="w">    </span><span class="s2">"algarve"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Portugal</span>
</span><span id="__span-36-150"><a id="__codelineno-36-150" name="__codelineno-36-150" href="#__codelineno-36-150"></a><span class="w">    </span><span class="s2">"twarda"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Poland (Assumed)</span>
</span><span id="__span-36-151"><a id="__codelineno-36-151" name="__codelineno-36-151" href="#__codelineno-36-151"></a><span class="w">    </span><span class="s2">"bangalore"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-152"><a id="__codelineno-36-152" name="__codelineno-36-152" href="#__codelineno-36-152"></a><span class="w">    </span><span class="s2">"fablabsantiago"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Chile</span>
</span><span id="__span-36-153"><a id="__codelineno-36-153" name="__codelineno-36-153" href="#__codelineno-36-153"></a><span class="w">    </span><span class="s2">"fablablccc"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-154"><a id="__codelineno-36-154" name="__codelineno-36-154" href="#__codelineno-36-154"></a><span class="w">    </span><span class="s2">"fablabcharlottelatin"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA</span>
</span><span id="__span-36-155"><a id="__codelineno-36-155" name="__codelineno-36-155" href="#__codelineno-36-155"></a><span class="w">    </span><span class="s2">"fablabat3flo"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Hungary (Assumed)</span>
</span><span id="__span-36-156"><a id="__codelineno-36-156" name="__codelineno-36-156" href="#__codelineno-36-156"></a><span class="w">    </span><span class="s2">"fablabecostudio"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-157"><a id="__codelineno-36-157" name="__codelineno-36-157" href="#__codelineno-36-157"></a><span class="w">    </span><span class="s2">"fablabsocom"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China (Assumed)</span>
</span><span id="__span-36-158"><a id="__codelineno-36-158" name="__codelineno-36-158" href="#__codelineno-36-158"></a><span class="w">    </span><span class="s2">"boldseoul"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// South Korea</span>
</span><span id="__span-36-159"><a id="__codelineno-36-159" name="__codelineno-36-159" href="#__codelineno-36-159"></a><span class="w">    </span><span class="s2">"napoli"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Italy</span>
</span><span id="__span-36-160"><a id="__codelineno-36-160" name="__codelineno-36-160" href="#__codelineno-36-160"></a><span class="w">    </span><span class="s2">"fablabkromlaboro"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Slovenia (Assumed)</span>
</span><span id="__span-36-161"><a id="__codelineno-36-161" name="__codelineno-36-161" href="#__codelineno-36-161"></a><span class="w">    </span><span class="s2">"seoul"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// South Korea</span>
</span><span id="__span-36-162"><a id="__codelineno-36-162" name="__codelineno-36-162" href="#__codelineno-36-162"></a><span class="w">    </span><span class="s2">"fablabtechworks"</span><span class="o">:</span><span class="s2">"North America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// USA (Assumed)</span>
</span><span id="__span-36-163"><a id="__codelineno-36-163" name="__codelineno-36-163" href="#__codelineno-36-163"></a><span class="w">    </span><span class="s2">"fablabkhairpur"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Pakistan</span>
</span><span id="__span-36-164"><a id="__codelineno-36-164" name="__codelineno-36-164" href="#__codelineno-36-164"></a><span class="w">    </span><span class="s2">"chaihuo"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China (Assumed)</span>
</span><span id="__span-36-165"><a id="__codelineno-36-165" name="__codelineno-36-165" href="#__codelineno-36-165"></a><span class="w">    </span><span class="s2">"fablabulb"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Belgium (Assumed)</span>
</span><span id="__span-36-166"><a id="__codelineno-36-166" name="__codelineno-36-166" href="#__codelineno-36-166"></a><span class="w">    </span><span class="s2">"esne"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spain (Assumed)</span>
</span><span id="__span-36-167"><a id="__codelineno-36-167" name="__codelineno-36-167" href="#__codelineno-36-167"></a><span class="w">    </span><span class="s2">"ulima"</span><span class="o">:</span><span class="s2">"South America"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Peru</span>
</span><span id="__span-36-168"><a id="__codelineno-36-168" name="__codelineno-36-168" href="#__codelineno-36-168"></a><span class="w">    </span><span class="s2">"fablabseoulinnovation"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// South Korea</span>
</span><span id="__span-36-169"><a id="__codelineno-36-169" name="__codelineno-36-169" href="#__codelineno-36-169"></a><span class="w">    </span><span class="s2">"benfica"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Portugal (Assumed)</span>
</span><span id="__span-36-170"><a id="__codelineno-36-170" name="__codelineno-36-170" href="#__codelineno-36-170"></a><span class="w">    </span><span class="s2">"fablabmadridceu"</span><span class="o">:</span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spain</span>
</span><span id="__span-36-171"><a id="__codelineno-36-171" name="__codelineno-36-171" href="#__codelineno-36-171"></a><span class="w">    </span><span class="s2">"chandigarh"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// India</span>
</span><span id="__span-36-172"><a id="__codelineno-36-172" name="__codelineno-36-172" href="#__codelineno-36-172"></a><span class="w">    </span><span class="s2">"jubail"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// Saudi Arabia</span>
</span><span id="__span-36-173"><a id="__codelineno-36-173" name="__codelineno-36-173" href="#__codelineno-36-173"></a><span class="w">    </span><span class="s2">"ningbo"</span><span class="o">:</span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="c1">// China</span>
</span><span id="__span-36-174"><a id="__codelineno-36-174" name="__codelineno-36-174" href="#__codelineno-36-174"></a><span class="w">    </span><span class="s2">"fablabwgtn"</span><span class="o">:</span><span class="s2">"Oceania"</span><span class="p">,</span><span class="w"> </span><span class="c1">// New Zealand</span>
</span><span id="__span-36-175"><a id="__codelineno-36-175" name="__codelineno-36-175" href="#__codelineno-36-175"></a><span class="p">};</span>
</span></code></pre></div>
<h4 id="app-js">App JS</h4>
<p><code>app.js</code> has three purposes: </p>
<ul>
<li>initialize hover tooltip</li>
<li>load JSON network data</li>
<li>initialize simulation and filters</li>
</ul>
<p>The code is broken up into blocks with explanations:</p>
<p><em>app.js - tooltip</em></p>
<p>A tooltip appears when a node is hovered over by the mouse to display information about a student.</p>
<p><img alt="Tooltip" src="../../assets/images/stem/expert-network-map/tooltip.jpg"></p>
<p>When the window loads, select the <code>div</code> with an id of <code>tooltip</code>. Whenever the mouse moves, store the new position in the <code>mousePos</code> object. It then calculates the dimensions and coordinates of a tooltip.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1">// run when page loads</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">    </span><span class="nx">Tooltip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#tooltip"</span><span class="p">);</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'body'</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'pointermove'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">        </span><span class="nx">mousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">            </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">            </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">tooltipWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Tooltip</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">offsetWidth</span><span class="p">;</span><span class="w"> </span><span class="c1">// Width of the tooltip</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">tooltipHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Tooltip</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">offsetHeight</span><span class="p">;</span><span class="w"> </span><span class="c1">// Height of the tooltip</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">windowWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">;</span><span class="w"> </span><span class="c1">// Width of the window</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">windowHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span><span class="w"> </span><span class="c1">// Height of the window</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">50</span><span class="p">;</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a><span class="w">        </span><span class="c1">// Consider a buffer to ensure that </span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a><span class="w">        </span><span class="c1">// the tooltip doesn't touch the edge of the viewport.</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a><span class="w">            </span><span class="s2">"x"</span><span class="o">:</span><span class="w"> </span><span class="mf">50</span><span class="p">,</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a><span class="w">            </span><span class="s2">"y"</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span>
</span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a><span class="w">        </span><span class="c1">// If the tooltip would go off the right side of the screen</span>
</span><span id="__span-37-28"><a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tooltipWidth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">buffer</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">windowWidth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-29"><a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a><span class="w">            </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tooltipWidth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
</span><span id="__span-37-30"><a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-37-31"><a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a>
</span><span id="__span-37-32"><a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a><span class="w">        </span><span class="c1">// If the tooltip would go off the bottom of the screen</span>
</span><span id="__span-37-33"><a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tooltipHeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">buffer</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">windowHeight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-34"><a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a><span class="w">            </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">tooltipHeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
</span><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-37-36"><a id="__codelineno-37-36" name="__codelineno-37-36" href="#__codelineno-37-36"></a>
</span><span id="__span-37-37"><a id="__codelineno-37-37" name="__codelineno-37-37" href="#__codelineno-37-37"></a><span class="w">        </span><span class="nx">Tooltip</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"left"</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"px"</span><span class="p">);</span>
</span><span id="__span-37-38"><a id="__codelineno-37-38" name="__codelineno-37-38" href="#__codelineno-37-38"></a><span class="w">        </span><span class="nx">Tooltip</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"top"</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"px"</span><span class="p">);</span>
</span><span id="__span-37-39"><a id="__codelineno-37-39" name="__codelineno-37-39" href="#__codelineno-37-39"></a><span class="w">    </span><span class="p">});</span>
</span></code></pre></div>
<p><em>app.js - load data</em></p>
<p>This section of the code loads data from <code>final_data.json</code>, precalculates data-intensive metrics that are used later in the visualization (largest and fewest number of times referenced for each subject area, dictionaries of edges with keys of students, all lab names, and strongest edge), and initializes the data arrays for the default settings (all labs, all subject areas, minimum of 20 times referenced).</p>
<p>See all of the function definitions in <a href="#helper-functions"><code>helper_functions.js</code></a> below, except for <code>updateData</code> which is defined in <a href="#update-data"><code>update_data.js</code></a>, <code>initializeLabMultiselect</code> which is defined in <a href="#lab-filter"><code>multiselect_dropdown.js</code></a>, <code>initializeDial</code> which is defined in <a href="#minimum-times-referenced-dial"><code>dial.js</code></a>, and <code>initializeCarousel</code> which is defined in <a href="#subject-area-carousel"><code>carousel.js</code></a>.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="w">    </span><span class="c1">// load the json data and filter out all references by students to themselves</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">    </span><span class="nx">create_not_filteredFromJSON</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">        </span><span class="c1">// store the most and least amount of references for a student in each subject area</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">        </span><span class="nx">calculateMinMaxMapFromFiltered</span><span class="p">();</span><span class="w"> </span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">        </span><span class="c1">// go through all of the data and create an dictionary where you can look up a student and their subject area and recieve the number of times they were referenced in that subject area</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">        </span><span class="nx">createReferenceCache</span><span class="p">();</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">        </span><span class="c1">// create a dictionary of each time a student referenced another student for a certain topic</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">        </span><span class="nx">createNumLinksDictFrom_not_filtered</span><span class="p">(</span><span class="nx">nodes_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">links_not_filtered</span><span class="p">);</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="w">        </span><span class="c1">// stores each student's lab (using their website URL) and removes all repeats</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">        </span><span class="nx">setLabs</span><span class="p">(</span><span class="nx">nodes_not_filtered</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">        </span><span class="c1">// stores all of the nodes and edges who meet the default filter criteria into the main `nodes`, `node_ids`, and `links` arrays</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="w">        </span><span class="nx">transferNot_filteredToArrays</span><span class="p">();</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">        </span><span class="c1">// stores the strongest edge between nodes</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">        </span><span class="nx">calculateMaxStrength</span><span class="p">();</span>
</span></code></pre></div>
<p><em>app.js - initialize simulation and filters</em></p>
<p>This section initializes the filters (subject area, labs, years, and minimum number of times referenced) and the visualization (SVG elements and linear gradients for edges when only one node is highlighted).</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="w">        </span><span class="c1">// make the lab filter display the default option</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">        </span><span class="nx">setCurrentLabHighlightList</span><span class="p">();</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">        </span><span class="c1">// initialize the force graph simulation</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">        </span><span class="nx">createSimulation</span><span class="p">();</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">        </span><span class="c1">// initialize the HTML elements that the SVGs of the visualization</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">        </span><span class="nx">createAndFormatSVG</span><span class="p">();</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">        </span><span class="c1">// initialize linear gradients</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">        </span><span class="nx">initializeDefs</span><span class="p">();</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">        </span><span class="c1">// create the container SVG element for the graph</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">        </span><span class="nx">gl_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate(150, -10)"</span><span class="p">);</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">        </span><span class="c1">// pair the linear gradient SVGs to all of the references, not only the selected ones, so that elements aren't created in real-time as filters are changed. (Doesn't take into account that some edges will never have a linear gradient)</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">        </span><span class="nx">registerLinearGradients</span><span class="p">(</span><span class="nx">links_not_filtered</span><span class="p">);</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">        </span><span class="c1">// create SVG container for all of the nodes</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="w">        </span><span class="nx">nodesToNodeAndFormat</span><span class="p">();</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="w">        </span><span class="c1">// initialize year-select pie</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a><span class="w">        </span><span class="nx">createPie</span><span class="p">();</span>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">        </span><span class="c1">// create overlay text and links, such as link to documentation, mattermost channel, etc</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">        </span><span class="nx">createOverlayText</span><span class="p">();</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="w">        </span><span class="c1">// update the graph to display network on the SVG</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="w">        </span><span class="nx">updateData</span><span class="p">({</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a><span class="w">            </span><span class="nx">minNumConnections</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="p">,</span>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="w">            </span><span class="nx">simulation</span><span class="p">,</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a><span class="w">            </span><span class="nx">svg</span><span class="p">,</span>
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="w">            </span><span class="nx">g</span><span class="p">,</span>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="w">            </span><span class="s2">"gl"</span><span class="o">:</span><span class="w"> </span><span class="nx">gl_</span>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a><span class="w">        </span><span class="c1">// initialize subject-area-selection carousel</span>
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="w">        </span><span class="nx">initializeCarousel</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// anonymous function defines behavior on carousel update</span>
</span><span id="__span-39-39"><a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="w">            </span><span class="nx">currentTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
</span><span id="__span-39-40"><a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentTopic</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-41"><a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="w">                </span><span class="nx">mapMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">minMaxMap</span><span class="p">[</span><span class="nx">currentTopic</span><span class="p">].</span><span class="nx">min</span><span class="p">;</span>
</span><span id="__span-39-42"><a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a><span class="w">                </span><span class="nx">mapMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">minMaxMap</span><span class="p">[</span><span class="nx">currentTopic</span><span class="p">].</span><span class="nx">max</span><span class="p">;</span>
</span><span id="__span-39-43"><a id="__codelineno-39-43" name="__codelineno-39-43" href="#__codelineno-39-43"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-44"><a id="__codelineno-39-44" name="__codelineno-39-44" href="#__codelineno-39-44"></a><span class="w">                </span><span class="p">[</span><span class="nx">mapMin</span><span class="p">,</span><span class="w"> </span><span class="nx">mapMax</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">60</span><span class="p">];</span>
</span><span id="__span-39-45"><a id="__codelineno-39-45" name="__codelineno-39-45" href="#__codelineno-39-45"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-39-46"><a id="__codelineno-39-46" name="__codelineno-39-46" href="#__codelineno-39-46"></a><span class="w">            </span><span class="nx">updateDialText</span><span class="p">(</span><span class="nx">currentDialDeg</span><span class="p">,</span><span class="w"> </span><span class="nx">dialCallback</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-39-47"><a id="__codelineno-39-47" name="__codelineno-39-47" href="#__codelineno-39-47"></a><span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="nx">topicCarouselList</span><span class="p">,</span><span class="w"> </span><span class="mf">350</span><span class="p">,</span><span class="w"> </span><span class="mf">600</span><span class="p">,</span><span class="w"> </span><span class="mf">30</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">svg</span><span class="p">,</span><span class="w"> </span><span class="nx">FAB_PALETTE</span><span class="p">);</span>
</span><span id="__span-39-48"><a id="__codelineno-39-48" name="__codelineno-39-48" href="#__codelineno-39-48"></a>
</span><span id="__span-39-49"><a id="__codelineno-39-49" name="__codelineno-39-49" href="#__codelineno-39-49"></a><span class="w">        </span><span class="c1">// defines callback function for lab filter being altered </span>
</span><span id="__span-39-50"><a id="__codelineno-39-50" name="__codelineno-39-50" href="#__codelineno-39-50"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">labCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lab_list</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-51"><a id="__codelineno-39-51" name="__codelineno-39-51" href="#__codelineno-39-51"></a><span class="w">            </span><span class="nx">currentLabHighlightList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lab_list</span><span class="p">;</span>
</span><span id="__span-39-52"><a id="__codelineno-39-52" name="__codelineno-39-52" href="#__codelineno-39-52"></a><span class="w">            </span><span class="nx">updateData</span><span class="p">({</span><span class="w"> </span><span class="c1">// updates visualization with new filters</span>
</span><span id="__span-39-53"><a id="__codelineno-39-53" name="__codelineno-39-53" href="#__codelineno-39-53"></a><span class="w">                </span><span class="nx">minNumConnections</span><span class="p">,</span>
</span><span id="__span-39-54"><a id="__codelineno-39-54" name="__codelineno-39-54" href="#__codelineno-39-54"></a><span class="w">                </span><span class="nx">simulation</span><span class="p">,</span>
</span><span id="__span-39-55"><a id="__codelineno-39-55" name="__codelineno-39-55" href="#__codelineno-39-55"></a><span class="w">                </span><span class="nx">svg</span><span class="p">,</span>
</span><span id="__span-39-56"><a id="__codelineno-39-56" name="__codelineno-39-56" href="#__codelineno-39-56"></a><span class="w">                </span><span class="nx">g</span><span class="p">,</span>
</span><span id="__span-39-57"><a id="__codelineno-39-57" name="__codelineno-39-57" href="#__codelineno-39-57"></a><span class="w">                </span><span class="s2">"gl"</span><span class="o">:</span><span class="w"> </span><span class="nx">gl_</span>
</span><span id="__span-39-58"><a id="__codelineno-39-58" name="__codelineno-39-58" href="#__codelineno-39-58"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-39-59"><a id="__codelineno-39-59" name="__codelineno-39-59" href="#__codelineno-39-59"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-39-60"><a id="__codelineno-39-60" name="__codelineno-39-60" href="#__codelineno-39-60"></a>
</span><span id="__span-39-61"><a id="__codelineno-39-61" name="__codelineno-39-61" href="#__codelineno-39-61"></a><span class="w">        </span><span class="c1">// defines callback function for minimum number of times referenced filter being altered</span>
</span><span id="__span-39-62"><a id="__codelineno-39-62" name="__codelineno-39-62" href="#__codelineno-39-62"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">dialCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">roundedVal</span><span class="p">,</span><span class="w"> </span><span class="nx">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-63"><a id="__codelineno-39-63" name="__codelineno-39-63" href="#__codelineno-39-63"></a><span class="w">            </span><span class="nx">minNumConnections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">roundedVal</span><span class="p">;</span>
</span><span id="__span-39-64"><a id="__codelineno-39-64" name="__codelineno-39-64" href="#__codelineno-39-64"></a><span class="w">            </span><span class="nx">updateData</span><span class="p">({</span><span class="w"> </span><span class="c1">// updates visualization wth new filters</span>
</span><span id="__span-39-65"><a id="__codelineno-39-65" name="__codelineno-39-65" href="#__codelineno-39-65"></a><span class="w">                </span><span class="s2">"minNumConnections"</span><span class="o">:</span><span class="w"> </span><span class="nx">roundedVal</span><span class="p">,</span>
</span><span id="__span-39-66"><a id="__codelineno-39-66" name="__codelineno-39-66" href="#__codelineno-39-66"></a><span class="w">                </span><span class="nx">simulation</span><span class="p">,</span>
</span><span id="__span-39-67"><a id="__codelineno-39-67" name="__codelineno-39-67" href="#__codelineno-39-67"></a><span class="w">                </span><span class="nx">svg</span><span class="p">,</span>
</span><span id="__span-39-68"><a id="__codelineno-39-68" name="__codelineno-39-68" href="#__codelineno-39-68"></a><span class="w">                </span><span class="nx">g</span><span class="p">,</span>
</span><span id="__span-39-69"><a id="__codelineno-39-69" name="__codelineno-39-69" href="#__codelineno-39-69"></a><span class="w">                </span><span class="s2">"gl"</span><span class="o">:</span><span class="w"> </span><span class="nx">gl_</span><span class="p">,</span>
</span><span id="__span-39-70"><a id="__codelineno-39-70" name="__codelineno-39-70" href="#__codelineno-39-70"></a><span class="w">                </span><span class="s2">"isFirst"</span><span class="o">:</span><span class="w"> </span><span class="nx">first</span>
</span><span id="__span-39-71"><a id="__codelineno-39-71" name="__codelineno-39-71" href="#__codelineno-39-71"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-39-72"><a id="__codelineno-39-72" name="__codelineno-39-72" href="#__codelineno-39-72"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-39-73"><a id="__codelineno-39-73" name="__codelineno-39-73" href="#__codelineno-39-73"></a>
</span><span id="__span-39-74"><a id="__codelineno-39-74" name="__codelineno-39-74" href="#__codelineno-39-74"></a><span class="w">        </span><span class="c1">// initializes minimum number of times referenced dial</span>
</span><span id="__span-39-75"><a id="__codelineno-39-75" name="__codelineno-39-75" href="#__codelineno-39-75"></a><span class="w">        </span><span class="nx">initializeDial</span><span class="p">(</span><span class="nx">svg</span><span class="p">,</span><span class="w"> </span><span class="nx">dialCallback</span><span class="p">);</span>
</span><span id="__span-39-76"><a id="__codelineno-39-76" name="__codelineno-39-76" href="#__codelineno-39-76"></a>
</span><span id="__span-39-77"><a id="__codelineno-39-77" name="__codelineno-39-77" href="#__codelineno-39-77"></a><span class="w">        </span><span class="c1">// initialize lab multiselect dropdown functionalityW</span>
</span><span id="__span-39-78"><a id="__codelineno-39-78" name="__codelineno-39-78" href="#__codelineno-39-78"></a><span class="w">        </span><span class="nx">initializeLabMultiselect</span><span class="p">(</span><span class="nx">labs</span><span class="p">,</span><span class="w"> </span><span class="nx">labCallback</span><span class="p">);</span>
</span><span id="__span-39-79"><a id="__codelineno-39-79" name="__codelineno-39-79" href="#__codelineno-39-79"></a>
</span><span id="__span-39-80"><a id="__codelineno-39-80" name="__codelineno-39-80" href="#__codelineno-39-80"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-39-81"><a id="__codelineno-39-81" name="__codelineno-39-81" href="#__codelineno-39-81"></a><span class="p">};</span>
</span></code></pre></div>
<h4 id="helper-functions">Helper Functions</h4>
<p><code>helper_functions.js</code> defines many functions used in other JavaScript files, including simulation initialization and data loading and processing. All of the functions are explained in the documentation or comments where they are called.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">clamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="p">),</span><span class="w"> </span><span class="nx">max</span><span class="p">);</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">toTitleCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">        </span><span class="sr">/\w\S*/g</span><span class="p">,</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">        </span><span class="kd">function</span><span class="p">(</span><span class="nx">txt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">txt</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">txt</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="p">};</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="kd">function</span><span class="w"> </span><span class="nx">normalize</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">min</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nx">max</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">min</span><span class="p">);</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="p">}</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="kd">const</span><span class="w"> </span><span class="nx">calculateMinMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">ns</span><span class="p">,</span><span class="w"> </span><span class="nx">ls</span><span class="p">,</span><span class="w"> </span><span class="nx">topic</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">minV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Infinity</span><span class="p">;</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">maxV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="kc">Infinity</span><span class="p">;</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="w">    </span><span class="nx">ns</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="w">        </span><span class="nx">ls</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="w">                </span><span class="nx">v</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-40-24"><a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-40-25"><a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-40-26"><a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">minV</span><span class="p">)</span><span class="w"> </span><span class="nx">minV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">;</span>
</span><span id="__span-40-27"><a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxV</span><span class="p">)</span><span class="w"> </span><span class="nx">maxV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">v</span><span class="p">;</span>
</span><span id="__span-40-28"><a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-29"><a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-30"><a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a><span class="w">        </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="nx">minV</span><span class="p">,</span>
</span><span id="__span-40-31"><a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a><span class="w">        </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="nx">maxV</span>
</span><span id="__span-40-32"><a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-40-33"><a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a><span class="p">};</span>
</span><span id="__span-40-34"><a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a>
</span><span id="__span-40-35"><a id="__codelineno-40-35" name="__codelineno-40-35" href="#__codelineno-40-35"></a><span class="kd">const</span><span class="w"> </span><span class="nx">sumObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-40-36"><a id="__codelineno-40-36" name="__codelineno-40-36" href="#__codelineno-40-36"></a>
</span><span id="__span-40-37"><a id="__codelineno-40-37" name="__codelineno-40-37" href="#__codelineno-40-37"></a><span class="kd">const</span><span class="w"> </span><span class="nx">getAllLabs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node_ids</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-38"><a id="__codelineno-40-38" name="__codelineno-40-38" href="#__codelineno-40-38"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">labs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-40-39"><a id="__codelineno-40-39" name="__codelineno-40-39" href="#__codelineno-40-39"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-40"><a id="__codelineno-40-40" name="__codelineno-40-40" href="#__codelineno-40-40"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">node_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node_ids</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span id="__span-40-41"><a id="__codelineno-40-41" name="__codelineno-40-41" href="#__codelineno-40-41"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node_id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-40-42"><a id="__codelineno-40-42" name="__codelineno-40-42" href="#__codelineno-40-42"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">labs</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">lab</span><span class="p">))</span><span class="w"> </span><span class="nx">labs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">lab</span><span class="p">);</span>
</span><span id="__span-40-43"><a id="__codelineno-40-43" name="__codelineno-40-43" href="#__codelineno-40-43"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-44"><a id="__codelineno-40-44" name="__codelineno-40-44" href="#__codelineno-40-44"></a>
</span><span id="__span-40-45"><a id="__codelineno-40-45" name="__codelineno-40-45" href="#__codelineno-40-45"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">labs</span><span class="p">;</span>
</span><span id="__span-40-46"><a id="__codelineno-40-46" name="__codelineno-40-46" href="#__codelineno-40-46"></a><span class="p">};</span>
</span><span id="__span-40-47"><a id="__codelineno-40-47" name="__codelineno-40-47" href="#__codelineno-40-47"></a>
</span><span id="__span-40-48"><a id="__codelineno-40-48" name="__codelineno-40-48" href="#__codelineno-40-48"></a><span class="kd">const</span><span class="w"> </span><span class="nx">filterStudents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">nodes_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">links_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">filterFunc</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-49"><a id="__codelineno-40-49" name="__codelineno-40-49" href="#__codelineno-40-49"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">nodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nodes_not_filtered</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">filterFunc</span><span class="p">(</span><span class="nx">n</span><span class="p">));</span>
</span><span id="__span-40-50"><a id="__codelineno-40-50" name="__codelineno-40-50" href="#__codelineno-40-50"></a>
</span><span id="__span-40-51"><a id="__codelineno-40-51" name="__codelineno-40-51" href="#__codelineno-40-51"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">node_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nodes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-40-52"><a id="__codelineno-40-52" name="__codelineno-40-52" href="#__codelineno-40-52"></a>
</span><span id="__span-40-53"><a id="__codelineno-40-53" name="__codelineno-40-53" href="#__codelineno-40-53"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">links</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">links_not_filtered</span><span class="p">)).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// deepcopy solves heisenbug</span>
</span><span id="__span-40-54"><a id="__codelineno-40-54" name="__codelineno-40-54" href="#__codelineno-40-54"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">)));</span>
</span><span id="__span-40-55"><a id="__codelineno-40-55" name="__codelineno-40-55" href="#__codelineno-40-55"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-56"><a id="__codelineno-40-56" name="__codelineno-40-56" href="#__codelineno-40-56"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">node_ids</span><span class="p">,</span><span class="w"> </span><span class="nx">links</span><span class="p">];</span>
</span><span id="__span-40-57"><a id="__codelineno-40-57" name="__codelineno-40-57" href="#__codelineno-40-57"></a><span class="p">};</span>
</span><span id="__span-40-58"><a id="__codelineno-40-58" name="__codelineno-40-58" href="#__codelineno-40-58"></a>
</span><span id="__span-40-59"><a id="__codelineno-40-59" name="__codelineno-40-59" href="#__codelineno-40-59"></a><span class="kd">const</span><span class="w"> </span><span class="nx">uniqueId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-60"><a id="__codelineno-40-60" name="__codelineno-40-60" href="#__codelineno-40-60"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">sT</span><span class="p">;</span>
</span><span id="__span-40-61"><a id="__codelineno-40-61" name="__codelineno-40-61" href="#__codelineno-40-61"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">tT</span><span class="p">;</span>
</span><span id="__span-40-62"><a id="__codelineno-40-62" name="__codelineno-40-62" href="#__codelineno-40-62"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'string'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-63"><a id="__codelineno-40-63" name="__codelineno-40-63" href="#__codelineno-40-63"></a><span class="w">        </span><span class="nx">sT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">;</span>
</span><span id="__span-40-64"><a id="__codelineno-40-64" name="__codelineno-40-64" href="#__codelineno-40-64"></a><span class="w">        </span><span class="nx">tT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
</span><span id="__span-40-65"><a id="__codelineno-40-65" name="__codelineno-40-65" href="#__codelineno-40-65"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-66"><a id="__codelineno-40-66" name="__codelineno-40-66" href="#__codelineno-40-66"></a><span class="w">        </span><span class="nx">sT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-67"><a id="__codelineno-40-67" name="__codelineno-40-67" href="#__codelineno-40-67"></a><span class="w">        </span><span class="nx">tT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-68"><a id="__codelineno-40-68" name="__codelineno-40-68" href="#__codelineno-40-68"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-69"><a id="__codelineno-40-69" name="__codelineno-40-69" href="#__codelineno-40-69"></a>
</span><span id="__span-40-70"><a id="__codelineno-40-70" name="__codelineno-40-70" href="#__codelineno-40-70"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">sT</span><span class="si">}${</span><span class="nx">tT</span><span class="si">}${</span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="si">}${</span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-40-71"><a id="__codelineno-40-71" name="__codelineno-40-71" href="#__codelineno-40-71"></a><span class="p">};</span>
</span><span id="__span-40-72"><a id="__codelineno-40-72" name="__codelineno-40-72" href="#__codelineno-40-72"></a>
</span><span id="__span-40-73"><a id="__codelineno-40-73" name="__codelineno-40-73" href="#__codelineno-40-73"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createNumLinksDictFrom_not_filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-74"><a id="__codelineno-40-74" name="__codelineno-40-74" href="#__codelineno-40-74"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">nodes_not_filtered</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-75"><a id="__codelineno-40-75" name="__codelineno-40-75" href="#__codelineno-40-75"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">toAdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-76"><a id="__codelineno-40-76" name="__codelineno-40-76" href="#__codelineno-40-76"></a><span class="w">            </span><span class="s2">"source"</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-40-77"><a id="__codelineno-40-77" name="__codelineno-40-77" href="#__codelineno-40-77"></a><span class="w">            </span><span class="s2">"target"</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-40-78"><a id="__codelineno-40-78" name="__codelineno-40-78" href="#__codelineno-40-78"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-40-79"><a id="__codelineno-40-79" name="__codelineno-40-79" href="#__codelineno-40-79"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">TOPICS</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-80"><a id="__codelineno-40-80" name="__codelineno-40-80" href="#__codelineno-40-80"></a><span class="w">            </span><span class="nx">toAdd</span><span class="p">.</span><span class="nx">source</span><span class="p">[</span><span class="nx">TOPICS</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-40-81"><a id="__codelineno-40-81" name="__codelineno-40-81" href="#__codelineno-40-81"></a><span class="w">            </span><span class="nx">toAdd</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">TOPICS</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-40-82"><a id="__codelineno-40-82" name="__codelineno-40-82" href="#__codelineno-40-82"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-83"><a id="__codelineno-40-83" name="__codelineno-40-83" href="#__codelineno-40-83"></a><span class="w">        </span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">nodes_not_filtered</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">toAdd</span><span class="p">;</span>
</span><span id="__span-40-84"><a id="__codelineno-40-84" name="__codelineno-40-84" href="#__codelineno-40-84"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-85"><a id="__codelineno-40-85" name="__codelineno-40-85" href="#__codelineno-40-85"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">links_not_filtered</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-86"><a id="__codelineno-40-86" name="__codelineno-40-86" href="#__codelineno-40-86"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">links_not_filtered</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span id="__span-40-87"><a id="__codelineno-40-87" name="__codelineno-40-87" href="#__codelineno-40-87"></a><span class="w">        </span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">].</span><span class="nx">target</span><span class="p">[</span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-40-88"><a id="__codelineno-40-88" name="__codelineno-40-88" href="#__codelineno-40-88"></a><span class="w">        </span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">].</span><span class="nx">source</span><span class="p">[</span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-40-89"><a id="__codelineno-40-89" name="__codelineno-40-89" href="#__codelineno-40-89"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-90"><a id="__codelineno-40-90" name="__codelineno-40-90" href="#__codelineno-40-90"></a><span class="p">};</span>
</span><span id="__span-40-91"><a id="__codelineno-40-91" name="__codelineno-40-91" href="#__codelineno-40-91"></a>
</span><span id="__span-40-92"><a id="__codelineno-40-92" name="__codelineno-40-92" href="#__codelineno-40-92"></a>
</span><span id="__span-40-93"><a id="__codelineno-40-93" name="__codelineno-40-93" href="#__codelineno-40-93"></a><span class="kd">const</span><span class="w"> </span><span class="nx">create_not_filteredFromJSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-94"><a id="__codelineno-40-94" name="__codelineno-40-94" href="#__codelineno-40-94"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="s1">'final_data.json'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-95"><a id="__codelineno-40-95" name="__codelineno-40-95" href="#__codelineno-40-95"></a><span class="w">        </span><span class="nx">links_not_filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">links</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">d</span><span class="p">)).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">);</span>
</span><span id="__span-40-96"><a id="__codelineno-40-96" name="__codelineno-40-96" href="#__codelineno-40-96"></a><span class="w">        </span><span class="nx">nodes_not_filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span><span class="w"> </span><span class="nx">d</span><span class="p">));</span>
</span><span id="__span-40-97"><a id="__codelineno-40-97" name="__codelineno-40-97" href="#__codelineno-40-97"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-98"><a id="__codelineno-40-98" name="__codelineno-40-98" href="#__codelineno-40-98"></a><span class="p">};</span>
</span><span id="__span-40-99"><a id="__codelineno-40-99" name="__codelineno-40-99" href="#__codelineno-40-99"></a>
</span><span id="__span-40-100"><a id="__codelineno-40-100" name="__codelineno-40-100" href="#__codelineno-40-100"></a><span class="kd">const</span><span class="w"> </span><span class="nx">assignFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filterResult</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">node_ids</span><span class="p">,</span><span class="w"> </span><span class="nx">links</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filterResult</span><span class="p">;</span>
</span><span id="__span-40-101"><a id="__codelineno-40-101" name="__codelineno-40-101" href="#__codelineno-40-101"></a>
</span><span id="__span-40-102"><a id="__codelineno-40-102" name="__codelineno-40-102" href="#__codelineno-40-102"></a><span class="kd">const</span><span class="w"> </span><span class="nx">transferNot_filteredToArrays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-103"><a id="__codelineno-40-103" name="__codelineno-40-103" href="#__codelineno-40-103"></a><span class="w">    </span><span class="nx">assignFilter</span><span class="p">(</span><span class="nx">filterStudents</span><span class="p">(</span><span class="nx">nodes_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">links_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-104"><a id="__codelineno-40-104" name="__codelineno-40-104" href="#__codelineno-40-104"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">currentTopic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-105"><a id="__codelineno-40-105" name="__codelineno-40-105" href="#__codelineno-40-105"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">sumObj</span><span class="p">(</span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">target</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">minNumConnections</span><span class="p">;</span>
</span><span id="__span-40-106"><a id="__codelineno-40-106" name="__codelineno-40-106" href="#__codelineno-40-106"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-107"><a id="__codelineno-40-107" name="__codelineno-40-107" href="#__codelineno-40-107"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">target</span><span class="p">[</span><span class="nx">currentTopic</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">minNumConnections</span><span class="p">;</span>
</span><span id="__span-40-108"><a id="__codelineno-40-108" name="__codelineno-40-108" href="#__codelineno-40-108"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-109"><a id="__codelineno-40-109" name="__codelineno-40-109" href="#__codelineno-40-109"></a><span class="w">    </span><span class="p">}));</span>
</span><span id="__span-40-110"><a id="__codelineno-40-110" name="__codelineno-40-110" href="#__codelineno-40-110"></a><span class="p">};</span>
</span><span id="__span-40-111"><a id="__codelineno-40-111" name="__codelineno-40-111" href="#__codelineno-40-111"></a>
</span><span id="__span-40-112"><a id="__codelineno-40-112" name="__codelineno-40-112" href="#__codelineno-40-112"></a><span class="kd">const</span><span class="w"> </span><span class="nx">initializeDefs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-113"><a id="__codelineno-40-113" name="__codelineno-40-113" href="#__codelineno-40-113"></a><span class="w">    </span><span class="nx">linearGradient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"defs"</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"linearGradient"</span><span class="p">);</span>
</span><span id="__span-40-114"><a id="__codelineno-40-114" name="__codelineno-40-114" href="#__codelineno-40-114"></a><span class="p">};</span>
</span><span id="__span-40-115"><a id="__codelineno-40-115" name="__codelineno-40-115" href="#__codelineno-40-115"></a>
</span><span id="__span-40-116"><a id="__codelineno-40-116" name="__codelineno-40-116" href="#__codelineno-40-116"></a><span class="kd">const</span><span class="w"> </span><span class="nx">getGradientID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-117"><a id="__codelineno-40-117" name="__codelineno-40-117" href="#__codelineno-40-117"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">sForm</span><span class="p">,</span><span class="w"> </span><span class="nx">tForm</span><span class="p">;</span>
</span><span id="__span-40-118"><a id="__codelineno-40-118" name="__codelineno-40-118" href="#__codelineno-40-118"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-119"><a id="__codelineno-40-119" name="__codelineno-40-119" href="#__codelineno-40-119"></a><span class="w">        </span><span class="nx">sForm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\W/g</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="p">);</span>
</span><span id="__span-40-120"><a id="__codelineno-40-120" name="__codelineno-40-120" href="#__codelineno-40-120"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-121"><a id="__codelineno-40-121" name="__codelineno-40-121" href="#__codelineno-40-121"></a><span class="w">        </span><span class="nx">sForm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\W/g</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="p">);</span>
</span><span id="__span-40-122"><a id="__codelineno-40-122" name="__codelineno-40-122" href="#__codelineno-40-122"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-123"><a id="__codelineno-40-123" name="__codelineno-40-123" href="#__codelineno-40-123"></a>
</span><span id="__span-40-124"><a id="__codelineno-40-124" name="__codelineno-40-124" href="#__codelineno-40-124"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-125"><a id="__codelineno-40-125" name="__codelineno-40-125" href="#__codelineno-40-125"></a><span class="w">        </span><span class="nx">tForm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\W/g</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="p">);</span>
</span><span id="__span-40-126"><a id="__codelineno-40-126" name="__codelineno-40-126" href="#__codelineno-40-126"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-127"><a id="__codelineno-40-127" name="__codelineno-40-127" href="#__codelineno-40-127"></a><span class="w">        </span><span class="nx">tForm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\W/g</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="p">);</span>
</span><span id="__span-40-128"><a id="__codelineno-40-128" name="__codelineno-40-128" href="#__codelineno-40-128"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-129"><a id="__codelineno-40-129" name="__codelineno-40-129" href="#__codelineno-40-129"></a>
</span><span id="__span-40-130"><a id="__codelineno-40-130" name="__codelineno-40-130" href="#__codelineno-40-130"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`gradient_</span><span class="si">${</span><span class="nx">sForm</span><span class="si">}</span><span class="sb">|</span><span class="si">${</span><span class="nx">tForm</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-40-131"><a id="__codelineno-40-131" name="__codelineno-40-131" href="#__codelineno-40-131"></a><span class="p">};</span>
</span><span id="__span-40-132"><a id="__codelineno-40-132" name="__codelineno-40-132" href="#__codelineno-40-132"></a>
</span><span id="__span-40-133"><a id="__codelineno-40-133" name="__codelineno-40-133" href="#__codelineno-40-133"></a><span class="kd">const</span><span class="w"> </span><span class="nx">registerLinearGradients</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">links</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-134"><a id="__codelineno-40-134" name="__codelineno-40-134" href="#__codelineno-40-134"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">elem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">linearGradient</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">links</span><span class="p">,</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">l</span><span class="p">));</span>
</span><span id="__span-40-135"><a id="__codelineno-40-135" name="__codelineno-40-135" href="#__codelineno-40-135"></a><span class="w">    </span><span class="nx">elem</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span id="__span-40-136"><a id="__codelineno-40-136" name="__codelineno-40-136" href="#__codelineno-40-136"></a><span class="w">        </span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-137"><a id="__codelineno-40-137" name="__codelineno-40-137" href="#__codelineno-40-137"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-40-138"><a id="__codelineno-40-138" name="__codelineno-40-138" href="#__codelineno-40-138"></a><span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">linearGradient</span><span class="p">[</span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">d</span><span class="p">)]);</span>
</span><span id="__span-40-139"><a id="__codelineno-40-139" name="__codelineno-40-139" href="#__codelineno-40-139"></a><span class="w">            </span><span class="ow">delete</span><span class="w"> </span><span class="nx">linearGradient</span><span class="p">[</span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">d</span><span class="p">)];</span>
</span><span id="__span-40-140"><a id="__codelineno-40-140" name="__codelineno-40-140" href="#__codelineno-40-140"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-40-141"><a id="__codelineno-40-141" name="__codelineno-40-141" href="#__codelineno-40-141"></a><span class="w">        </span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span><span id="__span-40-142"><a id="__codelineno-40-142" name="__codelineno-40-142" href="#__codelineno-40-142"></a>
</span><span id="__span-40-143"><a id="__codelineno-40-143" name="__codelineno-40-143" href="#__codelineno-40-143"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">enter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elem</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"linearGradient"</span><span class="p">)</span>
</span><span id="__span-40-144"><a id="__codelineno-40-144" name="__codelineno-40-144" href="#__codelineno-40-144"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"gradientUnits"</span><span class="p">,</span><span class="w"> </span><span class="s2">"userSpaceOnUse"</span><span class="p">)</span>
</span><span id="__span-40-145"><a id="__codelineno-40-145" name="__codelineno-40-145" href="#__codelineno-40-145"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">d</span><span class="p">))</span>
</span><span id="__span-40-146"><a id="__codelineno-40-146" name="__codelineno-40-146" href="#__codelineno-40-146"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-40-147"><a id="__codelineno-40-147" name="__codelineno-40-147" href="#__codelineno-40-147"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</span><span id="__span-40-148"><a id="__codelineno-40-148" name="__codelineno-40-148" href="#__codelineno-40-148"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-40-149"><a id="__codelineno-40-149" name="__codelineno-40-149" href="#__codelineno-40-149"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-40-150"><a id="__codelineno-40-150" name="__codelineno-40-150" href="#__codelineno-40-150"></a>
</span><span id="__span-40-151"><a id="__codelineno-40-151" name="__codelineno-40-151" href="#__codelineno-40-151"></a><span class="w">    </span><span class="nx">enter</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"stop"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"offset"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0%"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stop-color"</span><span class="p">,</span><span class="w"> </span><span class="s2">"rgba("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">RGB_LINE_COLOR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">",1)"</span><span class="p">);</span>
</span><span id="__span-40-152"><a id="__codelineno-40-152" name="__codelineno-40-152" href="#__codelineno-40-152"></a><span class="w">    </span><span class="nx">enter</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"stop"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"offset"</span><span class="p">,</span><span class="w"> </span><span class="s2">"100%"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stop-color"</span><span class="p">,</span><span class="w"> </span><span class="s2">"rgba("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">RGB_LINE_COLOR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">",0)"</span><span class="p">);</span>
</span><span id="__span-40-153"><a id="__codelineno-40-153" name="__codelineno-40-153" href="#__codelineno-40-153"></a>
</span><span id="__span-40-154"><a id="__codelineno-40-154" name="__codelineno-40-154" href="#__codelineno-40-154"></a><span class="w">    </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"defs"</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"linearGradient"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-155"><a id="__codelineno-40-155" name="__codelineno-40-155" href="#__codelineno-40-155"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span><span id="__span-40-156"><a id="__codelineno-40-156" name="__codelineno-40-156" href="#__codelineno-40-156"></a><span class="w">        </span><span class="nx">linearGradientDict</span><span class="p">[</span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">e</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
</span><span id="__span-40-157"><a id="__codelineno-40-157" name="__codelineno-40-157" href="#__codelineno-40-157"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-158"><a id="__codelineno-40-158" name="__codelineno-40-158" href="#__codelineno-40-158"></a><span class="p">};</span>
</span><span id="__span-40-159"><a id="__codelineno-40-159" name="__codelineno-40-159" href="#__codelineno-40-159"></a>
</span><span id="__span-40-160"><a id="__codelineno-40-160" name="__codelineno-40-160" href="#__codelineno-40-160"></a><span class="kd">const</span><span class="w"> </span><span class="nx">condenseLinksforSimulation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ls</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-161"><a id="__codelineno-40-161" name="__codelineno-40-161" href="#__codelineno-40-161"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">toReturn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-40-162"><a id="__codelineno-40-162" name="__codelineno-40-162" href="#__codelineno-40-162"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">ls</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-163"><a id="__codelineno-40-163" name="__codelineno-40-163" href="#__codelineno-40-163"></a><span class="w">        </span><span class="nx">condensed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-40-164"><a id="__codelineno-40-164" name="__codelineno-40-164" href="#__codelineno-40-164"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">toReturn</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-165"><a id="__codelineno-40-165" name="__codelineno-40-165" href="#__codelineno-40-165"></a><span class="w">            </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">toReturn</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span id="__span-40-166"><a id="__codelineno-40-166" name="__codelineno-40-166" href="#__codelineno-40-166"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">lTargStr</span><span class="p">;</span>
</span><span id="__span-40-167"><a id="__codelineno-40-167" name="__codelineno-40-167" href="#__codelineno-40-167"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">rTargStr</span><span class="p">;</span>
</span><span id="__span-40-168"><a id="__codelineno-40-168" name="__codelineno-40-168" href="#__codelineno-40-168"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">lSourStr</span><span class="p">;</span>
</span><span id="__span-40-169"><a id="__codelineno-40-169" name="__codelineno-40-169" href="#__codelineno-40-169"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">rSourStr</span><span class="p">;</span>
</span><span id="__span-40-170"><a id="__codelineno-40-170" name="__codelineno-40-170" href="#__codelineno-40-170"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'string'</span><span class="p">)</span><span class="w"> </span><span class="nx">lTargStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
</span><span id="__span-40-171"><a id="__codelineno-40-171" name="__codelineno-40-171" href="#__codelineno-40-171"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="nx">lTargStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-172"><a id="__codelineno-40-172" name="__codelineno-40-172" href="#__codelineno-40-172"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">target</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'string'</span><span class="p">)</span><span class="w"> </span><span class="nx">rTargStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
</span><span id="__span-40-173"><a id="__codelineno-40-173" name="__codelineno-40-173" href="#__codelineno-40-173"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="nx">rTargStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-174"><a id="__codelineno-40-174" name="__codelineno-40-174" href="#__codelineno-40-174"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'string'</span><span class="p">)</span><span class="w"> </span><span class="nx">lSourStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">;</span>
</span><span id="__span-40-175"><a id="__codelineno-40-175" name="__codelineno-40-175" href="#__codelineno-40-175"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="nx">lSourStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-176"><a id="__codelineno-40-176" name="__codelineno-40-176" href="#__codelineno-40-176"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">source</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'string'</span><span class="p">)</span><span class="w"> </span><span class="nx">rSourStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">source</span><span class="p">;</span>
</span><span id="__span-40-177"><a id="__codelineno-40-177" name="__codelineno-40-177" href="#__codelineno-40-177"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="nx">rSourStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-178"><a id="__codelineno-40-178" name="__codelineno-40-178" href="#__codelineno-40-178"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">lTargStr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">rTargStr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">lSourStr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">rSourStr</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="nx">lTargStr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">rSourStr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">lSourStr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">rTargStr</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-179"><a id="__codelineno-40-179" name="__codelineno-40-179" href="#__codelineno-40-179"></a><span class="w">                </span><span class="nx">toReturn</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-40-180"><a id="__codelineno-40-180" name="__codelineno-40-180" href="#__codelineno-40-180"></a><span class="w">                </span><span class="nx">condensed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-40-181"><a id="__codelineno-40-181" name="__codelineno-40-181" href="#__codelineno-40-181"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-40-182"><a id="__codelineno-40-182" name="__codelineno-40-182" href="#__codelineno-40-182"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-40-183"><a id="__codelineno-40-183" name="__codelineno-40-183" href="#__codelineno-40-183"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-184"><a id="__codelineno-40-184" name="__codelineno-40-184" href="#__codelineno-40-184"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">condensed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-185"><a id="__codelineno-40-185" name="__codelineno-40-185" href="#__codelineno-40-185"></a><span class="w">            </span><span class="ow">delete</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="p">;</span>
</span><span id="__span-40-186"><a id="__codelineno-40-186" name="__codelineno-40-186" href="#__codelineno-40-186"></a><span class="w">            </span><span class="nx">toReturn</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span>
</span><span id="__span-40-187"><a id="__codelineno-40-187" name="__codelineno-40-187" href="#__codelineno-40-187"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-188"><a id="__codelineno-40-188" name="__codelineno-40-188" href="#__codelineno-40-188"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-189"><a id="__codelineno-40-189" name="__codelineno-40-189" href="#__codelineno-40-189"></a>
</span><span id="__span-40-190"><a id="__codelineno-40-190" name="__codelineno-40-190" href="#__codelineno-40-190"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">toReturn</span><span class="p">;</span>
</span><span id="__span-40-191"><a id="__codelineno-40-191" name="__codelineno-40-191" href="#__codelineno-40-191"></a><span class="p">};</span>
</span><span id="__span-40-192"><a id="__codelineno-40-192" name="__codelineno-40-192" href="#__codelineno-40-192"></a>
</span><span id="__span-40-193"><a id="__codelineno-40-193" name="__codelineno-40-193" href="#__codelineno-40-193"></a><span class="kd">const</span><span class="w"> </span><span class="nx">calculateMaxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-194"><a id="__codelineno-40-194" name="__codelineno-40-194" href="#__codelineno-40-194"></a><span class="w">    </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-40-195"><a id="__codelineno-40-195" name="__codelineno-40-195" href="#__codelineno-40-195"></a><span class="w">    </span><span class="nx">links</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-196"><a id="__codelineno-40-196" name="__codelineno-40-196" href="#__codelineno-40-196"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxStrength</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-197"><a id="__codelineno-40-197" name="__codelineno-40-197" href="#__codelineno-40-197"></a><span class="w">            </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-40-198"><a id="__codelineno-40-198" name="__codelineno-40-198" href="#__codelineno-40-198"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-199"><a id="__codelineno-40-199" name="__codelineno-40-199" href="#__codelineno-40-199"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-200"><a id="__codelineno-40-200" name="__codelineno-40-200" href="#__codelineno-40-200"></a><span class="p">}</span>
</span><span id="__span-40-201"><a id="__codelineno-40-201" name="__codelineno-40-201" href="#__codelineno-40-201"></a>
</span><span id="__span-40-202"><a id="__codelineno-40-202" name="__codelineno-40-202" href="#__codelineno-40-202"></a><span class="kd">const</span><span class="w"> </span><span class="nx">setLabs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node_ids</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">labs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getAllLabs</span><span class="p">(</span><span class="nx">node_ids</span><span class="p">).</span><span class="nx">sort</span><span class="p">();</span>
</span><span id="__span-40-203"><a id="__codelineno-40-203" name="__codelineno-40-203" href="#__codelineno-40-203"></a>
</span><span id="__span-40-204"><a id="__codelineno-40-204" name="__codelineno-40-204" href="#__codelineno-40-204"></a><span class="kd">const</span><span class="w"> </span><span class="nx">setCurrentLabHighlightList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">currentLabHighlightList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">labs</span><span class="p">;</span>
</span><span id="__span-40-205"><a id="__codelineno-40-205" name="__codelineno-40-205" href="#__codelineno-40-205"></a>
</span><span id="__span-40-206"><a id="__codelineno-40-206" name="__codelineno-40-206" href="#__codelineno-40-206"></a><span class="kd">const</span><span class="w"> </span><span class="nx">calculateSimulationStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">maxstrength</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">MINIMUM_STRENGTH_CONSTANT</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">normalize</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">maxStrength</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">SCALE_FACTOR</span><span class="p">));</span><span class="w"> </span><span class="c1">// so that it returns the callback function</span>
</span><span id="__span-40-207"><a id="__codelineno-40-207" name="__codelineno-40-207" href="#__codelineno-40-207"></a>
</span><span id="__span-40-208"><a id="__codelineno-40-208" name="__codelineno-40-208" href="#__codelineno-40-208"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createSimulation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-209"><a id="__codelineno-40-209" name="__codelineno-40-209" href="#__codelineno-40-209"></a><span class="w">    </span><span class="nx">simulation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceSimulation</span><span class="p">(</span><span class="nx">nodes</span><span class="p">)</span>
</span><span id="__span-40-210"><a id="__codelineno-40-210" name="__codelineno-40-210" href="#__codelineno-40-210"></a><span class="w">        </span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"boundary"</span><span class="p">,</span><span class="w"> </span><span class="nx">forceBoundary</span><span class="p">(</span><span class="nx">forceBoundaryMargin</span><span class="p">,</span><span class="w"> </span><span class="nx">forceBoundaryMargin</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">forceBoundaryMargin</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">forceBoundaryMargin</span><span class="p">))</span>
</span><span id="__span-40-211"><a id="__codelineno-40-211" name="__codelineno-40-211" href="#__codelineno-40-211"></a><span class="w">        </span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"link"</span><span class="p">,</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceLink</span><span class="p">(</span><span class="nx">links</span><span class="p">).</span><span class="nx">id</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">strength</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">calculateSimulationStrength</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">maxStrength</span><span class="p">)))</span>
</span><span id="__span-40-212"><a id="__codelineno-40-212" name="__codelineno-40-212" href="#__codelineno-40-212"></a><span class="w">        </span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"charge"</span><span class="p">,</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceManyBody</span><span class="p">().</span><span class="nx">strength</span><span class="p">(</span><span class="o">-</span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="cm">/*(d3.forceManyBody().strength(-50 / SCALE_FACTOR)*/</span><span class="w"> </span><span class="p">)</span>
</span><span id="__span-40-213"><a id="__codelineno-40-213" name="__codelineno-40-213" href="#__codelineno-40-213"></a><span class="w">        </span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"center"</span><span class="p">,</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceCenter</span><span class="p">(</span><span class="nx">width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span>
</span><span id="__span-40-214"><a id="__codelineno-40-214" name="__codelineno-40-214" href="#__codelineno-40-214"></a><span class="p">};</span>
</span><span id="__span-40-215"><a id="__codelineno-40-215" name="__codelineno-40-215" href="#__codelineno-40-215"></a>
</span><span id="__span-40-216"><a id="__codelineno-40-216" name="__codelineno-40-216" href="#__codelineno-40-216"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createAndFormatSVG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-217"><a id="__codelineno-40-217" name="__codelineno-40-217" href="#__codelineno-40-217"></a><span class="w">    </span><span class="nx">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"svg"</span><span class="p">)</span>
</span><span id="__span-40-218"><a id="__codelineno-40-218" name="__codelineno-40-218" href="#__codelineno-40-218"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"width"</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">)</span>
</span><span id="__span-40-219"><a id="__codelineno-40-219" name="__codelineno-40-219" href="#__codelineno-40-219"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"height"</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">)</span>
</span><span id="__span-40-220"><a id="__codelineno-40-220" name="__codelineno-40-220" href="#__codelineno-40-220"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"viewBox"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">])</span>
</span><span id="__span-40-221"><a id="__codelineno-40-221" name="__codelineno-40-221" href="#__codelineno-40-221"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"max-width"</span><span class="p">,</span><span class="w"> </span><span class="s2">"100%"</span><span class="p">)</span>
</span><span id="__span-40-222"><a id="__codelineno-40-222" name="__codelineno-40-222" href="#__codelineno-40-222"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"height"</span><span class="p">,</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">)</span>
</span><span id="__span-40-223"><a id="__codelineno-40-223" name="__codelineno-40-223" href="#__codelineno-40-223"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span><span class="w"> </span><span class="s2">"white"</span><span class="p">);</span>
</span><span id="__span-40-224"><a id="__codelineno-40-224" name="__codelineno-40-224" href="#__codelineno-40-224"></a>
</span><span id="__span-40-225"><a id="__codelineno-40-225" name="__codelineno-40-225" href="#__codelineno-40-225"></a><span class="w">    </span><span class="nx">transformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">getCTM</span><span class="p">();</span>
</span><span id="__span-40-226"><a id="__codelineno-40-226" name="__codelineno-40-226" href="#__codelineno-40-226"></a><span class="w">    </span><span class="nx">svgPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">createSVGPoint</span><span class="p">();</span>
</span><span id="__span-40-227"><a id="__codelineno-40-227" name="__codelineno-40-227" href="#__codelineno-40-227"></a><span class="w">    </span><span class="nx">boundingRect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
</span><span id="__span-40-228"><a id="__codelineno-40-228" name="__codelineno-40-228" href="#__codelineno-40-228"></a><span class="p">};</span>
</span><span id="__span-40-229"><a id="__codelineno-40-229" name="__codelineno-40-229" href="#__codelineno-40-229"></a>
</span><span id="__span-40-230"><a id="__codelineno-40-230" name="__codelineno-40-230" href="#__codelineno-40-230"></a><span class="kd">const</span><span class="w"> </span><span class="nx">linksToLink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isFirst</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-231"><a id="__codelineno-40-231" name="__codelineno-40-231" href="#__codelineno-40-231"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isFirst</span><span class="p">)</span><span class="w"> </span><span class="nx">gl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate(150, -10)"</span><span class="p">);</span>
</span><span id="__span-40-232"><a id="__codelineno-40-232" name="__codelineno-40-232" href="#__codelineno-40-232"></a>
</span><span id="__span-40-233"><a id="__codelineno-40-233" name="__codelineno-40-233" href="#__codelineno-40-233"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">gl</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"path"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">condenseLinksforSimulation</span><span class="p">(</span><span class="nx">links</span><span class="p">),</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uniqueId</span><span class="p">(</span><span class="nx">l</span><span class="p">));</span>
</span><span id="__span-40-234"><a id="__codelineno-40-234" name="__codelineno-40-234" href="#__codelineno-40-234"></a>
</span><span id="__span-40-235"><a id="__codelineno-40-235" name="__codelineno-40-235" href="#__codelineno-40-235"></a><span class="w">    </span><span class="nx">sel</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span id="__span-40-236"><a id="__codelineno-40-236" name="__codelineno-40-236" href="#__codelineno-40-236"></a><span class="w">        </span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span><span id="__span-40-237"><a id="__codelineno-40-237" name="__codelineno-40-237" href="#__codelineno-40-237"></a>
</span><span id="__span-40-238"><a id="__codelineno-40-238" name="__codelineno-40-238" href="#__codelineno-40-238"></a><span class="w">    </span><span class="nx">sel</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"path"</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">sel</span><span class="p">)</span>
</span><span id="__span-40-239"><a id="__codelineno-40-239" name="__codelineno-40-239" href="#__codelineno-40-239"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span>
</span><span id="__span-40-240"><a id="__codelineno-40-240" name="__codelineno-40-240" href="#__codelineno-40-240"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="nx">LINE_WIDTH</span><span class="p">)</span>
</span><span id="__span-40-241"><a id="__codelineno-40-241" name="__codelineno-40-241" href="#__codelineno-40-241"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-linecap"</span><span class="p">,</span><span class="w"> </span><span class="s2">"round"</span><span class="p">);</span>
</span><span id="__span-40-242"><a id="__codelineno-40-242" name="__codelineno-40-242" href="#__codelineno-40-242"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sel</span><span class="p">;</span>
</span><span id="__span-40-243"><a id="__codelineno-40-243" name="__codelineno-40-243" href="#__codelineno-40-243"></a><span class="p">};</span>
</span><span id="__span-40-244"><a id="__codelineno-40-244" name="__codelineno-40-244" href="#__codelineno-40-244"></a>
</span><span id="__span-40-245"><a id="__codelineno-40-245" name="__codelineno-40-245" href="#__codelineno-40-245"></a><span class="kd">const</span><span class="w"> </span><span class="nx">calculateMinMaxMapFromFiltered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-246"><a id="__codelineno-40-246" name="__codelineno-40-246" href="#__codelineno-40-246"></a><span class="w">    </span><span class="p">[...</span><span class="nx">TOPICS</span><span class="p">,</span><span class="w"> </span><span class="s2">"All"</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">topic</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-247"><a id="__codelineno-40-247" name="__codelineno-40-247" href="#__codelineno-40-247"></a><span class="w">        </span><span class="nx">minMaxMap</span><span class="p">[</span><span class="nx">topic</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">calculateMinMax</span><span class="p">(</span><span class="nx">nodes_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">links_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">topic</span><span class="p">);</span>
</span><span id="__span-40-248"><a id="__codelineno-40-248" name="__codelineno-40-248" href="#__codelineno-40-248"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-249"><a id="__codelineno-40-249" name="__codelineno-40-249" href="#__codelineno-40-249"></a><span class="p">};</span>
</span><span id="__span-40-250"><a id="__codelineno-40-250" name="__codelineno-40-250" href="#__codelineno-40-250"></a>
</span><span id="__span-40-251"><a id="__codelineno-40-251" name="__codelineno-40-251" href="#__codelineno-40-251"></a><span class="kd">const</span><span class="w"> </span><span class="nx">nodesToNodeAndFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-252"><a id="__codelineno-40-252" name="__codelineno-40-252" href="#__codelineno-40-252"></a><span class="w">    </span><span class="nx">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate(150, -10)"</span><span class="p">);</span>
</span><span id="__span-40-253"><a id="__codelineno-40-253" name="__codelineno-40-253" href="#__codelineno-40-253"></a><span class="w">    </span><span class="nx">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">node</span><span class="p">;</span>
</span><span id="__span-40-254"><a id="__codelineno-40-254" name="__codelineno-40-254" href="#__codelineno-40-254"></a><span class="p">};</span>
</span><span id="__span-40-255"><a id="__codelineno-40-255" name="__codelineno-40-255" href="#__codelineno-40-255"></a>
</span><span id="__span-40-256"><a id="__codelineno-40-256" name="__codelineno-40-256" href="#__codelineno-40-256"></a><span class="kd">const</span><span class="w"> </span><span class="nx">configureNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="nx">nodes</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-257"><a id="__codelineno-40-257" name="__codelineno-40-257" href="#__codelineno-40-257"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-40-258"><a id="__codelineno-40-258" name="__codelineno-40-258" href="#__codelineno-40-258"></a>
</span><span id="__span-40-259"><a id="__codelineno-40-259" name="__codelineno-40-259" href="#__codelineno-40-259"></a><span class="w">    </span><span class="nx">sel</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span id="__span-40-260"><a id="__codelineno-40-260" name="__codelineno-40-260" href="#__codelineno-40-260"></a><span class="w">        </span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span><span id="__span-40-261"><a id="__codelineno-40-261" name="__codelineno-40-261" href="#__codelineno-40-261"></a>
</span><span id="__span-40-262"><a id="__codelineno-40-262" name="__codelineno-40-262" href="#__codelineno-40-262"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sel</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>
</span><span id="__span-40-263"><a id="__codelineno-40-263" name="__codelineno-40-263" href="#__codelineno-40-263"></a>
</span><span id="__span-40-264"><a id="__codelineno-40-264" name="__codelineno-40-264" href="#__codelineno-40-264"></a><span class="w">    </span><span class="nx">ent</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">referenceCache</span><span class="p">[</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="s2">"All"</span><span class="p">]);</span>
</span><span id="__span-40-265"><a id="__codelineno-40-265" name="__codelineno-40-265" href="#__codelineno-40-265"></a>
</span><span id="__span-40-266"><a id="__codelineno-40-266" name="__codelineno-40-266" href="#__codelineno-40-266"></a><span class="w">    </span><span class="nx">ent</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-267"><a id="__codelineno-40-267" name="__codelineno-40-267" href="#__codelineno-40-267"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-40-268"><a id="__codelineno-40-268" name="__codelineno-40-268" href="#__codelineno-40-268"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">colorRegion</span><span class="p">(</span><span class="nx">LABS_CONTINENT</span><span class="p">[</span><span class="nx">lab</span><span class="p">]);</span>
</span><span id="__span-40-269"><a id="__codelineno-40-269" name="__codelineno-40-269" href="#__codelineno-40-269"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-40-270"><a id="__codelineno-40-270" name="__codelineno-40-270" href="#__codelineno-40-270"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="nx">NODE_HIGHLIGHTED_OPACITY</span><span class="p">)</span>
</span><span id="__span-40-271"><a id="__codelineno-40-271" name="__codelineno-40-271" href="#__codelineno-40-271"></a><span class="w">        </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">drag</span><span class="p">()</span>
</span><span id="__span-40-272"><a id="__codelineno-40-272" name="__codelineno-40-272" href="#__codelineno-40-272"></a><span class="w">            </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"start"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragstarted</span><span class="p">)</span>
</span><span id="__span-40-273"><a id="__codelineno-40-273" name="__codelineno-40-273" href="#__codelineno-40-273"></a><span class="w">            </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"drag"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragged</span><span class="p">)</span>
</span><span id="__span-40-274"><a id="__codelineno-40-274" name="__codelineno-40-274" href="#__codelineno-40-274"></a><span class="w">            </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"end"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragended</span><span class="p">));</span>
</span><span id="__span-40-275"><a id="__codelineno-40-275" name="__codelineno-40-275" href="#__codelineno-40-275"></a>
</span><span id="__span-40-276"><a id="__codelineno-40-276" name="__codelineno-40-276" href="#__codelineno-40-276"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">);</span>
</span><span id="__span-40-277"><a id="__codelineno-40-277" name="__codelineno-40-277" href="#__codelineno-40-277"></a><span class="p">};</span>
</span><span id="__span-40-278"><a id="__codelineno-40-278" name="__codelineno-40-278" href="#__codelineno-40-278"></a>
</span><span id="__span-40-279"><a id="__codelineno-40-279" name="__codelineno-40-279" href="#__codelineno-40-279"></a><span class="kd">function</span><span class="w"> </span><span class="nx">dragstarted</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-280"><a id="__codelineno-40-280" name="__codelineno-40-280" href="#__codelineno-40-280"></a><span class="w">    </span><span class="nx">objectBeingDragged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-40-281"><a id="__codelineno-40-281" name="__codelineno-40-281" href="#__codelineno-40-281"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="nx">simulation</span><span class="p">.</span><span class="nx">alphaTarget</span><span class="p">(</span><span class="mf">0.3</span><span class="p">).</span><span class="nx">restart</span><span class="p">();</span>
</span><span id="__span-40-282"><a id="__codelineno-40-282" name="__codelineno-40-282" href="#__codelineno-40-282"></a><span class="w">    </span><span class="nx">d</span><span class="p">.</span><span class="nx">fx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span id="__span-40-283"><a id="__codelineno-40-283" name="__codelineno-40-283" href="#__codelineno-40-283"></a><span class="w">    </span><span class="nx">d</span><span class="p">.</span><span class="nx">fy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
</span><span id="__span-40-284"><a id="__codelineno-40-284" name="__codelineno-40-284" href="#__codelineno-40-284"></a><span class="w">    </span><span class="nx">mouseIsDragging</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-40-285"><a id="__codelineno-40-285" name="__codelineno-40-285" href="#__codelineno-40-285"></a><span class="p">}</span>
</span><span id="__span-40-286"><a id="__codelineno-40-286" name="__codelineno-40-286" href="#__codelineno-40-286"></a>
</span><span id="__span-40-287"><a id="__codelineno-40-287" name="__codelineno-40-287" href="#__codelineno-40-287"></a><span class="kd">function</span><span class="w"> </span><span class="nx">dragged</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-288"><a id="__codelineno-40-288" name="__codelineno-40-288" href="#__codelineno-40-288"></a><span class="w">    </span><span class="nx">d</span><span class="p">.</span><span class="nx">fx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span id="__span-40-289"><a id="__codelineno-40-289" name="__codelineno-40-289" href="#__codelineno-40-289"></a><span class="w">    </span><span class="nx">d</span><span class="p">.</span><span class="nx">fy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
</span><span id="__span-40-290"><a id="__codelineno-40-290" name="__codelineno-40-290" href="#__codelineno-40-290"></a><span class="p">}</span>
</span><span id="__span-40-291"><a id="__codelineno-40-291" name="__codelineno-40-291" href="#__codelineno-40-291"></a>
</span><span id="__span-40-292"><a id="__codelineno-40-292" name="__codelineno-40-292" href="#__codelineno-40-292"></a><span class="kd">function</span><span class="w"> </span><span class="nx">dragended</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-293"><a id="__codelineno-40-293" name="__codelineno-40-293" href="#__codelineno-40-293"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span><span class="w"> </span><span class="nx">simulation</span><span class="p">.</span><span class="nx">alphaTarget</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-40-294"><a id="__codelineno-40-294" name="__codelineno-40-294" href="#__codelineno-40-294"></a><span class="w">    </span><span class="nx">d</span><span class="p">.</span><span class="nx">fx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-40-295"><a id="__codelineno-40-295" name="__codelineno-40-295" href="#__codelineno-40-295"></a><span class="w">    </span><span class="nx">d</span><span class="p">.</span><span class="nx">fy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-40-296"><a id="__codelineno-40-296" name="__codelineno-40-296" href="#__codelineno-40-296"></a><span class="w">    </span><span class="nx">mouseIsDragging</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-40-297"><a id="__codelineno-40-297" name="__codelineno-40-297" href="#__codelineno-40-297"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pointerOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointerOutOfSVG</span><span class="p">();</span>
</span><span id="__span-40-298"><a id="__codelineno-40-298" name="__codelineno-40-298" href="#__codelineno-40-298"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pointerOut</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-299"><a id="__codelineno-40-299" name="__codelineno-40-299" href="#__codelineno-40-299"></a><span class="w">        </span><span class="nx">tooltipMouseleave</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">objectBeingDragged</span><span class="p">);</span>
</span><span id="__span-40-300"><a id="__codelineno-40-300" name="__codelineno-40-300" href="#__codelineno-40-300"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-301"><a id="__codelineno-40-301" name="__codelineno-40-301" href="#__codelineno-40-301"></a><span class="w">    </span><span class="nx">objectBeingDragged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-40-302"><a id="__codelineno-40-302" name="__codelineno-40-302" href="#__codelineno-40-302"></a><span class="p">}</span>
</span><span id="__span-40-303"><a id="__codelineno-40-303" name="__codelineno-40-303" href="#__codelineno-40-303"></a>
</span><span id="__span-40-304"><a id="__codelineno-40-304" name="__codelineno-40-304" href="#__codelineno-40-304"></a><span class="kd">const</span><span class="w"> </span><span class="nx">getSimulationForceLinkDistance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">referenceCache</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="nx">currentTopic</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">referenceCache</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="nx">currentTopic</span><span class="p">];</span><span class="w"> </span><span class="c1">// this is good but it doesn't completely fix the circle overlapping problem because of circles that are touching but aren't linked  //Math.max(referenceCache[d.target.id][currentTopic], referenceCache[d.source.id][currentTopic]);</span>
</span><span id="__span-40-305"><a id="__codelineno-40-305" name="__codelineno-40-305" href="#__codelineno-40-305"></a>
</span><span id="__span-40-306"><a id="__codelineno-40-306" name="__codelineno-40-306" href="#__codelineno-40-306"></a><span class="kd">const</span><span class="w"> </span><span class="nx">calibrateSimulation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-307"><a id="__codelineno-40-307" name="__codelineno-40-307" href="#__codelineno-40-307"></a><span class="w">    </span><span class="nx">simulation</span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"collision"</span><span class="p">,</span><span class="w"> </span><span class="nx">forceCollide</span><span class="p">.</span><span class="nx">radius</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">r</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1.2</span><span class="p">));</span>
</span><span id="__span-40-308"><a id="__codelineno-40-308" name="__codelineno-40-308" href="#__codelineno-40-308"></a>
</span><span id="__span-40-309"><a id="__codelineno-40-309" name="__codelineno-40-309" href="#__codelineno-40-309"></a><span class="w">    </span><span class="nx">simulation</span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"link"</span><span class="p">,</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceLink</span><span class="p">(</span><span class="nx">links</span><span class="p">).</span><span class="nx">id</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">distance</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-310"><a id="__codelineno-40-310" name="__codelineno-40-310" href="#__codelineno-40-310"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">getSimulationForceLinkDistance</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-40-311"><a id="__codelineno-40-311" name="__codelineno-40-311" href="#__codelineno-40-311"></a><span class="w">    </span><span class="p">}));</span>
</span><span id="__span-40-312"><a id="__codelineno-40-312" name="__codelineno-40-312" href="#__codelineno-40-312"></a><span class="p">};</span>
</span><span id="__span-40-313"><a id="__codelineno-40-313" name="__codelineno-40-313" href="#__codelineno-40-313"></a>
</span><span id="__span-40-314"><a id="__codelineno-40-314" name="__codelineno-40-314" href="#__codelineno-40-314"></a><span class="kd">const</span><span class="w"> </span><span class="nx">activationCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">currentYear</span><span class="p">,</span><span class="w"> </span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">lab</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">currentLabHighlightList</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">lab</span><span class="p">));</span>
</span><span id="__span-40-315"><a id="__codelineno-40-315" name="__codelineno-40-315" href="#__codelineno-40-315"></a>
</span><span id="__span-40-316"><a id="__codelineno-40-316" name="__codelineno-40-316" href="#__codelineno-40-316"></a><span class="kd">const</span><span class="w"> </span><span class="nx">linkTick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-317"><a id="__codelineno-40-317" name="__codelineno-40-317" href="#__codelineno-40-317"></a><span class="w">    </span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"d"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-318"><a id="__codelineno-40-318" name="__codelineno-40-318" href="#__codelineno-40-318"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">gradientID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-40-319"><a id="__codelineno-40-319" name="__codelineno-40-319" href="#__codelineno-40-319"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">lg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">gradientID</span><span class="p">);</span>
</span><span id="__span-40-320"><a id="__codelineno-40-320" name="__codelineno-40-320" href="#__codelineno-40-320"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-321"><a id="__codelineno-40-321" name="__codelineno-40-321" href="#__codelineno-40-321"></a><span class="w">            </span><span class="nx">source</span><span class="p">,</span>
</span><span id="__span-40-322"><a id="__codelineno-40-322" name="__codelineno-40-322" href="#__codelineno-40-322"></a><span class="w">            </span><span class="nx">sourceYear</span><span class="p">,</span>
</span><span id="__span-40-323"><a id="__codelineno-40-323" name="__codelineno-40-323" href="#__codelineno-40-323"></a><span class="w">            </span><span class="nx">sourceLab</span><span class="p">,</span>
</span><span id="__span-40-324"><a id="__codelineno-40-324" name="__codelineno-40-324" href="#__codelineno-40-324"></a><span class="w">            </span><span class="nx">target</span><span class="p">,</span>
</span><span id="__span-40-325"><a id="__codelineno-40-325" name="__codelineno-40-325" href="#__codelineno-40-325"></a><span class="w">            </span><span class="nx">targetYear</span><span class="p">,</span>
</span><span id="__span-40-326"><a id="__codelineno-40-326" name="__codelineno-40-326" href="#__codelineno-40-326"></a><span class="w">            </span><span class="nx">targetLab</span>
</span><span id="__span-40-327"><a id="__codelineno-40-327" name="__codelineno-40-327" href="#__codelineno-40-327"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getLinkSummary</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-40-328"><a id="__codelineno-40-328" name="__codelineno-40-328" href="#__codelineno-40-328"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">sourceYear</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceLab</span><span class="p">);</span>
</span><span id="__span-40-329"><a id="__codelineno-40-329" name="__codelineno-40-329" href="#__codelineno-40-329"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">targetYear</span><span class="p">,</span><span class="w"> </span><span class="nx">targetLab</span><span class="p">);</span>
</span><span id="__span-40-330"><a id="__codelineno-40-330" name="__codelineno-40-330" href="#__codelineno-40-330"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="p">))))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if only one is activated</span>
</span><span id="__span-40-331"><a id="__codelineno-40-331" name="__codelineno-40-331" href="#__codelineno-40-331"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsActivated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-332"><a id="__codelineno-40-332" name="__codelineno-40-332" href="#__codelineno-40-332"></a><span class="w">                </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-40-333"><a id="__codelineno-40-333" name="__codelineno-40-333" href="#__codelineno-40-333"></a><span class="w">                </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-40-334"><a id="__codelineno-40-334" name="__codelineno-40-334" href="#__codelineno-40-334"></a><span class="w">                </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-40-335"><a id="__codelineno-40-335" name="__codelineno-40-335" href="#__codelineno-40-335"></a><span class="w">                </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-40-336"><a id="__codelineno-40-336" name="__codelineno-40-336" href="#__codelineno-40-336"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-337"><a id="__codelineno-40-337" name="__codelineno-40-337" href="#__codelineno-40-337"></a><span class="w">                </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-40-338"><a id="__codelineno-40-338" name="__codelineno-40-338" href="#__codelineno-40-338"></a><span class="w">                </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-40-339"><a id="__codelineno-40-339" name="__codelineno-40-339" href="#__codelineno-40-339"></a><span class="w">                </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-40-340"><a id="__codelineno-40-340" name="__codelineno-40-340" href="#__codelineno-40-340"></a><span class="w">                </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-40-341"><a id="__codelineno-40-341" name="__codelineno-40-341" href="#__codelineno-40-341"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-40-342"><a id="__codelineno-40-342" name="__codelineno-40-342" href="#__codelineno-40-342"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-343"><a id="__codelineno-40-343" name="__codelineno-40-343" href="#__codelineno-40-343"></a>
</span><span id="__span-40-344"><a id="__codelineno-40-344" name="__codelineno-40-344" href="#__codelineno-40-344"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">path</span><span class="p">();</span>
</span><span id="__span-40-345"><a id="__codelineno-40-345" name="__codelineno-40-345" href="#__codelineno-40-345"></a><span class="w">        </span><span class="nx">path</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-40-346"><a id="__codelineno-40-346" name="__codelineno-40-346" href="#__codelineno-40-346"></a><span class="w">        </span><span class="nx">path</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-40-347"><a id="__codelineno-40-347" name="__codelineno-40-347" href="#__codelineno-40-347"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span id="__span-40-348"><a id="__codelineno-40-348" name="__codelineno-40-348" href="#__codelineno-40-348"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-349"><a id="__codelineno-40-349" name="__codelineno-40-349" href="#__codelineno-40-349"></a><span class="p">};</span>
</span><span id="__span-40-350"><a id="__codelineno-40-350" name="__codelineno-40-350" href="#__codelineno-40-350"></a>
</span><span id="__span-40-351"><a id="__codelineno-40-351" name="__codelineno-40-351" href="#__codelineno-40-351"></a><span class="kd">const</span><span class="w"> </span><span class="nx">setSimulationTick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">node</span><span class="p">,</span><span class="w"> </span><span class="nx">link</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-352"><a id="__codelineno-40-352" name="__codelineno-40-352" href="#__codelineno-40-352"></a>
</span><span id="__span-40-353"><a id="__codelineno-40-353" name="__codelineno-40-353" href="#__codelineno-40-353"></a><span class="w">    </span><span class="nx">linkTick</span><span class="p">();</span><span class="w"> </span><span class="c1">// so that the directions and everything are correct before the user first drags on the simulation</span>
</span><span id="__span-40-354"><a id="__codelineno-40-354" name="__codelineno-40-354" href="#__codelineno-40-354"></a><span class="w">    </span><span class="nx">simulation</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"tick"</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-355"><a id="__codelineno-40-355" name="__codelineno-40-355" href="#__codelineno-40-355"></a><span class="w">        </span><span class="nx">linkTick</span><span class="p">();</span>
</span><span id="__span-40-356"><a id="__codelineno-40-356" name="__codelineno-40-356" href="#__codelineno-40-356"></a><span class="w">        </span><span class="nx">node</span>
</span><span id="__span-40-357"><a id="__codelineno-40-357" name="__codelineno-40-357" href="#__codelineno-40-357"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cx"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-40-358"><a id="__codelineno-40-358" name="__codelineno-40-358" href="#__codelineno-40-358"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cy"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-40-359"><a id="__codelineno-40-359" name="__codelineno-40-359" href="#__codelineno-40-359"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-360"><a id="__codelineno-40-360" name="__codelineno-40-360" href="#__codelineno-40-360"></a><span class="p">};</span>
</span><span id="__span-40-361"><a id="__codelineno-40-361" name="__codelineno-40-361" href="#__codelineno-40-361"></a>
</span><span id="__span-40-362"><a id="__codelineno-40-362" name="__codelineno-40-362" href="#__codelineno-40-362"></a><span class="kd">const</span><span class="w"> </span><span class="nx">selectByTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-363"><a id="__codelineno-40-363" name="__codelineno-40-363" href="#__codelineno-40-363"></a><span class="w">    </span><span class="nx">currentTopic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">topic</span><span class="p">;</span>
</span><span id="__span-40-364"><a id="__codelineno-40-364" name="__codelineno-40-364" href="#__codelineno-40-364"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-40-365"><a id="__codelineno-40-365" name="__codelineno-40-365" href="#__codelineno-40-365"></a><span class="w">    </span><span class="nx">links</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-366"><a id="__codelineno-40-366" name="__codelineno-40-366" href="#__codelineno-40-366"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-367"><a id="__codelineno-40-367" name="__codelineno-40-367" href="#__codelineno-40-367"></a><span class="w">            </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-40-368"><a id="__codelineno-40-368" name="__codelineno-40-368" href="#__codelineno-40-368"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-369"><a id="__codelineno-40-369" name="__codelineno-40-369" href="#__codelineno-40-369"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-370"><a id="__codelineno-40-370" name="__codelineno-40-370" href="#__codelineno-40-370"></a>
</span><span id="__span-40-371"><a id="__codelineno-40-371" name="__codelineno-40-371" href="#__codelineno-40-371"></a><span class="w">    </span><span class="nx">link</span>
</span><span id="__span-40-372"><a id="__codelineno-40-372" name="__codelineno-40-372" href="#__codelineno-40-372"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'opacity'</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-373"><a id="__codelineno-40-373" name="__codelineno-40-373" href="#__codelineno-40-373"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-374"><a id="__codelineno-40-374" name="__codelineno-40-374" href="#__codelineno-40-374"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">normalize</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">maxStrength</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">SCALE_FACTOR</span><span class="p">;</span>
</span><span id="__span-40-375"><a id="__codelineno-40-375" name="__codelineno-40-375" href="#__codelineno-40-375"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-376"><a id="__codelineno-40-376" name="__codelineno-40-376" href="#__codelineno-40-376"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-40-377"><a id="__codelineno-40-377" name="__codelineno-40-377" href="#__codelineno-40-377"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-40-378"><a id="__codelineno-40-378" name="__codelineno-40-378" href="#__codelineno-40-378"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-40-379"><a id="__codelineno-40-379" name="__codelineno-40-379" href="#__codelineno-40-379"></a>
</span><span id="__span-40-380"><a id="__codelineno-40-380" name="__codelineno-40-380" href="#__codelineno-40-380"></a><span class="w">    </span><span class="nx">simulation</span>
</span><span id="__span-40-381"><a id="__codelineno-40-381" name="__codelineno-40-381" href="#__codelineno-40-381"></a><span class="w">        </span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"link"</span><span class="p">,</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceLink</span><span class="p">(</span><span class="nx">links</span><span class="p">).</span><span class="nx">id</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span><span id="__span-40-382"><a id="__codelineno-40-382" name="__codelineno-40-382" href="#__codelineno-40-382"></a><span class="w">            </span><span class="p">.</span><span class="nx">strength</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">calculateSimulationStrength</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">maxStrength</span><span class="p">))</span>
</span><span id="__span-40-383"><a id="__codelineno-40-383" name="__codelineno-40-383" href="#__codelineno-40-383"></a><span class="w">            </span><span class="p">.</span><span class="nx">distance</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">getSimulationForceLinkDistance</span><span class="p">(</span><span class="nx">d</span><span class="p">)));</span>
</span><span id="__span-40-384"><a id="__codelineno-40-384" name="__codelineno-40-384" href="#__codelineno-40-384"></a>
</span><span id="__span-40-385"><a id="__codelineno-40-385" name="__codelineno-40-385" href="#__codelineno-40-385"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">topicLinks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-40-386"><a id="__codelineno-40-386" name="__codelineno-40-386" href="#__codelineno-40-386"></a><span class="w">    </span><span class="nx">links</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-387"><a id="__codelineno-40-387" name="__codelineno-40-387" href="#__codelineno-40-387"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-388"><a id="__codelineno-40-388" name="__codelineno-40-388" href="#__codelineno-40-388"></a><span class="w">            </span><span class="nx">topicLinks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span>
</span><span id="__span-40-389"><a id="__codelineno-40-389" name="__codelineno-40-389" href="#__codelineno-40-389"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-390"><a id="__codelineno-40-390" name="__codelineno-40-390" href="#__codelineno-40-390"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-391"><a id="__codelineno-40-391" name="__codelineno-40-391" href="#__codelineno-40-391"></a>
</span><span id="__span-40-392"><a id="__codelineno-40-392" name="__codelineno-40-392" href="#__codelineno-40-392"></a><span class="w">    </span><span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">referenceCache</span><span class="p">[</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="nx">topic</span><span class="p">]);</span>
</span><span id="__span-40-393"><a id="__codelineno-40-393" name="__codelineno-40-393" href="#__codelineno-40-393"></a><span class="w">    </span><span class="nx">simulation</span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"link"</span><span class="p">,</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceLink</span><span class="p">(</span><span class="nx">topicLinks</span><span class="p">).</span><span class="nx">id</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">distance</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">getSimulationForceLinkDistance</span><span class="p">(</span><span class="nx">d</span><span class="p">)));</span>
</span><span id="__span-40-394"><a id="__codelineno-40-394" name="__codelineno-40-394" href="#__codelineno-40-394"></a><span class="w">    </span><span class="nx">forceCollide</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="nx">nodes</span><span class="p">);</span>
</span><span id="__span-40-395"><a id="__codelineno-40-395" name="__codelineno-40-395" href="#__codelineno-40-395"></a><span class="w">    </span><span class="nx">simulation</span><span class="p">.</span><span class="nx">alpha</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">restart</span><span class="p">();</span>
</span><span id="__span-40-396"><a id="__codelineno-40-396" name="__codelineno-40-396" href="#__codelineno-40-396"></a><span class="p">};</span>
</span><span id="__span-40-397"><a id="__codelineno-40-397" name="__codelineno-40-397" href="#__codelineno-40-397"></a>
</span><span id="__span-40-398"><a id="__codelineno-40-398" name="__codelineno-40-398" href="#__codelineno-40-398"></a><span class="kd">const</span><span class="w"> </span><span class="nx">configureGlowDefinitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-399"><a id="__codelineno-40-399" name="__codelineno-40-399" href="#__codelineno-40-399"></a><span class="w">    </span><span class="nx">defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"defs"</span><span class="p">);</span>
</span><span id="__span-40-400"><a id="__codelineno-40-400" name="__codelineno-40-400" href="#__codelineno-40-400"></a>
</span><span id="__span-40-401"><a id="__codelineno-40-401" name="__codelineno-40-401" href="#__codelineno-40-401"></a><span class="w">    </span><span class="nx">defs</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"filter"</span><span class="p">)</span>
</span><span id="__span-40-402"><a id="__codelineno-40-402" name="__codelineno-40-402" href="#__codelineno-40-402"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sofGlow"</span><span class="p">)</span>
</span><span id="__span-40-403"><a id="__codelineno-40-403" name="__codelineno-40-403" href="#__codelineno-40-403"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"width"</span><span class="p">,</span><span class="w"> </span><span class="s2">"300%"</span><span class="p">)</span>
</span><span id="__span-40-404"><a id="__codelineno-40-404" name="__codelineno-40-404" href="#__codelineno-40-404"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"height"</span><span class="p">,</span><span class="w"> </span><span class="s2">"300%"</span><span class="p">)</span>
</span><span id="__span-40-405"><a id="__codelineno-40-405" name="__codelineno-40-405" href="#__codelineno-40-405"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-100%"</span><span class="p">)</span>
</span><span id="__span-40-406"><a id="__codelineno-40-406" name="__codelineno-40-406" href="#__codelineno-40-406"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-100%"</span><span class="p">)</span>
</span><span id="__span-40-407"><a id="__codelineno-40-407" name="__codelineno-40-407" href="#__codelineno-40-407"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stdDeviation"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">)</span>
</span><span id="__span-40-408"><a id="__codelineno-40-408" name="__codelineno-40-408" href="#__codelineno-40-408"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"result"</span><span class="p">,</span><span class="w"> </span><span class="s2">"coloredBlur"</span><span class="p">)</span>
</span><span id="__span-40-409"><a id="__codelineno-40-409" name="__codelineno-40-409" href="#__codelineno-40-409"></a><span class="w">        </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"feGaussianBlur"</span><span class="p">)</span>
</span><span id="__span-40-410"><a id="__codelineno-40-410" name="__codelineno-40-410" href="#__codelineno-40-410"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="s2">"thicken"</span><span class="p">)</span>
</span><span id="__span-40-411"><a id="__codelineno-40-411" name="__codelineno-40-411" href="#__codelineno-40-411"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stdDeviation"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">)</span>
</span><span id="__span-40-412"><a id="__codelineno-40-412" name="__codelineno-40-412" href="#__codelineno-40-412"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"result"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blurred"</span><span class="p">);</span>
</span><span id="__span-40-413"><a id="__codelineno-40-413" name="__codelineno-40-413" href="#__codelineno-40-413"></a><span class="p">};</span>
</span><span id="__span-40-414"><a id="__codelineno-40-414" name="__codelineno-40-414" href="#__codelineno-40-414"></a>
</span><span id="__span-40-415"><a id="__codelineno-40-415" name="__codelineno-40-415" href="#__codelineno-40-415"></a><span class="kd">const</span><span class="w"> </span><span class="nx">getLinkSummary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-416"><a id="__codelineno-40-416" name="__codelineno-40-416" href="#__codelineno-40-416"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-417"><a id="__codelineno-40-417" name="__codelineno-40-417" href="#__codelineno-40-417"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-40-418"><a id="__codelineno-40-418" name="__codelineno-40-418" href="#__codelineno-40-418"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceLab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-40-419"><a id="__codelineno-40-419" name="__codelineno-40-419" href="#__codelineno-40-419"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-420"><a id="__codelineno-40-420" name="__codelineno-40-420" href="#__codelineno-40-420"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-40-421"><a id="__codelineno-40-421" name="__codelineno-40-421" href="#__codelineno-40-421"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetLab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-40-422"><a id="__codelineno-40-422" name="__codelineno-40-422" href="#__codelineno-40-422"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-423"><a id="__codelineno-40-423" name="__codelineno-40-423" href="#__codelineno-40-423"></a><span class="w">        </span><span class="nx">source</span><span class="p">,</span>
</span><span id="__span-40-424"><a id="__codelineno-40-424" name="__codelineno-40-424" href="#__codelineno-40-424"></a><span class="w">        </span><span class="nx">sourceYear</span><span class="p">,</span>
</span><span id="__span-40-425"><a id="__codelineno-40-425" name="__codelineno-40-425" href="#__codelineno-40-425"></a><span class="w">        </span><span class="nx">sourceLab</span><span class="p">,</span>
</span><span id="__span-40-426"><a id="__codelineno-40-426" name="__codelineno-40-426" href="#__codelineno-40-426"></a><span class="w">        </span><span class="nx">target</span><span class="p">,</span>
</span><span id="__span-40-427"><a id="__codelineno-40-427" name="__codelineno-40-427" href="#__codelineno-40-427"></a><span class="w">        </span><span class="nx">targetYear</span><span class="p">,</span>
</span><span id="__span-40-428"><a id="__codelineno-40-428" name="__codelineno-40-428" href="#__codelineno-40-428"></a><span class="w">        </span><span class="nx">targetLab</span>
</span><span id="__span-40-429"><a id="__codelineno-40-429" name="__codelineno-40-429" href="#__codelineno-40-429"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-40-430"><a id="__codelineno-40-430" name="__codelineno-40-430" href="#__codelineno-40-430"></a><span class="p">};</span>
</span><span id="__span-40-431"><a id="__codelineno-40-431" name="__codelineno-40-431" href="#__codelineno-40-431"></a>
</span><span id="__span-40-432"><a id="__codelineno-40-432" name="__codelineno-40-432" href="#__codelineno-40-432"></a><span class="kd">const</span><span class="w"> </span><span class="nx">setLinkOpacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-433"><a id="__codelineno-40-433" name="__codelineno-40-433" href="#__codelineno-40-433"></a><span class="w">    </span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-434"><a id="__codelineno-40-434" name="__codelineno-40-434" href="#__codelineno-40-434"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-435"><a id="__codelineno-40-435" name="__codelineno-40-435" href="#__codelineno-40-435"></a><span class="w">            </span><span class="nx">source</span><span class="p">,</span>
</span><span id="__span-40-436"><a id="__codelineno-40-436" name="__codelineno-40-436" href="#__codelineno-40-436"></a><span class="w">            </span><span class="nx">sourceYear</span><span class="p">,</span>
</span><span id="__span-40-437"><a id="__codelineno-40-437" name="__codelineno-40-437" href="#__codelineno-40-437"></a><span class="w">            </span><span class="nx">sourceLab</span><span class="p">,</span>
</span><span id="__span-40-438"><a id="__codelineno-40-438" name="__codelineno-40-438" href="#__codelineno-40-438"></a><span class="w">            </span><span class="nx">target</span><span class="p">,</span>
</span><span id="__span-40-439"><a id="__codelineno-40-439" name="__codelineno-40-439" href="#__codelineno-40-439"></a><span class="w">            </span><span class="nx">targetYear</span><span class="p">,</span>
</span><span id="__span-40-440"><a id="__codelineno-40-440" name="__codelineno-40-440" href="#__codelineno-40-440"></a><span class="w">            </span><span class="nx">targetLab</span>
</span><span id="__span-40-441"><a id="__codelineno-40-441" name="__codelineno-40-441" href="#__codelineno-40-441"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getLinkSummary</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-40-442"><a id="__codelineno-40-442" name="__codelineno-40-442" href="#__codelineno-40-442"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-40-443"><a id="__codelineno-40-443" name="__codelineno-40-443" href="#__codelineno-40-443"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-40-444"><a id="__codelineno-40-444" name="__codelineno-40-444" href="#__codelineno-40-444"></a>
</span><span id="__span-40-445"><a id="__codelineno-40-445" name="__codelineno-40-445" href="#__codelineno-40-445"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">sourceYear</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-446"><a id="__codelineno-40-446" name="__codelineno-40-446" href="#__codelineno-40-446"></a><span class="w">            </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-40-447"><a id="__codelineno-40-447" name="__codelineno-40-447" href="#__codelineno-40-447"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-448"><a id="__codelineno-40-448" name="__codelineno-40-448" href="#__codelineno-40-448"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">targetYear</span><span class="p">,</span><span class="w"> </span><span class="nx">targetLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-449"><a id="__codelineno-40-449" name="__codelineno-40-449" href="#__codelineno-40-449"></a><span class="w">            </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-40-450"><a id="__codelineno-40-450" name="__codelineno-40-450" href="#__codelineno-40-450"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-451"><a id="__codelineno-40-451" name="__codelineno-40-451" href="#__codelineno-40-451"></a>
</span><span id="__span-40-452"><a id="__codelineno-40-452" name="__codelineno-40-452" href="#__codelineno-40-452"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-453"><a id="__codelineno-40-453" name="__codelineno-40-453" href="#__codelineno-40-453"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-40-454"><a id="__codelineno-40-454" name="__codelineno-40-454" href="#__codelineno-40-454"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-455"><a id="__codelineno-40-455" name="__codelineno-40-455" href="#__codelineno-40-455"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-40-456"><a id="__codelineno-40-456" name="__codelineno-40-456" href="#__codelineno-40-456"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-457"><a id="__codelineno-40-457" name="__codelineno-40-457" href="#__codelineno-40-457"></a><span class="w">    </span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-458"><a id="__codelineno-40-458" name="__codelineno-40-458" href="#__codelineno-40-458"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-459"><a id="__codelineno-40-459" name="__codelineno-40-459" href="#__codelineno-40-459"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-40-460"><a id="__codelineno-40-460" name="__codelineno-40-460" href="#__codelineno-40-460"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceLab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-40-461"><a id="__codelineno-40-461" name="__codelineno-40-461" href="#__codelineno-40-461"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-462"><a id="__codelineno-40-462" name="__codelineno-40-462" href="#__codelineno-40-462"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-40-463"><a id="__codelineno-40-463" name="__codelineno-40-463" href="#__codelineno-40-463"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetLab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-40-464"><a id="__codelineno-40-464" name="__codelineno-40-464" href="#__codelineno-40-464"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-40-465"><a id="__codelineno-40-465" name="__codelineno-40-465" href="#__codelineno-40-465"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-40-466"><a id="__codelineno-40-466" name="__codelineno-40-466" href="#__codelineno-40-466"></a>
</span><span id="__span-40-467"><a id="__codelineno-40-467" name="__codelineno-40-467" href="#__codelineno-40-467"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">sourceYear</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">currentLabHighlightList</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">sourceLab</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-468"><a id="__codelineno-40-468" name="__codelineno-40-468" href="#__codelineno-40-468"></a><span class="w">            </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-40-469"><a id="__codelineno-40-469" name="__codelineno-40-469" href="#__codelineno-40-469"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-470"><a id="__codelineno-40-470" name="__codelineno-40-470" href="#__codelineno-40-470"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">targetYear</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">currentLabHighlightList</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">targetLab</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-471"><a id="__codelineno-40-471" name="__codelineno-40-471" href="#__codelineno-40-471"></a><span class="w">            </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-40-472"><a id="__codelineno-40-472" name="__codelineno-40-472" href="#__codelineno-40-472"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-473"><a id="__codelineno-40-473" name="__codelineno-40-473" href="#__codelineno-40-473"></a>
</span><span id="__span-40-474"><a id="__codelineno-40-474" name="__codelineno-40-474" href="#__codelineno-40-474"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-475"><a id="__codelineno-40-475" name="__codelineno-40-475" href="#__codelineno-40-475"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s2">"rgba(255,255,255"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="nx">normalize</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">maxStrength</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">SCALE_FACTOR</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">;</span>
</span><span id="__span-40-476"><a id="__codelineno-40-476" name="__codelineno-40-476" href="#__codelineno-40-476"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-477"><a id="__codelineno-40-477" name="__codelineno-40-477" href="#__codelineno-40-477"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="sb">`url(#</span><span class="si">${</span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span>
</span><span id="__span-40-478"><a id="__codelineno-40-478" name="__codelineno-40-478" href="#__codelineno-40-478"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-479"><a id="__codelineno-40-479" name="__codelineno-40-479" href="#__codelineno-40-479"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s2">"rgba(255,255,255,0.05)"</span><span class="p">;</span>
</span><span id="__span-40-480"><a id="__codelineno-40-480" name="__codelineno-40-480" href="#__codelineno-40-480"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-481"><a id="__codelineno-40-481" name="__codelineno-40-481" href="#__codelineno-40-481"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-482"><a id="__codelineno-40-482" name="__codelineno-40-482" href="#__codelineno-40-482"></a><span class="p">};</span>
</span><span id="__span-40-483"><a id="__codelineno-40-483" name="__codelineno-40-483" href="#__codelineno-40-483"></a>
</span><span id="__span-40-484"><a id="__codelineno-40-484" name="__codelineno-40-484" href="#__codelineno-40-484"></a><span class="kd">const</span><span class="w"> </span><span class="nx">setYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">year</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-485"><a id="__codelineno-40-485" name="__codelineno-40-485" href="#__codelineno-40-485"></a><span class="w">    </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">year</span><span class="p">;</span>
</span><span id="__span-40-486"><a id="__codelineno-40-486" name="__codelineno-40-486" href="#__codelineno-40-486"></a><span class="w">    </span><span class="nx">updateData</span><span class="p">({</span>
</span><span id="__span-40-487"><a id="__codelineno-40-487" name="__codelineno-40-487" href="#__codelineno-40-487"></a><span class="w">        </span><span class="nx">minNumConnections</span><span class="p">,</span>
</span><span id="__span-40-488"><a id="__codelineno-40-488" name="__codelineno-40-488" href="#__codelineno-40-488"></a><span class="w">        </span><span class="nx">simulation</span><span class="p">,</span>
</span><span id="__span-40-489"><a id="__codelineno-40-489" name="__codelineno-40-489" href="#__codelineno-40-489"></a><span class="w">        </span><span class="nx">svg</span><span class="p">,</span>
</span><span id="__span-40-490"><a id="__codelineno-40-490" name="__codelineno-40-490" href="#__codelineno-40-490"></a><span class="w">        </span><span class="nx">g</span><span class="p">,</span>
</span><span id="__span-40-491"><a id="__codelineno-40-491" name="__codelineno-40-491" href="#__codelineno-40-491"></a><span class="w">        </span><span class="s2">"gl"</span><span class="o">:</span><span class="w"> </span><span class="nx">gl_</span>
</span><span id="__span-40-492"><a id="__codelineno-40-492" name="__codelineno-40-492" href="#__codelineno-40-492"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-40-493"><a id="__codelineno-40-493" name="__codelineno-40-493" href="#__codelineno-40-493"></a><span class="p">};</span>
</span><span id="__span-40-494"><a id="__codelineno-40-494" name="__codelineno-40-494" href="#__codelineno-40-494"></a>
</span><span id="__span-40-495"><a id="__codelineno-40-495" name="__codelineno-40-495" href="#__codelineno-40-495"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createPie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-496"><a id="__codelineno-40-496" name="__codelineno-40-496" href="#__codelineno-40-496"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pieG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">)</span>
</span><span id="__span-40-497"><a id="__codelineno-40-497" name="__codelineno-40-497" href="#__codelineno-40-497"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pieX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">","</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pieY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">") rotate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">360</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">14</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">);</span>
</span><span id="__span-40-498"><a id="__codelineno-40-498" name="__codelineno-40-498" href="#__codelineno-40-498"></a>
</span><span id="__span-40-499"><a id="__codelineno-40-499" name="__codelineno-40-499" href="#__codelineno-40-499"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pieData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-500"><a id="__codelineno-40-500" name="__codelineno-40-500" href="#__codelineno-40-500"></a><span class="w">        </span><span class="s2">"All"</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
</span><span id="__span-40-501"><a id="__codelineno-40-501" name="__codelineno-40-501" href="#__codelineno-40-501"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-40-502"><a id="__codelineno-40-502" name="__codelineno-40-502" href="#__codelineno-40-502"></a>
</span><span id="__span-40-503"><a id="__codelineno-40-503" name="__codelineno-40-503" href="#__codelineno-40-503"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2018</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">2023</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-504"><a id="__codelineno-40-504" name="__codelineno-40-504" href="#__codelineno-40-504"></a><span class="w">        </span><span class="nx">pieData</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-40-505"><a id="__codelineno-40-505" name="__codelineno-40-505" href="#__codelineno-40-505"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-506"><a id="__codelineno-40-506" name="__codelineno-40-506" href="#__codelineno-40-506"></a>
</span><span id="__span-40-507"><a id="__codelineno-40-507" name="__codelineno-40-507" href="#__codelineno-40-507"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">pie</span><span class="p">()</span>
</span><span id="__span-40-508"><a id="__codelineno-40-508" name="__codelineno-40-508" href="#__codelineno-40-508"></a><span class="w">        </span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-509"><a id="__codelineno-40-509" name="__codelineno-40-509" href="#__codelineno-40-509"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-40-510"><a id="__codelineno-40-510" name="__codelineno-40-510" href="#__codelineno-40-510"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-40-511"><a id="__codelineno-40-511" name="__codelineno-40-511" href="#__codelineno-40-511"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data_ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pie</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">pieData</span><span class="p">).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-40-512"><a id="__codelineno-40-512" name="__codelineno-40-512" href="#__codelineno-40-512"></a><span class="w">        </span><span class="nx">key</span><span class="p">,</span>
</span><span id="__span-40-513"><a id="__codelineno-40-513" name="__codelineno-40-513" href="#__codelineno-40-513"></a><span class="w">        </span><span class="nx">value</span>
</span><span id="__span-40-514"><a id="__codelineno-40-514" name="__codelineno-40-514" href="#__codelineno-40-514"></a><span class="w">    </span><span class="p">})));</span>
</span><span id="__span-40-515"><a id="__codelineno-40-515" name="__codelineno-40-515" href="#__codelineno-40-515"></a>
</span><span id="__span-40-516"><a id="__codelineno-40-516" name="__codelineno-40-516" href="#__codelineno-40-516"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">arcGenerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">arc</span><span class="p">()</span>
</span><span id="__span-40-517"><a id="__codelineno-40-517" name="__codelineno-40-517" href="#__codelineno-40-517"></a><span class="w">        </span><span class="p">.</span><span class="nx">innerRadius</span><span class="p">(</span><span class="mf">50</span><span class="p">)</span>
</span><span id="__span-40-518"><a id="__codelineno-40-518" name="__codelineno-40-518" href="#__codelineno-40-518"></a><span class="w">        </span><span class="p">.</span><span class="nx">outerRadius</span><span class="p">(</span><span class="nx">pieRadius</span><span class="p">)</span>
</span><span id="__span-40-519"><a id="__codelineno-40-519" name="__codelineno-40-519" href="#__codelineno-40-519"></a>
</span><span id="__span-40-520"><a id="__codelineno-40-520" name="__codelineno-40-520" href="#__codelineno-40-520"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotatePie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-521"><a id="__codelineno-40-521" name="__codelineno-40-521" href="#__codelineno-40-521"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">rotate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">((</span><span class="nx">d</span><span class="p">.</span><span class="nx">startAngle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">endAngle</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
</span><span id="__span-40-522"><a id="__codelineno-40-522" name="__codelineno-40-522" href="#__codelineno-40-522"></a><span class="w">        </span><span class="nx">pieG</span><span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
</span><span id="__span-40-523"><a id="__codelineno-40-523" name="__codelineno-40-523" href="#__codelineno-40-523"></a><span class="w">            </span><span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
</span><span id="__span-40-524"><a id="__codelineno-40-524" name="__codelineno-40-524" href="#__codelineno-40-524"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pieX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">","</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pieY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">") rotate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">rotate</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">180</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">);</span>
</span><span id="__span-40-525"><a id="__codelineno-40-525" name="__codelineno-40-525" href="#__codelineno-40-525"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-40-526"><a id="__codelineno-40-526" name="__codelineno-40-526" href="#__codelineno-40-526"></a>
</span><span id="__span-40-527"><a id="__codelineno-40-527" name="__codelineno-40-527" href="#__codelineno-40-527"></a><span class="w">    </span><span class="nx">pieG</span>
</span><span id="__span-40-528"><a id="__codelineno-40-528" name="__codelineno-40-528" href="#__codelineno-40-528"></a><span class="w">        </span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'mySlices'</span><span class="p">)</span>
</span><span id="__span-40-529"><a id="__codelineno-40-529" name="__codelineno-40-529" href="#__codelineno-40-529"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">data_ready</span><span class="p">)</span>
</span><span id="__span-40-530"><a id="__codelineno-40-530" name="__codelineno-40-530" href="#__codelineno-40-530"></a><span class="w">        </span><span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
</span><span id="__span-40-531"><a id="__codelineno-40-531" name="__codelineno-40-531" href="#__codelineno-40-531"></a><span class="w">        </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>
</span><span id="__span-40-532"><a id="__codelineno-40-532" name="__codelineno-40-532" href="#__codelineno-40-532"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="nx">arcGenerator</span><span class="p">)</span>
</span><span id="__span-40-533"><a id="__codelineno-40-533" name="__codelineno-40-533" href="#__codelineno-40-533"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span><span class="w"> </span><span class="nx">PIE_SLICE_COLOR</span><span class="p">)</span>
</span><span id="__span-40-534"><a id="__codelineno-40-534" name="__codelineno-40-534" href="#__codelineno-40-534"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="s2">"white"</span><span class="p">)</span>
</span><span id="__span-40-535"><a id="__codelineno-40-535" name="__codelineno-40-535" href="#__codelineno-40-535"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2px"</span><span class="p">)</span>
</span><span id="__span-40-536"><a id="__codelineno-40-536" name="__codelineno-40-536" href="#__codelineno-40-536"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</span><span id="__span-40-537"><a id="__codelineno-40-537" name="__codelineno-40-537" href="#__codelineno-40-537"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-538"><a id="__codelineno-40-538" name="__codelineno-40-538" href="#__codelineno-40-538"></a><span class="w">            </span><span class="nx">setYear</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-40-539"><a id="__codelineno-40-539" name="__codelineno-40-539" href="#__codelineno-40-539"></a><span class="w">            </span><span class="nx">rotatePie</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-40-540"><a id="__codelineno-40-540" name="__codelineno-40-540" href="#__codelineno-40-540"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-40-541"><a id="__codelineno-40-541" name="__codelineno-40-541" href="#__codelineno-40-541"></a>
</span><span id="__span-40-542"><a id="__codelineno-40-542" name="__codelineno-40-542" href="#__codelineno-40-542"></a><span class="w">    </span><span class="nx">pieG</span>
</span><span id="__span-40-543"><a id="__codelineno-40-543" name="__codelineno-40-543" href="#__codelineno-40-543"></a><span class="w">        </span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'mySlices'</span><span class="p">)</span>
</span><span id="__span-40-544"><a id="__codelineno-40-544" name="__codelineno-40-544" href="#__codelineno-40-544"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">data_ready</span><span class="p">)</span>
</span><span id="__span-40-545"><a id="__codelineno-40-545" name="__codelineno-40-545" href="#__codelineno-40-545"></a><span class="w">        </span><span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
</span><span id="__span-40-546"><a id="__codelineno-40-546" name="__codelineno-40-546" href="#__codelineno-40-546"></a><span class="w">        </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'text'</span><span class="p">)</span>
</span><span id="__span-40-547"><a id="__codelineno-40-547" name="__codelineno-40-547" href="#__codelineno-40-547"></a><span class="w">        </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-548"><a id="__codelineno-40-548" name="__codelineno-40-548" href="#__codelineno-40-548"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span>
</span><span id="__span-40-549"><a id="__codelineno-40-549" name="__codelineno-40-549" href="#__codelineno-40-549"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-40-550"><a id="__codelineno-40-550" name="__codelineno-40-550" href="#__codelineno-40-550"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"dy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.3em"</span><span class="p">)</span>
</span><span id="__span-40-551"><a id="__codelineno-40-551" name="__codelineno-40-551" href="#__codelineno-40-551"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-552"><a id="__codelineno-40-552" name="__codelineno-40-552" href="#__codelineno-40-552"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s2">"translate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">arcGenerator</span><span class="p">.</span><span class="nx">centroid</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">") rotate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">startAngle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">endAngle</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">180</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">;</span>
</span><span id="__span-40-553"><a id="__codelineno-40-553" name="__codelineno-40-553" href="#__codelineno-40-553"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-40-554"><a id="__codelineno-40-554" name="__codelineno-40-554" href="#__codelineno-40-554"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'text-anchor'</span><span class="p">,</span><span class="w"> </span><span class="s1">'middle'</span><span class="p">)</span>
</span><span id="__span-40-555"><a id="__codelineno-40-555" name="__codelineno-40-555" href="#__codelineno-40-555"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span><span class="w"> </span><span class="nx">PIE_TEXT_COLOR</span><span class="p">)</span>
</span><span id="__span-40-556"><a id="__codelineno-40-556" name="__codelineno-40-556" href="#__codelineno-40-556"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-weight"</span><span class="p">,</span><span class="w"> </span><span class="mf">700</span><span class="p">)</span>
</span><span id="__span-40-557"><a id="__codelineno-40-557" name="__codelineno-40-557" href="#__codelineno-40-557"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-family"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Saira"</span><span class="p">)</span>
</span><span id="__span-40-558"><a id="__codelineno-40-558" name="__codelineno-40-558" href="#__codelineno-40-558"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="mf">18</span><span class="p">)</span>
</span><span id="__span-40-559"><a id="__codelineno-40-559" name="__codelineno-40-559" href="#__codelineno-40-559"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-560"><a id="__codelineno-40-560" name="__codelineno-40-560" href="#__codelineno-40-560"></a><span class="w">            </span><span class="nx">setYear</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-40-561"><a id="__codelineno-40-561" name="__codelineno-40-561" href="#__codelineno-40-561"></a><span class="w">            </span><span class="nx">rotatePie</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-40-562"><a id="__codelineno-40-562" name="__codelineno-40-562" href="#__codelineno-40-562"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-40-563"><a id="__codelineno-40-563" name="__codelineno-40-563" href="#__codelineno-40-563"></a><span class="p">};</span>
</span><span id="__span-40-564"><a id="__codelineno-40-564" name="__codelineno-40-564" href="#__codelineno-40-564"></a>
</span><span id="__span-40-565"><a id="__codelineno-40-565" name="__codelineno-40-565" href="#__codelineno-40-565"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createReferenceCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-566"><a id="__codelineno-40-566" name="__codelineno-40-566" href="#__codelineno-40-566"></a><span class="w">    </span><span class="nx">referenceCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-40-567"><a id="__codelineno-40-567" name="__codelineno-40-567" href="#__codelineno-40-567"></a><span class="w">    </span><span class="p">[</span><span class="s2">"All"</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">TOPICS</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)].</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">topic</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-568"><a id="__codelineno-40-568" name="__codelineno-40-568" href="#__codelineno-40-568"></a><span class="w">        </span><span class="nx">nodes_not_filtered</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-569"><a id="__codelineno-40-569" name="__codelineno-40-569" href="#__codelineno-40-569"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-40-570"><a id="__codelineno-40-570" name="__codelineno-40-570" href="#__codelineno-40-570"></a><span class="w">            </span><span class="nx">links_not_filtered</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-571"><a id="__codelineno-40-571" name="__codelineno-40-571" href="#__codelineno-40-571"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">topic</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-572"><a id="__codelineno-40-572" name="__codelineno-40-572" href="#__codelineno-40-572"></a><span class="w">                    </span><span class="nx">r</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-40-573"><a id="__codelineno-40-573" name="__codelineno-40-573" href="#__codelineno-40-573"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-40-574"><a id="__codelineno-40-574" name="__codelineno-40-574" href="#__codelineno-40-574"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-40-575"><a id="__codelineno-40-575" name="__codelineno-40-575" href="#__codelineno-40-575"></a><span class="w">            </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">normalize</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">minMaxMap</span><span class="p">[</span><span class="nx">topic</span><span class="p">].</span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">minMaxMap</span><span class="p">[</span><span class="nx">topic</span><span class="p">].</span><span class="nx">max</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">NODE_SIZE_MULTIPLIER</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">minMaxMap</span><span class="p">[</span><span class="nx">topic</span><span class="p">].</span><span class="nx">max</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">NODE_SIZE_MINIMUM</span><span class="p">;</span>
</span><span id="__span-40-576"><a id="__codelineno-40-576" name="__codelineno-40-576" href="#__codelineno-40-576"></a><span class="w">            </span><span class="nx">r</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nx">SCALE_FACTOR</span><span class="p">;</span>
</span><span id="__span-40-577"><a id="__codelineno-40-577" name="__codelineno-40-577" href="#__codelineno-40-577"></a><span class="w">            </span><span class="nx">data</span><span class="p">.</span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
</span><span id="__span-40-578"><a id="__codelineno-40-578" name="__codelineno-40-578" href="#__codelineno-40-578"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">referenceCache</span><span class="p">))</span><span class="w"> </span><span class="nx">referenceCache</span><span class="p">[</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-40-579"><a id="__codelineno-40-579" name="__codelineno-40-579" href="#__codelineno-40-579"></a><span class="w">            </span><span class="nx">referenceCache</span><span class="p">[</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="nx">topic</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">r</span><span class="p">;</span>
</span><span id="__span-40-580"><a id="__codelineno-40-580" name="__codelineno-40-580" href="#__codelineno-40-580"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-40-581"><a id="__codelineno-40-581" name="__codelineno-40-581" href="#__codelineno-40-581"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-40-582"><a id="__codelineno-40-582" name="__codelineno-40-582" href="#__codelineno-40-582"></a><span class="p">};</span>
</span><span id="__span-40-583"><a id="__codelineno-40-583" name="__codelineno-40-583" href="#__codelineno-40-583"></a>
</span><span id="__span-40-584"><a id="__codelineno-40-584" name="__codelineno-40-584" href="#__codelineno-40-584"></a><span class="kd">const</span><span class="w"> </span><span class="nx">centerText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">txt</span><span class="p">,</span><span class="w"> </span><span class="nx">xPos</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-585"><a id="__codelineno-40-585" name="__codelineno-40-585" href="#__codelineno-40-585"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">textWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">txt</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">getBBox</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>
</span><span id="__span-40-586"><a id="__codelineno-40-586" name="__codelineno-40-586" href="#__codelineno-40-586"></a><span class="w">    </span><span class="nx">txt</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">xPos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">textWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)));</span>
</span><span id="__span-40-587"><a id="__codelineno-40-587" name="__codelineno-40-587" href="#__codelineno-40-587"></a><span class="p">};</span>
</span><span id="__span-40-588"><a id="__codelineno-40-588" name="__codelineno-40-588" href="#__codelineno-40-588"></a>
</span><span id="__span-40-589"><a id="__codelineno-40-589" name="__codelineno-40-589" href="#__codelineno-40-589"></a><span class="kd">const</span><span class="w"> </span><span class="nx">pointerOutOfSVG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-590"><a id="__codelineno-40-590" name="__codelineno-40-590" href="#__codelineno-40-590"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">el</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">elementFromPoint</span><span class="p">(</span><span class="nx">mousePos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">mousePos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-40-591"><a id="__codelineno-40-591" name="__codelineno-40-591" href="#__codelineno-40-591"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nx">svg</span><span class="p">.</span><span class="nx">node</span><span class="p">()</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">el</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">contains</span><span class="p">(</span><span class="nx">el</span><span class="p">));</span>
</span><span id="__span-40-592"><a id="__codelineno-40-592" name="__codelineno-40-592" href="#__codelineno-40-592"></a><span class="p">};</span>
</span><span id="__span-40-593"><a id="__codelineno-40-593" name="__codelineno-40-593" href="#__codelineno-40-593"></a>
</span><span id="__span-40-594"><a id="__codelineno-40-594" name="__codelineno-40-594" href="#__codelineno-40-594"></a><span class="kd">const</span><span class="w"> </span><span class="nx">tooltipMouseover</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-595"><a id="__codelineno-40-595" name="__codelineno-40-595" href="#__codelineno-40-595"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mouseIsOver</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-40-596"><a id="__codelineno-40-596" name="__codelineno-40-596" href="#__codelineno-40-596"></a><span class="w">    </span><span class="nx">mouseIsOver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-40-597"><a id="__codelineno-40-597" name="__codelineno-40-597" href="#__codelineno-40-597"></a><span class="w">    </span><span class="nx">Tooltip</span>
</span><span id="__span-40-598"><a id="__codelineno-40-598" name="__codelineno-40-598" href="#__codelineno-40-598"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"display"</span><span class="p">,</span><span class="w"> </span><span class="s2">"initial"</span><span class="p">)</span>
</span><span id="__span-40-599"><a id="__codelineno-40-599" name="__codelineno-40-599" href="#__codelineno-40-599"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"visibility"</span><span class="p">,</span><span class="w"> </span><span class="s2">"visible"</span><span class="p">);</span>
</span><span id="__span-40-600"><a id="__codelineno-40-600" name="__codelineno-40-600" href="#__codelineno-40-600"></a>
</span><span id="__span-40-601"><a id="__codelineno-40-601" name="__codelineno-40-601" href="#__codelineno-40-601"></a><span class="w">    </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span><span id="__span-40-602"><a id="__codelineno-40-602" name="__codelineno-40-602" href="#__codelineno-40-602"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="nx">HOVER_NODE_STROKE_COLOR</span><span class="p">)</span>
</span><span id="__span-40-603"><a id="__codelineno-40-603" name="__codelineno-40-603" href="#__codelineno-40-603"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="nx">NODE_STROKE_WIDTH_HIGHLIGHTED</span><span class="p">);</span>
</span><span id="__span-40-604"><a id="__codelineno-40-604" name="__codelineno-40-604" href="#__codelineno-40-604"></a><span class="p">}</span>
</span><span id="__span-40-605"><a id="__codelineno-40-605" name="__codelineno-40-605" href="#__codelineno-40-605"></a>
</span><span id="__span-40-606"><a id="__codelineno-40-606" name="__codelineno-40-606" href="#__codelineno-40-606"></a><span class="kd">var</span><span class="w"> </span><span class="nx">tooltipMousemove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-607"><a id="__codelineno-40-607" name="__codelineno-40-607" href="#__codelineno-40-607"></a><span class="w">    </span><span class="nx">Tooltip</span>
</span><span id="__span-40-608"><a id="__codelineno-40-608" name="__codelineno-40-608" href="#__codelineno-40-608"></a><span class="w">        </span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s2">"&lt;span&gt;Student: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&lt;br&gt;Year: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&lt;br&gt;Lab: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">namesFromCodes</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">]]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&lt;br&gt;Region: &lt;span style=\"color:"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorRegion</span><span class="p">(</span><span class="nx">LABS_CONTINENT</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">]])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">";\"&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">LABS_CONTINENT</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">]]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&lt;/span&gt;&lt;/span&gt;"</span><span class="p">);</span>
</span><span id="__span-40-609"><a id="__codelineno-40-609" name="__codelineno-40-609" href="#__codelineno-40-609"></a><span class="p">};</span>
</span><span id="__span-40-610"><a id="__codelineno-40-610" name="__codelineno-40-610" href="#__codelineno-40-610"></a>
</span><span id="__span-40-611"><a id="__codelineno-40-611" name="__codelineno-40-611" href="#__codelineno-40-611"></a><span class="kd">var</span><span class="w"> </span><span class="nx">tooltipMouseleave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-612"><a id="__codelineno-40-612" name="__codelineno-40-612" href="#__codelineno-40-612"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">mouseIsDragging</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-40-613"><a id="__codelineno-40-613" name="__codelineno-40-613" href="#__codelineno-40-613"></a><span class="w">    </span><span class="nx">mouseIsOver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-40-614"><a id="__codelineno-40-614" name="__codelineno-40-614" href="#__codelineno-40-614"></a><span class="w">    </span><span class="nx">Tooltip</span>
</span><span id="__span-40-615"><a id="__codelineno-40-615" name="__codelineno-40-615" href="#__codelineno-40-615"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"display"</span><span class="p">,</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span>
</span><span id="__span-40-616"><a id="__codelineno-40-616" name="__codelineno-40-616" href="#__codelineno-40-616"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"visbility"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hidden"</span><span class="p">);</span>
</span><span id="__span-40-617"><a id="__codelineno-40-617" name="__codelineno-40-617" href="#__codelineno-40-617"></a>
</span><span id="__span-40-618"><a id="__codelineno-40-618" name="__codelineno-40-618" href="#__codelineno-40-618"></a><span class="w">    </span><span class="p">(</span><span class="nx">obj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">obj</span><span class="p">)</span>
</span><span id="__span-40-619"><a id="__codelineno-40-619" name="__codelineno-40-619" href="#__codelineno-40-619"></a><span class="w">    </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="nx">NOT_HOVERING_NODE_STROKE_COLOR</span><span class="p">)</span>
</span><span id="__span-40-620"><a id="__codelineno-40-620" name="__codelineno-40-620" href="#__codelineno-40-620"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="nx">NOT_HOVERING_NODE_STROKE_WIDTH</span><span class="p">);</span>
</span><span id="__span-40-621"><a id="__codelineno-40-621" name="__codelineno-40-621" href="#__codelineno-40-621"></a><span class="p">};</span>
</span></code></pre></div>
<h4 id="update-data">Update Data</h4>
<p>To create a scalable architecture for adding new features to the data visualization, the update sequence relies on multiples arrays of functions that each handle an aspect of the visualization. <code>updata_data.js</code> is the epicenter of interactivity in the visualization. See the following flowchart for an overview of the process.</p>
<p><img alt="Update Data Flowchart" src="../../assets/images/stem/expert-network-map/update_data_flowchart.jpg"></p>
<p>The <code>updateData</code> function is called whenever a filter is changed that requires an update in the visualization. It takes as a parameter <code>absolutes</code>, an object that stores the newly changed filters and object references (for example, the HTML element encasing the SVGs of the visualization). It is called <code>absolutes</code> since they do not change from the time the filters are updates to when the data has been recalculated and the visualization has been updates. </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">absolutes</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="nx">absolutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">      </span><span class="p">...</span><span class="nx">absolutes</span><span class="p">,</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">      </span><span class="s2">"topic"</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="s2">"topic"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">absolutes</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">currentTopic</span><span class="p">),</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">      </span><span class="s2">"year"</span><span class="o">:</span><span class="w"> </span><span class="nx">currentYear</span><span class="p">,</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">      </span><span class="nx">currentLabHighlightList</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filterData</span><span class="p">(</span><span class="nx">updateCallbacks</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">calculationDict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">runCalculations</span><span class="p">(</span><span class="nx">calculationCallbacks</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">  </span><span class="nx">setDataAttributes</span><span class="p">(</span><span class="nx">attributeCallbacks</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calculationDict</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="p">}</span>
</span></code></pre></div>
<p><code>updateData</code> first calls <code>filterData</code>, passing in <code>updateCallbacks</code> (an array of functions that filter which students and edges should appear given filters in <code>absolutes</code>) and <code>absolutes</code>. </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1">// filter nodes and edges based on `absolutes`</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">filterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">funcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">      </span><span class="s2">"nodes"</span><span class="o">:</span><span class="w"> </span><span class="nx">nodes_not_filtered</span><span class="p">,</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">      </span><span class="s2">"links"</span><span class="o">:</span><span class="w"> </span><span class="nx">links_not_filtered</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">funcs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">      </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="p">};</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="c1">// run calculations for visualization</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">runCalculations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">funcs</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">calcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">funcs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="w">      </span><span class="nx">calcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="w">          </span><span class="p">...</span><span class="nx">calcs</span><span class="p">,</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="w">          </span><span class="p">...</span><span class="nx">f</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">)</span>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">calcs</span><span class="p">;</span>
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="p">}</span>
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a>
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a><span class="c1">// update the visualization</span>
</span><span id="__span-42-26"><a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a><span class="kd">const</span><span class="w"> </span><span class="nx">setDataAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">funcs</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-27"><a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">funcs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-28"><a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a><span class="w">      </span><span class="nx">f</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-42-29"><a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-42-30"><a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a><span class="p">}</span>
</span></code></pre></div>
<p><code>updateCallbacks</code> filters the data by beginning with the arrays of all nodes and edges and removing students that do not meet the certain minimum number of times referenced for the selected subject area. However, students are not removed for filters such as lab and year - these nodes will have a lower opacity instead, set in the <code>attributeCallbacks</code> array.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">nodes_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">links_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">filterFunc</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">nodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nodes_not_filtered</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">filterFunc</span><span class="p">(</span><span class="nx">n</span><span class="p">));</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">node_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nodes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">links</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">links_not_filtered</span><span class="p">)).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// deepcopy solves heisenbug</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">));</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">          </span><span class="p">});</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">links</span><span class="p">];</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">links</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">links</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">sumObj</span><span class="p">(</span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">target</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">minNumConnections</span><span class="p">;</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">target</span><span class="p">[</span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">minNumConnections</span><span class="p">;</span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="w">          </span><span class="nx">nodes</span><span class="p">,</span>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="w">          </span><span class="nx">links</span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="p">];</span>
</span></code></pre></div>
<p><code>calculationCallbacks</code> runs all of the real-time calculations and fetches pre-calculated metrics that are required for the visualization. The functions are as follows:</p>
<ul>
<li>The strongest edge between two nodes (i.e. most times referenced each other out of any two pairs of students - number of times are pre-calculated, but which student has the highest for each subject-area is not) is found.</li>
<li>Overlapping edges are condensed (i.e. Student A referenced Student B 5 times and Student B referenced Student A 4 times for the subject area "Electronics Design" becomes one edge with a value of 9).</li>
<li>D3JS enter-update-exit protocol is used to update the <code>link</code> variable (different from <code>links</code>, <code>link</code> is a D3JS <a href="https://d3js.org/d3-selection/selecting">selection</a> of the edge elements)</li>
<li>D3JS enter-update-exit protocol is used to update the <code>node</code> variable (different from <code>nodes</code>, <code>node</code> is a D3JS <a href="https://d3js.org/d3-selection/selecting">selection</a> of the node elements)</li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">calculationCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">links</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxStrength</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">              </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">          </span><span class="nx">maxStrength</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="w">          </span><span class="s2">"condensedLinks"</span><span class="o">:</span><span class="w"> </span><span class="nx">condenseLinksforSimulation</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">links</span><span class="p">)</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">gl</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"path"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">calcs</span><span class="p">.</span><span class="nx">condensedLinks</span><span class="p">,</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uniqueId</span><span class="p">(</span><span class="nx">l</span><span class="p">));</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="w">      </span><span class="nx">sel</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a><span class="w">          </span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">ent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sel</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"path"</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a>
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-27"><a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a><span class="w">          </span><span class="s2">"link"</span><span class="o">:</span><span class="w"> </span><span class="nx">ent</span>
</span><span id="__span-44-28"><a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-44-29"><a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-44-30"><a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-31"><a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-44-32"><a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a><span class="w">      </span><span class="nx">sel</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span id="__span-44-33"><a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a><span class="w">          </span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span><span id="__span-44-34"><a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a>
</span><span id="__span-44-35"><a id="__codelineno-44-35" name="__codelineno-44-35" href="#__codelineno-44-35"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">ent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sel</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>
</span><span id="__span-44-36"><a id="__codelineno-44-36" name="__codelineno-44-36" href="#__codelineno-44-36"></a>
</span><span id="__span-44-37"><a id="__codelineno-44-37" name="__codelineno-44-37" href="#__codelineno-44-37"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-38"><a id="__codelineno-44-38" name="__codelineno-44-38" href="#__codelineno-44-38"></a><span class="w">          </span><span class="s2">"node"</span><span class="o">:</span><span class="w"> </span><span class="nx">ent</span>
</span><span id="__span-44-39"><a id="__codelineno-44-39" name="__codelineno-44-39" href="#__codelineno-44-39"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-44-40"><a id="__codelineno-44-40" name="__codelineno-44-40" href="#__codelineno-44-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-44-41"><a id="__codelineno-44-41" name="__codelineno-44-41" href="#__codelineno-44-41"></a><span class="p">];</span>
</span></code></pre></div>
<p><code>attributeCallbacks</code> actually updates the visualization using the calculations and compiled arrays from the first two processes, <code>updateCallbacks</code> and <code>calculationCallbacks</code>. The functions are as follows:</p>
<ul>
<li>set node radii</li>
<li>set force simulation edges, their lengths, and their strengths; set the collision circles for the nodes</li>
<li>color nodes by continent, change node opacity, set node drag mouse events</li>
<li>set edge stroke width and linecap</li>
<li>activate linear gradient SVGs for edges where one node is highlighted and one isn't (due to filters from <code>absolutes</code> that weren't utilized in <code>updateCallbacks</code> to eliminate nodes)</li>
<li>reduce opacity of unselected nodes</li>
<li>set opacity of edges where either both nodes are highlighted or not highlighted</li>
<li>when a student's node is clicked, open their documentation website</li>
<li>reheat simulation</li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">attributeCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// node radii</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w">      </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nx">referenceCache</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="p">];</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">      </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">nodes</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">);</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">      </span><span class="nx">forceCollide</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">);</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="c1">// simulation edges + node collision circles</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">      </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"link"</span><span class="p">,</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceLink</span><span class="p">(</span><span class="nx">calcs</span><span class="p">.</span><span class="nx">condensedLinks</span><span class="p">).</span><span class="nx">id</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">distance</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">getSimulationForceLinkDistance</span><span class="p">(</span><span class="nx">d</span><span class="p">)));</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">      </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"collision"</span><span class="p">,</span><span class="w"> </span><span class="nx">forceCollide</span><span class="p">.</span><span class="nx">radius</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">r</span><span class="p">));</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// coloring nodes by continent, setting node opacity, defining dragging behavior</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w">      </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">colorRegion</span><span class="p">(</span><span class="nx">LABS_CONTINENT</span><span class="p">[</span><span class="nx">lab</span><span class="p">]);</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w">          </span><span class="p">})</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="w">          </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="nx">NODE_HIGHLIGHTED_OPACITY</span><span class="p">)</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="w">          </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">drag</span><span class="p">()</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="w">              </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"start"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragstarted</span><span class="p">)</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="w">              </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"drag"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragged</span><span class="p">)</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="w">              </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"end"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragended</span><span class="p">));</span>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// setting edge stroke width and linecap</span>
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="w">      </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="w">          </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="nx">LINE_WIDTH</span><span class="p">)</span>
</span><span id="__span-45-27"><a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="w">          </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-linecap"</span><span class="p">,</span><span class="w"> </span><span class="s2">"round"</span><span class="p">);</span>
</span><span id="__span-45-28"><a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-45-29"><a id="__codelineno-45-29" name="__codelineno-45-29" href="#__codelineno-45-29"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// manipulate linear gradient SVGs for edges where one node is highlighted and one isn't</span>
</span><span id="__span-45-30"><a id="__codelineno-45-30" name="__codelineno-45-30" href="#__codelineno-45-30"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">linkTick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-31"><a id="__codelineno-45-31" name="__codelineno-45-31" href="#__codelineno-45-31"></a><span class="w">          </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"d"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-32"><a id="__codelineno-45-32" name="__codelineno-45-32" href="#__codelineno-45-32"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">gradientID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-45-33"><a id="__codelineno-45-33" name="__codelineno-45-33" href="#__codelineno-45-33"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">lg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">gradientID</span><span class="p">);</span>
</span><span id="__span-45-34"><a id="__codelineno-45-34" name="__codelineno-45-34" href="#__codelineno-45-34"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-35"><a id="__codelineno-45-35" name="__codelineno-45-35" href="#__codelineno-45-35"></a><span class="w">                  </span><span class="nx">source</span><span class="p">,</span>
</span><span id="__span-45-36"><a id="__codelineno-45-36" name="__codelineno-45-36" href="#__codelineno-45-36"></a><span class="w">                  </span><span class="nx">sourceYear</span><span class="p">,</span>
</span><span id="__span-45-37"><a id="__codelineno-45-37" name="__codelineno-45-37" href="#__codelineno-45-37"></a><span class="w">                  </span><span class="nx">sourceLab</span><span class="p">,</span>
</span><span id="__span-45-38"><a id="__codelineno-45-38" name="__codelineno-45-38" href="#__codelineno-45-38"></a><span class="w">                  </span><span class="nx">target</span><span class="p">,</span>
</span><span id="__span-45-39"><a id="__codelineno-45-39" name="__codelineno-45-39" href="#__codelineno-45-39"></a><span class="w">                  </span><span class="nx">targetYear</span><span class="p">,</span>
</span><span id="__span-45-40"><a id="__codelineno-45-40" name="__codelineno-45-40" href="#__codelineno-45-40"></a><span class="w">                  </span><span class="nx">targetLab</span>
</span><span id="__span-45-41"><a id="__codelineno-45-41" name="__codelineno-45-41" href="#__codelineno-45-41"></a><span class="w">              </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getLinkSummary</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-45-42"><a id="__codelineno-45-42" name="__codelineno-45-42" href="#__codelineno-45-42"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceYear</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceLab</span><span class="p">);</span>
</span><span id="__span-45-43"><a id="__codelineno-45-43" name="__codelineno-45-43" href="#__codelineno-45-43"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">targetYear</span><span class="p">,</span><span class="w"> </span><span class="nx">targetLab</span><span class="p">);</span>
</span><span id="__span-45-44"><a id="__codelineno-45-44" name="__codelineno-45-44" href="#__codelineno-45-44"></a><span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="p">))))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if only one is activated</span>
</span><span id="__span-45-45"><a id="__codelineno-45-45" name="__codelineno-45-45" href="#__codelineno-45-45"></a>
</span><span id="__span-45-46"><a id="__codelineno-45-46" name="__codelineno-45-46" href="#__codelineno-45-46"></a><span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsActivated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-47"><a id="__codelineno-45-47" name="__codelineno-45-47" href="#__codelineno-45-47"></a><span class="w">                      </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-45-48"><a id="__codelineno-45-48" name="__codelineno-45-48" href="#__codelineno-45-48"></a><span class="w">                      </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-45-49"><a id="__codelineno-45-49" name="__codelineno-45-49" href="#__codelineno-45-49"></a><span class="w">                      </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-45-50"><a id="__codelineno-45-50" name="__codelineno-45-50" href="#__codelineno-45-50"></a><span class="w">                      </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-45-51"><a id="__codelineno-45-51" name="__codelineno-45-51" href="#__codelineno-45-51"></a><span class="w">                  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-52"><a id="__codelineno-45-52" name="__codelineno-45-52" href="#__codelineno-45-52"></a><span class="w">                      </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-45-53"><a id="__codelineno-45-53" name="__codelineno-45-53" href="#__codelineno-45-53"></a><span class="w">                      </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-45-54"><a id="__codelineno-45-54" name="__codelineno-45-54" href="#__codelineno-45-54"></a><span class="w">                      </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-45-55"><a id="__codelineno-45-55" name="__codelineno-45-55" href="#__codelineno-45-55"></a><span class="w">                      </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-45-56"><a id="__codelineno-45-56" name="__codelineno-45-56" href="#__codelineno-45-56"></a><span class="w">                  </span><span class="p">}</span>
</span><span id="__span-45-57"><a id="__codelineno-45-57" name="__codelineno-45-57" href="#__codelineno-45-57"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-45-58"><a id="__codelineno-45-58" name="__codelineno-45-58" href="#__codelineno-45-58"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">path</span><span class="p">();</span>
</span><span id="__span-45-59"><a id="__codelineno-45-59" name="__codelineno-45-59" href="#__codelineno-45-59"></a><span class="w">              </span><span class="nx">path</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-45-60"><a id="__codelineno-45-60" name="__codelineno-45-60" href="#__codelineno-45-60"></a><span class="w">              </span><span class="nx">path</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-45-61"><a id="__codelineno-45-61" name="__codelineno-45-61" href="#__codelineno-45-61"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span id="__span-45-62"><a id="__codelineno-45-62" name="__codelineno-45-62" href="#__codelineno-45-62"></a><span class="w">          </span><span class="p">});</span>
</span><span id="__span-45-63"><a id="__codelineno-45-63" name="__codelineno-45-63" href="#__codelineno-45-63"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-45-64"><a id="__codelineno-45-64" name="__codelineno-45-64" href="#__codelineno-45-64"></a><span class="w">      </span><span class="nx">linkTick</span><span class="p">();</span>
</span><span id="__span-45-65"><a id="__codelineno-45-65" name="__codelineno-45-65" href="#__codelineno-45-65"></a><span class="w">      </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"tick"</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-66"><a id="__codelineno-45-66" name="__codelineno-45-66" href="#__codelineno-45-66"></a><span class="w">          </span><span class="nx">linkTick</span><span class="p">();</span>
</span><span id="__span-45-67"><a id="__codelineno-45-67" name="__codelineno-45-67" href="#__codelineno-45-67"></a><span class="w">          </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span>
</span><span id="__span-45-68"><a id="__codelineno-45-68" name="__codelineno-45-68" href="#__codelineno-45-68"></a><span class="w">              </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cx"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-45-69"><a id="__codelineno-45-69" name="__codelineno-45-69" href="#__codelineno-45-69"></a><span class="w">              </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cy"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-45-70"><a id="__codelineno-45-70" name="__codelineno-45-70" href="#__codelineno-45-70"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-45-71"><a id="__codelineno-45-71" name="__codelineno-45-71" href="#__codelineno-45-71"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-45-72"><a id="__codelineno-45-72" name="__codelineno-45-72" href="#__codelineno-45-72"></a><span class="w">  </span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// reduce opacity of unselected nodes</span>
</span><span id="__span-45-73"><a id="__codelineno-45-73" name="__codelineno-45-73" href="#__codelineno-45-73"></a><span class="w">      </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-74"><a id="__codelineno-45-74" name="__codelineno-45-74" href="#__codelineno-45-74"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-45-75"><a id="__codelineno-45-75" name="__codelineno-45-75" href="#__codelineno-45-75"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-45-76"><a id="__codelineno-45-76" name="__codelineno-45-76" href="#__codelineno-45-76"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">lab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-77"><a id="__codelineno-45-77" name="__codelineno-45-77" href="#__codelineno-45-77"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">NODE_HIGHLIGHTED_OPACITY</span><span class="p">;</span>
</span><span id="__span-45-78"><a id="__codelineno-45-78" name="__codelineno-45-78" href="#__codelineno-45-78"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-79"><a id="__codelineno-45-79" name="__codelineno-45-79" href="#__codelineno-45-79"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">minOpacity</span><span class="p">;</span>
</span><span id="__span-45-80"><a id="__codelineno-45-80" name="__codelineno-45-80" href="#__codelineno-45-80"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-81"><a id="__codelineno-45-81" name="__codelineno-45-81" href="#__codelineno-45-81"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-45-82"><a id="__codelineno-45-82" name="__codelineno-45-82" href="#__codelineno-45-82"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-45-83"><a id="__codelineno-45-83" name="__codelineno-45-83" href="#__codelineno-45-83"></a><span class="w">  </span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// set opacity of edges where either both nodes are highlighted or not highlighted</span>
</span><span id="__span-45-84"><a id="__codelineno-45-84" name="__codelineno-45-84" href="#__codelineno-45-84"></a><span class="w">      </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-85"><a id="__codelineno-45-85" name="__codelineno-45-85" href="#__codelineno-45-85"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-86"><a id="__codelineno-45-86" name="__codelineno-45-86" href="#__codelineno-45-86"></a><span class="w">              </span><span class="nx">source</span><span class="p">,</span>
</span><span id="__span-45-87"><a id="__codelineno-45-87" name="__codelineno-45-87" href="#__codelineno-45-87"></a><span class="w">              </span><span class="nx">sourceYear</span><span class="p">,</span>
</span><span id="__span-45-88"><a id="__codelineno-45-88" name="__codelineno-45-88" href="#__codelineno-45-88"></a><span class="w">              </span><span class="nx">sourceLab</span><span class="p">,</span>
</span><span id="__span-45-89"><a id="__codelineno-45-89" name="__codelineno-45-89" href="#__codelineno-45-89"></a><span class="w">              </span><span class="nx">target</span><span class="p">,</span>
</span><span id="__span-45-90"><a id="__codelineno-45-90" name="__codelineno-45-90" href="#__codelineno-45-90"></a><span class="w">              </span><span class="nx">targetYear</span><span class="p">,</span>
</span><span id="__span-45-91"><a id="__codelineno-45-91" name="__codelineno-45-91" href="#__codelineno-45-91"></a><span class="w">              </span><span class="nx">targetLab</span>
</span><span id="__span-45-92"><a id="__codelineno-45-92" name="__codelineno-45-92" href="#__codelineno-45-92"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getLinkSummary</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-45-93"><a id="__codelineno-45-93" name="__codelineno-45-93" href="#__codelineno-45-93"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-45-94"><a id="__codelineno-45-94" name="__codelineno-45-94" href="#__codelineno-45-94"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-45-95"><a id="__codelineno-45-95" name="__codelineno-45-95" href="#__codelineno-45-95"></a>
</span><span id="__span-45-96"><a id="__codelineno-45-96" name="__codelineno-45-96" href="#__codelineno-45-96"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceYear</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-97"><a id="__codelineno-45-97" name="__codelineno-45-97" href="#__codelineno-45-97"></a><span class="w">              </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-45-98"><a id="__codelineno-45-98" name="__codelineno-45-98" href="#__codelineno-45-98"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-99"><a id="__codelineno-45-99" name="__codelineno-45-99" href="#__codelineno-45-99"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">targetYear</span><span class="p">,</span><span class="w"> </span><span class="nx">targetLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-100"><a id="__codelineno-45-100" name="__codelineno-45-100" href="#__codelineno-45-100"></a><span class="w">              </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-45-101"><a id="__codelineno-45-101" name="__codelineno-45-101" href="#__codelineno-45-101"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-102"><a id="__codelineno-45-102" name="__codelineno-45-102" href="#__codelineno-45-102"></a>
</span><span id="__span-45-103"><a id="__codelineno-45-103" name="__codelineno-45-103" href="#__codelineno-45-103"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-104"><a id="__codelineno-45-104" name="__codelineno-45-104" href="#__codelineno-45-104"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-45-105"><a id="__codelineno-45-105" name="__codelineno-45-105" href="#__codelineno-45-105"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-106"><a id="__codelineno-45-106" name="__codelineno-45-106" href="#__codelineno-45-106"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-45-107"><a id="__codelineno-45-107" name="__codelineno-45-107" href="#__codelineno-45-107"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-45-108"><a id="__codelineno-45-108" name="__codelineno-45-108" href="#__codelineno-45-108"></a><span class="w">      </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-109"><a id="__codelineno-45-109" name="__codelineno-45-109" href="#__codelineno-45-109"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-45-110"><a id="__codelineno-45-110" name="__codelineno-45-110" href="#__codelineno-45-110"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-45-111"><a id="__codelineno-45-111" name="__codelineno-45-111" href="#__codelineno-45-111"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceLab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-45-112"><a id="__codelineno-45-112" name="__codelineno-45-112" href="#__codelineno-45-112"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-45-113"><a id="__codelineno-45-113" name="__codelineno-45-113" href="#__codelineno-45-113"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-45-114"><a id="__codelineno-45-114" name="__codelineno-45-114" href="#__codelineno-45-114"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetLab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-45-115"><a id="__codelineno-45-115" name="__codelineno-45-115" href="#__codelineno-45-115"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-45-116"><a id="__codelineno-45-116" name="__codelineno-45-116" href="#__codelineno-45-116"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-45-117"><a id="__codelineno-45-117" name="__codelineno-45-117" href="#__codelineno-45-117"></a>
</span><span id="__span-45-118"><a id="__codelineno-45-118" name="__codelineno-45-118" href="#__codelineno-45-118"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceYear</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-119"><a id="__codelineno-45-119" name="__codelineno-45-119" href="#__codelineno-45-119"></a><span class="w">              </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-45-120"><a id="__codelineno-45-120" name="__codelineno-45-120" href="#__codelineno-45-120"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-121"><a id="__codelineno-45-121" name="__codelineno-45-121" href="#__codelineno-45-121"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">targetYear</span><span class="p">,</span><span class="w"> </span><span class="nx">targetLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-122"><a id="__codelineno-45-122" name="__codelineno-45-122" href="#__codelineno-45-122"></a><span class="w">              </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-45-123"><a id="__codelineno-45-123" name="__codelineno-45-123" href="#__codelineno-45-123"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-124"><a id="__codelineno-45-124" name="__codelineno-45-124" href="#__codelineno-45-124"></a>
</span><span id="__span-45-125"><a id="__codelineno-45-125" name="__codelineno-45-125" href="#__codelineno-45-125"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-126"><a id="__codelineno-45-126" name="__codelineno-45-126" href="#__codelineno-45-126"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="s2">"rgba("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">RGB_LINE_COLOR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">",1)"</span><span class="p">;</span>
</span><span id="__span-45-127"><a id="__codelineno-45-127" name="__codelineno-45-127" href="#__codelineno-45-127"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-128"><a id="__codelineno-45-128" name="__codelineno-45-128" href="#__codelineno-45-128"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="sb">`url(#</span><span class="si">${</span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span>
</span><span id="__span-45-129"><a id="__codelineno-45-129" name="__codelineno-45-129" href="#__codelineno-45-129"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-130"><a id="__codelineno-45-130" name="__codelineno-45-130" href="#__codelineno-45-130"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="s2">"rgba("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">RGB_LINE_COLOR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">",0.05)"</span><span class="p">;</span>
</span><span id="__span-45-131"><a id="__codelineno-45-131" name="__codelineno-45-131" href="#__codelineno-45-131"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-132"><a id="__codelineno-45-132" name="__codelineno-45-132" href="#__codelineno-45-132"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-45-133"><a id="__codelineno-45-133" name="__codelineno-45-133" href="#__codelineno-45-133"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-45-134"><a id="__codelineno-45-134" name="__codelineno-45-134" href="#__codelineno-45-134"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// when a student's node is clicked, open their documentation website</span>
</span><span id="__span-45-135"><a id="__codelineno-45-135" name="__codelineno-45-135" href="#__codelineno-45-135"></a>
</span><span id="__span-45-136"><a id="__codelineno-45-136" name="__codelineno-45-136" href="#__codelineno-45-136"></a><span class="w">      </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-137"><a id="__codelineno-45-137" name="__codelineno-45-137" href="#__codelineno-45-137"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-45-138"><a id="__codelineno-45-138" name="__codelineno-45-138" href="#__codelineno-45-138"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseover"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-139"><a id="__codelineno-45-139" name="__codelineno-45-139" href="#__codelineno-45-139"></a><span class="w">              </span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseover"</span><span class="p">,</span><span class="w"> </span><span class="nx">tooltipMouseover</span><span class="p">)</span>
</span><span id="__span-45-140"><a id="__codelineno-45-140" name="__codelineno-45-140" href="#__codelineno-45-140"></a><span class="w">                  </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mousemove"</span><span class="p">,</span><span class="w"> </span><span class="nx">tooltipMousemove</span><span class="p">)</span>
</span><span id="__span-45-141"><a id="__codelineno-45-141" name="__codelineno-45-141" href="#__codelineno-45-141"></a><span class="w">                  </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseleave"</span><span class="p">,</span><span class="w"> </span><span class="nx">tooltipMouseleave</span><span class="p">);</span>
</span><span id="__span-45-142"><a id="__codelineno-45-142" name="__codelineno-45-142" href="#__codelineno-45-142"></a><span class="w">              </span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-143"><a id="__codelineno-45-143" name="__codelineno-45-143" href="#__codelineno-45-143"></a><span class="w">                  </span><span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">],</span><span class="w"> </span><span class="s2">"_blank"</span><span class="p">)</span>
</span><span id="__span-45-144"><a id="__codelineno-45-144" name="__codelineno-45-144" href="#__codelineno-45-144"></a><span class="w">              </span><span class="p">})</span>
</span><span id="__span-45-145"><a id="__codelineno-45-145" name="__codelineno-45-145" href="#__codelineno-45-145"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-146"><a id="__codelineno-45-146" name="__codelineno-45-146" href="#__codelineno-45-146"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-45-147"><a id="__codelineno-45-147" name="__codelineno-45-147" href="#__codelineno-45-147"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-45-148"><a id="__codelineno-45-148" name="__codelineno-45-148" href="#__codelineno-45-148"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">alpha</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">restart</span><span class="p">()</span><span class="w"> </span><span class="c1">// reheat simulation</span>
</span><span id="__span-45-149"><a id="__codelineno-45-149" name="__codelineno-45-149" href="#__codelineno-45-149"></a><span class="p">];</span>
</span></code></pre></div>
<p>So all together, here's <code>update_data.js</code>.</p>
<p><em>update_data.js</em></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">nodes_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">links_not_filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">filterFunc</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">nodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nodes_not_filtered</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">filterFunc</span><span class="p">(</span><span class="nx">n</span><span class="p">));</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">node_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nodes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">links</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">links_not_filtered</span><span class="p">)).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// deepcopy solves heisenbug</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">target</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">node_ids</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">source</span><span class="p">));</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">          </span><span class="p">});</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">links</span><span class="p">];</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">links</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">links</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">sumObj</span><span class="p">(</span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">target</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">minNumConnections</span><span class="p">;</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">numLinksDict</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">target</span><span class="p">[</span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">minNumConnections</span><span class="p">;</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="w">          </span><span class="nx">nodes</span><span class="p">,</span>
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="w">          </span><span class="nx">links</span>
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a><span class="p">];</span>
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a>
</span><span id="__span-46-27"><a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="kd">const</span><span class="w"> </span><span class="nx">calculationCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-46-28"><a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-29"><a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a><span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-46-30"><a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a><span class="w">      </span><span class="nx">data</span><span class="p">.</span><span class="nx">links</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-31"><a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxStrength</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-32"><a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a><span class="w">              </span><span class="nx">maxStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-46-33"><a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-46-34"><a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-46-35"><a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-36"><a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a><span class="w">          </span><span class="nx">maxStrength</span>
</span><span id="__span-46-37"><a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-46-38"><a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-46-39"><a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-40"><a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-41"><a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a><span class="w">          </span><span class="s2">"condensedLinks"</span><span class="o">:</span><span class="w"> </span><span class="nx">condenseLinksforSimulation</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">links</span><span class="p">)</span>
</span><span id="__span-46-42"><a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-46-43"><a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-46-44"><a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-45"><a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">gl</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"path"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">calcs</span><span class="p">.</span><span class="nx">condensedLinks</span><span class="p">,</span><span class="w"> </span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">uniqueId</span><span class="p">(</span><span class="nx">l</span><span class="p">));</span>
</span><span id="__span-46-46"><a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a>
</span><span id="__span-46-47"><a id="__codelineno-46-47" name="__codelineno-46-47" href="#__codelineno-46-47"></a><span class="w">      </span><span class="nx">sel</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span id="__span-46-48"><a id="__codelineno-46-48" name="__codelineno-46-48" href="#__codelineno-46-48"></a><span class="w">          </span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span><span id="__span-46-49"><a id="__codelineno-46-49" name="__codelineno-46-49" href="#__codelineno-46-49"></a>
</span><span id="__span-46-50"><a id="__codelineno-46-50" name="__codelineno-46-50" href="#__codelineno-46-50"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">ent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sel</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"path"</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>
</span><span id="__span-46-51"><a id="__codelineno-46-51" name="__codelineno-46-51" href="#__codelineno-46-51"></a>
</span><span id="__span-46-52"><a id="__codelineno-46-52" name="__codelineno-46-52" href="#__codelineno-46-52"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-53"><a id="__codelineno-46-53" name="__codelineno-46-53" href="#__codelineno-46-53"></a><span class="w">          </span><span class="s2">"link"</span><span class="o">:</span><span class="w"> </span><span class="nx">ent</span>
</span><span id="__span-46-54"><a id="__codelineno-46-54" name="__codelineno-46-54" href="#__codelineno-46-54"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-46-55"><a id="__codelineno-46-55" name="__codelineno-46-55" href="#__codelineno-46-55"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-46-56"><a id="__codelineno-46-56" name="__codelineno-46-56" href="#__codelineno-46-56"></a><span class="w">  </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-57"><a id="__codelineno-46-57" name="__codelineno-46-57" href="#__codelineno-46-57"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-46-58"><a id="__codelineno-46-58" name="__codelineno-46-58" href="#__codelineno-46-58"></a><span class="w">      </span><span class="nx">sel</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</span><span id="__span-46-59"><a id="__codelineno-46-59" name="__codelineno-46-59" href="#__codelineno-46-59"></a><span class="w">          </span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span><span id="__span-46-60"><a id="__codelineno-46-60" name="__codelineno-46-60" href="#__codelineno-46-60"></a>
</span><span id="__span-46-61"><a id="__codelineno-46-61" name="__codelineno-46-61" href="#__codelineno-46-61"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">ent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sel</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">sel</span><span class="p">);</span>
</span><span id="__span-46-62"><a id="__codelineno-46-62" name="__codelineno-46-62" href="#__codelineno-46-62"></a>
</span><span id="__span-46-63"><a id="__codelineno-46-63" name="__codelineno-46-63" href="#__codelineno-46-63"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-64"><a id="__codelineno-46-64" name="__codelineno-46-64" href="#__codelineno-46-64"></a><span class="w">          </span><span class="s2">"node"</span><span class="o">:</span><span class="w"> </span><span class="nx">ent</span>
</span><span id="__span-46-65"><a id="__codelineno-46-65" name="__codelineno-46-65" href="#__codelineno-46-65"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-46-66"><a id="__codelineno-46-66" name="__codelineno-46-66" href="#__codelineno-46-66"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-46-67"><a id="__codelineno-46-67" name="__codelineno-46-67" href="#__codelineno-46-67"></a><span class="p">];</span>
</span><span id="__span-46-68"><a id="__codelineno-46-68" name="__codelineno-46-68" href="#__codelineno-46-68"></a>
</span><span id="__span-46-69"><a id="__codelineno-46-69" name="__codelineno-46-69" href="#__codelineno-46-69"></a><span class="kd">const</span><span class="w"> </span><span class="nx">attributeCallbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-46-70"><a id="__codelineno-46-70" name="__codelineno-46-70" href="#__codelineno-46-70"></a><span class="w">    </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// node radii</span>
</span><span id="__span-46-71"><a id="__codelineno-46-71" name="__codelineno-46-71" href="#__codelineno-46-71"></a><span class="w">        </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-72"><a id="__codelineno-46-72" name="__codelineno-46-72" href="#__codelineno-46-72"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">referenceCache</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="nx">absl</span><span class="p">.</span><span class="nx">topic</span><span class="p">];</span>
</span><span id="__span-46-73"><a id="__codelineno-46-73" name="__codelineno-46-73" href="#__codelineno-46-73"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-46-74"><a id="__codelineno-46-74" name="__codelineno-46-74" href="#__codelineno-46-74"></a><span class="w">        </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">nodes</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">);</span>
</span><span id="__span-46-75"><a id="__codelineno-46-75" name="__codelineno-46-75" href="#__codelineno-46-75"></a><span class="w">        </span><span class="nx">forceCollide</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">nodes</span><span class="p">);</span>
</span><span id="__span-46-76"><a id="__codelineno-46-76" name="__codelineno-46-76" href="#__codelineno-46-76"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="c1">// simulation edges + node collision circles</span>
</span><span id="__span-46-77"><a id="__codelineno-46-77" name="__codelineno-46-77" href="#__codelineno-46-77"></a><span class="w">    </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-78"><a id="__codelineno-46-78" name="__codelineno-46-78" href="#__codelineno-46-78"></a><span class="w">        </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"link"</span><span class="p">,</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">forceLink</span><span class="p">(</span><span class="nx">calcs</span><span class="p">.</span><span class="nx">condensedLinks</span><span class="p">).</span><span class="nx">id</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">distance</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">getSimulationForceLinkDistance</span><span class="p">(</span><span class="nx">d</span><span class="p">)));</span>
</span><span id="__span-46-79"><a id="__codelineno-46-79" name="__codelineno-46-79" href="#__codelineno-46-79"></a><span class="w">        </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">force</span><span class="p">(</span><span class="s2">"collision"</span><span class="p">,</span><span class="w"> </span><span class="nx">forceCollide</span><span class="p">.</span><span class="nx">radius</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">r</span><span class="p">));</span>
</span><span id="__span-46-80"><a id="__codelineno-46-80" name="__codelineno-46-80" href="#__codelineno-46-80"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-46-81"><a id="__codelineno-46-81" name="__codelineno-46-81" href="#__codelineno-46-81"></a><span class="w">    </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// coloring nodes by continent, setting node opacity, defining dragging behavior</span>
</span><span id="__span-46-82"><a id="__codelineno-46-82" name="__codelineno-46-82" href="#__codelineno-46-82"></a><span class="w">        </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-83"><a id="__codelineno-46-83" name="__codelineno-46-83" href="#__codelineno-46-83"></a><span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-46-84"><a id="__codelineno-46-84" name="__codelineno-46-84" href="#__codelineno-46-84"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">colorRegion</span><span class="p">(</span><span class="nx">LABS_CONTINENT</span><span class="p">[</span><span class="nx">lab</span><span class="p">]);</span>
</span><span id="__span-46-85"><a id="__codelineno-46-85" name="__codelineno-46-85" href="#__codelineno-46-85"></a><span class="w">            </span><span class="p">})</span>
</span><span id="__span-46-86"><a id="__codelineno-46-86" name="__codelineno-46-86" href="#__codelineno-46-86"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="nx">NODE_HIGHLIGHTED_OPACITY</span><span class="p">)</span>
</span><span id="__span-46-87"><a id="__codelineno-46-87" name="__codelineno-46-87" href="#__codelineno-46-87"></a><span class="w">            </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">drag</span><span class="p">()</span>
</span><span id="__span-46-88"><a id="__codelineno-46-88" name="__codelineno-46-88" href="#__codelineno-46-88"></a><span class="w">                </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"start"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragstarted</span><span class="p">)</span>
</span><span id="__span-46-89"><a id="__codelineno-46-89" name="__codelineno-46-89" href="#__codelineno-46-89"></a><span class="w">                </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"drag"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragged</span><span class="p">)</span>
</span><span id="__span-46-90"><a id="__codelineno-46-90" name="__codelineno-46-90" href="#__codelineno-46-90"></a><span class="w">                </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"end"</span><span class="p">,</span><span class="w"> </span><span class="nx">dragended</span><span class="p">));</span>
</span><span id="__span-46-91"><a id="__codelineno-46-91" name="__codelineno-46-91" href="#__codelineno-46-91"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-46-92"><a id="__codelineno-46-92" name="__codelineno-46-92" href="#__codelineno-46-92"></a><span class="w">    </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// setting edge stroke width and linecap</span>
</span><span id="__span-46-93"><a id="__codelineno-46-93" name="__codelineno-46-93" href="#__codelineno-46-93"></a><span class="w">        </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span>
</span><span id="__span-46-94"><a id="__codelineno-46-94" name="__codelineno-46-94" href="#__codelineno-46-94"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="nx">LINE_WIDTH</span><span class="p">)</span>
</span><span id="__span-46-95"><a id="__codelineno-46-95" name="__codelineno-46-95" href="#__codelineno-46-95"></a><span class="w">            </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-linecap"</span><span class="p">,</span><span class="w"> </span><span class="s2">"round"</span><span class="p">);</span>
</span><span id="__span-46-96"><a id="__codelineno-46-96" name="__codelineno-46-96" href="#__codelineno-46-96"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-46-97"><a id="__codelineno-46-97" name="__codelineno-46-97" href="#__codelineno-46-97"></a><span class="w">    </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// manipulate linear gradient SVGs for edges where one node is highlighted and one isn't</span>
</span><span id="__span-46-98"><a id="__codelineno-46-98" name="__codelineno-46-98" href="#__codelineno-46-98"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">linkTick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-99"><a id="__codelineno-46-99" name="__codelineno-46-99" href="#__codelineno-46-99"></a><span class="w">            </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"d"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-100"><a id="__codelineno-46-100" name="__codelineno-46-100" href="#__codelineno-46-100"></a><span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">gradientID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-46-101"><a id="__codelineno-46-101" name="__codelineno-46-101" href="#__codelineno-46-101"></a><span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">lg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">gradientID</span><span class="p">);</span>
</span><span id="__span-46-102"><a id="__codelineno-46-102" name="__codelineno-46-102" href="#__codelineno-46-102"></a><span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-103"><a id="__codelineno-46-103" name="__codelineno-46-103" href="#__codelineno-46-103"></a><span class="w">                    </span><span class="nx">source</span><span class="p">,</span>
</span><span id="__span-46-104"><a id="__codelineno-46-104" name="__codelineno-46-104" href="#__codelineno-46-104"></a><span class="w">                    </span><span class="nx">sourceYear</span><span class="p">,</span>
</span><span id="__span-46-105"><a id="__codelineno-46-105" name="__codelineno-46-105" href="#__codelineno-46-105"></a><span class="w">                    </span><span class="nx">sourceLab</span><span class="p">,</span>
</span><span id="__span-46-106"><a id="__codelineno-46-106" name="__codelineno-46-106" href="#__codelineno-46-106"></a><span class="w">                    </span><span class="nx">target</span><span class="p">,</span>
</span><span id="__span-46-107"><a id="__codelineno-46-107" name="__codelineno-46-107" href="#__codelineno-46-107"></a><span class="w">                    </span><span class="nx">targetYear</span><span class="p">,</span>
</span><span id="__span-46-108"><a id="__codelineno-46-108" name="__codelineno-46-108" href="#__codelineno-46-108"></a><span class="w">                    </span><span class="nx">targetLab</span>
</span><span id="__span-46-109"><a id="__codelineno-46-109" name="__codelineno-46-109" href="#__codelineno-46-109"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getLinkSummary</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-46-110"><a id="__codelineno-46-110" name="__codelineno-46-110" href="#__codelineno-46-110"></a><span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceYear</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceLab</span><span class="p">);</span>
</span><span id="__span-46-111"><a id="__codelineno-46-111" name="__codelineno-46-111" href="#__codelineno-46-111"></a><span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">targetYear</span><span class="p">,</span><span class="w"> </span><span class="nx">targetLab</span><span class="p">);</span>
</span><span id="__span-46-112"><a id="__codelineno-46-112" name="__codelineno-46-112" href="#__codelineno-46-112"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">sourceIsActivated</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsActivated</span><span class="p">))))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if only one is activated</span>
</span><span id="__span-46-113"><a id="__codelineno-46-113" name="__codelineno-46-113" href="#__codelineno-46-113"></a>
</span><span id="__span-46-114"><a id="__codelineno-46-114" name="__codelineno-46-114" href="#__codelineno-46-114"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsActivated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-115"><a id="__codelineno-46-115" name="__codelineno-46-115" href="#__codelineno-46-115"></a><span class="w">                        </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-46-116"><a id="__codelineno-46-116" name="__codelineno-46-116" href="#__codelineno-46-116"></a><span class="w">                        </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-46-117"><a id="__codelineno-46-117" name="__codelineno-46-117" href="#__codelineno-46-117"></a><span class="w">                        </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-46-118"><a id="__codelineno-46-118" name="__codelineno-46-118" href="#__codelineno-46-118"></a><span class="w">                        </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-46-119"><a id="__codelineno-46-119" name="__codelineno-46-119" href="#__codelineno-46-119"></a><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-120"><a id="__codelineno-46-120" name="__codelineno-46-120" href="#__codelineno-46-120"></a><span class="w">                        </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-46-121"><a id="__codelineno-46-121" name="__codelineno-46-121" href="#__codelineno-46-121"></a><span class="w">                        </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-46-122"><a id="__codelineno-46-122" name="__codelineno-46-122" href="#__codelineno-46-122"></a><span class="w">                        </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
</span><span id="__span-46-123"><a id="__codelineno-46-123" name="__codelineno-46-123" href="#__codelineno-46-123"></a><span class="w">                        </span><span class="nx">lg</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-46-124"><a id="__codelineno-46-124" name="__codelineno-46-124" href="#__codelineno-46-124"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-46-125"><a id="__codelineno-46-125" name="__codelineno-46-125" href="#__codelineno-46-125"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-46-126"><a id="__codelineno-46-126" name="__codelineno-46-126" href="#__codelineno-46-126"></a><span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">path</span><span class="p">();</span>
</span><span id="__span-46-127"><a id="__codelineno-46-127" name="__codelineno-46-127" href="#__codelineno-46-127"></a><span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-46-128"><a id="__codelineno-46-128" name="__codelineno-46-128" href="#__codelineno-46-128"></a><span class="w">                </span><span class="nx">path</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span id="__span-46-129"><a id="__codelineno-46-129" name="__codelineno-46-129" href="#__codelineno-46-129"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span id="__span-46-130"><a id="__codelineno-46-130" name="__codelineno-46-130" href="#__codelineno-46-130"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-46-131"><a id="__codelineno-46-131" name="__codelineno-46-131" href="#__codelineno-46-131"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-46-132"><a id="__codelineno-46-132" name="__codelineno-46-132" href="#__codelineno-46-132"></a><span class="w">        </span><span class="nx">linkTick</span><span class="p">();</span>
</span><span id="__span-46-133"><a id="__codelineno-46-133" name="__codelineno-46-133" href="#__codelineno-46-133"></a><span class="w">        </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"tick"</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-134"><a id="__codelineno-46-134" name="__codelineno-46-134" href="#__codelineno-46-134"></a><span class="w">            </span><span class="nx">linkTick</span><span class="p">();</span>
</span><span id="__span-46-135"><a id="__codelineno-46-135" name="__codelineno-46-135" href="#__codelineno-46-135"></a><span class="w">            </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span>
</span><span id="__span-46-136"><a id="__codelineno-46-136" name="__codelineno-46-136" href="#__codelineno-46-136"></a><span class="w">                </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cx"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-46-137"><a id="__codelineno-46-137" name="__codelineno-46-137" href="#__codelineno-46-137"></a><span class="w">                </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cy"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-46-138"><a id="__codelineno-46-138" name="__codelineno-46-138" href="#__codelineno-46-138"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-46-139"><a id="__codelineno-46-139" name="__codelineno-46-139" href="#__codelineno-46-139"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-46-140"><a id="__codelineno-46-140" name="__codelineno-46-140" href="#__codelineno-46-140"></a><span class="w">    </span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// reduce opacity of unselected nodes</span>
</span><span id="__span-46-141"><a id="__codelineno-46-141" name="__codelineno-46-141" href="#__codelineno-46-141"></a><span class="w">        </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-142"><a id="__codelineno-46-142" name="__codelineno-46-142" href="#__codelineno-46-142"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-46-143"><a id="__codelineno-46-143" name="__codelineno-46-143" href="#__codelineno-46-143"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-46-144"><a id="__codelineno-46-144" name="__codelineno-46-144" href="#__codelineno-46-144"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">lab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-145"><a id="__codelineno-46-145" name="__codelineno-46-145" href="#__codelineno-46-145"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">NODE_HIGHLIGHTED_OPACITY</span><span class="p">;</span>
</span><span id="__span-46-146"><a id="__codelineno-46-146" name="__codelineno-46-146" href="#__codelineno-46-146"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-147"><a id="__codelineno-46-147" name="__codelineno-46-147" href="#__codelineno-46-147"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">minOpacity</span><span class="p">;</span>
</span><span id="__span-46-148"><a id="__codelineno-46-148" name="__codelineno-46-148" href="#__codelineno-46-148"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-149"><a id="__codelineno-46-149" name="__codelineno-46-149" href="#__codelineno-46-149"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-46-150"><a id="__codelineno-46-150" name="__codelineno-46-150" href="#__codelineno-46-150"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-46-151"><a id="__codelineno-46-151" name="__codelineno-46-151" href="#__codelineno-46-151"></a><span class="w">    </span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// set opacity of edges where either both nodes are highlighted or not highlighted</span>
</span><span id="__span-46-152"><a id="__codelineno-46-152" name="__codelineno-46-152" href="#__codelineno-46-152"></a><span class="w">        </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-153"><a id="__codelineno-46-153" name="__codelineno-46-153" href="#__codelineno-46-153"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-154"><a id="__codelineno-46-154" name="__codelineno-46-154" href="#__codelineno-46-154"></a><span class="w">                </span><span class="nx">source</span><span class="p">,</span>
</span><span id="__span-46-155"><a id="__codelineno-46-155" name="__codelineno-46-155" href="#__codelineno-46-155"></a><span class="w">                </span><span class="nx">sourceYear</span><span class="p">,</span>
</span><span id="__span-46-156"><a id="__codelineno-46-156" name="__codelineno-46-156" href="#__codelineno-46-156"></a><span class="w">                </span><span class="nx">sourceLab</span><span class="p">,</span>
</span><span id="__span-46-157"><a id="__codelineno-46-157" name="__codelineno-46-157" href="#__codelineno-46-157"></a><span class="w">                </span><span class="nx">target</span><span class="p">,</span>
</span><span id="__span-46-158"><a id="__codelineno-46-158" name="__codelineno-46-158" href="#__codelineno-46-158"></a><span class="w">                </span><span class="nx">targetYear</span><span class="p">,</span>
</span><span id="__span-46-159"><a id="__codelineno-46-159" name="__codelineno-46-159" href="#__codelineno-46-159"></a><span class="w">                </span><span class="nx">targetLab</span>
</span><span id="__span-46-160"><a id="__codelineno-46-160" name="__codelineno-46-160" href="#__codelineno-46-160"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getLinkSummary</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-46-161"><a id="__codelineno-46-161" name="__codelineno-46-161" href="#__codelineno-46-161"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-46-162"><a id="__codelineno-46-162" name="__codelineno-46-162" href="#__codelineno-46-162"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-46-163"><a id="__codelineno-46-163" name="__codelineno-46-163" href="#__codelineno-46-163"></a>
</span><span id="__span-46-164"><a id="__codelineno-46-164" name="__codelineno-46-164" href="#__codelineno-46-164"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceYear</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-165"><a id="__codelineno-46-165" name="__codelineno-46-165" href="#__codelineno-46-165"></a><span class="w">                </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-46-166"><a id="__codelineno-46-166" name="__codelineno-46-166" href="#__codelineno-46-166"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-167"><a id="__codelineno-46-167" name="__codelineno-46-167" href="#__codelineno-46-167"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">targetYear</span><span class="p">,</span><span class="w"> </span><span class="nx">targetLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-168"><a id="__codelineno-46-168" name="__codelineno-46-168" href="#__codelineno-46-168"></a><span class="w">                </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-46-169"><a id="__codelineno-46-169" name="__codelineno-46-169" href="#__codelineno-46-169"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-170"><a id="__codelineno-46-170" name="__codelineno-46-170" href="#__codelineno-46-170"></a>
</span><span id="__span-46-171"><a id="__codelineno-46-171" name="__codelineno-46-171" href="#__codelineno-46-171"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-172"><a id="__codelineno-46-172" name="__codelineno-46-172" href="#__codelineno-46-172"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-46-173"><a id="__codelineno-46-173" name="__codelineno-46-173" href="#__codelineno-46-173"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-174"><a id="__codelineno-46-174" name="__codelineno-46-174" href="#__codelineno-46-174"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-46-175"><a id="__codelineno-46-175" name="__codelineno-46-175" href="#__codelineno-46-175"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-46-176"><a id="__codelineno-46-176" name="__codelineno-46-176" href="#__codelineno-46-176"></a><span class="w">        </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-177"><a id="__codelineno-46-177" name="__codelineno-46-177" href="#__codelineno-46-177"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-46-178"><a id="__codelineno-46-178" name="__codelineno-46-178" href="#__codelineno-46-178"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-46-179"><a id="__codelineno-46-179" name="__codelineno-46-179" href="#__codelineno-46-179"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">sourceLab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-46-180"><a id="__codelineno-46-180" name="__codelineno-46-180" href="#__codelineno-46-180"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-46-181"><a id="__codelineno-46-181" name="__codelineno-46-181" href="#__codelineno-46-181"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-46-182"><a id="__codelineno-46-182" name="__codelineno-46-182" href="#__codelineno-46-182"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetLab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mf">5</span><span class="p">];</span>
</span><span id="__span-46-183"><a id="__codelineno-46-183" name="__codelineno-46-183" href="#__codelineno-46-183"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-46-184"><a id="__codelineno-46-184" name="__codelineno-46-184" href="#__codelineno-46-184"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-46-185"><a id="__codelineno-46-185" name="__codelineno-46-185" href="#__codelineno-46-185"></a>
</span><span id="__span-46-186"><a id="__codelineno-46-186" name="__codelineno-46-186" href="#__codelineno-46-186"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceYear</span><span class="p">,</span><span class="w"> </span><span class="nx">sourceLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-187"><a id="__codelineno-46-187" name="__codelineno-46-187" href="#__codelineno-46-187"></a><span class="w">                </span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-46-188"><a id="__codelineno-46-188" name="__codelineno-46-188" href="#__codelineno-46-188"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-189"><a id="__codelineno-46-189" name="__codelineno-46-189" href="#__codelineno-46-189"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activationCheck</span><span class="p">(</span><span class="nx">absl</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">currentLabHighlightList</span><span class="p">,</span><span class="w"> </span><span class="nx">targetYear</span><span class="p">,</span><span class="w"> </span><span class="nx">targetLab</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-190"><a id="__codelineno-46-190" name="__codelineno-46-190" href="#__codelineno-46-190"></a><span class="w">                </span><span class="nx">targetIsOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-46-191"><a id="__codelineno-46-191" name="__codelineno-46-191" href="#__codelineno-46-191"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-192"><a id="__codelineno-46-192" name="__codelineno-46-192" href="#__codelineno-46-192"></a>
</span><span id="__span-46-193"><a id="__codelineno-46-193" name="__codelineno-46-193" href="#__codelineno-46-193"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-194"><a id="__codelineno-46-194" name="__codelineno-46-194" href="#__codelineno-46-194"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="s2">"rgba("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">RGB_LINE_COLOR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">",1)"</span><span class="p">;</span>
</span><span id="__span-46-195"><a id="__codelineno-46-195" name="__codelineno-46-195" href="#__codelineno-46-195"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sourceIsOn</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">targetIsOn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-196"><a id="__codelineno-46-196" name="__codelineno-46-196" href="#__codelineno-46-196"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="sb">`url(#</span><span class="si">${</span><span class="nx">getGradientID</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="si">}</span><span class="sb">)`</span><span class="p">;</span>
</span><span id="__span-46-197"><a id="__codelineno-46-197" name="__codelineno-46-197" href="#__codelineno-46-197"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-198"><a id="__codelineno-46-198" name="__codelineno-46-198" href="#__codelineno-46-198"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="s2">"rgba("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">RGB_LINE_COLOR</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">",0.05)"</span><span class="p">;</span>
</span><span id="__span-46-199"><a id="__codelineno-46-199" name="__codelineno-46-199" href="#__codelineno-46-199"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-200"><a id="__codelineno-46-200" name="__codelineno-46-200" href="#__codelineno-46-200"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-46-201"><a id="__codelineno-46-201" name="__codelineno-46-201" href="#__codelineno-46-201"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-46-202"><a id="__codelineno-46-202" name="__codelineno-46-202" href="#__codelineno-46-202"></a><span class="w">    </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// when a student's node is clicked, open their documentation website</span>
</span><span id="__span-46-203"><a id="__codelineno-46-203" name="__codelineno-46-203" href="#__codelineno-46-203"></a>
</span><span id="__span-46-204"><a id="__codelineno-46-204" name="__codelineno-46-204" href="#__codelineno-46-204"></a><span class="w">        </span><span class="nx">calcs</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-205"><a id="__codelineno-46-205" name="__codelineno-46-205" href="#__codelineno-46-205"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-46-206"><a id="__codelineno-46-206" name="__codelineno-46-206" href="#__codelineno-46-206"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseover"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-207"><a id="__codelineno-46-207" name="__codelineno-46-207" href="#__codelineno-46-207"></a><span class="w">                </span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseover"</span><span class="p">,</span><span class="w"> </span><span class="nx">tooltipMouseover</span><span class="p">)</span>
</span><span id="__span-46-208"><a id="__codelineno-46-208" name="__codelineno-46-208" href="#__codelineno-46-208"></a><span class="w">                    </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mousemove"</span><span class="p">,</span><span class="w"> </span><span class="nx">tooltipMousemove</span><span class="p">)</span>
</span><span id="__span-46-209"><a id="__codelineno-46-209" name="__codelineno-46-209" href="#__codelineno-46-209"></a><span class="w">                    </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseleave"</span><span class="p">,</span><span class="w"> </span><span class="nx">tooltipMouseleave</span><span class="p">);</span>
</span><span id="__span-46-210"><a id="__codelineno-46-210" name="__codelineno-46-210" href="#__codelineno-46-210"></a><span class="w">                </span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-211"><a id="__codelineno-46-211" name="__codelineno-46-211" href="#__codelineno-46-211"></a><span class="w">                    </span><span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)[</span><span class="mf">1</span><span class="p">],</span><span class="w"> </span><span class="s2">"_blank"</span><span class="p">)</span>
</span><span id="__span-46-212"><a id="__codelineno-46-212" name="__codelineno-46-212" href="#__codelineno-46-212"></a><span class="w">                </span><span class="p">})</span>
</span><span id="__span-46-213"><a id="__codelineno-46-213" name="__codelineno-46-213" href="#__codelineno-46-213"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-214"><a id="__codelineno-46-214" name="__codelineno-46-214" href="#__codelineno-46-214"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-46-215"><a id="__codelineno-46-215" name="__codelineno-46-215" href="#__codelineno-46-215"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-46-216"><a id="__codelineno-46-216" name="__codelineno-46-216" href="#__codelineno-46-216"></a><span class="w">    </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absl</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">absl</span><span class="p">.</span><span class="nx">simulation</span><span class="p">.</span><span class="nx">alpha</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">restart</span><span class="p">()</span><span class="w"> </span><span class="c1">// reheat simulation</span>
</span><span id="__span-46-217"><a id="__codelineno-46-217" name="__codelineno-46-217" href="#__codelineno-46-217"></a><span class="w">  </span><span class="p">];</span>
</span><span id="__span-46-218"><a id="__codelineno-46-218" name="__codelineno-46-218" href="#__codelineno-46-218"></a>
</span><span id="__span-46-219"><a id="__codelineno-46-219" name="__codelineno-46-219" href="#__codelineno-46-219"></a>
</span><span id="__span-46-220"><a id="__codelineno-46-220" name="__codelineno-46-220" href="#__codelineno-46-220"></a><span class="c1">// filter nodes and edges based on `absolutes`</span>
</span><span id="__span-46-221"><a id="__codelineno-46-221" name="__codelineno-46-221" href="#__codelineno-46-221"></a><span class="kd">const</span><span class="w"> </span><span class="nx">filterData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">funcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-222"><a id="__codelineno-46-222" name="__codelineno-46-222" href="#__codelineno-46-222"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-223"><a id="__codelineno-46-223" name="__codelineno-46-223" href="#__codelineno-46-223"></a><span class="w">        </span><span class="s2">"nodes"</span><span class="o">:</span><span class="w"> </span><span class="nx">nodes_not_filtered</span><span class="p">,</span>
</span><span id="__span-46-224"><a id="__codelineno-46-224" name="__codelineno-46-224" href="#__codelineno-46-224"></a><span class="w">        </span><span class="s2">"links"</span><span class="o">:</span><span class="w"> </span><span class="nx">links_not_filtered</span>
</span><span id="__span-46-225"><a id="__codelineno-46-225" name="__codelineno-46-225" href="#__codelineno-46-225"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-46-226"><a id="__codelineno-46-226" name="__codelineno-46-226" href="#__codelineno-46-226"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">funcs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-227"><a id="__codelineno-46-227" name="__codelineno-46-227" href="#__codelineno-46-227"></a><span class="w">        </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-46-228"><a id="__codelineno-46-228" name="__codelineno-46-228" href="#__codelineno-46-228"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-46-229"><a id="__codelineno-46-229" name="__codelineno-46-229" href="#__codelineno-46-229"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">;</span>
</span><span id="__span-46-230"><a id="__codelineno-46-230" name="__codelineno-46-230" href="#__codelineno-46-230"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-46-231"><a id="__codelineno-46-231" name="__codelineno-46-231" href="#__codelineno-46-231"></a>
</span><span id="__span-46-232"><a id="__codelineno-46-232" name="__codelineno-46-232" href="#__codelineno-46-232"></a><span class="w">  </span><span class="c1">// run calculations for visualization</span>
</span><span id="__span-46-233"><a id="__codelineno-46-233" name="__codelineno-46-233" href="#__codelineno-46-233"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">runCalculations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">funcs</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-234"><a id="__codelineno-46-234" name="__codelineno-46-234" href="#__codelineno-46-234"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">calcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-46-235"><a id="__codelineno-46-235" name="__codelineno-46-235" href="#__codelineno-46-235"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">funcs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-236"><a id="__codelineno-46-236" name="__codelineno-46-236" href="#__codelineno-46-236"></a><span class="w">        </span><span class="nx">calcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-237"><a id="__codelineno-46-237" name="__codelineno-46-237" href="#__codelineno-46-237"></a><span class="w">            </span><span class="p">...</span><span class="nx">calcs</span><span class="p">,</span>
</span><span id="__span-46-238"><a id="__codelineno-46-238" name="__codelineno-46-238" href="#__codelineno-46-238"></a><span class="w">            </span><span class="p">...</span><span class="nx">f</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">)</span>
</span><span id="__span-46-239"><a id="__codelineno-46-239" name="__codelineno-46-239" href="#__codelineno-46-239"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-46-240"><a id="__codelineno-46-240" name="__codelineno-46-240" href="#__codelineno-46-240"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-46-241"><a id="__codelineno-46-241" name="__codelineno-46-241" href="#__codelineno-46-241"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">calcs</span><span class="p">;</span>
</span><span id="__span-46-242"><a id="__codelineno-46-242" name="__codelineno-46-242" href="#__codelineno-46-242"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-46-243"><a id="__codelineno-46-243" name="__codelineno-46-243" href="#__codelineno-46-243"></a>
</span><span id="__span-46-244"><a id="__codelineno-46-244" name="__codelineno-46-244" href="#__codelineno-46-244"></a><span class="w">  </span><span class="c1">// update the visualization</span>
</span><span id="__span-46-245"><a id="__codelineno-46-245" name="__codelineno-46-245" href="#__codelineno-46-245"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">setDataAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">funcs</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-246"><a id="__codelineno-46-246" name="__codelineno-46-246" href="#__codelineno-46-246"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">funcs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-247"><a id="__codelineno-46-247" name="__codelineno-46-247" href="#__codelineno-46-247"></a><span class="w">        </span><span class="nx">f</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calcs</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-46-248"><a id="__codelineno-46-248" name="__codelineno-46-248" href="#__codelineno-46-248"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-46-249"><a id="__codelineno-46-249" name="__codelineno-46-249" href="#__codelineno-46-249"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-46-250"><a id="__codelineno-46-250" name="__codelineno-46-250" href="#__codelineno-46-250"></a>
</span><span id="__span-46-251"><a id="__codelineno-46-251" name="__codelineno-46-251" href="#__codelineno-46-251"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">absolutes</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-252"><a id="__codelineno-46-252" name="__codelineno-46-252" href="#__codelineno-46-252"></a><span class="w">  </span><span class="nx">absolutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-253"><a id="__codelineno-46-253" name="__codelineno-46-253" href="#__codelineno-46-253"></a><span class="w">      </span><span class="p">...</span><span class="nx">absolutes</span><span class="p">,</span>
</span><span id="__span-46-254"><a id="__codelineno-46-254" name="__codelineno-46-254" href="#__codelineno-46-254"></a><span class="w">      </span><span class="s2">"topic"</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="s2">"topic"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">absolutes</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">.</span><span class="nx">topic</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">currentTopic</span><span class="p">),</span>
</span><span id="__span-46-255"><a id="__codelineno-46-255" name="__codelineno-46-255" href="#__codelineno-46-255"></a><span class="w">      </span><span class="s2">"year"</span><span class="o">:</span><span class="w"> </span><span class="nx">currentYear</span><span class="p">,</span>
</span><span id="__span-46-256"><a id="__codelineno-46-256" name="__codelineno-46-256" href="#__codelineno-46-256"></a><span class="w">      </span><span class="nx">currentLabHighlightList</span>
</span><span id="__span-46-257"><a id="__codelineno-46-257" name="__codelineno-46-257" href="#__codelineno-46-257"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-46-258"><a id="__codelineno-46-258" name="__codelineno-46-258" href="#__codelineno-46-258"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filterData</span><span class="p">(</span><span class="nx">updateCallbacks</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-46-259"><a id="__codelineno-46-259" name="__codelineno-46-259" href="#__codelineno-46-259"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">calculationDict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">runCalculations</span><span class="p">(</span><span class="nx">calculationCallbacks</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-46-260"><a id="__codelineno-46-260" name="__codelineno-46-260" href="#__codelineno-46-260"></a><span class="w">  </span><span class="nx">setDataAttributes</span><span class="p">(</span><span class="nx">attributeCallbacks</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">calculationDict</span><span class="p">,</span><span class="w"> </span><span class="nx">absolutes</span><span class="p">);</span>
</span><span id="__span-46-261"><a id="__codelineno-46-261" name="__codelineno-46-261" href="#__codelineno-46-261"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="lab-filter">Lab Filter</h4>
<p><code>multiselect-dropdown.js</code> contains the JavaScript functionality for the lab selection filter. The only part of the code that directly invovles the data visualization is the <code>initializeLabMultiselect</code> function. It takes in a list of labs and a callback function as parameters, initializes a new Multiselect object (defined earlier in the file), and binds the GUI to the callback. The callback is called whenever there is a change in the selection.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">initializeLabMultiselect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">labs</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Multiselect</span><span class="p">(</span><span class="s2">"#countries"</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">);</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#my_dataviz"</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="s2">"div div.container"</span><span class="p">);</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">labNamesToDisplay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="w">    </span><span class="nx">labs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">namesFromCodes</span><span class="p">).</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">labNamesToDisplay</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">namesFromCodes</span><span class="p">[</span><span class="nx">l</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">            </span><span class="nx">labNamesToDisplay</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">namesFromCodes</span><span class="p">[</span><span class="nx">l</span><span class="p">]);</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">namesFromCodes</span><span class="p">).</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">)){</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">            </span><span class="nx">labNamesToDisplay</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="w">    </span><span class="nx">labNamesToDisplay</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="w">    </span><span class="nx">select</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"option"</span><span class="p">)</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="s2">"All"</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">labNamesToDisplay</span><span class="p">))</span><span class="w"> </span><span class="c1">// Add "All" option to the start of the list</span>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="w">        </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">"option"</span><span class="p">)</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a><span class="w">        </span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a><span class="p">};</span>
</span></code></pre></div>
<p>Here's the entire file. The code uses <a href="https://jquery.com/">jQuery</a>.</p>
<p><em>multiselect-dropdown.js</em></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">search</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">elem</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="p">};</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">Multiselect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"ERROR: Element %s does not exist."</span><span class="p">,</span><span class="w"> </span><span class="nx">selector</span><span class="p">);</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selector</span><span class="p">;</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">callback</span><span class="p">;</span>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="w">    </span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">that</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a><span class="w">        </span><span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a><span class="w">    </span><span class="p">})(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a><span class="p">};</span>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a><span class="nx">Multiselect</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a><span class="w">    </span><span class="nx">open</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">that</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">that</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"data-target"</span><span class="p">);</span>
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a>
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a><span class="w">        </span><span class="c1">// If we are not keeping track of this one's entries, then start doing so.</span>
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-48-32"><a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a>
</span><span id="__span-48-33"><a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a><span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect"</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">"active"</span><span class="p">);</span>
</span><span id="__span-48-34"><a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-35"><a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a>
</span><span id="__span-48-36"><a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a><span class="w">    </span><span class="nx">close</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-37"><a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a><span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"active"</span><span class="p">);</span>
</span><span id="__span-48-38"><a id="__codelineno-48-38" name="__codelineno-48-38" href="#__codelineno-48-38"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-39"><a id="__codelineno-48-39" name="__codelineno-48-39" href="#__codelineno-48-39"></a>
</span><span id="__span-48-40"><a id="__codelineno-48-40" name="__codelineno-48-40" href="#__codelineno-48-40"></a><span class="w">    </span><span class="nx">events</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Pass the callback function as an argument</span>
</span><span id="__span-48-41"><a id="__codelineno-48-41" name="__codelineno-48-41" href="#__codelineno-48-41"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
</span><span id="__span-48-42"><a id="__codelineno-48-42" name="__codelineno-48-42" href="#__codelineno-48-42"></a>
</span><span id="__span-48-43"><a id="__codelineno-48-43" name="__codelineno-48-43" href="#__codelineno-48-43"></a><span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect &gt; .title"</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-44"><a id="__codelineno-48-44" name="__codelineno-48-44" href="#__codelineno-48-44"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">"close-icon"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-45"><a id="__codelineno-48-45" name="__codelineno-48-45" href="#__codelineno-48-45"></a><span class="w">                </span><span class="nx">that</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
</span><span id="__span-48-46"><a id="__codelineno-48-46" name="__codelineno-48-46" href="#__codelineno-48-46"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-48-47"><a id="__codelineno-48-47" name="__codelineno-48-47" href="#__codelineno-48-47"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-48-48"><a id="__codelineno-48-48" name="__codelineno-48-48" href="#__codelineno-48-48"></a>
</span><span id="__span-48-49"><a id="__codelineno-48-49" name="__codelineno-48-49" href="#__codelineno-48-49"></a><span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect &gt; .title &gt; .close-icon"</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-50"><a id="__codelineno-48-50" name="__codelineno-48-50" href="#__codelineno-48-50"></a><span class="w">            </span><span class="nx">that</span><span class="p">.</span><span class="nx">clearSelections</span><span class="p">();</span>
</span><span id="__span-48-51"><a id="__codelineno-48-51" name="__codelineno-48-51" href="#__codelineno-48-51"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-48-52"><a id="__codelineno-48-52" name="__codelineno-48-52" href="#__codelineno-48-52"></a>
</span><span id="__span-48-53"><a id="__codelineno-48-53" name="__codelineno-48-53" href="#__codelineno-48-53"></a>
</span><span id="__span-48-54"><a id="__codelineno-48-54" name="__codelineno-48-54" href="#__codelineno-48-54"></a><span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect option"</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-55"><a id="__codelineno-48-55" name="__codelineno-48-55" href="#__codelineno-48-55"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"value"</span><span class="p">);</span>
</span><span id="__span-48-56"><a id="__codelineno-48-56" name="__codelineno-48-56" href="#__codelineno-48-56"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">optionsCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect option"</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-48-57"><a id="__codelineno-48-57" name="__codelineno-48-57" href="#__codelineno-48-57"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-58"><a id="__codelineno-48-58" name="__codelineno-48-58" href="#__codelineno-48-58"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-59"><a id="__codelineno-48-59" name="__codelineno-48-59" href="#__codelineno-48-59"></a><span class="w">                    </span><span class="c1">// Select All</span>
</span><span id="__span-48-60"><a id="__codelineno-48-60" name="__codelineno-48-60" href="#__codelineno-48-60"></a><span class="w">                    </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect option"</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-61"><a id="__codelineno-48-61" name="__codelineno-48-61" href="#__codelineno-48-61"></a><span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
</span><span id="__span-48-62"><a id="__codelineno-48-62" name="__codelineno-48-62" href="#__codelineno-48-62"></a><span class="w">                    </span><span class="p">}).</span><span class="nx">get</span><span class="p">();</span>
</span><span id="__span-48-63"><a id="__codelineno-48-63" name="__codelineno-48-63" href="#__codelineno-48-63"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-64"><a id="__codelineno-48-64" name="__codelineno-48-64" href="#__codelineno-48-64"></a><span class="w">                    </span><span class="c1">// Deselect All</span>
</span><span id="__span-48-65"><a id="__codelineno-48-65" name="__codelineno-48-65" href="#__codelineno-48-65"></a><span class="w">                    </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-48-66"><a id="__codelineno-48-66" name="__codelineno-48-66" href="#__codelineno-48-66"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-48-67"><a id="__codelineno-48-67" name="__codelineno-48-67" href="#__codelineno-48-67"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-68"><a id="__codelineno-48-68" name="__codelineno-48-68" href="#__codelineno-48-68"></a>
</span><span id="__span-48-69"><a id="__codelineno-48-69" name="__codelineno-48-69" href="#__codelineno-48-69"></a><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="nx">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">selection</span><span class="p">);</span>
</span><span id="__span-48-70"><a id="__codelineno-48-70" name="__codelineno-48-70" href="#__codelineno-48-70"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">io</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">selection</span><span class="p">)</span>
</span><span id="__span-48-71"><a id="__codelineno-48-71" name="__codelineno-48-71" href="#__codelineno-48-71"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">io</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-48-72"><a id="__codelineno-48-72" name="__codelineno-48-72" href="#__codelineno-48-72"></a>
</span><span id="__span-48-73"><a id="__codelineno-48-73" name="__codelineno-48-73" href="#__codelineno-48-73"></a><span class="w">                </span><span class="c1">// If not all options are selected, deselect "All"</span>
</span><span id="__span-48-74"><a id="__codelineno-48-74" name="__codelineno-48-74" href="#__codelineno-48-74"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">optionsCount</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-75"><a id="__codelineno-48-75" name="__codelineno-48-75" href="#__codelineno-48-75"></a><span class="w">                    </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">"All"</span><span class="p">);</span>
</span><span id="__span-48-76"><a id="__codelineno-48-76" name="__codelineno-48-76" href="#__codelineno-48-76"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-48-77"><a id="__codelineno-48-77" name="__codelineno-48-77" href="#__codelineno-48-77"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-48-78"><a id="__codelineno-48-78" name="__codelineno-48-78" href="#__codelineno-48-78"></a><span class="w">                </span><span class="c1">// If all options are selected, also select 'All'</span>
</span><span id="__span-48-79"><a id="__codelineno-48-79" name="__codelineno-48-79" href="#__codelineno-48-79"></a><span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">optionsCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-80"><a id="__codelineno-48-80" name="__codelineno-48-80" href="#__codelineno-48-80"></a><span class="w">                    </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">'All'</span><span class="p">);</span>
</span><span id="__span-48-81"><a id="__codelineno-48-81" name="__codelineno-48-81" href="#__codelineno-48-81"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-48-82"><a id="__codelineno-48-82" name="__codelineno-48-82" href="#__codelineno-48-82"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-48-83"><a id="__codelineno-48-83" name="__codelineno-48-83" href="#__codelineno-48-83"></a>
</span><span id="__span-48-84"><a id="__codelineno-48-84" name="__codelineno-48-84" href="#__codelineno-48-84"></a><span class="w">            </span><span class="nx">that</span><span class="p">.</span><span class="nx">selectionStatus</span><span class="p">();</span>
</span><span id="__span-48-85"><a id="__codelineno-48-85" name="__codelineno-48-85" href="#__codelineno-48-85"></a><span class="w">            </span><span class="nx">that</span><span class="p">.</span><span class="nx">setSelectionsString</span><span class="p">();</span>
</span><span id="__span-48-86"><a id="__codelineno-48-86" name="__codelineno-48-86" href="#__codelineno-48-86"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">callback</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">"function"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-87"><a id="__codelineno-48-87" name="__codelineno-48-87" href="#__codelineno-48-87"></a><span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">selectionCodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span><span class="w"> </span>
</span><span id="__span-48-88"><a id="__codelineno-48-88" name="__codelineno-48-88" href="#__codelineno-48-88"></a><span class="w">                </span><span class="nx">that</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-89"><a id="__codelineno-48-89" name="__codelineno-48-89" href="#__codelineno-48-89"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">codesFromNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-90"><a id="__codelineno-48-90" name="__codelineno-48-90" href="#__codelineno-48-90"></a><span class="w">                        </span><span class="nx">codesFromNames</span><span class="p">[</span><span class="nx">s</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-91"><a id="__codelineno-48-91" name="__codelineno-48-91" href="#__codelineno-48-91"></a><span class="w">                            </span><span class="nx">selectionCodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
</span><span id="__span-48-92"><a id="__codelineno-48-92" name="__codelineno-48-92" href="#__codelineno-48-92"></a><span class="w">                        </span><span class="p">})</span>
</span><span id="__span-48-93"><a id="__codelineno-48-93" name="__codelineno-48-93" href="#__codelineno-48-93"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-48-94"><a id="__codelineno-48-94" name="__codelineno-48-94" href="#__codelineno-48-94"></a><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="nx">selectionCodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span id="__span-48-95"><a id="__codelineno-48-95" name="__codelineno-48-95" href="#__codelineno-48-95"></a><span class="w">                </span><span class="p">});</span>
</span><span id="__span-48-96"><a id="__codelineno-48-96" name="__codelineno-48-96" href="#__codelineno-48-96"></a><span class="w">                </span><span class="nx">callback</span><span class="p">(</span><span class="nx">selectionCodes</span><span class="p">);</span>
</span><span id="__span-48-97"><a id="__codelineno-48-97" name="__codelineno-48-97" href="#__codelineno-48-97"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-48-98"><a id="__codelineno-48-98" name="__codelineno-48-98" href="#__codelineno-48-98"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-48-99"><a id="__codelineno-48-99" name="__codelineno-48-99" href="#__codelineno-48-99"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-100"><a id="__codelineno-48-100" name="__codelineno-48-100" href="#__codelineno-48-100"></a>
</span><span id="__span-48-101"><a id="__codelineno-48-101" name="__codelineno-48-101" href="#__codelineno-48-101"></a><span class="w">    </span><span class="nx">selectionStatus</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-102"><a id="__codelineno-48-102" name="__codelineno-48-102" href="#__codelineno-48-102"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect"</span><span class="p">);</span>
</span><span id="__span-48-103"><a id="__codelineno-48-103" name="__codelineno-48-103" href="#__codelineno-48-103"></a>
</span><span id="__span-48-104"><a id="__codelineno-48-104" name="__codelineno-48-104" href="#__codelineno-48-104"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"selection"</span><span class="p">);</span>
</span><span id="__span-48-105"><a id="__codelineno-48-105" name="__codelineno-48-105" href="#__codelineno-48-105"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"selection"</span><span class="p">);</span>
</span><span id="__span-48-106"><a id="__codelineno-48-106" name="__codelineno-48-106" href="#__codelineno-48-106"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-107"><a id="__codelineno-48-107" name="__codelineno-48-107" href="#__codelineno-48-107"></a>
</span><span id="__span-48-108"><a id="__codelineno-48-108" name="__codelineno-48-108" href="#__codelineno-48-108"></a><span class="w">    </span><span class="nx">clearSelections</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-109"><a id="__codelineno-48-109" name="__codelineno-48-109" href="#__codelineno-48-109"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-48-110"><a id="__codelineno-48-110" name="__codelineno-48-110" href="#__codelineno-48-110"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">selectionStatus</span><span class="p">();</span>
</span><span id="__span-48-111"><a id="__codelineno-48-111" name="__codelineno-48-111" href="#__codelineno-48-111"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">setSelectionsString</span><span class="p">();</span>
</span><span id="__span-48-112"><a id="__codelineno-48-112" name="__codelineno-48-112" href="#__codelineno-48-112"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">([]);</span>
</span><span id="__span-48-113"><a id="__codelineno-48-113" name="__codelineno-48-113" href="#__codelineno-48-113"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-114"><a id="__codelineno-48-114" name="__codelineno-48-114" href="#__codelineno-48-114"></a>
</span><span id="__span-48-115"><a id="__codelineno-48-115" name="__codelineno-48-115" href="#__codelineno-48-115"></a><span class="w">    </span><span class="nx">getSelections</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-116"><a id="__codelineno-48-116" name="__codelineno-48-116" href="#__codelineno-48-116"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="p">;</span>
</span><span id="__span-48-117"><a id="__codelineno-48-117" name="__codelineno-48-117" href="#__codelineno-48-117"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-118"><a id="__codelineno-48-118" name="__codelineno-48-118" href="#__codelineno-48-118"></a>
</span><span id="__span-48-119"><a id="__codelineno-48-119" name="__codelineno-48-119" href="#__codelineno-48-119"></a><span class="w">    </span><span class="nx">setSelectionsString</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-120"><a id="__codelineno-48-120" name="__codelineno-48-120" href="#__codelineno-48-120"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">selects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getSelectionsString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s2">", "</span><span class="p">);</span>
</span><span id="__span-48-121"><a id="__codelineno-48-121" name="__codelineno-48-121" href="#__codelineno-48-121"></a><span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect &gt; .title"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"title"</span><span class="p">,</span><span class="w"> </span><span class="nx">selects</span><span class="p">);</span>
</span><span id="__span-48-122"><a id="__codelineno-48-122" name="__codelineno-48-122" href="#__codelineno-48-122"></a>
</span><span id="__span-48-123"><a id="__codelineno-48-123" name="__codelineno-48-123" href="#__codelineno-48-123"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect option"</span><span class="p">);</span>
</span><span id="__span-48-124"><a id="__codelineno-48-124" name="__codelineno-48-124" href="#__codelineno-48-124"></a>
</span><span id="__span-48-125"><a id="__codelineno-48-125" name="__codelineno-48-125" href="#__codelineno-48-125"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selects</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-126"><a id="__codelineno-48-126" name="__codelineno-48-126" href="#__codelineno-48-126"></a><span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect &gt; .title &gt; .text"</span><span class="p">)</span>
</span><span id="__span-48-127"><a id="__codelineno-48-127" name="__codelineno-48-127" href="#__codelineno-48-127"></a><span class="w">                </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">selects</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">16</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"..."</span><span class="p">);</span>
</span><span id="__span-48-128"><a id="__codelineno-48-128" name="__codelineno-48-128" href="#__codelineno-48-128"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-129"><a id="__codelineno-48-129" name="__codelineno-48-129" href="#__codelineno-48-129"></a><span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".multiselect &gt; .title &gt; .text"</span><span class="p">)</span>
</span><span id="__span-48-130"><a id="__codelineno-48-130" name="__codelineno-48-130" href="#__codelineno-48-130"></a><span class="w">                </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">selects</span><span class="p">);</span>
</span><span id="__span-48-131"><a id="__codelineno-48-131" name="__codelineno-48-131" href="#__codelineno-48-131"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-48-132"><a id="__codelineno-48-132" name="__codelineno-48-132" href="#__codelineno-48-132"></a>
</span><span id="__span-48-133"><a id="__codelineno-48-133" name="__codelineno-48-133" href="#__codelineno-48-133"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-134"><a id="__codelineno-48-134" name="__codelineno-48-134" href="#__codelineno-48-134"></a><span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"selected"</span><span class="p">);</span>
</span><span id="__span-48-135"><a id="__codelineno-48-135" name="__codelineno-48-135" href="#__codelineno-48-135"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-48-136"><a id="__codelineno-48-136" name="__codelineno-48-136" href="#__codelineno-48-136"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">selects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-137"><a id="__codelineno-48-137" name="__codelineno-48-137" href="#__codelineno-48-137"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">selects</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
</span><span id="__span-48-138"><a id="__codelineno-48-138" name="__codelineno-48-138" href="#__codelineno-48-138"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-139"><a id="__codelineno-48-139" name="__codelineno-48-139" href="#__codelineno-48-139"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"value"</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">select</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">select</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-140"><a id="__codelineno-48-140" name="__codelineno-48-140" href="#__codelineno-48-140"></a><span class="w">                    </span><span class="nx">$</span><span class="p">(</span><span class="nx">opts</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"selected"</span><span class="p">);</span>
</span><span id="__span-48-141"><a id="__codelineno-48-141" name="__codelineno-48-141" href="#__codelineno-48-141"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">select</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-48-142"><a id="__codelineno-48-142" name="__codelineno-48-142" href="#__codelineno-48-142"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-48-143"><a id="__codelineno-48-143" name="__codelineno-48-143" href="#__codelineno-48-143"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-48-144"><a id="__codelineno-48-144" name="__codelineno-48-144" href="#__codelineno-48-144"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-48-145"><a id="__codelineno-48-145" name="__codelineno-48-145" href="#__codelineno-48-145"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-146"><a id="__codelineno-48-146" name="__codelineno-48-146" href="#__codelineno-48-146"></a>
</span><span id="__span-48-147"><a id="__codelineno-48-147" name="__codelineno-48-147" href="#__codelineno-48-147"></a><span class="w">    </span><span class="nx">getSelectionsString</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-148"><a id="__codelineno-48-148" name="__codelineno-48-148" href="#__codelineno-48-148"></a><span class="w">        </span><span class="c1">// If "All" is selected, return "All"</span>
</span><span id="__span-48-149"><a id="__codelineno-48-149" name="__codelineno-48-149" href="#__codelineno-48-149"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-48-150"><a id="__codelineno-48-150" name="__codelineno-48-150" href="#__codelineno-48-150"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s2">"All"</span><span class="p">;</span>
</span><span id="__span-48-151"><a id="__codelineno-48-151" name="__codelineno-48-151" href="#__codelineno-48-151"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-48-152"><a id="__codelineno-48-152" name="__codelineno-48-152" href="#__codelineno-48-152"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">", "</span><span class="p">);</span>
</span><span id="__span-48-153"><a id="__codelineno-48-153" name="__codelineno-48-153" href="#__codelineno-48-153"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s2">"Filter Labs"</span><span class="p">;</span>
</span><span id="__span-48-154"><a id="__codelineno-48-154" name="__codelineno-48-154" href="#__codelineno-48-154"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-155"><a id="__codelineno-48-155" name="__codelineno-48-155" href="#__codelineno-48-155"></a>
</span><span id="__span-48-156"><a id="__codelineno-48-156" name="__codelineno-48-156" href="#__codelineno-48-156"></a><span class="w">    </span><span class="nx">setSelections</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-157"><a id="__codelineno-48-157" name="__codelineno-48-157" href="#__codelineno-48-157"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">arr</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-158"><a id="__codelineno-48-158" name="__codelineno-48-158" href="#__codelineno-48-158"></a><span class="w">            </span><span class="nx">error</span><span class="p">(</span><span class="s2">"ERROR: This does not look like an array."</span><span class="p">);</span>
</span><span id="__span-48-159"><a id="__codelineno-48-159" name="__codelineno-48-159" href="#__codelineno-48-159"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-48-160"><a id="__codelineno-48-160" name="__codelineno-48-160" href="#__codelineno-48-160"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-48-161"><a id="__codelineno-48-161" name="__codelineno-48-161" href="#__codelineno-48-161"></a>
</span><span id="__span-48-162"><a id="__codelineno-48-162" name="__codelineno-48-162" href="#__codelineno-48-162"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">selections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">arr</span><span class="p">;</span>
</span><span id="__span-48-163"><a id="__codelineno-48-163" name="__codelineno-48-163" href="#__codelineno-48-163"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">selectionStatus</span><span class="p">();</span>
</span><span id="__span-48-164"><a id="__codelineno-48-164" name="__codelineno-48-164" href="#__codelineno-48-164"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">setSelectionsString</span><span class="p">();</span>
</span><span id="__span-48-165"><a id="__codelineno-48-165" name="__codelineno-48-165" href="#__codelineno-48-165"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-166"><a id="__codelineno-48-166" name="__codelineno-48-166" href="#__codelineno-48-166"></a><span class="p">};</span>
</span><span id="__span-48-167"><a id="__codelineno-48-167" name="__codelineno-48-167" href="#__codelineno-48-167"></a>
</span><span id="__span-48-168"><a id="__codelineno-48-168" name="__codelineno-48-168" href="#__codelineno-48-168"></a><span class="kd">const</span><span class="w"> </span><span class="nx">initializeLabMultiselect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">labs</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-169"><a id="__codelineno-48-169" name="__codelineno-48-169" href="#__codelineno-48-169"></a><span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-170"><a id="__codelineno-48-170" name="__codelineno-48-170" href="#__codelineno-48-170"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Multiselect</span><span class="p">(</span><span class="s2">"#countries"</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">);</span>
</span><span id="__span-48-171"><a id="__codelineno-48-171" name="__codelineno-48-171" href="#__codelineno-48-171"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-48-172"><a id="__codelineno-48-172" name="__codelineno-48-172" href="#__codelineno-48-172"></a>
</span><span id="__span-48-173"><a id="__codelineno-48-173" name="__codelineno-48-173" href="#__codelineno-48-173"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#my_dataviz"</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="s2">"div div.container"</span><span class="p">);</span>
</span><span id="__span-48-174"><a id="__codelineno-48-174" name="__codelineno-48-174" href="#__codelineno-48-174"></a>
</span><span id="__span-48-175"><a id="__codelineno-48-175" name="__codelineno-48-175" href="#__codelineno-48-175"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">labNamesToDisplay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-48-176"><a id="__codelineno-48-176" name="__codelineno-48-176" href="#__codelineno-48-176"></a>
</span><span id="__span-48-177"><a id="__codelineno-48-177" name="__codelineno-48-177" href="#__codelineno-48-177"></a><span class="w">    </span><span class="nx">labs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-178"><a id="__codelineno-48-178" name="__codelineno-48-178" href="#__codelineno-48-178"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">namesFromCodes</span><span class="p">).</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">labNamesToDisplay</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">namesFromCodes</span><span class="p">[</span><span class="nx">l</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-179"><a id="__codelineno-48-179" name="__codelineno-48-179" href="#__codelineno-48-179"></a><span class="w">            </span><span class="nx">labNamesToDisplay</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">namesFromCodes</span><span class="p">[</span><span class="nx">l</span><span class="p">]);</span>
</span><span id="__span-48-180"><a id="__codelineno-48-180" name="__codelineno-48-180" href="#__codelineno-48-180"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-48-181"><a id="__codelineno-48-181" name="__codelineno-48-181" href="#__codelineno-48-181"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">namesFromCodes</span><span class="p">).</span><span class="nx">includes</span><span class="p">(</span><span class="nx">l</span><span class="p">)){</span>
</span><span id="__span-48-182"><a id="__codelineno-48-182" name="__codelineno-48-182" href="#__codelineno-48-182"></a><span class="w">            </span><span class="nx">labNamesToDisplay</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span>
</span><span id="__span-48-183"><a id="__codelineno-48-183" name="__codelineno-48-183" href="#__codelineno-48-183"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-48-184"><a id="__codelineno-48-184" name="__codelineno-48-184" href="#__codelineno-48-184"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-48-185"><a id="__codelineno-48-185" name="__codelineno-48-185" href="#__codelineno-48-185"></a>
</span><span id="__span-48-186"><a id="__codelineno-48-186" name="__codelineno-48-186" href="#__codelineno-48-186"></a><span class="w">    </span><span class="nx">labNamesToDisplay</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
</span><span id="__span-48-187"><a id="__codelineno-48-187" name="__codelineno-48-187" href="#__codelineno-48-187"></a>
</span><span id="__span-48-188"><a id="__codelineno-48-188" name="__codelineno-48-188" href="#__codelineno-48-188"></a><span class="w">    </span><span class="nx">select</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"option"</span><span class="p">)</span>
</span><span id="__span-48-189"><a id="__codelineno-48-189" name="__codelineno-48-189" href="#__codelineno-48-189"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="s2">"All"</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">labNamesToDisplay</span><span class="p">))</span><span class="w"> </span><span class="c1">// Add "All" option to the start of the list</span>
</span><span id="__span-48-190"><a id="__codelineno-48-190" name="__codelineno-48-190" href="#__codelineno-48-190"></a><span class="w">        </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">"option"</span><span class="p">)</span>
</span><span id="__span-48-191"><a id="__codelineno-48-191" name="__codelineno-48-191" href="#__codelineno-48-191"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span>
</span><span id="__span-48-192"><a id="__codelineno-48-192" name="__codelineno-48-192" href="#__codelineno-48-192"></a><span class="w">        </span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-48-193"><a id="__codelineno-48-193" name="__codelineno-48-193" href="#__codelineno-48-193"></a><span class="p">};</span>
</span></code></pre></div>
<h4 id="minimum-times-referenced-dial">Minimum Times Referenced Dial</h4>
<p><code>dial.js</code> handles the minimum number of times referenced filter. </p>
<p><img alt="Minimum Number of Times Referenced Dial" src="../../assets/images/stem/expert-network-map/mntf-dial.jpg"></p>
<p>This filter originally was draggable left-to-right, but this movement was really unintuitive, and feedback from testers reveals that a circular dragging motion would significantly improve the user experience, so I implemented this change.</p>
<p>The code handles:</p>
<ul>
<li>scaling rotation in degrees to a number in between the minimum and maximum number of times a student was referenced for that topic, with a cap set to 60 (<code>maxMap</code>).</li>
<li>update number on dial when turned - only when the number rounds up to the next integer is the callback function called.</li>
<li>carry out trigonometry to relate mouse dragging to rotation about a point. </li>
<li>create dial SVG objects and set attributes (font, position, etc).</li>
</ul>
<p><em>dial.js</em></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">prevSentToCallback</span><span class="p">;</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">strokeWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">12</span><span class="p">;</span><span class="w"> </span><span class="c1">// stroke width of the line of the dial</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">dialY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pieY</span><span class="p">;</span><span class="w"> </span><span class="c1">// y-coordinate of dial</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">dialX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">pieX</span><span class="p">;</span><span class="w"> </span><span class="c1">// x-coordinate of dial</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="c1">// scale rotation in degrees of dial to number of times referenced filter value</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">generateDialMapScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">().</span><span class="nx">domain</span><span class="p">([</span><span class="nx">startDegree</span><span class="p">,</span><span class="w"> </span><span class="nx">endDegree</span><span class="p">]).</span><span class="nx">range</span><span class="p">([</span><span class="nx">clamp</span><span class="p">(</span><span class="nx">mapMin</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="kc">Infinity</span><span class="p">),</span><span class="w"> </span><span class="nx">mapMax</span><span class="p">])</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="p">};</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="c1">// update number on dial when turned and callback if now integer</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="kd">const</span><span class="w"> </span><span class="nx">updateDialText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">currentDialDeg</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">dialGroup</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">    </span><span class="nx">dialGroup</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="sb">`translate(</span><span class="si">${</span><span class="nx">dialX</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">dialY</span><span class="si">}</span><span class="sb">) rotate(</span><span class="si">${</span><span class="nx">currentDialDeg</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">mapScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateDialMapScale</span><span class="p">();</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">mappedValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mapScale</span><span class="p">(</span><span class="nx">currentDialDeg</span><span class="p">);</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rounded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">mappedValue</span><span class="p">);</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="w">    </span><span class="nx">numText</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a><span class="w">        </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">rounded</span><span class="p">);</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a><span class="w">    </span><span class="nx">numTextWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">numText</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">getBBox</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a><span class="w">    </span><span class="nx">numText</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">dialX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">numTextWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)));</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a><span class="w">    </span><span class="nx">callback</span><span class="p">(</span><span class="nx">rounded</span><span class="p">);</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a><span class="p">};</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a><span class="c1">// helper function to convert between coordinates for placement</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a><span class="kd">function</span><span class="w"> </span><span class="nx">convertSVGtoScreenCoordinates</span><span class="p">(</span><span class="nx">svgElement</span><span class="p">,</span><span class="w"> </span><span class="nx">dialX</span><span class="p">,</span><span class="w"> </span><span class="nx">dialY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31" href="#__codelineno-49-31"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svgElement</span><span class="p">.</span><span class="nx">createSVGPoint</span><span class="p">();</span>
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32" href="#__codelineno-49-32"></a><span class="w">    </span><span class="nx">pt</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dialX</span><span class="p">;</span>
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33" href="#__codelineno-49-33"></a><span class="w">    </span><span class="nx">pt</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dialY</span><span class="p">;</span>
</span><span id="__span-49-34"><a id="__codelineno-49-34" name="__codelineno-49-34" href="#__codelineno-49-34"></a>
</span><span id="__span-49-35"><a id="__codelineno-49-35" name="__codelineno-49-35" href="#__codelineno-49-35"></a><span class="w">    </span><span class="c1">// getScreenCTM returns the matrix that transforms current user units to screen coordinates</span>
</span><span id="__span-49-36"><a id="__codelineno-49-36" name="__codelineno-49-36" href="#__codelineno-49-36"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">svgP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pt</span><span class="p">.</span><span class="nx">matrixTransform</span><span class="p">(</span><span class="nx">svgElement</span><span class="p">.</span><span class="nx">getScreenCTM</span><span class="p">());</span>
</span><span id="__span-49-37"><a id="__codelineno-49-37" name="__codelineno-49-37" href="#__codelineno-49-37"></a>
</span><span id="__span-49-38"><a id="__codelineno-49-38" name="__codelineno-49-38" href="#__codelineno-49-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-39"><a id="__codelineno-49-39" name="__codelineno-49-39" href="#__codelineno-49-39"></a><span class="w">        </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">svgP</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
</span><span id="__span-49-40"><a id="__codelineno-49-40" name="__codelineno-49-40" href="#__codelineno-49-40"></a><span class="w">        </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">svgP</span><span class="p">.</span><span class="nx">y</span>
</span><span id="__span-49-41"><a id="__codelineno-49-41" name="__codelineno-49-41" href="#__codelineno-49-41"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-49-42"><a id="__codelineno-49-42" name="__codelineno-49-42" href="#__codelineno-49-42"></a><span class="p">}</span>
</span><span id="__span-49-43"><a id="__codelineno-49-43" name="__codelineno-49-43" href="#__codelineno-49-43"></a>
</span><span id="__span-49-44"><a id="__codelineno-49-44" name="__codelineno-49-44" href="#__codelineno-49-44"></a><span class="c1">// helper function for dragging trigonometry </span>
</span><span id="__span-49-45"><a id="__codelineno-49-45" name="__codelineno-49-45" href="#__codelineno-49-45"></a><span class="kd">function</span><span class="w"> </span><span class="nx">calculateAngle</span><span class="p">(</span><span class="nx">center</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-46"><a id="__codelineno-49-46" name="__codelineno-49-46" href="#__codelineno-49-46"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
</span><span id="__span-49-47"><a id="__codelineno-49-47" name="__codelineno-49-47" href="#__codelineno-49-47"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span id="__span-49-48"><a id="__codelineno-49-48" name="__codelineno-49-48" href="#__codelineno-49-48"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="nx">dy</span><span class="p">,</span><span class="w"> </span><span class="nx">dx</span><span class="p">);</span>
</span><span id="__span-49-49"><a id="__codelineno-49-49" name="__codelineno-49-49" href="#__codelineno-49-49"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">theta</span><span class="p">;</span>
</span><span id="__span-49-50"><a id="__codelineno-49-50" name="__codelineno-49-50" href="#__codelineno-49-50"></a><span class="p">}</span>
</span><span id="__span-49-51"><a id="__codelineno-49-51" name="__codelineno-49-51" href="#__codelineno-49-51"></a>
</span><span id="__span-49-52"><a id="__codelineno-49-52" name="__codelineno-49-52" href="#__codelineno-49-52"></a><span class="c1">// create dial SVG objects and set attributes (font, position, etc)</span>
</span><span id="__span-49-53"><a id="__codelineno-49-53" name="__codelineno-49-53" href="#__codelineno-49-53"></a><span class="kd">const</span><span class="w"> </span><span class="nx">initializeDial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">svg</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-54"><a id="__codelineno-49-54" name="__codelineno-49-54" href="#__codelineno-49-54"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="nx">svg</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"width"</span><span class="p">),</span>
</span><span id="__span-49-55"><a id="__codelineno-49-55" name="__codelineno-49-55" href="#__codelineno-49-55"></a><span class="w">        </span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="nx">svg</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"height"</span><span class="p">),</span>
</span><span id="__span-49-56"><a id="__codelineno-49-56" name="__codelineno-49-56" href="#__codelineno-49-56"></a><span class="w">        </span><span class="nx">radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pieRadius</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">strokeWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// to be same as the year-select pie</span>
</span><span id="__span-49-57"><a id="__codelineno-49-57" name="__codelineno-49-57" href="#__codelineno-49-57"></a>
</span><span id="__span-49-58"><a id="__codelineno-49-58" name="__codelineno-49-58" href="#__codelineno-49-58"></a><span class="w">    </span><span class="c1">// Get the input element for displaying the mapped value</span>
</span><span id="__span-49-59"><a id="__codelineno-49-59" name="__codelineno-49-59" href="#__codelineno-49-59"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">inputElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"value-input"</span><span class="p">);</span>
</span><span id="__span-49-60"><a id="__codelineno-49-60" name="__codelineno-49-60" href="#__codelineno-49-60"></a>
</span><span id="__span-49-61"><a id="__codelineno-49-61" name="__codelineno-49-61" href="#__codelineno-49-61"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">clamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="p">),</span><span class="w"> </span><span class="nx">max</span><span class="p">);</span>
</span><span id="__span-49-62"><a id="__codelineno-49-62" name="__codelineno-49-62" href="#__codelineno-49-62"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sensitivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-49-63"><a id="__codelineno-49-63" name="__codelineno-49-63" href="#__codelineno-49-63"></a>
</span><span id="__span-49-64"><a id="__codelineno-49-64" name="__codelineno-49-64" href="#__codelineno-49-64"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">textElem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"text"</span><span class="p">);</span>
</span><span id="__span-49-65"><a id="__codelineno-49-65" name="__codelineno-49-65" href="#__codelineno-49-65"></a><span class="w">    </span><span class="nx">textElem</span>
</span><span id="__span-49-66"><a id="__codelineno-49-66" name="__codelineno-49-66" href="#__codelineno-49-66"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nx">dialX</span><span class="p">)</span>
</span><span id="__span-49-67"><a id="__codelineno-49-67" name="__codelineno-49-67" href="#__codelineno-49-67"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nx">dialY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">radius</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">strokeWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">)))</span>
</span><span id="__span-49-68"><a id="__codelineno-49-68" name="__codelineno-49-68" href="#__codelineno-49-68"></a><span class="w">        </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Minimum Times Referenced"</span><span class="p">)</span>
</span><span id="__span-49-69"><a id="__codelineno-49-69" name="__codelineno-49-69" href="#__codelineno-49-69"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-family"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sans-serif"</span><span class="p">)</span>
</span><span id="__span-49-70"><a id="__codelineno-49-70" name="__codelineno-49-70" href="#__codelineno-49-70"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"13px"</span><span class="p">)</span>
</span><span id="__span-49-71"><a id="__codelineno-49-71" name="__codelineno-49-71" href="#__codelineno-49-71"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="nx">DIAL_TEXT_COLOR</span><span class="p">);</span>
</span><span id="__span-49-72"><a id="__codelineno-49-72" name="__codelineno-49-72" href="#__codelineno-49-72"></a><span class="w">    </span><span class="nx">centerText</span><span class="p">(</span><span class="nx">textElem</span><span class="p">,</span><span class="w"> </span><span class="nx">dialX</span><span class="p">);</span>
</span><span id="__span-49-73"><a id="__codelineno-49-73" name="__codelineno-49-73" href="#__codelineno-49-73"></a>
</span><span id="__span-49-74"><a id="__codelineno-49-74" name="__codelineno-49-74" href="#__codelineno-49-74"></a><span class="w">    </span><span class="nx">numText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"text"</span><span class="p">);</span>
</span><span id="__span-49-75"><a id="__codelineno-49-75" name="__codelineno-49-75" href="#__codelineno-49-75"></a><span class="w">    </span><span class="nx">numText</span>
</span><span id="__span-49-76"><a id="__codelineno-49-76" name="__codelineno-49-76" href="#__codelineno-49-76"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nx">dialX</span><span class="p">)</span>
</span><span id="__span-49-77"><a id="__codelineno-49-77" name="__codelineno-49-77" href="#__codelineno-49-77"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nx">dialY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="nx">radius</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">strokeWidth</span><span class="p">))</span>
</span><span id="__span-49-78"><a id="__codelineno-49-78" name="__codelineno-49-78" href="#__codelineno-49-78"></a><span class="w">        </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">"20"</span><span class="p">)</span>
</span><span id="__span-49-79"><a id="__codelineno-49-79" name="__codelineno-49-79" href="#__codelineno-49-79"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-family"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sans-serif"</span><span class="p">)</span>
</span><span id="__span-49-80"><a id="__codelineno-49-80" name="__codelineno-49-80" href="#__codelineno-49-80"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"40px"</span><span class="p">)</span>
</span><span id="__span-49-81"><a id="__codelineno-49-81" name="__codelineno-49-81" href="#__codelineno-49-81"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="nx">DIAL_TEXT_COLOR</span><span class="p">);</span>
</span><span id="__span-49-82"><a id="__codelineno-49-82" name="__codelineno-49-82" href="#__codelineno-49-82"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">numTextWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">numText</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">getBBox</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>
</span><span id="__span-49-83"><a id="__codelineno-49-83" name="__codelineno-49-83" href="#__codelineno-49-83"></a><span class="w">    </span><span class="nx">numText</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">dialX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">numTextWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)));</span>
</span><span id="__span-49-84"><a id="__codelineno-49-84" name="__codelineno-49-84" href="#__codelineno-49-84"></a>
</span><span id="__span-49-85"><a id="__codelineno-49-85" name="__codelineno-49-85" href="#__codelineno-49-85"></a><span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'mousemove'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-86"><a id="__codelineno-49-86" name="__codelineno-49-86" href="#__codelineno-49-86"></a><span class="w">        </span><span class="nx">mousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-87"><a id="__codelineno-49-87" name="__codelineno-49-87" href="#__codelineno-49-87"></a><span class="w">            </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
</span><span id="__span-49-88"><a id="__codelineno-49-88" name="__codelineno-49-88" href="#__codelineno-49-88"></a><span class="w">            </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span>
</span><span id="__span-49-89"><a id="__codelineno-49-89" name="__codelineno-49-89" href="#__codelineno-49-89"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-49-90"><a id="__codelineno-49-90" name="__codelineno-49-90" href="#__codelineno-49-90"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-49-91"><a id="__codelineno-49-91" name="__codelineno-49-91" href="#__codelineno-49-91"></a>
</span><span id="__span-49-92"><a id="__codelineno-49-92" name="__codelineno-49-92" href="#__codelineno-49-92"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">drag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">drag</span><span class="p">()</span>
</span><span id="__span-49-93"><a id="__codelineno-49-93" name="__codelineno-49-93" href="#__codelineno-49-93"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"start"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-94"><a id="__codelineno-49-94" name="__codelineno-49-94" href="#__codelineno-49-94"></a><span class="w">            </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">sourceEvent</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
</span><span id="__span-49-95"><a id="__codelineno-49-95" name="__codelineno-49-95" href="#__codelineno-49-95"></a><span class="w">            </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">sourceEvent</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>
</span><span id="__span-49-96"><a id="__codelineno-49-96" name="__codelineno-49-96" href="#__codelineno-49-96"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">currentDeg</span><span class="p">)</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">currentDeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">startPos</span><span class="p">;</span>
</span><span id="__span-49-97"><a id="__codelineno-49-97" name="__codelineno-49-97" href="#__codelineno-49-97"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-49-98"><a id="__codelineno-49-98" name="__codelineno-49-98" href="#__codelineno-49-98"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"drag"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-99"><a id="__codelineno-49-99" name="__codelineno-49-99" href="#__codelineno-49-99"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">convertSVGtoScreenCoordinates</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'svg'</span><span class="p">)[</span><span class="mf">0</span><span class="p">],</span><span class="w"> </span><span class="nx">dialX</span><span class="p">,</span><span class="w"> </span><span class="nx">dialY</span><span class="p">);</span>
</span><span id="__span-49-100"><a id="__codelineno-49-100" name="__codelineno-49-100" href="#__codelineno-49-100"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">newXY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-101"><a id="__codelineno-49-101" name="__codelineno-49-101" href="#__codelineno-49-101"></a><span class="w">                </span><span class="s2">"x"</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">sourceEvent</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
</span><span id="__span-49-102"><a id="__codelineno-49-102" name="__codelineno-49-102" href="#__codelineno-49-102"></a><span class="w">                </span><span class="s2">"y"</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">sourceEvent</span><span class="p">.</span><span class="nx">clientY</span>
</span><span id="__span-49-103"><a id="__codelineno-49-103" name="__codelineno-49-103" href="#__codelineno-49-103"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-49-104"><a id="__codelineno-49-104" name="__codelineno-49-104" href="#__codelineno-49-104"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">calculateAngle</span><span class="p">(</span><span class="nx">vals</span><span class="p">,</span><span class="w"> </span><span class="cm">/*mousePos*/</span><span class="w"> </span><span class="nx">newXY</span><span class="p">);</span>
</span><span id="__span-49-105"><a id="__codelineno-49-105" name="__codelineno-49-105" href="#__codelineno-49-105"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">thetaDegrees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">theta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">180</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">);</span>
</span><span id="__span-49-106"><a id="__codelineno-49-106" name="__codelineno-49-106" href="#__codelineno-49-106"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">oldXY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-107"><a id="__codelineno-49-107" name="__codelineno-49-107" href="#__codelineno-49-107"></a><span class="w">                </span><span class="s2">"x"</span><span class="o">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
</span><span id="__span-49-108"><a id="__codelineno-49-108" name="__codelineno-49-108" href="#__codelineno-49-108"></a><span class="w">                </span><span class="s2">"y"</span><span class="o">:</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span>
</span><span id="__span-49-109"><a id="__codelineno-49-109" name="__codelineno-49-109" href="#__codelineno-49-109"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-49-110"><a id="__codelineno-49-110" name="__codelineno-49-110" href="#__codelineno-49-110"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">oldAngle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">calculateAngle</span><span class="p">(</span><span class="nx">vals</span><span class="p">,</span><span class="w"> </span><span class="nx">oldXY</span><span class="p">);</span>
</span><span id="__span-49-111"><a id="__codelineno-49-111" name="__codelineno-49-111" href="#__codelineno-49-111"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">oldAngleDegrees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">oldAngle</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">180</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span>
</span><span id="__span-49-112"><a id="__codelineno-49-112" name="__codelineno-49-112" href="#__codelineno-49-112"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">angleDelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">thetaDegrees</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">oldAngleDegrees</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">180</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">360</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">360</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">180</span><span class="p">;</span>
</span><span id="__span-49-113"><a id="__codelineno-49-113" name="__codelineno-49-113" href="#__codelineno-49-113"></a><span class="w">            </span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newXY</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span id="__span-49-114"><a id="__codelineno-49-114" name="__codelineno-49-114" href="#__codelineno-49-114"></a><span class="w">            </span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newXY</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
</span><span id="__span-49-115"><a id="__codelineno-49-115" name="__codelineno-49-115" href="#__codelineno-49-115"></a>
</span><span id="__span-49-116"><a id="__codelineno-49-116" name="__codelineno-49-116" href="#__codelineno-49-116"></a><span class="w">            </span><span class="nx">d</span><span class="p">.</span><span class="nx">degNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">angleDelta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">currentDeg</span><span class="p">;</span>
</span><span id="__span-49-117"><a id="__codelineno-49-117" name="__codelineno-49-117" href="#__codelineno-49-117"></a><span class="w">            </span><span class="nx">d</span><span class="p">.</span><span class="nx">currentDeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">degNew</span><span class="p">;</span>
</span><span id="__span-49-118"><a id="__codelineno-49-118" name="__codelineno-49-118" href="#__codelineno-49-118"></a><span class="w">            </span><span class="nx">currentDialDeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clamp</span><span class="p">(</span><span class="nx">angleDelta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">currentDialDeg</span><span class="p">,</span><span class="w"> </span><span class="nx">startDegree</span><span class="p">,</span><span class="w"> </span><span class="nx">endDegree</span><span class="p">);</span>
</span><span id="__span-49-119"><a id="__codelineno-49-119" name="__codelineno-49-119" href="#__codelineno-49-119"></a>
</span><span id="__span-49-120"><a id="__codelineno-49-120" name="__codelineno-49-120" href="#__codelineno-49-120"></a><span class="w">            </span><span class="nx">updateDialText</span><span class="p">(</span><span class="nx">currentDialDeg</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">);</span>
</span><span id="__span-49-121"><a id="__codelineno-49-121" name="__codelineno-49-121" href="#__codelineno-49-121"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-49-122"><a id="__codelineno-49-122" name="__codelineno-49-122" href="#__codelineno-49-122"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"end"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-123"><a id="__codelineno-49-123" name="__codelineno-49-123" href="#__codelineno-49-123"></a><span class="w">            </span><span class="nx">d</span><span class="p">.</span><span class="nx">currentDeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">degNew</span><span class="p">;</span>
</span><span id="__span-49-124"><a id="__codelineno-49-124" name="__codelineno-49-124" href="#__codelineno-49-124"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-49-125"><a id="__codelineno-49-125" name="__codelineno-49-125" href="#__codelineno-49-125"></a>
</span><span id="__span-49-126"><a id="__codelineno-49-126" name="__codelineno-49-126" href="#__codelineno-49-126"></a>
</span><span id="__span-49-127"><a id="__codelineno-49-127" name="__codelineno-49-127" href="#__codelineno-49-127"></a><span class="w">    </span><span class="nx">dialGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">)</span>
</span><span id="__span-49-128"><a id="__codelineno-49-128" name="__codelineno-49-128" href="#__codelineno-49-128"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">([{</span>
</span><span id="__span-49-129"><a id="__codelineno-49-129" name="__codelineno-49-129" href="#__codelineno-49-129"></a><span class="w">            </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-49-130"><a id="__codelineno-49-130" name="__codelineno-49-130" href="#__codelineno-49-130"></a><span class="w">            </span><span class="nx">scale</span><span class="o">:</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">().</span><span class="nx">domain</span><span class="p">([</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">]).</span><span class="nx">range</span><span class="p">([</span><span class="nx">startDegree</span><span class="p">,</span><span class="w"> </span><span class="nx">endDegree</span><span class="p">])</span>
</span><span id="__span-49-131"><a id="__codelineno-49-131" name="__codelineno-49-131" href="#__codelineno-49-131"></a><span class="w">        </span><span class="p">}])</span><span class="w"> </span><span class="c1">// initial data for dialGroup</span>
</span><span id="__span-49-132"><a id="__codelineno-49-132" name="__codelineno-49-132" href="#__codelineno-49-132"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="sb">`translate(</span><span class="si">${</span><span class="nx">dialX</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">dialY</span><span class="si">}</span><span class="sb">) rotate(</span><span class="si">${</span><span class="nx">startPos</span><span class="si">}</span><span class="sb">)`</span><span class="p">)</span>
</span><span id="__span-49-133"><a id="__codelineno-49-133" name="__codelineno-49-133" href="#__codelineno-49-133"></a><span class="w">        </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">drag</span><span class="p">);</span>
</span><span id="__span-49-134"><a id="__codelineno-49-134" name="__codelineno-49-134" href="#__codelineno-49-134"></a>
</span><span id="__span-49-135"><a id="__codelineno-49-135" name="__codelineno-49-135" href="#__codelineno-49-135"></a><span class="w">    </span><span class="c1">// Add a transparent circle for better dragging</span>
</span><span id="__span-49-136"><a id="__codelineno-49-136" name="__codelineno-49-136" href="#__codelineno-49-136"></a><span class="w">    </span><span class="nx">dialGroup</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">)</span>
</span><span id="__span-49-137"><a id="__codelineno-49-137" name="__codelineno-49-137" href="#__codelineno-49-137"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span>
</span><span id="__span-49-138"><a id="__codelineno-49-138" name="__codelineno-49-138" href="#__codelineno-49-138"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="s2">"transparent"</span><span class="p">);</span>
</span><span id="__span-49-139"><a id="__codelineno-49-139" name="__codelineno-49-139" href="#__codelineno-49-139"></a>
</span><span id="__span-49-140"><a id="__codelineno-49-140" name="__codelineno-49-140" href="#__codelineno-49-140"></a><span class="w">    </span><span class="nx">dialGroup</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">)</span>
</span><span id="__span-49-141"><a id="__codelineno-49-141" name="__codelineno-49-141" href="#__codelineno-49-141"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span><span class="w"> </span><span class="nx">radius</span><span class="p">)</span>
</span><span id="__span-49-142"><a id="__codelineno-49-142" name="__codelineno-49-142" href="#__codelineno-49-142"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span>
</span><span id="__span-49-143"><a id="__codelineno-49-143" name="__codelineno-49-143" href="#__codelineno-49-143"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="nx">DIAL_OUTLINE_COLOR</span><span class="p">)</span>
</span><span id="__span-49-144"><a id="__codelineno-49-144" name="__codelineno-49-144" href="#__codelineno-49-144"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">strokeWidth</span><span class="si">}</span><span class="sb">px`</span><span class="p">);</span>
</span><span id="__span-49-145"><a id="__codelineno-49-145" name="__codelineno-49-145" href="#__codelineno-49-145"></a>
</span><span id="__span-49-146"><a id="__codelineno-49-146" name="__codelineno-49-146" href="#__codelineno-49-146"></a><span class="w">    </span><span class="nx">dialGroup</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"line"</span><span class="p">)</span>
</span><span id="__span-49-147"><a id="__codelineno-49-147" name="__codelineno-49-147" href="#__codelineno-49-147"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x1"</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-49-148"><a id="__codelineno-49-148" name="__codelineno-49-148" href="#__codelineno-49-148"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y1"</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-49-149"><a id="__codelineno-49-149" name="__codelineno-49-149" href="#__codelineno-49-149"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x2"</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-49-150"><a id="__codelineno-49-150" name="__codelineno-49-150" href="#__codelineno-49-150"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y2"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="nx">radius</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">strokeWidth</span><span class="p">))</span>
</span><span id="__span-49-151"><a id="__codelineno-49-151" name="__codelineno-49-151" href="#__codelineno-49-151"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="nx">DIAL_STICK_COLOR</span><span class="p">)</span>
</span><span id="__span-49-152"><a id="__codelineno-49-152" name="__codelineno-49-152" href="#__codelineno-49-152"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">strokeWidth</span><span class="si">}</span><span class="sb">px`</span><span class="p">)</span>
</span><span id="__span-49-153"><a id="__codelineno-49-153" name="__codelineno-49-153" href="#__codelineno-49-153"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-linecap"</span><span class="p">,</span><span class="w"> </span><span class="s2">"round"</span><span class="p">);</span>
</span><span id="__span-49-154"><a id="__codelineno-49-154" name="__codelineno-49-154" href="#__codelineno-49-154"></a>
</span><span id="__span-49-155"><a id="__codelineno-49-155" name="__codelineno-49-155" href="#__codelineno-49-155"></a><span class="w">    </span><span class="c1">// Display the initial mapped value</span>
</span><span id="__span-49-156"><a id="__codelineno-49-156" name="__codelineno-49-156" href="#__codelineno-49-156"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">initialScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">().</span><span class="nx">domain</span><span class="p">([</span><span class="nx">startDegree</span><span class="p">,</span><span class="w"> </span><span class="nx">endDegree</span><span class="p">]).</span><span class="nx">range</span><span class="p">([</span><span class="nx">mapMin</span><span class="p">,</span><span class="w"> </span><span class="nx">mapMax</span><span class="p">]);</span>
</span><span id="__span-49-157"><a id="__codelineno-49-157" name="__codelineno-49-157" href="#__codelineno-49-157"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">initialMappedValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">initialScale</span><span class="p">(</span><span class="nx">startPos</span><span class="p">);</span>
</span><span id="__span-49-158"><a id="__codelineno-49-158" name="__codelineno-49-158" href="#__codelineno-49-158"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="subject-area-carousel">Subject-Area Carousel</h4>
<p><code>carousel.js</code> only handles the initialization of the subject-area-selection carousel. By carousel, I am referring to the selection of a rectangle of the subject-area where a black rectangular outline moves down to highlight the selection. I originally planned to use a more traditional <a href="https://ui-patterns.com/patterns/Carousel">carousel design</a> but altered the axis and mobility of the options for aesthetic reasons.</p>
<p><img alt="Carousel" src="../../assets/images/stem/expert-network-map/carousel.jpg" style="height:300px;"></p>
<p><em>carousel.js</em></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">initializeCarousel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="nx">carousel_data</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">svg</span><span class="p">,</span><span class="w"> </span><span class="nx">colorPalette</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">    </span><span class="c1">// create SVG group (&lt;g&gt;) HTML element</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="c1">// create D3JS scale band for the y-axis of the filter</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">yScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">scaleBand</span><span class="p">()</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">        </span><span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="p">])</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">        </span><span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">carousel_data</span><span class="p">)</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">        </span><span class="p">.</span><span class="nx">padding</span><span class="p">(</span><span class="mf">0.2</span><span class="p">);</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">    </span><span class="c1">// create D3JS color scale</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">scaleOrdinal</span><span class="p">().</span><span class="nx">range</span><span class="p">(</span><span class="nx">colorPalette</span><span class="p">);</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">    </span><span class="c1">// make D3JS selection for option rectangles and set aesthetic attributes based on constants</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"rect"</span><span class="p">)</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">carousel_data</span><span class="p">)</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">        </span><span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">        </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"rect"</span><span class="p">)</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'width'</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">)</span>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'height'</span><span class="p">,</span><span class="w"> </span><span class="nx">yScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'stroke'</span><span class="p">,</span><span class="w"> </span><span class="nx">CAROUSEL_RECT_STROKE_COLOR</span><span class="p">)</span>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'stroke-width'</span><span class="p">,</span><span class="w"> </span><span class="nx">CAROUSEL_RECT_STROKE_WIDTH</span><span class="p">)</span>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span><span class="w"> </span><span class="nx">CAROUSEL_OPTION_COLOR</span><span class="cm">/*d =&gt; color(d)*/</span><span class="p">)</span>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a><span class="w">            </span><span class="nx">movePointerTo</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a>
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a><span class="w">    </span><span class="c1">// calculat width of outline selection rectangle</span>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">outerWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">carousel_data</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">yScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">outerHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">carousel_data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">innerWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">innerHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">yScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">();</span>
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a>
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">top</span><span class="o">:</span><span class="w"> </span><span class="nx">yScale</span><span class="p">(</span><span class="nx">carousel_data</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="nx">yScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">carousel_data</span><span class="p">.</span><span class="nx">length</span><span class="p">)))</span><span class="o">/</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">left</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="nx">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">carousel_data</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">yScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">())</span><span class="o">/</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="nx">outerWidth</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="nx">outerHeight</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">innerRectangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a><span class="w">        </span><span class="nx">top</span><span class="o">:</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="p">.</span><span class="nx">top</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">outerHeight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">innerHeight</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a><span class="w">        </span><span class="nx">left</span><span class="o">:</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="p">.</span><span class="nx">left</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">outerWidth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">innerWidth</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38" href="#__codelineno-50-38"></a><span class="w">        </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="nx">innerWidth</span><span class="p">,</span>
</span><span id="__span-50-39"><a id="__codelineno-50-39" name="__codelineno-50-39" href="#__codelineno-50-39"></a><span class="w">        </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="nx">innerHeight</span>
</span><span id="__span-50-40"><a id="__codelineno-50-40" name="__codelineno-50-40" href="#__codelineno-50-40"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-50-41"><a id="__codelineno-50-41" name="__codelineno-50-41" href="#__codelineno-50-41"></a>
</span><span id="__span-50-42"><a id="__codelineno-50-42" name="__codelineno-50-42" href="#__codelineno-50-42"></a><span class="w">    </span><span class="c1">// SVG path for outer selection rectangle</span>
</span><span id="__span-50-43"><a id="__codelineno-50-43" name="__codelineno-50-43" href="#__codelineno-50-43"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pathData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-44"><a id="__codelineno-50-44" name="__codelineno-50-44" href="#__codelineno-50-44"></a><span class="w">        </span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span><span class="w"> </span><span class="c1">// Move to the top-left corner of the outer rectangle</span>
</span><span id="__span-50-45"><a id="__codelineno-50-45" name="__codelineno-50-45" href="#__codelineno-50-45"></a><span class="w">        </span><span class="s2">"h"</span><span class="p">,</span><span class="w"> </span><span class="nx">outerWidth</span><span class="p">,</span><span class="w"> </span><span class="c1">// Draw the top side</span>
</span><span id="__span-50-46"><a id="__codelineno-50-46" name="__codelineno-50-46" href="#__codelineno-50-46"></a><span class="w">        </span><span class="s2">"v"</span><span class="p">,</span><span class="w"> </span><span class="nx">outerHeight</span><span class="p">,</span><span class="w"> </span><span class="c1">// Draw the right side</span>
</span><span id="__span-50-47"><a id="__codelineno-50-47" name="__codelineno-50-47" href="#__codelineno-50-47"></a><span class="w">        </span><span class="s2">"h"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nx">outerWidth</span><span class="p">,</span><span class="w"> </span><span class="c1">// Draw the bottom side</span>
</span><span id="__span-50-48"><a id="__codelineno-50-48" name="__codelineno-50-48" href="#__codelineno-50-48"></a><span class="w">        </span><span class="s2">"v"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nx">outerHeight</span><span class="p">,</span><span class="w"> </span><span class="c1">// Draw the left side</span>
</span><span id="__span-50-49"><a id="__codelineno-50-49" name="__codelineno-50-49" href="#__codelineno-50-49"></a><span class="w">        </span><span class="s2">"M"</span><span class="p">,</span><span class="w"> </span><span class="nx">innerRectangle</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span><span class="w"> </span><span class="nx">innerRectangle</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span><span class="w"> </span><span class="c1">// Move to the top-left corner of the inner rectangle</span>
</span><span id="__span-50-50"><a id="__codelineno-50-50" name="__codelineno-50-50" href="#__codelineno-50-50"></a><span class="w">        </span><span class="s2">"h"</span><span class="p">,</span><span class="w"> </span><span class="nx">innerWidth</span><span class="p">,</span><span class="w"> </span><span class="c1">// Draw the top side</span>
</span><span id="__span-50-51"><a id="__codelineno-50-51" name="__codelineno-50-51" href="#__codelineno-50-51"></a><span class="w">        </span><span class="s2">"v"</span><span class="p">,</span><span class="w"> </span><span class="nx">innerHeight</span><span class="p">,</span><span class="w"> </span><span class="c1">// Draw the right side</span>
</span><span id="__span-50-52"><a id="__codelineno-50-52" name="__codelineno-50-52" href="#__codelineno-50-52"></a><span class="w">        </span><span class="s2">"h"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nx">innerWidth</span><span class="p">,</span><span class="w"> </span><span class="c1">// Draw the bottom side</span>
</span><span id="__span-50-53"><a id="__codelineno-50-53" name="__codelineno-50-53" href="#__codelineno-50-53"></a><span class="w">        </span><span class="s2">"v"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nx">innerHeight</span><span class="p">,</span><span class="w"> </span><span class="c1">// Draw the left side</span>
</span><span id="__span-50-54"><a id="__codelineno-50-54" name="__codelineno-50-54" href="#__codelineno-50-54"></a><span class="w">        </span><span class="s2">"Z"</span><span class="w"> </span><span class="c1">// Close the path</span>
</span><span id="__span-50-55"><a id="__codelineno-50-55" name="__codelineno-50-55" href="#__codelineno-50-55"></a><span class="w">    </span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">);</span>
</span><span id="__span-50-56"><a id="__codelineno-50-56" name="__codelineno-50-56" href="#__codelineno-50-56"></a>
</span><span id="__span-50-57"><a id="__codelineno-50-57" name="__codelineno-50-57" href="#__codelineno-50-57"></a><span class="w">    </span><span class="c1">// create definitions section of &lt;g&gt;</span>
</span><span id="__span-50-58"><a id="__codelineno-50-58" name="__codelineno-50-58" href="#__codelineno-50-58"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"defs"</span><span class="p">);</span>
</span><span id="__span-50-59"><a id="__codelineno-50-59" name="__codelineno-50-59" href="#__codelineno-50-59"></a>
</span><span id="__span-50-60"><a id="__codelineno-50-60" name="__codelineno-50-60" href="#__codelineno-50-60"></a><span class="w">    </span><span class="c1">// create mask (for selection rectangle outline)</span>
</span><span id="__span-50-61"><a id="__codelineno-50-61" name="__codelineno-50-61" href="#__codelineno-50-61"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">defs</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"mask"</span><span class="p">)</span>
</span><span id="__span-50-62"><a id="__codelineno-50-62" name="__codelineno-50-62" href="#__codelineno-50-62"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="s2">"myMask"</span><span class="p">);</span>
</span><span id="__span-50-63"><a id="__codelineno-50-63" name="__codelineno-50-63" href="#__codelineno-50-63"></a>
</span><span id="__span-50-64"><a id="__codelineno-50-64" name="__codelineno-50-64" href="#__codelineno-50-64"></a><span class="w">    </span><span class="c1">// Add a white rectangle to the mask</span>
</span><span id="__span-50-65"><a id="__codelineno-50-65" name="__codelineno-50-65" href="#__codelineno-50-65"></a><span class="w">    </span><span class="nx">mask</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"rect"</span><span class="p">)</span>
</span><span id="__span-50-66"><a id="__codelineno-50-66" name="__codelineno-50-66" href="#__codelineno-50-66"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-50-67"><a id="__codelineno-50-67" name="__codelineno-50-67" href="#__codelineno-50-67"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-50-68"><a id="__codelineno-50-68" name="__codelineno-50-68" href="#__codelineno-50-68"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"width"</span><span class="p">,</span><span class="w"> </span><span class="s2">"100%"</span><span class="p">)</span>
</span><span id="__span-50-69"><a id="__codelineno-50-69" name="__codelineno-50-69" href="#__codelineno-50-69"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"height"</span><span class="p">,</span><span class="w"> </span><span class="s2">"100%"</span><span class="p">)</span>
</span><span id="__span-50-70"><a id="__codelineno-50-70" name="__codelineno-50-70" href="#__codelineno-50-70"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="s2">"white"</span><span class="p">);</span>
</span><span id="__span-50-71"><a id="__codelineno-50-71" name="__codelineno-50-71" href="#__codelineno-50-71"></a>
</span><span id="__span-50-72"><a id="__codelineno-50-72" name="__codelineno-50-72" href="#__codelineno-50-72"></a><span class="w">    </span><span class="c1">// Add a smaller black rectangle to the mask to cut out</span>
</span><span id="__span-50-73"><a id="__codelineno-50-73" name="__codelineno-50-73" href="#__codelineno-50-73"></a><span class="w">    </span><span class="nx">mask</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"rect"</span><span class="p">)</span>
</span><span id="__span-50-74"><a id="__codelineno-50-74" name="__codelineno-50-74" href="#__codelineno-50-74"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nx">innerRectangle</span><span class="p">.</span><span class="nx">left</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-50-75"><a id="__codelineno-50-75" name="__codelineno-50-75" href="#__codelineno-50-75"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nx">innerRectangle</span><span class="p">.</span><span class="nx">top</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-50-76"><a id="__codelineno-50-76" name="__codelineno-50-76" href="#__codelineno-50-76"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"width"</span><span class="p">,</span><span class="w"> </span><span class="nx">innerRectangle</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
</span><span id="__span-50-77"><a id="__codelineno-50-77" name="__codelineno-50-77" href="#__codelineno-50-77"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"height"</span><span class="p">,</span><span class="w"> </span><span class="nx">innerRectangle</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
</span><span id="__span-50-78"><a id="__codelineno-50-78" name="__codelineno-50-78" href="#__codelineno-50-78"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="s2">"black"</span><span class="p">);</span>
</span><span id="__span-50-79"><a id="__codelineno-50-79" name="__codelineno-50-79" href="#__codelineno-50-79"></a>
</span><span id="__span-50-80"><a id="__codelineno-50-80" name="__codelineno-50-80" href="#__codelineno-50-80"></a><span class="w">    </span><span class="c1">// Draw a rectangle with the mask</span>
</span><span id="__span-50-81"><a id="__codelineno-50-81" name="__codelineno-50-81" href="#__codelineno-50-81"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">selectionRect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"rect"</span><span class="p">)</span>
</span><span id="__span-50-82"><a id="__codelineno-50-82" name="__codelineno-50-82" href="#__codelineno-50-82"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="p">.</span><span class="nx">left</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-50-83"><a id="__codelineno-50-83" name="__codelineno-50-83" href="#__codelineno-50-83"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="p">.</span><span class="nx">top</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-50-84"><a id="__codelineno-50-84" name="__codelineno-50-84" href="#__codelineno-50-84"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"width"</span><span class="p">,</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
</span><span id="__span-50-85"><a id="__codelineno-50-85" name="__codelineno-50-85" href="#__codelineno-50-85"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"height"</span><span class="p">,</span><span class="w"> </span><span class="nx">outerRectangle</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
</span><span id="__span-50-86"><a id="__codelineno-50-86" name="__codelineno-50-86" href="#__codelineno-50-86"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="nx">CAROUSEL_SELECTOR_COLOR</span><span class="p">)</span>
</span><span id="__span-50-87"><a id="__codelineno-50-87" name="__codelineno-50-87" href="#__codelineno-50-87"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"mask"</span><span class="p">,</span><span class="w"> </span><span class="s2">"url(#myMask)"</span><span class="p">);</span>
</span><span id="__span-50-88"><a id="__codelineno-50-88" name="__codelineno-50-88" href="#__codelineno-50-88"></a>
</span><span id="__span-50-89"><a id="__codelineno-50-89" name="__codelineno-50-89" href="#__codelineno-50-89"></a><span class="w">    </span><span class="c1">// when an option is clicked, move the selection rectangle to that option</span>
</span><span id="__span-50-90"><a id="__codelineno-50-90" name="__codelineno-50-90" href="#__codelineno-50-90"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">movePointerTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-91"><a id="__codelineno-50-91" name="__codelineno-50-91" href="#__codelineno-50-91"></a><span class="w">        </span><span class="nx">selectionRect</span><span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
</span><span id="__span-50-92"><a id="__codelineno-50-92" name="__codelineno-50-92" href="#__codelineno-50-92"></a><span class="w">            </span><span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
</span><span id="__span-50-93"><a id="__codelineno-50-93" name="__codelineno-50-93" href="#__codelineno-50-93"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'transform'</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate(0, "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">yScale</span><span class="p">(</span><span class="nx">carousel_data</span><span class="p">[</span><span class="mf">0</span><span class="p">]))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">);</span>
</span><span id="__span-50-94"><a id="__codelineno-50-94" name="__codelineno-50-94" href="#__codelineno-50-94"></a><span class="w">            </span><span class="nx">callback</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-50-95"><a id="__codelineno-50-95" name="__codelineno-50-95" href="#__codelineno-50-95"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-50-96"><a id="__codelineno-50-96" name="__codelineno-50-96" href="#__codelineno-50-96"></a>
</span><span id="__span-50-97"><a id="__codelineno-50-97" name="__codelineno-50-97" href="#__codelineno-50-97"></a><span class="w">    </span><span class="c1">// set text attributes and click callback for option rectangles</span>
</span><span id="__span-50-98"><a id="__codelineno-50-98" name="__codelineno-50-98" href="#__codelineno-50-98"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"text"</span><span class="p">)</span>
</span><span id="__span-50-99"><a id="__codelineno-50-99" name="__codelineno-50-99" href="#__codelineno-50-99"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">carousel_data</span><span class="p">)</span>
</span><span id="__span-50-100"><a id="__codelineno-50-100" name="__codelineno-50-100" href="#__codelineno-50-100"></a><span class="w">        </span><span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
</span><span id="__span-50-101"><a id="__codelineno-50-101" name="__codelineno-50-101" href="#__codelineno-50-101"></a><span class="w">        </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"text"</span><span class="p">)</span>
</span><span id="__span-50-102"><a id="__codelineno-50-102" name="__codelineno-50-102" href="#__codelineno-50-102"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">width</span><span class="o">/</span><span class="mf">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-50-103"><a id="__codelineno-50-103" name="__codelineno-50-103" href="#__codelineno-50-103"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">yScale</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">yScale</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">()</span><span class="o">/</span><span class="mf">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-50-104"><a id="__codelineno-50-104" name="__codelineno-50-104" href="#__codelineno-50-104"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'dy'</span><span class="p">,</span><span class="w"> </span><span class="s1">'0.3em'</span><span class="p">)</span>
</span><span id="__span-50-105"><a id="__codelineno-50-105" name="__codelineno-50-105" href="#__codelineno-50-105"></a><span class="w">        </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span>
</span><span id="__span-50-106"><a id="__codelineno-50-106" name="__codelineno-50-106" href="#__codelineno-50-106"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-107"><a id="__codelineno-50-107" name="__codelineno-50-107" href="#__codelineno-50-107"></a><span class="w">            </span><span class="nx">movePointerTo</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-50-108"><a id="__codelineno-50-108" name="__codelineno-50-108" href="#__codelineno-50-108"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-50-109"><a id="__codelineno-50-109" name="__codelineno-50-109" href="#__codelineno-50-109"></a>
</span><span id="__span-50-110"><a id="__codelineno-50-110" name="__codelineno-50-110" href="#__codelineno-50-110"></a><span class="w">    </span><span class="c1">// set text style attributes</span>
</span><span id="__span-50-111"><a id="__codelineno-50-111" name="__codelineno-50-111" href="#__codelineno-50-111"></a><span class="w">    </span><span class="nx">text</span>
</span><span id="__span-50-112"><a id="__codelineno-50-112" name="__codelineno-50-112" href="#__codelineno-50-112"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'text-anchor'</span><span class="p">,</span><span class="w"> </span><span class="s1">'middle'</span><span class="p">)</span>
</span><span id="__span-50-113"><a id="__codelineno-50-113" name="__codelineno-50-113" href="#__codelineno-50-113"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span><span class="w"> </span><span class="nx">CAROUSEL_TEXT_COLOR</span><span class="p">)</span>
</span><span id="__span-50-114"><a id="__codelineno-50-114" name="__codelineno-50-114" href="#__codelineno-50-114"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-weight"</span><span class="p">,</span><span class="w"> </span><span class="mf">700</span><span class="p">)</span>
</span><span id="__span-50-115"><a id="__codelineno-50-115" name="__codelineno-50-115" href="#__codelineno-50-115"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-family"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Saira"</span><span class="p">)</span>
</span><span id="__span-50-116"><a id="__codelineno-50-116" name="__codelineno-50-116" href="#__codelineno-50-116"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="mf">13</span><span class="p">)</span>
</span><span id="__span-50-117"><a id="__codelineno-50-117" name="__codelineno-50-117" href="#__codelineno-50-117"></a><span class="p">};</span>
</span></code></pre></div>
<h4 id="year-selection">Year Selection</h4>
<p>The year selection pie was not substantial enough to be moved into its own file, so its code is found in <code>helper_functions.js</code>. I'll provide a snippet and explanation below.</p>
<p>The code does the following:</p>
<ul>
<li>create a new SVG group for the filter</li>
<li>add a slice for each year</li>
<li>handle rotation on click</li>
<li>style the text inside each slice</li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createPie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pieG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">)</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pieX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">","</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pieY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">") rotate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">360</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">14</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">);</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pieData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">        </span><span class="s2">"All"</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2018</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">2023</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">        </span><span class="nx">pieData</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">pie</span><span class="p">()</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">        </span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data_ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pie</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">pieData</span><span class="p">).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">        </span><span class="nx">key</span><span class="p">,</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">        </span><span class="nx">value</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">    </span><span class="p">})));</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">arcGenerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">.</span><span class="nx">arc</span><span class="p">()</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="w">        </span><span class="p">.</span><span class="nx">innerRadius</span><span class="p">(</span><span class="mf">50</span><span class="p">)</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="w">        </span><span class="p">.</span><span class="nx">outerRadius</span><span class="p">(</span><span class="nx">pieRadius</span><span class="p">)</span>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rotatePie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">rotate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">((</span><span class="nx">d</span><span class="p">.</span><span class="nx">startAngle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">endAngle</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="w">        </span><span class="nx">pieG</span><span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">            </span><span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pieX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">","</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pieY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">") rotate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">rotate</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">180</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">);</span>
</span><span id="__span-51-31"><a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-51-32"><a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a>
</span><span id="__span-51-33"><a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="w">    </span><span class="nx">pieG</span>
</span><span id="__span-51-34"><a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a><span class="w">        </span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'mySlices'</span><span class="p">)</span>
</span><span id="__span-51-35"><a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">data_ready</span><span class="p">)</span>
</span><span id="__span-51-36"><a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="w">        </span><span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
</span><span id="__span-51-37"><a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a><span class="w">        </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>
</span><span id="__span-51-38"><a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="nx">arcGenerator</span><span class="p">)</span>
</span><span id="__span-51-39"><a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span><span class="w"> </span><span class="nx">PIE_SLICE_COLOR</span><span class="p">)</span>
</span><span id="__span-51-40"><a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span><span class="w"> </span><span class="s2">"white"</span><span class="p">)</span>
</span><span id="__span-51-41"><a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2px"</span><span class="p">)</span>
</span><span id="__span-51-42"><a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</span><span id="__span-51-43"><a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-44"><a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a><span class="w">            </span><span class="nx">setYear</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-51-45"><a id="__codelineno-51-45" name="__codelineno-51-45" href="#__codelineno-51-45"></a><span class="w">            </span><span class="nx">rotatePie</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-51-46"><a id="__codelineno-51-46" name="__codelineno-51-46" href="#__codelineno-51-46"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-51-47"><a id="__codelineno-51-47" name="__codelineno-51-47" href="#__codelineno-51-47"></a>
</span><span id="__span-51-48"><a id="__codelineno-51-48" name="__codelineno-51-48" href="#__codelineno-51-48"></a><span class="w">    </span><span class="nx">pieG</span>
</span><span id="__span-51-49"><a id="__codelineno-51-49" name="__codelineno-51-49" href="#__codelineno-51-49"></a><span class="w">        </span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'mySlices'</span><span class="p">)</span>
</span><span id="__span-51-50"><a id="__codelineno-51-50" name="__codelineno-51-50" href="#__codelineno-51-50"></a><span class="w">        </span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">data_ready</span><span class="p">)</span>
</span><span id="__span-51-51"><a id="__codelineno-51-51" name="__codelineno-51-51" href="#__codelineno-51-51"></a><span class="w">        </span><span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
</span><span id="__span-51-52"><a id="__codelineno-51-52" name="__codelineno-51-52" href="#__codelineno-51-52"></a><span class="w">        </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'text'</span><span class="p">)</span>
</span><span id="__span-51-53"><a id="__codelineno-51-53" name="__codelineno-51-53" href="#__codelineno-51-53"></a><span class="w">        </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-54"><a id="__codelineno-51-54" name="__codelineno-51-54" href="#__codelineno-51-54"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span>
</span><span id="__span-51-55"><a id="__codelineno-51-55" name="__codelineno-51-55" href="#__codelineno-51-55"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-51-56"><a id="__codelineno-51-56" name="__codelineno-51-56" href="#__codelineno-51-56"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"dy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.3em"</span><span class="p">)</span>
</span><span id="__span-51-57"><a id="__codelineno-51-57" name="__codelineno-51-57" href="#__codelineno-51-57"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-58"><a id="__codelineno-51-58" name="__codelineno-51-58" href="#__codelineno-51-58"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s2">"translate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">arcGenerator</span><span class="p">.</span><span class="nx">centroid</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">") rotate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">startAngle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">endAngle</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">180</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">;</span>
</span><span id="__span-51-59"><a id="__codelineno-51-59" name="__codelineno-51-59" href="#__codelineno-51-59"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-51-60"><a id="__codelineno-51-60" name="__codelineno-51-60" href="#__codelineno-51-60"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'text-anchor'</span><span class="p">,</span><span class="w"> </span><span class="s1">'middle'</span><span class="p">)</span>
</span><span id="__span-51-61"><a id="__codelineno-51-61" name="__codelineno-51-61" href="#__codelineno-51-61"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span><span class="w"> </span><span class="nx">PIE_TEXT_COLOR</span><span class="p">)</span>
</span><span id="__span-51-62"><a id="__codelineno-51-62" name="__codelineno-51-62" href="#__codelineno-51-62"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-weight"</span><span class="p">,</span><span class="w"> </span><span class="mf">700</span><span class="p">)</span>
</span><span id="__span-51-63"><a id="__codelineno-51-63" name="__codelineno-51-63" href="#__codelineno-51-63"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-family"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Saira"</span><span class="p">)</span>
</span><span id="__span-51-64"><a id="__codelineno-51-64" name="__codelineno-51-64" href="#__codelineno-51-64"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="mf">18</span><span class="p">)</span>
</span><span id="__span-51-65"><a id="__codelineno-51-65" name="__codelineno-51-65" href="#__codelineno-51-65"></a><span class="w">        </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-66"><a id="__codelineno-51-66" name="__codelineno-51-66" href="#__codelineno-51-66"></a><span class="w">            </span><span class="nx">setYear</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-51-67"><a id="__codelineno-51-67" name="__codelineno-51-67" href="#__codelineno-51-67"></a><span class="w">            </span><span class="nx">rotatePie</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</span><span id="__span-51-68"><a id="__codelineno-51-68" name="__codelineno-51-68" href="#__codelineno-51-68"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-51-69"><a id="__codelineno-51-69" name="__codelineno-51-69" href="#__codelineno-51-69"></a><span class="p">};</span>
</span></code></pre></div>
<h4 id="overlay-text">Overlay Text</h4>
<p><code>overlay_text.js</code> handles the creation of text and links in the SVG through D3JS. The code defines the <code>createTxt</code> function then calls that with different text and URLs.</p>
<p><em>overlay_text.js</em></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createOverlayText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">    </span><span class="nx">createdBy</span><span class="p">();</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="p">};</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">createdBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">xPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span><span class="w"> </span><span class="c1">// 10px from the left edge</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">createTxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">ySub</span><span class="p">,</span><span class="w"> </span><span class="nx">txt</span><span class="p">,</span><span class="w"> </span><span class="nx">lnk_txt</span><span class="p">,</span><span class="w"> </span><span class="nx">lnk</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">yPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ySub</span><span class="p">;</span><span class="w"> </span><span class="c1">// 10px from the bottom edge</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">        </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"text"</span><span class="p">)</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"14px"</span><span class="p">)</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nx">xPos</span><span class="p">)</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nx">yPos</span><span class="p">)</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span><span class="w"> </span><span class="s2">"overlay-text"</span><span class="p">)</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="w">            </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">txt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">" "</span><span class="p">)</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="w">            </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"xlink:href"</span><span class="p">,</span><span class="w"> </span><span class="nx">lnk</span><span class="p">)</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"target"</span><span class="p">,</span><span class="w"> </span><span class="s2">"_blank"</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="w">            </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="nx">OVERLAY_TEXT_LINK_COLOR</span><span class="p">)</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"14px"</span><span class="p">)</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="w">            </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">lnk_txt</span><span class="p">);</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="w">    </span><span class="nx">createTxt</span><span class="p">(</span><span class="mf">50</span><span class="p">,</span><span class="w"> </span><span class="s2">"Created by"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Adam Stone"</span><span class="p">,</span><span class="w"> </span><span class="s2">"https://fabacademy.org/2023/labs/charlotte/students/adam-stone/"</span><span class="p">)</span>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="w">    </span><span class="c1">//createTxt(50, "To join the Mattermost channel", "click here", "https://chat.academany.org/fabacademy-2023/channels/fab-academy-data-viz");</span>
</span><span id="__span-52-26"><a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="w">    </span><span class="nx">createTxt</span><span class="p">(</span><span class="mf">35</span><span class="p">,</span><span class="w"> </span><span class="s2">"For documentation"</span><span class="p">,</span><span class="w"> </span><span class="s2">"click here"</span><span class="p">,</span><span class="w"> </span><span class="s2">"https://gitlab.fabcloud.org/pub/project/expert-network-map/-/blob/main/documentation.md"</span><span class="p">)</span>
</span><span id="__span-52-27"><a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="w">    </span><span class="nx">createTxt</span><span class="p">(</span><span class="mf">20</span><span class="p">,</span><span class="w"> </span><span class="s2">"Took inspiration from"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Nadieh Bremer"</span><span class="p">,</span><span class="w"> </span><span class="s2">"https://royalconstellations.visualcinnamon.com/"</span><span class="p">)</span>
</span><span id="__span-52-28"><a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="w">    </span><span class="nx">createTxt</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">"Recieved guidance and support from"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Francisco Sanchez"</span><span class="p">,</span><span class="w"> </span><span class="s2">"https://www.fablabs.io/users/francisco"</span><span class="p">)</span>
</span><span id="__span-52-29"><a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a>
</span><span id="__span-52-30"><a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a><span class="w">    </span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"text"</span><span class="p">)</span>
</span><span id="__span-52-31"><a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"30px"</span><span class="p">)</span>
</span><span id="__span-52-32"><a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-52-33"><a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span>
</span><span id="__span-52-34"><a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"text-anchor"</span><span class="p">,</span><span class="w"> </span><span class="s2">"middle"</span><span class="p">)</span>
</span><span id="__span-52-35"><a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"class"</span><span class="p">,</span><span class="w"> </span><span class="s2">"overlay-text"</span><span class="p">)</span>
</span><span id="__span-52-36"><a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span>
</span><span id="__span-52-37"><a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a><span class="w">        </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Join the Mattermost Channel "</span><span class="p">)</span>
</span><span id="__span-52-38"><a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="w">        </span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
</span><span id="__span-52-39"><a id="__codelineno-52-39" name="__codelineno-52-39" href="#__codelineno-52-39"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"xlink:href"</span><span class="p">,</span><span class="w"> </span><span class="s2">"https://chat.academany.org/fabacademy-2023/channels/fab-academy-data-viz"</span><span class="p">)</span>
</span><span id="__span-52-40"><a id="__codelineno-52-40" name="__codelineno-52-40" href="#__codelineno-52-40"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"target"</span><span class="p">,</span><span class="w"> </span><span class="s2">"_blank"</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-52-41"><a id="__codelineno-52-41" name="__codelineno-52-41" href="#__codelineno-52-41"></a><span class="w">        </span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="nx">OVERLAY_TEXT_LINK_COLOR</span><span class="p">)</span>
</span><span id="__span-52-42"><a id="__codelineno-52-42" name="__codelineno-52-42" href="#__codelineno-52-42"></a><span class="w">        </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"30px"</span><span class="p">)</span>
</span><span id="__span-52-43"><a id="__codelineno-52-43" name="__codelineno-52-43" href="#__codelineno-52-43"></a><span class="w">        </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Here"</span><span class="p">);</span>
</span><span id="__span-52-44"><a id="__codelineno-52-44" name="__codelineno-52-44" href="#__codelineno-52-44"></a><span class="p">};</span>
</span></code></pre></div>
<h4 id="other-files-minification-and-google-analytics">Other Files, Minification, and Google Analytics</h4>
<p>I downloaded <a href="https://d3js.org/d3.v7.min.js">D3JS minified</a>, <a href="https://unpkg.com/d3-force-boundary@0.0.1/dist/d3-force-boundary.min.js">D3JS force boundary library minified</a>, and <a href="http://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">jQuery minified</a> in the <code>d3js_download.js</code>, <code>force_boundary_downoad.js</code>, and <code>jquery_download.js</code> files respectively to increase performance where three extra HTTP requests to not have to be sent before the content loads.</p>
<p>I also combined the code for all of the different JavaScript files into one file, <code>combined.js</code>, and minified it using <a href="https://www.toptal.com/developers/javascript-minifier">Toptal JavaScript Minifier</a>. This maximizes performance by reducing initial loading time. I pasted files into the minifier in the order they are linked in an older version of the HTML below.</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"vars.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"lab_region.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"update_data.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"helper_functions.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"constants.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"carousel.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"dial.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"multiselect_dropdown.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"overlay_text.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"app.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>Finally, I use <a href="https://analytics.google.com/analytics/web/">Google Analytics</a> to measure traffic on the site and measure usage.</p>
<h4 id="html">HTML</h4>
<p>Since the website is a static webpage, I only use one HTML file, <code>index.html</code>. </p>
<p><em>index.html</em></p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"icon"</span> <span class="na">type</span><span class="o">=</span><span class="s">"image/x-icon"</span> <span class="na">href</span><span class="o">=</span><span class="s">"./img/favicon/favicon.ico"</span><span class="p">&gt;</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="p">&gt;</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="na">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="p">&gt;</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Expert Network Map<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">"style.css"</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span><span class="p">&gt;</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://fonts.googleapis.com/css?family=Saira:100,200,300,400,500,600,700,800,900"</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span><span class="p">&gt;</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span> <span class="na">src</span><span class="o">=</span><span class="s">"jquery_download.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"d3js_download.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"force_boundary_download.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"combined.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a>    <span class="cm">&lt;!-- Google tag (gtag.js) --&gt;</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">async</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://www.googletagmanager.com/gtag/js?id=G-GJZ579DNTW"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a>    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="w">        </span><span class="kd">function</span><span class="w"> </span><span class="nx">gtag</span><span class="p">(){</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);}</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a><span class="w">        </span><span class="nx">gtag</span><span class="p">(</span><span class="s1">'js'</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">());</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a><span class="w">        </span><span class="nx">gtag</span><span class="p">(</span><span class="s1">'config'</span><span class="p">,</span><span class="w"> </span><span class="s1">'G-GJZ579DNTW'</span><span class="p">);</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a>
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a><span class="p">&lt;</span><span class="nt">body</span> <span class="na">id</span><span class="o">=</span><span class="s">"my_dataviz"</span><span class="p">&gt;</span>
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"tooltip"</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"top-intro"</span><span class="p">&gt;</span>
</span><span id="__span-54-29"><a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"top-title"</span><span class="p">&gt;</span>Expert Network Map<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-30"><a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"intro-title"</span><span class="p">&gt;</span>
</span><span id="__span-54-31"><a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a>            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"top-subtitle"</span><span class="p">&gt;</span>Six generations of Fab Academy students intertwined<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-32"><a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a>            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"top-blurb"</span><span class="p">&gt;</span>
</span><span id="__span-54-33"><a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a>                <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Seek Out <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Topic Experts<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span><span id="__span-54-34"><a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a>                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>The <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Expert Network Map<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> allows users to visually identify <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Topic Experts<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> in the Fab community. <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Topic Experts<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> are Fab Academy students who are frequently referenced by peers. Fab Academy students often link each other's websites in their documentation, and mapping these connections creates a network intertwined across labs, years, and countries. The more times a student is referenced correlates with expertise level in specific subject areas. For current Fab Academy students, it can be extremely helpful to quickly identify <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Topic Experts<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> to access their documentation for reference. Interacting with the Map can determine <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Topic Experts<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> by year and specific labs. Once <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Topic Experts<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> are found, clicking on their circle redirects the user to their Fab Academy Documentation Website.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-54-35"><a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a>            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-36"><a id="__codelineno-54-36" name="__codelineno-54-36" href="#__codelineno-54-36"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-37"><a id="__codelineno-54-37" name="__codelineno-54-37" href="#__codelineno-54-37"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"intro-text"</span><span class="p">&gt;</span>
</span><span id="__span-54-38"><a id="__codelineno-54-38" name="__codelineno-54-38" href="#__codelineno-54-38"></a>            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"top-explanation"</span><span class="p">&gt;</span>
</span><span id="__span-54-39"><a id="__codelineno-54-39" name="__codelineno-54-39" href="#__codelineno-54-39"></a>                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>The <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Expert Network Map<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> allows users to navigate the massive web of interconnected students and highlights <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Topics Experts<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span> dating back to 2018. Each Fab Academy student is represented by a circle. Drag around different students to play with the data and gain insight into the interconnectedness of the Fab community.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-54-40"><a id="__codelineno-54-40" name="__codelineno-54-40" href="#__codelineno-54-40"></a>                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>The larger a student's circle, the more times they have been referenced. Hover over a circle to see the student's name, year, lab, and region, and click on it to open their documentation website. Click the tabs on the left to filter by topic area; click different years on the bottom left circle to highlight students from that year; use the dropdown on the top right to highlight students from certain Fab Labs; and use the dial on the bottom right to set a minimum number of references that a student must have, changing the <span class="p">&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Expertise Threshold<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-54-41"><a id="__codelineno-54-41" name="__codelineno-54-41" href="#__codelineno-54-41"></a>            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-42"><a id="__codelineno-54-42" name="__codelineno-54-42" href="#__codelineno-54-42"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-43"><a id="__codelineno-54-43" name="__codelineno-54-43" href="#__codelineno-54-43"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-44"><a id="__codelineno-54-44" name="__codelineno-54-44" href="#__codelineno-54-44"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">"width:100%;position:relative;"</span><span class="p">&gt;</span>
</span><span id="__span-54-45"><a id="__codelineno-54-45" name="__codelineno-54-45" href="#__codelineno-54-45"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">"background: white; position: absolute; right: 10px; top: 10px; display: inline-block;"</span> <span class="na">class</span><span class="o">=</span><span class="s">"multiselect"</span> <span class="na">id</span><span class="o">=</span><span class="s">"countries"</span> <span class="na">multiple</span><span class="o">=</span><span class="s">"multiple"</span> <span class="na">data-target</span><span class="o">=</span><span class="s">"multi-0"</span><span class="p">&gt;</span>
</span><span id="__span-54-46"><a id="__codelineno-54-46" name="__codelineno-54-46" href="#__codelineno-54-46"></a>            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"title noselect"</span><span class="p">&gt;</span>
</span><span id="__span-54-47"><a id="__codelineno-54-47" name="__codelineno-54-47" href="#__codelineno-54-47"></a>                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"text"</span><span class="p">&gt;</span>Filter Labs<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span><span id="__span-54-48"><a id="__codelineno-54-48" name="__codelineno-54-48" href="#__codelineno-54-48"></a>                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"close-icon"</span><span class="p">&gt;</span><span class="ni">&amp;times;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span><span id="__span-54-49"><a id="__codelineno-54-49" name="__codelineno-54-49" href="#__codelineno-54-49"></a>                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"expand-icon"</span><span class="p">&gt;</span><span class="ni">&amp;plus;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span><span id="__span-54-50"><a id="__codelineno-54-50" name="__codelineno-54-50" href="#__codelineno-54-50"></a>            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-51"><a id="__codelineno-54-51" name="__codelineno-54-51" href="#__codelineno-54-51"></a>            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"container"</span><span class="p">&gt;</span>
</span><span id="__span-54-52"><a id="__codelineno-54-52" name="__codelineno-54-52" href="#__codelineno-54-52"></a>            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-53"><a id="__codelineno-54-53" name="__codelineno-54-53" href="#__codelineno-54-53"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-54"><a id="__codelineno-54-54" name="__codelineno-54-54" href="#__codelineno-54-54"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-54-55"><a id="__codelineno-54-55" name="__codelineno-54-55" href="#__codelineno-54-55"></a>    <span class="p">&lt;</span><span class="nt">svg</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">"http://www.w3.org/2000/svg"</span><span class="p">&gt;</span>
</span><span id="__span-54-56"><a id="__codelineno-54-56" name="__codelineno-54-56" href="#__codelineno-54-56"></a>        <span class="p">&lt;</span><span class="nt">defs</span><span class="p">&gt;&lt;/</span><span class="nt">defs</span><span class="p">&gt;</span>
</span><span id="__span-54-57"><a id="__codelineno-54-57" name="__codelineno-54-57" href="#__codelineno-54-57"></a>    <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
</span><span id="__span-54-58"><a id="__codelineno-54-58" name="__codelineno-54-58" href="#__codelineno-54-58"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-54-59"><a id="__codelineno-54-59" name="__codelineno-54-59" href="#__codelineno-54-59"></a>
</span><span id="__span-54-60"><a id="__codelineno-54-60" name="__codelineno-54-60" href="#__codelineno-54-60"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div>
<h4 id="css">CSS</h4>
<p>All styles not created through D3JS are located in <code>style.css</code>. This includes background color, orienting description text, etc.</p>
<p><em>styles.css</em></p>
<div class="language-css highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="p">:</span><span class="nd">root</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="nv">--tooltip-background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">    </span><span class="nv">--node-stroke</span><span class="p">:</span><span class="w"> </span><span class="mh">#000</span><span class="p">;</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">    </span><span class="nv">--top-title-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#393836</span><span class="p">;</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">    </span><span class="nv">--top-subtitle-color</span><span class="p">:</span><span class="w"> </span><span class="kc">grey</span><span class="p">;</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">    </span><span class="nv">--top-blurb-h3-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#595754</span><span class="p">;</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="nv">--body-background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">    </span><span class="nv">--overlay-text-color</span><span class="p">:</span><span class="w"> </span><span class="kc">black</span><span class="p">;</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="p">}</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="p">#</span><span class="nn">tooltip</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--tooltip-background-color</span><span class="p">);</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">black</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="w">    </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="w">    </span><span class="k">visibility</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-19"><a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a><span class="w">    </span><span class="k">pointer-events</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-20"><a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a><span class="p">}</span>
</span><span id="__span-55-21"><a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a>
</span><span id="__span-55-22"><a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a><span class="p">#</span><span class="nn">tooltip</span><span class="w"> </span><span class="nt">span</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-23"><a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">black</span><span class="p">;</span>
</span><span id="__span-55-24"><a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">'Saira'</span><span class="p">;</span>
</span><span id="__span-55-25"><a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a><span class="p">}</span>
</span><span id="__span-55-26"><a id="__codelineno-55-26" name="__codelineno-55-26" href="#__codelineno-55-26"></a>
</span><span id="__span-55-27"><a id="__codelineno-55-27" name="__codelineno-55-27" href="#__codelineno-55-27"></a><span class="nt">html</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-28"><a id="__codelineno-55-28" name="__codelineno-55-28" href="#__codelineno-55-28"></a><span class="w">    </span><span class="n">Overflow-y</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
</span><span id="__span-55-29"><a id="__codelineno-55-29" name="__codelineno-55-29" href="#__codelineno-55-29"></a><span class="p">}</span>
</span><span id="__span-55-30"><a id="__codelineno-55-30" name="__codelineno-55-30" href="#__codelineno-55-30"></a>
</span><span id="__span-55-31"><a id="__codelineno-55-31" name="__codelineno-55-31" href="#__codelineno-55-31"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-32"><a id="__codelineno-55-32" name="__codelineno-55-32" href="#__codelineno-55-32"></a><span class="w">    </span><span class="n">Overflow-y</span><span class="p">:</span><span class="w"> </span><span class="kc">scroll</span><span class="p">;</span>
</span><span id="__span-55-33"><a id="__codelineno-55-33" name="__codelineno-55-33" href="#__codelineno-55-33"></a><span class="p">}</span>
</span><span id="__span-55-34"><a id="__codelineno-55-34" name="__codelineno-55-34" href="#__codelineno-55-34"></a>
</span><span id="__span-55-35"><a id="__codelineno-55-35" name="__codelineno-55-35" href="#__codelineno-55-35"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-36"><a id="__codelineno-55-36" name="__codelineno-55-36" href="#__codelineno-55-36"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-55-37"><a id="__codelineno-55-37" name="__codelineno-55-37" href="#__codelineno-55-37"></a><span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">fixed</span><span class="p">;</span>
</span><span id="__span-55-38"><a id="__codelineno-55-38" name="__codelineno-55-38" href="#__codelineno-55-38"></a><span class="w">    </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-55-39"><a id="__codelineno-55-39" name="__codelineno-55-39" href="#__codelineno-55-39"></a><span class="w">    </span><span class="k">right</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-55-40"><a id="__codelineno-55-40" name="__codelineno-55-40" href="#__codelineno-55-40"></a><span class="w">    </span><span class="k">bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-55-41"><a id="__codelineno-55-41" name="__codelineno-55-41" href="#__codelineno-55-41"></a><span class="w">    </span><span class="k">left</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-55-42"><a id="__codelineno-55-42" name="__codelineno-55-42" href="#__codelineno-55-42"></a><span class="p">}</span>
</span><span id="__span-55-43"><a id="__codelineno-55-43" name="__codelineno-55-43" href="#__codelineno-55-43"></a>
</span><span id="__span-55-44"><a id="__codelineno-55-44" name="__codelineno-55-44" href="#__codelineno-55-44"></a><span class="nt">circle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-45"><a id="__codelineno-55-45" name="__codelineno-55-45" href="#__codelineno-55-45"></a><span class="w">    </span><span class="k">stroke</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--node-stroke</span><span class="p">);</span>
</span><span id="__span-55-46"><a id="__codelineno-55-46" name="__codelineno-55-46" href="#__codelineno-55-46"></a><span class="w">    </span><span class="k">stroke-width</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-47"><a id="__codelineno-55-47" name="__codelineno-55-47" href="#__codelineno-55-47"></a><span class="p">}</span>
</span><span id="__span-55-48"><a id="__codelineno-55-48" name="__codelineno-55-48" href="#__codelineno-55-48"></a>
</span><span id="__span-55-49"><a id="__codelineno-55-49" name="__codelineno-55-49" href="#__codelineno-55-49"></a><span class="nt">line</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-50"><a id="__codelineno-55-50" name="__codelineno-55-50" href="#__codelineno-55-50"></a><span class="w">    </span><span class="k">stroke</span><span class="p">:</span><span class="w"> </span><span class="mh">#999</span><span class="p">;</span>
</span><span id="__span-55-51"><a id="__codelineno-55-51" name="__codelineno-55-51" href="#__codelineno-55-51"></a><span class="w">    </span><span class="k">stroke-opacity</span><span class="p">:</span><span class="w"> </span><span class="mf">0.6</span><span class="p">;</span>
</span><span id="__span-55-52"><a id="__codelineno-55-52" name="__codelineno-55-52" href="#__codelineno-55-52"></a><span class="p">}</span>
</span><span id="__span-55-53"><a id="__codelineno-55-53" name="__codelineno-55-53" href="#__codelineno-55-53"></a>
</span><span id="__span-55-54"><a id="__codelineno-55-54" name="__codelineno-55-54" href="#__codelineno-55-54"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-55"><a id="__codelineno-55-55" name="__codelineno-55-55" href="#__codelineno-55-55"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
</span><span id="__span-55-56"><a id="__codelineno-55-56" name="__codelineno-55-56" href="#__codelineno-55-56"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--body-background-color</span><span class="p">);</span>
</span><span id="__span-55-57"><a id="__codelineno-55-57" name="__codelineno-55-57" href="#__codelineno-55-57"></a><span class="p">}</span>
</span><span id="__span-55-58"><a id="__codelineno-55-58" name="__codelineno-55-58" href="#__codelineno-55-58"></a>
</span><span id="__span-55-59"><a id="__codelineno-55-59" name="__codelineno-55-59" href="#__codelineno-55-59"></a><span class="p">#</span><span class="nn">top-intro</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-60"><a id="__codelineno-55-60" name="__codelineno-55-60" href="#__codelineno-55-60"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
</span><span id="__span-55-61"><a id="__codelineno-55-61" name="__codelineno-55-61" href="#__codelineno-55-61"></a><span class="w">    </span><span class="k">padding-left</span><span class="p">:</span><span class="w"> </span><span class="mi">70</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-62"><a id="__codelineno-55-62" name="__codelineno-55-62" href="#__codelineno-55-62"></a><span class="w">    </span><span class="k">padding-right</span><span class="p">:</span><span class="w"> </span><span class="mi">70</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-63"><a id="__codelineno-55-63" name="__codelineno-55-63" href="#__codelineno-55-63"></a><span class="p">}</span>
</span><span id="__span-55-64"><a id="__codelineno-55-64" name="__codelineno-55-64" href="#__codelineno-55-64"></a>
</span><span id="__span-55-65"><a id="__codelineno-55-65" name="__codelineno-55-65" href="#__codelineno-55-65"></a><span class="p">#</span><span class="nn">top-title</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-66"><a id="__codelineno-55-66" name="__codelineno-55-66" href="#__codelineno-55-66"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">57</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-67"><a id="__codelineno-55-67" name="__codelineno-55-67" href="#__codelineno-55-67"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--top-title-color</span><span class="p">);</span>
</span><span id="__span-55-68"><a id="__codelineno-55-68" name="__codelineno-55-68" href="#__codelineno-55-68"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">'IM Fell DW Pica'</span><span class="p">,</span><span class="w"> </span><span class="kc">serif</span><span class="p">;</span>
</span><span id="__span-55-69"><a id="__codelineno-55-69" name="__codelineno-55-69" href="#__codelineno-55-69"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">-12</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-70"><a id="__codelineno-55-70" name="__codelineno-55-70" href="#__codelineno-55-70"></a><span class="w">    </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-71"><a id="__codelineno-55-71" name="__codelineno-55-71" href="#__codelineno-55-71"></a><span class="w">    </span><span class="k">margin-right</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-72"><a id="__codelineno-55-72" name="__codelineno-55-72" href="#__codelineno-55-72"></a><span class="p">}</span>
</span><span id="__span-55-73"><a id="__codelineno-55-73" name="__codelineno-55-73" href="#__codelineno-55-73"></a>
</span><span id="__span-55-74"><a id="__codelineno-55-74" name="__codelineno-55-74" href="#__codelineno-55-74"></a><span class="p">#</span><span class="nn">intro-title</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-75"><a id="__codelineno-55-75" name="__codelineno-55-75" href="#__codelineno-55-75"></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">46</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-55-76"><a id="__codelineno-55-76" name="__codelineno-55-76" href="#__codelineno-55-76"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">inline-block</span><span class="p">;</span>
</span><span id="__span-55-77"><a id="__codelineno-55-77" name="__codelineno-55-77" href="#__codelineno-55-77"></a><span class="p">}</span>
</span><span id="__span-55-78"><a id="__codelineno-55-78" name="__codelineno-55-78" href="#__codelineno-55-78"></a>
</span><span id="__span-55-79"><a id="__codelineno-55-79" name="__codelineno-55-79" href="#__codelineno-55-79"></a><span class="p">#</span><span class="nn">top-subtitle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-80"><a id="__codelineno-55-80" name="__codelineno-55-80" href="#__codelineno-55-80"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-81"><a id="__codelineno-55-81" name="__codelineno-55-81" href="#__codelineno-55-81"></a><span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">;</span>
</span><span id="__span-55-82"><a id="__codelineno-55-82" name="__codelineno-55-82" href="#__codelineno-55-82"></a><span class="w">    </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-83"><a id="__codelineno-55-83" name="__codelineno-55-83" href="#__codelineno-55-83"></a><span class="w">    </span><span class="k">line-height</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-55-84"><a id="__codelineno-55-84" name="__codelineno-55-84" href="#__codelineno-55-84"></a><span class="w">    </span><span class="k">padding-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-85"><a id="__codelineno-55-85" name="__codelineno-55-85" href="#__codelineno-55-85"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--top-subtitle-color</span><span class="p">);</span>
</span><span id="__span-55-86"><a id="__codelineno-55-86" name="__codelineno-55-86" href="#__codelineno-55-86"></a><span class="p">}</span>
</span><span id="__span-55-87"><a id="__codelineno-55-87" name="__codelineno-55-87" href="#__codelineno-55-87"></a>
</span><span id="__span-55-88"><a id="__codelineno-55-88" name="__codelineno-55-88" href="#__codelineno-55-88"></a><span class="p">#</span><span class="nn">top-blurb</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-89"><a id="__codelineno-55-89" name="__codelineno-55-89" href="#__codelineno-55-89"></a><span class="w">    </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-90"><a id="__codelineno-55-90" name="__codelineno-55-90" href="#__codelineno-55-90"></a><span class="p">}</span>
</span><span id="__span-55-91"><a id="__codelineno-55-91" name="__codelineno-55-91" href="#__codelineno-55-91"></a>
</span><span id="__span-55-92"><a id="__codelineno-55-92" name="__codelineno-55-92" href="#__codelineno-55-92"></a><span class="p">#</span><span class="nn">top-blurb</span><span class="w"> </span><span class="nt">p</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-93"><a id="__codelineno-55-93" name="__codelineno-55-93" href="#__codelineno-55-93"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-94"><a id="__codelineno-55-94" name="__codelineno-55-94" href="#__codelineno-55-94"></a><span class="w">    </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">justify</span><span class="p">;</span>
</span><span id="__span-55-95"><a id="__codelineno-55-95" name="__codelineno-55-95" href="#__codelineno-55-95"></a><span class="w">    </span><span class="k">line-height</span><span class="p">:</span><span class="w"> </span><span class="mi">155</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-55-96"><a id="__codelineno-55-96" name="__codelineno-55-96" href="#__codelineno-55-96"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#777777</span><span class="p">;</span>
</span><span id="__span-55-97"><a id="__codelineno-55-97" name="__codelineno-55-97" href="#__codelineno-55-97"></a><span class="p">}</span>
</span><span id="__span-55-98"><a id="__codelineno-55-98" name="__codelineno-55-98" href="#__codelineno-55-98"></a>
</span><span id="__span-55-99"><a id="__codelineno-55-99" name="__codelineno-55-99" href="#__codelineno-55-99"></a><span class="p">#</span><span class="nn">top-blurb</span><span class="w"> </span><span class="nt">h3</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-100"><a id="__codelineno-55-100" name="__codelineno-55-100" href="#__codelineno-55-100"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-101"><a id="__codelineno-55-101" name="__codelineno-55-101" href="#__codelineno-55-101"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--top-blurb-h3-color</span><span class="p">);</span>
</span><span id="__span-55-102"><a id="__codelineno-55-102" name="__codelineno-55-102" href="#__codelineno-55-102"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">'IM Fell DW Pica'</span><span class="p">,</span><span class="w"> </span><span class="kc">serif</span><span class="p">;</span>
</span><span id="__span-55-103"><a id="__codelineno-55-103" name="__codelineno-55-103" href="#__codelineno-55-103"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">-8</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-104"><a id="__codelineno-55-104" name="__codelineno-55-104" href="#__codelineno-55-104"></a><span class="p">}</span>
</span><span id="__span-55-105"><a id="__codelineno-55-105" name="__codelineno-55-105" href="#__codelineno-55-105"></a>
</span><span id="__span-55-106"><a id="__codelineno-55-106" name="__codelineno-55-106" href="#__codelineno-55-106"></a><span class="p">#</span><span class="nn">intro-text</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-107"><a id="__codelineno-55-107" name="__codelineno-55-107" href="#__codelineno-55-107"></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-55-108"><a id="__codelineno-55-108" name="__codelineno-55-108" href="#__codelineno-55-108"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">inline-block</span><span class="p">;</span>
</span><span id="__span-55-109"><a id="__codelineno-55-109" name="__codelineno-55-109" href="#__codelineno-55-109"></a><span class="w">    </span><span class="k">padding-left</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-110"><a id="__codelineno-55-110" name="__codelineno-55-110" href="#__codelineno-55-110"></a><span class="w">    </span><span class="k">padding-right</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-111"><a id="__codelineno-55-111" name="__codelineno-55-111" href="#__codelineno-55-111"></a><span class="w">    </span><span class="k">vertical-align</span><span class="p">:</span><span class="w"> </span><span class="kc">top</span><span class="p">;</span>
</span><span id="__span-55-112"><a id="__codelineno-55-112" name="__codelineno-55-112" href="#__codelineno-55-112"></a><span class="w">    </span><span class="k">padding-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-113"><a id="__codelineno-55-113" name="__codelineno-55-113" href="#__codelineno-55-113"></a><span class="p">}</span>
</span><span id="__span-55-114"><a id="__codelineno-55-114" name="__codelineno-55-114" href="#__codelineno-55-114"></a>
</span><span id="__span-55-115"><a id="__codelineno-55-115" name="__codelineno-55-115" href="#__codelineno-55-115"></a><span class="p">#</span><span class="nn">top-explanation</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-116"><a id="__codelineno-55-116" name="__codelineno-55-116" href="#__codelineno-55-116"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-117"><a id="__codelineno-55-117" name="__codelineno-55-117" href="#__codelineno-55-117"></a><span class="w">    </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">justify</span><span class="p">;</span>
</span><span id="__span-55-118"><a id="__codelineno-55-118" name="__codelineno-55-118" href="#__codelineno-55-118"></a><span class="p">}</span>
</span><span id="__span-55-119"><a id="__codelineno-55-119" name="__codelineno-55-119" href="#__codelineno-55-119"></a>
</span><span id="__span-55-120"><a id="__codelineno-55-120" name="__codelineno-55-120" href="#__codelineno-55-120"></a><span class="p">#</span><span class="nn">top-explanation</span><span class="w"> </span><span class="nt">p</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-121"><a id="__codelineno-55-121" name="__codelineno-55-121" href="#__codelineno-55-121"></a><span class="w">    </span><span class="k">line-height</span><span class="p">:</span><span class="w"> </span><span class="mi">160</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-55-122"><a id="__codelineno-55-122" name="__codelineno-55-122" href="#__codelineno-55-122"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#777777</span><span class="p">;</span>
</span><span id="__span-55-123"><a id="__codelineno-55-123" name="__codelineno-55-123" href="#__codelineno-55-123"></a><span class="p">}</span>
</span><span id="__span-55-124"><a id="__codelineno-55-124" name="__codelineno-55-124" href="#__codelineno-55-124"></a>
</span><span id="__span-55-125"><a id="__codelineno-55-125" name="__codelineno-55-125" href="#__codelineno-55-125"></a><span class="p">.</span><span class="nc">noselect</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-126"><a id="__codelineno-55-126" name="__codelineno-55-126" href="#__codelineno-55-126"></a><span class="w">    </span><span class="kp">-webkit-</span><span class="n">touch-callout</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-127"><a id="__codelineno-55-127" name="__codelineno-55-127" href="#__codelineno-55-127"></a><span class="w">    </span><span class="kp">-webkit-</span><span class="k">user-select</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-128"><a id="__codelineno-55-128" name="__codelineno-55-128" href="#__codelineno-55-128"></a><span class="w">    </span><span class="kp">-khtml-</span><span class="k">user-select</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-129"><a id="__codelineno-55-129" name="__codelineno-55-129" href="#__codelineno-55-129"></a><span class="w">    </span><span class="kp">-moz-</span><span class="k">user-select</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-130"><a id="__codelineno-55-130" name="__codelineno-55-130" href="#__codelineno-55-130"></a><span class="w">    </span><span class="kp">-ms-</span><span class="k">user-select</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-131"><a id="__codelineno-55-131" name="__codelineno-55-131" href="#__codelineno-55-131"></a><span class="w">    </span><span class="k">user-select</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-132"><a id="__codelineno-55-132" name="__codelineno-55-132" href="#__codelineno-55-132"></a><span class="p">}</span>
</span><span id="__span-55-133"><a id="__codelineno-55-133" name="__codelineno-55-133" href="#__codelineno-55-133"></a>
</span><span id="__span-55-134"><a id="__codelineno-55-134" name="__codelineno-55-134" href="#__codelineno-55-134"></a><span class="p">.</span><span class="nc">multiselect</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-135"><a id="__codelineno-55-135" name="__codelineno-55-135" href="#__codelineno-55-135"></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">170</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-136"><a id="__codelineno-55-136" name="__codelineno-55-136" href="#__codelineno-55-136"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-137"><a id="__codelineno-55-137" name="__codelineno-55-137" href="#__codelineno-55-137"></a><span class="w">    </span><span class="k">padding-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-138"><a id="__codelineno-55-138" name="__codelineno-55-138" href="#__codelineno-55-138"></a><span class="w">    </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-139"><a id="__codelineno-55-139" name="__codelineno-55-139" href="#__codelineno-55-139"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">);</span>
</span><span id="__span-55-140"><a id="__codelineno-55-140" name="__codelineno-55-140" href="#__codelineno-55-140"></a><span class="w">    </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="kt">s</span><span class="p">;</span>
</span><span id="__span-55-141"><a id="__codelineno-55-141" name="__codelineno-55-141" href="#__codelineno-55-141"></a><span class="w">    </span><span class="k">outline</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-142"><a id="__codelineno-55-142" name="__codelineno-55-142" href="#__codelineno-55-142"></a><span class="p">}</span>
</span><span id="__span-55-143"><a id="__codelineno-55-143" name="__codelineno-55-143" href="#__codelineno-55-143"></a>
</span><span id="__span-55-144"><a id="__codelineno-55-144" name="__codelineno-55-144" href="#__codelineno-55-144"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-145"><a id="__codelineno-55-145" name="__codelineno-55-145" href="#__codelineno-55-145"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">);</span>
</span><span id="__span-55-146"><a id="__codelineno-55-146" name="__codelineno-55-146" href="#__codelineno-55-146"></a><span class="p">}</span>
</span><span id="__span-55-147"><a id="__codelineno-55-147" name="__codelineno-55-147" href="#__codelineno-55-147"></a>
</span><span id="__span-55-148"><a id="__codelineno-55-148" name="__codelineno-55-148" href="#__codelineno-55-148"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">.</span><span class="nc">active</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-149"><a id="__codelineno-55-149" name="__codelineno-55-149" href="#__codelineno-55-149"></a><span class="w">    </span><span class="k">border-bottom-left-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-150"><a id="__codelineno-55-150" name="__codelineno-55-150" href="#__codelineno-55-150"></a><span class="w">    </span><span class="k">border-bottom-right-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-151"><a id="__codelineno-55-151" name="__codelineno-55-151" href="#__codelineno-55-151"></a><span class="w">    </span><span class="k">border-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="kc">transparent</span><span class="p">;</span>
</span><span id="__span-55-152"><a id="__codelineno-55-152" name="__codelineno-55-152" href="#__codelineno-55-152"></a><span class="p">}</span>
</span><span id="__span-55-153"><a id="__codelineno-55-153" name="__codelineno-55-153" href="#__codelineno-55-153"></a>
</span><span id="__span-55-154"><a id="__codelineno-55-154" name="__codelineno-55-154" href="#__codelineno-55-154"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-155"><a id="__codelineno-55-155" name="__codelineno-55-155" href="#__codelineno-55-155"></a><span class="w">    </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
</span><span id="__span-55-156"><a id="__codelineno-55-156" name="__codelineno-55-156" href="#__codelineno-55-156"></a><span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-157"><a id="__codelineno-55-157" name="__codelineno-55-157" href="#__codelineno-55-157"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-158"><a id="__codelineno-55-158" name="__codelineno-55-158" href="#__codelineno-55-158"></a><span class="p">}</span>
</span><span id="__span-55-159"><a id="__codelineno-55-159" name="__codelineno-55-159" href="#__codelineno-55-159"></a>
</span><span id="__span-55-160"><a id="__codelineno-55-160" name="__codelineno-55-160" href="#__codelineno-55-160"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">text</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-161"><a id="__codelineno-55-161" name="__codelineno-55-161" href="#__codelineno-55-161"></a><span class="w">    </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">130</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-162"><a id="__codelineno-55-162" name="__codelineno-55-162" href="#__codelineno-55-162"></a><span class="w">    </span><span class="k">max-height</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-163"><a id="__codelineno-55-163" name="__codelineno-55-163" href="#__codelineno-55-163"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
</span><span id="__span-55-164"><a id="__codelineno-55-164" name="__codelineno-55-164" href="#__codelineno-55-164"></a><span class="w">    </span><span class="k">float</span><span class="p">:</span><span class="w"> </span><span class="kc">left</span><span class="p">;</span>
</span><span id="__span-55-165"><a id="__codelineno-55-165" name="__codelineno-55-165" href="#__codelineno-55-165"></a><span class="w">    </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">hidden</span><span class="p">;</span>
</span><span id="__span-55-166"><a id="__codelineno-55-166" name="__codelineno-55-166" href="#__codelineno-55-166"></a><span class="w">    </span><span class="k">line-height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.3</span><span class="kt">em</span><span class="p">;</span>
</span><span id="__span-55-167"><a id="__codelineno-55-167" name="__codelineno-55-167" href="#__codelineno-55-167"></a><span class="p">}</span>
</span><span id="__span-55-168"><a id="__codelineno-55-168" name="__codelineno-55-168" href="#__codelineno-55-168"></a>
</span><span id="__span-55-169"><a id="__codelineno-55-169" name="__codelineno-55-169" href="#__codelineno-55-169"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">expand-icon</span><span class="o">,</span>
</span><span id="__span-55-170"><a id="__codelineno-55-170" name="__codelineno-55-170" href="#__codelineno-55-170"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">close-icon</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-171"><a id="__codelineno-55-171" name="__codelineno-55-171" href="#__codelineno-55-171"></a><span class="w">    </span><span class="k">float</span><span class="p">:</span><span class="w"> </span><span class="kc">right</span><span class="p">;</span>
</span><span id="__span-55-172"><a id="__codelineno-55-172" name="__codelineno-55-172" href="#__codelineno-55-172"></a><span class="w">    </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
</span><span id="__span-55-173"><a id="__codelineno-55-173" name="__codelineno-55-173" href="#__codelineno-55-173"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-174"><a id="__codelineno-55-174" name="__codelineno-55-174" href="#__codelineno-55-174"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">);</span>
</span><span id="__span-55-175"><a id="__codelineno-55-175" name="__codelineno-55-175" href="#__codelineno-55-175"></a><span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="mi">700</span><span class="p">;</span>
</span><span id="__span-55-176"><a id="__codelineno-55-176" name="__codelineno-55-176" href="#__codelineno-55-176"></a><span class="w">    </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="kt">s</span><span class="p">;</span>
</span><span id="__span-55-177"><a id="__codelineno-55-177" name="__codelineno-55-177" href="#__codelineno-55-177"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-178"><a id="__codelineno-55-178" name="__codelineno-55-178" href="#__codelineno-55-178"></a><span class="p">}</span>
</span><span id="__span-55-179"><a id="__codelineno-55-179" name="__codelineno-55-179" href="#__codelineno-55-179"></a>
</span><span id="__span-55-180"><a id="__codelineno-55-180" name="__codelineno-55-180" href="#__codelineno-55-180"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">.</span><span class="nc">selection</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">expand-icon</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-181"><a id="__codelineno-55-181" name="__codelineno-55-181" href="#__codelineno-55-181"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-182"><a id="__codelineno-55-182" name="__codelineno-55-182" href="#__codelineno-55-182"></a><span class="p">}</span>
</span><span id="__span-55-183"><a id="__codelineno-55-183" name="__codelineno-55-183" href="#__codelineno-55-183"></a>
</span><span id="__span-55-184"><a id="__codelineno-55-184" name="__codelineno-55-184" href="#__codelineno-55-184"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">.</span><span class="nc">selection</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">expand-icon</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-185"><a id="__codelineno-55-185" name="__codelineno-55-185" href="#__codelineno-55-185"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">);</span>
</span><span id="__span-55-186"><a id="__codelineno-55-186" name="__codelineno-55-186" href="#__codelineno-55-186"></a><span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">203</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
</span><span id="__span-55-187"><a id="__codelineno-55-187" name="__codelineno-55-187" href="#__codelineno-55-187"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
</span><span id="__span-55-188"><a id="__codelineno-55-188" name="__codelineno-55-188" href="#__codelineno-55-188"></a><span class="p">}</span>
</span><span id="__span-55-189"><a id="__codelineno-55-189" name="__codelineno-55-189" href="#__codelineno-55-189"></a>
</span><span id="__span-55-190"><a id="__codelineno-55-190" name="__codelineno-55-190" href="#__codelineno-55-190"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">expand-icon</span><span class="o">,</span>
</span><span id="__span-55-191"><a id="__codelineno-55-191" name="__codelineno-55-191" href="#__codelineno-55-191"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">.</span><span class="nc">selection</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">close-icon</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-192"><a id="__codelineno-55-192" name="__codelineno-55-192" href="#__codelineno-55-192"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
</span><span id="__span-55-193"><a id="__codelineno-55-193" name="__codelineno-55-193" href="#__codelineno-55-193"></a><span class="p">}</span>
</span><span id="__span-55-194"><a id="__codelineno-55-194" name="__codelineno-55-194" href="#__codelineno-55-194"></a>
</span><span id="__span-55-195"><a id="__codelineno-55-195" name="__codelineno-55-195" href="#__codelineno-55-195"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">title</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">close-icon</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-196"><a id="__codelineno-55-196" name="__codelineno-55-196" href="#__codelineno-55-196"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">);</span>
</span><span id="__span-55-197"><a id="__codelineno-55-197" name="__codelineno-55-197" href="#__codelineno-55-197"></a><span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">203</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
</span><span id="__span-55-198"><a id="__codelineno-55-198" name="__codelineno-55-198" href="#__codelineno-55-198"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
</span><span id="__span-55-199"><a id="__codelineno-55-199" name="__codelineno-55-199" href="#__codelineno-55-199"></a><span class="p">}</span>
</span><span id="__span-55-200"><a id="__codelineno-55-200" name="__codelineno-55-200" href="#__codelineno-55-200"></a>
</span><span id="__span-55-201"><a id="__codelineno-55-201" name="__codelineno-55-201" href="#__codelineno-55-201"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-202"><a id="__codelineno-55-202" name="__codelineno-55-202" href="#__codelineno-55-202"></a><span class="w">    </span><span class="k">max-height</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-203"><a id="__codelineno-55-203" name="__codelineno-55-203" href="#__codelineno-55-203"></a><span class="w">    </span><span class="k">overflow</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
</span><span id="__span-55-204"><a id="__codelineno-55-204" name="__codelineno-55-204" href="#__codelineno-55-204"></a><span class="w">    </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-205"><a id="__codelineno-55-205" name="__codelineno-55-205" href="#__codelineno-55-205"></a><span class="w">    </span><span class="k">margin-left</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-206"><a id="__codelineno-55-206" name="__codelineno-55-206" href="#__codelineno-55-206"></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">170</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-207"><a id="__codelineno-55-207" name="__codelineno-55-207" href="#__codelineno-55-207"></a><span class="w">    </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="kt">s</span><span class="p">;</span>
</span><span id="__span-55-208"><a id="__codelineno-55-208" name="__codelineno-55-208" href="#__codelineno-55-208"></a><span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
</span><span id="__span-55-209"><a id="__codelineno-55-209" name="__codelineno-55-209" href="#__codelineno-55-209"></a><span class="w">    </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">;</span>
</span><span id="__span-55-210"><a id="__codelineno-55-210" name="__codelineno-55-210" href="#__codelineno-55-210"></a><span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
</span><span id="__span-55-211"><a id="__codelineno-55-211" name="__codelineno-55-211" href="#__codelineno-55-211"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="kc">transparent</span><span class="p">;</span>
</span><span id="__span-55-212"><a id="__codelineno-55-212" name="__codelineno-55-212" href="#__codelineno-55-212"></a><span class="w">    </span><span class="k">border-top</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">);</span>
</span><span id="__span-55-213"><a id="__codelineno-55-213" name="__codelineno-55-213" href="#__codelineno-55-213"></a><span class="p">}</span>
</span><span id="__span-55-214"><a id="__codelineno-55-214" name="__codelineno-55-214" href="#__codelineno-55-214"></a>
</span><span id="__span-55-215"><a id="__codelineno-55-215" name="__codelineno-55-215" href="#__codelineno-55-215"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">.</span><span class="nc">active</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-216"><a id="__codelineno-55-216" name="__codelineno-55-216" href="#__codelineno-55-216"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">);</span>
</span><span id="__span-55-217"><a id="__codelineno-55-217" name="__codelineno-55-217" href="#__codelineno-55-217"></a><span class="w">    </span><span class="k">border-bottom-left-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-218"><a id="__codelineno-55-218" name="__codelineno-55-218" href="#__codelineno-55-218"></a><span class="w">    </span><span class="k">border-bottom-right-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-219"><a id="__codelineno-55-219" name="__codelineno-55-219" href="#__codelineno-55-219"></a><span class="w">    </span><span class="k">border-top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-55-220"><a id="__codelineno-55-220" name="__codelineno-55-220" href="#__codelineno-55-220"></a><span class="p">}</span>
</span><span id="__span-55-221"><a id="__codelineno-55-221" name="__codelineno-55-221" href="#__codelineno-55-221"></a>
</span><span id="__span-55-222"><a id="__codelineno-55-222" name="__codelineno-55-222" href="#__codelineno-55-222"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">:</span><span class="nd">hover</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-223"><a id="__codelineno-55-223" name="__codelineno-55-223" href="#__codelineno-55-223"></a><span class="w">    </span><span class="k">border-top-color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">);</span>
</span><span id="__span-55-224"><a id="__codelineno-55-224" name="__codelineno-55-224" href="#__codelineno-55-224"></a><span class="p">}</span>
</span><span id="__span-55-225"><a id="__codelineno-55-225" name="__codelineno-55-225" href="#__codelineno-55-225"></a>
</span><span id="__span-55-226"><a id="__codelineno-55-226" name="__codelineno-55-226" href="#__codelineno-55-226"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">.</span><span class="nc">active</span><span class="p">:</span><span class="nd">hover</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-227"><a id="__codelineno-55-227" name="__codelineno-55-227" href="#__codelineno-55-227"></a><span class="w">    </span><span class="k">border-color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">);</span>
</span><span id="__span-55-228"><a id="__codelineno-55-228" name="__codelineno-55-228" href="#__codelineno-55-228"></a><span class="p">}</span>
</span><span id="__span-55-229"><a id="__codelineno-55-229" name="__codelineno-55-229" href="#__codelineno-55-229"></a>
</span><span id="__span-55-230"><a id="__codelineno-55-230" name="__codelineno-55-230" href="#__codelineno-55-230"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="o">&gt;</span><span class="nt">option</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-231"><a id="__codelineno-55-231" name="__codelineno-55-231" href="#__codelineno-55-231"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-232"><a id="__codelineno-55-232" name="__codelineno-55-232" href="#__codelineno-55-232"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-233"><a id="__codelineno-55-233" name="__codelineno-55-233" href="#__codelineno-55-233"></a><span class="w">    </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
</span><span id="__span-55-234"><a id="__codelineno-55-234" name="__codelineno-55-234" href="#__codelineno-55-234"></a><span class="w">    </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="kt">s</span><span class="p">;</span>
</span><span id="__span-55-235"><a id="__codelineno-55-235" name="__codelineno-55-235" href="#__codelineno-55-235"></a><span class="w">    </span><span class="k">border-top</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="kc">transparent</span><span class="p">;</span>
</span><span id="__span-55-236"><a id="__codelineno-55-236" name="__codelineno-55-236" href="#__codelineno-55-236"></a><span class="w">    </span><span class="k">border-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="kc">transparent</span><span class="p">;</span>
</span><span id="__span-55-237"><a id="__codelineno-55-237" name="__codelineno-55-237" href="#__codelineno-55-237"></a><span class="p">}</span>
</span><span id="__span-55-238"><a id="__codelineno-55-238" name="__codelineno-55-238" href="#__codelineno-55-238"></a>
</span><span id="__span-55-239"><a id="__codelineno-55-239" name="__codelineno-55-239" href="#__codelineno-55-239"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="o">&gt;</span><span class="nt">option</span><span class="p">.</span><span class="nc">selected</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-240"><a id="__codelineno-55-240" name="__codelineno-55-240" href="#__codelineno-55-240"></a><span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="mi">175</span><span class="p">,</span><span class="w"> </span><span class="mi">233</span><span class="p">);</span>
</span><span id="__span-55-241"><a id="__codelineno-55-241" name="__codelineno-55-241" href="#__codelineno-55-241"></a><span class="w">    </span><span class="k">border-top</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">);</span>
</span><span id="__span-55-242"><a id="__codelineno-55-242" name="__codelineno-55-242" href="#__codelineno-55-242"></a><span class="w">    </span><span class="k">border-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">);</span>
</span><span id="__span-55-243"><a id="__codelineno-55-243" name="__codelineno-55-243" href="#__codelineno-55-243"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
</span><span id="__span-55-244"><a id="__codelineno-55-244" name="__codelineno-55-244" href="#__codelineno-55-244"></a><span class="p">}</span>
</span><span id="__span-55-245"><a id="__codelineno-55-245" name="__codelineno-55-245" href="#__codelineno-55-245"></a>
</span><span id="__span-55-246"><a id="__codelineno-55-246" name="__codelineno-55-246" href="#__codelineno-55-246"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="o">&gt;</span><span class="nt">option</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-247"><a id="__codelineno-55-247" name="__codelineno-55-247" href="#__codelineno-55-247"></a><span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">);</span>
</span><span id="__span-55-248"><a id="__codelineno-55-248" name="__codelineno-55-248" href="#__codelineno-55-248"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#000</span><span class="p">;</span>
</span><span id="__span-55-249"><a id="__codelineno-55-249" name="__codelineno-55-249" href="#__codelineno-55-249"></a><span class="p">}</span>
</span><span id="__span-55-250"><a id="__codelineno-55-250" name="__codelineno-55-250" href="#__codelineno-55-250"></a>
</span><span id="__span-55-251"><a id="__codelineno-55-251" name="__codelineno-55-251" href="#__codelineno-55-251"></a><span class="p">.</span><span class="nc">multiselect</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="o">&gt;</span><span class="nt">option</span><span class="p">.</span><span class="nc">selected</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-252"><a id="__codelineno-55-252" name="__codelineno-55-252" href="#__codelineno-55-252"></a><span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">53</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4</span><span class="p">);</span>
</span><span id="__span-55-253"><a id="__codelineno-55-253" name="__codelineno-55-253" href="#__codelineno-55-253"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#000</span><span class="p">;</span>
</span><span id="__span-55-254"><a id="__codelineno-55-254" name="__codelineno-55-254" href="#__codelineno-55-254"></a><span class="p">}</span>
</span><span id="__span-55-255"><a id="__codelineno-55-255" name="__codelineno-55-255" href="#__codelineno-55-255"></a>
</span><span id="__span-55-256"><a id="__codelineno-55-256" name="__codelineno-55-256" href="#__codelineno-55-256"></a><span class="p">.</span><span class="nc">multiselect</span><span class="p">.</span><span class="nc">active</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">container</span><span class="o">&gt;</span><span class="nt">option</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-257"><a id="__codelineno-55-257" name="__codelineno-55-257" href="#__codelineno-55-257"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
</span><span id="__span-55-258"><a id="__codelineno-55-258" name="__codelineno-55-258" href="#__codelineno-55-258"></a><span class="p">}</span>
</span><span id="__span-55-259"><a id="__codelineno-55-259" name="__codelineno-55-259" href="#__codelineno-55-259"></a>
</span><span id="__span-55-260"><a id="__codelineno-55-260" name="__codelineno-55-260" href="#__codelineno-55-260"></a><span class="nt">option</span><span class="o">[</span><span class="nt">value</span><span class="o">=</span><span class="nt">All</span><span class="o">]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-261"><a id="__codelineno-55-261" name="__codelineno-55-261" href="#__codelineno-55-261"></a><span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="kc">bold</span><span class="p">;</span>
</span><span id="__span-55-262"><a id="__codelineno-55-262" name="__codelineno-55-262" href="#__codelineno-55-262"></a><span class="p">}</span>
</span><span id="__span-55-263"><a id="__codelineno-55-263" name="__codelineno-55-263" href="#__codelineno-55-263"></a>
</span><span id="__span-55-264"><a id="__codelineno-55-264" name="__codelineno-55-264" href="#__codelineno-55-264"></a><span class="p">#</span><span class="nn">value-input</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-265"><a id="__codelineno-55-265" name="__codelineno-55-265" href="#__codelineno-55-265"></a><span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
</span><span id="__span-55-266"><a id="__codelineno-55-266" name="__codelineno-55-266" href="#__codelineno-55-266"></a><span class="w">    </span><span class="c">/*right: 120px;*/</span>
</span><span id="__span-55-267"><a id="__codelineno-55-267" name="__codelineno-55-267" href="#__codelineno-55-267"></a><span class="w">    </span><span class="c">/*top: 48%;*/</span>
</span><span id="__span-55-268"><a id="__codelineno-55-268" name="__codelineno-55-268" href="#__codelineno-55-268"></a><span class="w">    </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-55-269"><a id="__codelineno-55-269" name="__codelineno-55-269" href="#__codelineno-55-269"></a><span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-270"><a id="__codelineno-55-270" name="__codelineno-55-270" href="#__codelineno-55-270"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-271"><a id="__codelineno-55-271" name="__codelineno-55-271" href="#__codelineno-55-271"></a><span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-272"><a id="__codelineno-55-272" name="__codelineno-55-272" href="#__codelineno-55-272"></a><span class="w">    </span><span class="k">outline</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
</span><span id="__span-55-273"><a id="__codelineno-55-273" name="__codelineno-55-273" href="#__codelineno-55-273"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-55-274"><a id="__codelineno-55-274" name="__codelineno-55-274" href="#__codelineno-55-274"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
</span><span id="__span-55-275"><a id="__codelineno-55-275" name="__codelineno-55-275" href="#__codelineno-55-275"></a><span class="p">}</span>
</span><span id="__span-55-276"><a id="__codelineno-55-276" name="__codelineno-55-276" href="#__codelineno-55-276"></a>
</span><span id="__span-55-277"><a id="__codelineno-55-277" name="__codelineno-55-277" href="#__codelineno-55-277"></a><span class="p">.</span><span class="nc">overlay-text</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-278"><a id="__codelineno-55-278" name="__codelineno-55-278" href="#__codelineno-55-278"></a><span class="w">    </span><span class="k">fill</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--overlay-text-color</span><span class="p">);</span>
</span><span id="__span-55-279"><a id="__codelineno-55-279" name="__codelineno-55-279" href="#__codelineno-55-279"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="n">Arial</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
</span><span id="__span-55-280"><a id="__codelineno-55-280" name="__codelineno-55-280" href="#__codelineno-55-280"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="updates">Updates</h2>
<p>Since the <a href="#introduction">initial presentation of the project in Bhutan</a>, I have updated the codebase to scrape and classify new references between student documentation every week. Throughout <a href="https://fabacademy.org/2024/">the 2024 Fab Academy cycle</a>, the map successfully evolved as new students made references to one another and to previous students in their documentation.</p>
<h3 id="high-level-overview">High-Level Overview</h3>
<p>On the <a href="https://gitlab.fabcloud.org/pub/project/expert-network-map/-/tree/pipeline_testing?ref_type=heads"><code>pipeline_testing</code> branch of the GitLab Repo</a>, at 3:00am every Wednesday, two <a href="https://gitlab.fabcloud.org/pub/project/expert-network-map/-/pipeline_schedules">Pipeline Schedules</a> are run. Below is the <code>.gitlab-ci.yml</code> file in the <code>pipeline_testing</code> branch that contains the functionality for the two pipelines. The first pipeline runs the <code>update_data</code> job, and the second pipeline runs the <code>format_data</code> job. All of the code being run in these jobs can be found in the <a href="https://gitlab.fabcloud.org/pub/project/expert-network-map/-/tree/pipeline_testing/update-data?ref_type=heads"><code>update-data</code> directory of the <code>pipeline_testing</code> branch of the repo</a>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a># Functions that should be executed before the build script is run
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>before_script: []
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>stages:
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>  - collect
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>  - format
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>  - production
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>update_data:
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>  stage: collect
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>  image: python:3.9
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>  script:
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>    - cd update-data
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>    - pip install --upgrade pip
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>    - pip install -r requirements.txt
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a>    - echo "Running update-data/main.py"
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a>    - python main.py
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a>    - cd ..
</span><span id="__span-56-19"><a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a>    - echo "Running update_data complete, now committing!"
</span><span id="__span-56-20"><a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a>    - git config --global user.email "ci-cd-bot@example.com"
</span><span id="__span-56-21"><a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a>    - git config --global user.name "CI/CD Bot"
</span><span id="__span-56-22"><a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a>    - git remote set-url origin https://oauth2:${CI_ACCESS_TOKEN}@gitlab.fabcloud.org/pub/project/expert-network-map.git
</span><span id="__span-56-23"><a id="__codelineno-56-23" name="__codelineno-56-23" href="#__codelineno-56-23"></a>    - git add update-data/final_data.csv update-data/student_repo_id_saves/*.obj
</span><span id="__span-56-24"><a id="__codelineno-56-24" name="__codelineno-56-24" href="#__codelineno-56-24"></a>    - git commit -m "update-data ran and final_data.csv updated"
</span><span id="__span-56-25"><a id="__codelineno-56-25" name="__codelineno-56-25" href="#__codelineno-56-25"></a>    - git push origin HEAD:pipeline_testing
</span><span id="__span-56-26"><a id="__codelineno-56-26" name="__codelineno-56-26" href="#__codelineno-56-26"></a>  timeout: 2 hours
</span><span id="__span-56-27"><a id="__codelineno-56-27" name="__codelineno-56-27" href="#__codelineno-56-27"></a>  rules:
</span><span id="__span-56-28"><a id="__codelineno-56-28" name="__codelineno-56-28" href="#__codelineno-56-28"></a>    - if: $TRIGGER_CONTEXT == "pipeline_test"
</span><span id="__span-56-29"><a id="__codelineno-56-29" name="__codelineno-56-29" href="#__codelineno-56-29"></a>  tags:
</span><span id="__span-56-30"><a id="__codelineno-56-30" name="__codelineno-56-30" href="#__codelineno-56-30"></a>    - longer
</span><span id="__span-56-31"><a id="__codelineno-56-31" name="__codelineno-56-31" href="#__codelineno-56-31"></a>
</span><span id="__span-56-32"><a id="__codelineno-56-32" name="__codelineno-56-32" href="#__codelineno-56-32"></a>format_data:
</span><span id="__span-56-33"><a id="__codelineno-56-33" name="__codelineno-56-33" href="#__codelineno-56-33"></a>  stage: format
</span><span id="__span-56-34"><a id="__codelineno-56-34" name="__codelineno-56-34" href="#__codelineno-56-34"></a>  image: python:3.9
</span><span id="__span-56-35"><a id="__codelineno-56-35" name="__codelineno-56-35" href="#__codelineno-56-35"></a>  script:
</span><span id="__span-56-36"><a id="__codelineno-56-36" name="__codelineno-56-36" href="#__codelineno-56-36"></a>    - cd update-data
</span><span id="__span-56-37"><a id="__codelineno-56-37" name="__codelineno-56-37" href="#__codelineno-56-37"></a>    - pip install --upgrade pip
</span><span id="__span-56-38"><a id="__codelineno-56-38" name="__codelineno-56-38" href="#__codelineno-56-38"></a>    - pip install -r requirements.txt
</span><span id="__span-56-39"><a id="__codelineno-56-39" name="__codelineno-56-39" href="#__codelineno-56-39"></a>    - echo "Running update-data/matrix2d3js.py"
</span><span id="__span-56-40"><a id="__codelineno-56-40" name="__codelineno-56-40" href="#__codelineno-56-40"></a>    - python matrix2d3js.py
</span><span id="__span-56-41"><a id="__codelineno-56-41" name="__codelineno-56-41" href="#__codelineno-56-41"></a>    - echo "Running update-data/resolve_name_conflicts.py"
</span><span id="__span-56-42"><a id="__codelineno-56-42" name="__codelineno-56-42" href="#__codelineno-56-42"></a>    - python resolve_name_conflicts.py
</span><span id="__span-56-43"><a id="__codelineno-56-43" name="__codelineno-56-43" href="#__codelineno-56-43"></a>    - cat final_data_name_fixed.json &gt; ./final_data.json
</span><span id="__span-56-44"><a id="__codelineno-56-44" name="__codelineno-56-44" href="#__codelineno-56-44"></a>    - cd ..
</span><span id="__span-56-45"><a id="__codelineno-56-45" name="__codelineno-56-45" href="#__codelineno-56-45"></a>    - echo "Running format_data complete, now committing!"
</span><span id="__span-56-46"><a id="__codelineno-56-46" name="__codelineno-56-46" href="#__codelineno-56-46"></a>    - git config --global user.email "ci-cd-bot@example.com"
</span><span id="__span-56-47"><a id="__codelineno-56-47" name="__codelineno-56-47" href="#__codelineno-56-47"></a>    - git config --global user.name "CI/CD Bot"
</span><span id="__span-56-48"><a id="__codelineno-56-48" name="__codelineno-56-48" href="#__codelineno-56-48"></a>    - git remote set-url origin https://oauth2:${CI_ACCESS_TOKEN}@gitlab.fabcloud.org/pub/project/expert-network-map.git
</span><span id="__span-56-49"><a id="__codelineno-56-49" name="__codelineno-56-49" href="#__codelineno-56-49"></a>    - mv update-data/final_data.json public/final_data.json
</span><span id="__span-56-50"><a id="__codelineno-56-50" name="__codelineno-56-50" href="#__codelineno-56-50"></a>    - git add public/final_data.json
</span><span id="__span-56-51"><a id="__codelineno-56-51" name="__codelineno-56-51" href="#__codelineno-56-51"></a>    - git commit -m "format_data ran and final_data.json updated"
</span><span id="__span-56-52"><a id="__codelineno-56-52" name="__codelineno-56-52" href="#__codelineno-56-52"></a>    - git push origin HEAD:pipeline_testing
</span><span id="__span-56-53"><a id="__codelineno-56-53" name="__codelineno-56-53" href="#__codelineno-56-53"></a>    - git fetch origin main
</span><span id="__span-56-54"><a id="__codelineno-56-54" name="__codelineno-56-54" href="#__codelineno-56-54"></a>    - git stash
</span><span id="__span-56-55"><a id="__codelineno-56-55" name="__codelineno-56-55" href="#__codelineno-56-55"></a>    - git switch main
</span><span id="__span-56-56"><a id="__codelineno-56-56" name="__codelineno-56-56" href="#__codelineno-56-56"></a>    - curl https://gitlab.fabcloud.org/pub/project/expert-network-map/-/raw/pipeline_testing/public/final_data.json?ref_type=heads -o public/final_data.json
</span><span id="__span-56-57"><a id="__codelineno-56-57" name="__codelineno-56-57" href="#__codelineno-56-57"></a>    - git add public/final_data.json
</span><span id="__span-56-58"><a id="__codelineno-56-58" name="__codelineno-56-58" href="#__codelineno-56-58"></a>    - git commit -m "copied public/final_data.json from pipeline_testing branch after format_data ran"
</span><span id="__span-56-59"><a id="__codelineno-56-59" name="__codelineno-56-59" href="#__codelineno-56-59"></a>    - git push origin HEAD:main
</span><span id="__span-56-60"><a id="__codelineno-56-60" name="__codelineno-56-60" href="#__codelineno-56-60"></a>  timeout: 2 hours
</span><span id="__span-56-61"><a id="__codelineno-56-61" name="__codelineno-56-61" href="#__codelineno-56-61"></a>  rules:
</span><span id="__span-56-62"><a id="__codelineno-56-62" name="__codelineno-56-62" href="#__codelineno-56-62"></a>    - if: $TRIGGER_CONTEXT == "pipeline_test_2"
</span><span id="__span-56-63"><a id="__codelineno-56-63" name="__codelineno-56-63" href="#__codelineno-56-63"></a>  tags:
</span><span id="__span-56-64"><a id="__codelineno-56-64" name="__codelineno-56-64" href="#__codelineno-56-64"></a>    - longer 
</span><span id="__span-56-65"><a id="__codelineno-56-65" name="__codelineno-56-65" href="#__codelineno-56-65"></a>
</span><span id="__span-56-66"><a id="__codelineno-56-66" name="__codelineno-56-66" href="#__codelineno-56-66"></a>pages:
</span><span id="__span-56-67"><a id="__codelineno-56-67" name="__codelineno-56-67" href="#__codelineno-56-67"></a>  stage: production
</span><span id="__span-56-68"><a id="__codelineno-56-68" name="__codelineno-56-68" href="#__codelineno-56-68"></a>  image: busybox
</span><span id="__span-56-69"><a id="__codelineno-56-69" name="__codelineno-56-69" href="#__codelineno-56-69"></a>  script:
</span><span id="__span-56-70"><a id="__codelineno-56-70" name="__codelineno-56-70" href="#__codelineno-56-70"></a>    - echo "The site will be deployed to $CI_PAGES_URL"
</span><span id="__span-56-71"><a id="__codelineno-56-71" name="__codelineno-56-71" href="#__codelineno-56-71"></a>  artifacts:
</span><span id="__span-56-72"><a id="__codelineno-56-72" name="__codelineno-56-72" href="#__codelineno-56-72"></a>    paths:
</span><span id="__span-56-73"><a id="__codelineno-56-73" name="__codelineno-56-73" href="#__codelineno-56-73"></a>      # The folder that contains the files to be exposed at the Page URL
</span><span id="__span-56-74"><a id="__codelineno-56-74" name="__codelineno-56-74" href="#__codelineno-56-74"></a>      - public
</span><span id="__span-56-75"><a id="__codelineno-56-75" name="__codelineno-56-75" href="#__codelineno-56-75"></a>  rules:
</span><span id="__span-56-76"><a id="__codelineno-56-76" name="__codelineno-56-76" href="#__codelineno-56-76"></a>    # This ensures that only pushes to the default branch will trigger
</span><span id="__span-56-77"><a id="__codelineno-56-77" name="__codelineno-56-77" href="#__codelineno-56-77"></a>    # a pages deploy
</span><span id="__span-56-78"><a id="__codelineno-56-78" name="__codelineno-56-78" href="#__codelineno-56-78"></a>    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
</span></code></pre></div>
<h4 id="update-data_1">Update Data</h4>
<p>The <code>update_data</code> job runs <code>main.py</code>, which scrapes all of the references between student repo, classified the references using the <a href="#classifying-references">text-classification neural network</a>, then creates a commit on the <code>pipeline_testing</code> branch that stores the exported <code>.csv</code> and <code>.obj</code> files created.</p>
<h4 id="format-data">Format Data</h4>
<p>The <code>format_data</code> job then runs <code>matrix2d3js.py</code> and <code>resolve_name_conflicts.py</code>, which convert and format the <code>CSV</code> data as a <code>JSON</code>, then commits the data to the <code>main</code> and <code>pipeline_testing</code> branches. The commit on hte <code>main</code> branch then triggers the <a href="https://docs.gitlab.com/ee/user/project/pages/"><code>GitLab Pages</code></a> pipeline which automatically updates the live site with the new data.</p>
<h4 id="examples-of-automated-commits">Examples of Automated Commits</h4>
<p><a href="https://gitlab.fabcloud.org/pub/project/expert-network-map/-/commits/main">Click here to see examples of the automated commits on the <code>main</code> branch!</a></p>
<p><a href="https://gitlab.fabcloud.org/pub/project/expert-network-map/-/commits/pipeline_testing">Click here to see examples of the automated commits on the <code>pipeline_testing</code> branch!</a></p>
<h2 id="offshoot-projects">Offshoot Projects</h2>
<p><a href="https://www.cesargarciasaez.com/"><code>César García</code></a>, Technical Systems Engineer and a member of the 52-person <a href="https://mattermost.com/"><code>Mattermost</code></a> channel dedicated to the <code>Expert Network Map</code>, created the <a href="https://github.com/lahoramaker/FabRAG"><code>Fab Academy Retrieval-Augmented Generation (FabRAG)</code></a>, a AI-powered system that uses expert documentation identified by the <code>Expert Network Map</code> to help further democratize access to education in the Fab Academy network. The project enables students to talk to the AI model with text, and the AI has access to all of the expertise of the most helpful documentation websties. Here is an example of the project's usage, which pulls information from the most referenced student during <code>Moulding and Casting</code> week, <a href="https://fabacademy.org/2020/labs/leon/students/adrian-torres/week15.html"><code>Adrián Torres</code></a>:</p>
<p><img alt="Offshoot Usage Example" src="../../assets/images/stem/expert-network-map/offshoot.png"></p>
<hr>
<p><em>Updated as of November 1st, 2024</em></p></div>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.indexes", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>